(()=>{var e={587(e,t,o){var a={"./(tabs)/_layout.tsx":8889,"./(tabs)/explore.styles.ts":2699,"./(tabs)/explore.tsx":4509,"./(tabs)/explore.web.tsx":8389,"./(tabs)/profile.tsx":8415,"./(tabs)/record.tsx":5209,"./(tabs)/record.web.tsx":745,"./+not-found.tsx":8973,"./_layout.tsx":5111,"./demo.tsx":5625,"./index.tsx":5250,"./login.tsx":4101,"./onboarding/dog-basics.tsx":4674,"./onboarding/dog-personality.tsx":6183,"./signup.tsx":3764,"./trail/[id].tsx":3686,"./trails.tsx":2399};function r(e){var t=n(e);return o(t)}function n(e){if(!o.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}r.keys=function(){return Object.keys(a)},r.resolve=n,e.exports=r,r.id=587},594(e,t,o){"use strict";o.r(t),o.d(t,{DOG_SIZES:()=>a,PERSONALITY_TAGS:()=>r,RECALL_RELIABILITY_OPTIONS:()=>n});const a=["XS","S","M","L","XL"],r=["Friendly","Shy","Energetic","Calm","Social","Independent","Playful","Curious","Barky","Reactive","Easily Triggered","Gentle","Protective","Anxious","Confident","Food-Motivated","Quiet","Adventurous","Lazy","Affectionate","Dominant","Submissive","Fearful","Obedient","Stubborn","High-Prey-Drive","Leash-Pulling","Good-With-Dogs","Good-With-Kids"],n=["Poor","Fair","Good","Excellent"]},745(e,t,o){"use strict";o.r(t),o.d(t,{default:()=>L});var a=o(6665),r=o(6283),n=o(3929),i=o(3668),l=o(5648),s=o(1690),d=o(530),c=o(5009),u=o(444),f=o(6725),g=o(6773),h=o(8264),m=o(9895),y=o(9637),x=o(5259),p=o(3271),b=o(5624),j=o(2301),w=o(1168),T=o(8032),C=o(8280),S=o(7353),v=o(1047),k=o(6746),I=o(3353),B=o(9269),z=o(397);const P="recording_coordinates",R="recording_start_time",D="recording_max_elevation",F="recording_max_speed",A="recording_last_update";function L(){const{saveTrail:e,getTrailById:t}=(0,k.useTrails)(),{user:o}=(0,I.useAuth)(),i=(0,y.useLocalSearchParams)(),L=(0,y.useRouter)(),O="string"===typeof i.trailId?i.trailId:void 0,W=O?t(O):void 0,_=(0,a.useRef)(null),[V,N]=(0,a.useState)(!1),[H,M]=(0,a.useState)([]),[$,G]=(0,a.useState)(null),[U,q]=(0,a.useState)(0),[J,Y]=(0,a.useState)(null),[K,Q]=(0,a.useState)(!0),[X,Z]=(0,a.useState)(null),ee=((0,a.useRef)(new Map),(0,a.useRef)(null)),te=(0,a.useRef)(null),oe=(0,a.useRef)(null),ae=.5*f.default.get("window").height,re=280,ne=(0,a.useRef)(new c.default.Value(re)).current,[ie,le]=(0,a.useState)(!1),[se,de]=(0,a.useState)(0),[ce,ue]=(0,a.useState)(0),[fe,ge]=(0,a.useState)("0:00"),[he,me]=(0,a.useState)(0),[ye,xe]=(0,a.useState)(0),[pe,be]=(0,a.useState)(!1),[je,we]=(0,a.useState)(null),[Te,Ce]=(0,a.useState)(""),[Se,ve]=(0,a.useState)(""),[ke,Ie]=(0,a.useState)(void 0);(0,a.useEffect)(()=>{(async()=>{try{if(navigator.permissions&&navigator.permissions.query){const e=await navigator.permissions.query({name:"geolocation"});Y("granted"===e.state),e.onchange=()=>Y("granted"===e.state)}else try{await new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(()=>e(!0),()=>e(!1),{timeout:5e3})}),Y(!0)}catch(e){Y(!1)}}catch(t){console.warn("Permission check failed",t),Y(null)}finally{Q(!1),Be()}})()},[]);const Be=async()=>{try{const e=await x.default.getItem(P);if(e){const t=JSON.parse(e);M(t)}const t=await x.default.getItem(D);t&&ue(parseFloat(t));const o=await x.default.getItem(F);o&&xe(parseFloat(o));const a=await x.default.getItem(R);if(a){const e=Math.floor((Date.now()-parseInt(a))/1e3);q(e),N(!0),ze()}}catch(e){console.error("Error loading recording state:",e)}},ze=()=>{te.current||(te.current=setInterval(async()=>{try{const e=await x.default.getItem(R);if(e){const t=Math.floor((Date.now()-parseInt(e))/1e3);q(t)}}catch(e){}},1e3))},Pe=()=>{be(!1),we(null)};(0,a.useEffect)(()=>{if(U>0){const e=(0,B.calculateTotalDistance)(H)/1e3;if(e>0){const t=U/60/e,o=Math.floor(t),a=Math.round(60*(t-o));ge(`${o}:${a.toString().padStart(2,"0")}`)}}},[U,H]);const Re=(0,a.useRef)(0),De=(0,a.useRef)(u.default.create({onStartShouldSetPanResponder:()=>!0,onMoveShouldSetPanResponder:(e,t)=>Math.abs(t.dy)>5,onPanResponderGrant:()=>{Re.current=ne._value},onPanResponderMove:(e,t)=>{const o=Re.current-t.dy;o>=re&&o<=ae&&ne.setValue(o)},onPanResponderRelease:(e,t)=>{const o=(ae+re)/2,a=ne._value;t.dy<-50?Fe():t.dy>50?Ae():a>o?Fe():Ae()}})).current,Fe=()=>{le(!0),c.default.spring(ne,{toValue:ae,useNativeDriver:!1,tension:50,friction:8}).start()},Ae=()=>{le(!1),c.default.spring(ne,{toValue:re,useNativeDriver:!1,tension:50,friction:8}).start()};if(K)return(0,z.jsxs)(n.default,{style:E.loadingContainer,children:[(0,z.jsx)(d.default,{size:"large",color:"#5d6b4a"}),(0,z.jsx)(r.default,{style:E.loadingText,children:"Checking permissions..."})]});if(!J)return(0,z.jsxs)(n.default,{style:E.permissionContainer,children:[(0,z.jsx)(w.default,{size:64,color:"#666"}),(0,z.jsx)(r.default,{style:E.permissionTitle,children:"Location Permission Required"}),(0,z.jsx)(r.default,{style:E.permissionText,children:"This page needs access to your location to track your walks. Please allow location access in your browser."}),(0,z.jsx)(l.default,{style:E.permissionButton,onPress:()=>{navigator.geolocation.getCurrentPosition(()=>Y(!0),()=>Y(!1))},children:(0,z.jsx)(r.default,{style:E.permissionButtonText,children:"Grant Permission"})})]});const Le=(0,B.calculateTotalDistance)(H),Ee=W&&V&&H.length>0&&W.coordinates.length>0?Math.min(Le/W.distance*100,100):0,Oe=!!W;return(0,z.jsxs)(n.default,{style:E.container,children:[$&&(0,z.jsx)(m.default,{ref:_,coordinates:H,style:E.map,initialRegion:{latitude:$.latitude,longitude:$.longitude,latitudeDelta:.01,longitudeDelta:.01},showsUserLocation:!0,followsUserLocation:V,showsMyLocationButton:!1}),(0,z.jsx)(l.default,{style:E.recenterButton,onPress:async()=>{if(_.current)try{navigator.geolocation.getCurrentPosition(e=>{const t={latitude:e.coords.latitude,longitude:e.coords.longitude};G(t),_.current.animateToRegion({latitude:t.latitude,longitude:t.longitude,latitudeDelta:.01,longitudeDelta:.01},500)})}catch(e){console.error("Error getting current location:",e)}},activeOpacity:.8,children:(0,z.jsx)(T.default,{size:24,color:"#5d6b4a"})}),(0,z.jsxs)(c.default.View,{style:[E.bottomSheet,{height:c.default.add(ne,92),bottom:0}],children:[(0,z.jsx)(n.default,Object.assign({},De.panHandlers,{style:E.handleBar,children:(0,z.jsxs)(l.default,{style:E.handleContainer,onPress:()=>{ie?Ae():Fe()},activeOpacity:.7,children:[(0,z.jsx)(n.default,{style:E.handle}),ie?(0,z.jsx)(b.default,{size:20,color:"#9ca3af"}):(0,z.jsx)(j.default,{size:20,color:"#9ca3af"})]})})),(0,z.jsxs)(n.default,{style:E.bottomSheetContent,children:[(0,z.jsxs)(n.default,{style:E.statsGrid,children:[(0,z.jsxs)(n.default,{style:E.statItem,children:[(0,z.jsx)(r.default,{style:E.statItemLabel,children:"Time"}),(0,z.jsx)(r.default,{style:E.statItemValue,children:(0,B.formatDuration)(U)})]}),(0,z.jsxs)(n.default,{style:E.statItem,children:[(0,z.jsx)(r.default,{style:E.statItemLabel,children:"Distance"}),(0,z.jsx)(r.default,{style:E.statItemValue,children:(0,B.formatDistance)(Le)})]}),(0,z.jsxs)(n.default,{style:E.statItem,children:[(0,z.jsx)(r.default,{style:E.statItemLabel,children:"Elevation"}),(0,z.jsxs)(r.default,{style:E.statItemValue,children:[se.toFixed(0),"m"]})]}),(0,z.jsxs)(n.default,{style:E.statItem,children:[(0,z.jsx)(r.default,{style:E.statItemLabel,children:"Pace"}),(0,z.jsxs)(r.default,{style:E.statItemValue,children:[fe,"/km"]})]}),(0,z.jsxs)(n.default,{style:E.statItem,children:[(0,z.jsx)(r.default,{style:E.statItemLabel,children:"Speed"}),(0,z.jsxs)(r.default,{style:E.statItemValue,children:[he.toFixed(1)," km/h"]})]}),Oe&&(0,z.jsxs)(n.default,{style:E.statItem,children:[(0,z.jsx)(r.default,{style:E.statItemLabel,children:"Progress"}),(0,z.jsxs)(r.default,{style:E.statItemValue,children:[Ee.toFixed(0),"%"]})]})]}),(0,z.jsx)(l.default,{style:[E.recordButton,V&&E.recordButtonActive],onPress:V?async()=>{console.log("Stopping web recording...");try{null!==ee.current&&(navigator.geolocation.clearWatch(ee.current),ee.current=null),oe.current&&oe.current.release&&(await oe.current.release(),oe.current=null),te.current&&(clearInterval(te.current),te.current=null);const e=await x.default.getItem(P),t=e?JSON.parse(e):H,o=await x.default.getItem(D),a=o?parseFloat(o):ce,r=await x.default.getItem(F),n=r?parseFloat(r):ye,i=await x.default.getItem(R),l=i?Math.floor((Date.now()-parseInt(i))/1e3):U;if(!t||t.length<2)return s.default.alert("No Trail Data","Not enough data to save this trail. Try walking a bit more!"),N(!1),M([]),q(0),await x.default.removeItem(P),await x.default.removeItem(D),await x.default.removeItem(F),await x.default.removeItem(R),void await x.default.removeItem(A);const d=(0,B.calculateTotalDistance)(t),c=d/1e3;let u="0:00";if(c>0){const e=l/60/c,t=Math.floor(e);u=`${t}:${Math.round(60*(e-t)).toString().padStart(2,"0")}`}const f={id:Date.now().toString(),date:Date.now(),distance:d,duration:l,coordinates:t,city:X?.city,country:X?.country,pace:u,speed:n,maxElevation:a};we(f),Ce(f.name||""),ve(f.description||""),Ie(f.photo||void 0),be(!0)}catch(e){console.error("Stop error:",e),s.default.alert("Error","Failed to stop recording"),N(!1)}}:async()=>{console.log("Starting web recording..."),N(!0),M([]),q(0),ue(0),xe(0);try{const t=Date.now();await x.default.setItem(R,t.toString()),await x.default.removeItem(P),await x.default.removeItem(D),await x.default.removeItem(F),await x.default.removeItem(A),navigator.geolocation.getCurrentPosition(async e=>{const t={latitude:e.coords.latitude,longitude:e.coords.longitude};await x.default.setItem(P,JSON.stringify([t])),M([t]),G(t)},e=>{console.warn("Initial geolocation failed",e)},{enableHighAccuracy:!0,timeout:1e4});const o=navigator.geolocation.watchPosition(async e=>{const t={latitude:e.coords.latitude,longitude:e.coords.longitude};G(t),M(e=>{const o=[...e,t];return x.default.setItem(P,JSON.stringify(o)).catch(()=>{}),o}),await x.default.setItem(A,Date.now().toString())},e=>{console.error("watchPosition error",e)},{enableHighAccuracy:!0,maximumAge:0,timeout:1e4});ee.current=o;try{navigator.wakeLock&&navigator.wakeLock.request&&(oe.current=await navigator.wakeLock.request("screen"))}catch(e){console.warn("Wake lock request failed",e)}ze()}catch(t){console.error("Recording error:",t),s.default.alert("Error",t?.message||"Failed to start recording"),N(!1)}},activeOpacity:.8,children:V?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(S.default,{size:24,color:"#fff",fill:"#fff"}),(0,z.jsx)(r.default,{style:E.recordButtonText,children:"Stop & Save"})]}):(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(C.default,{size:24,color:"#fff",fill:"#fff"}),(0,z.jsx)(r.default,{style:E.recordButtonText,children:"Start Trail"})]})}),ie&&(0,z.jsxs)(n.default,{style:E.expandedContent,children:[(0,z.jsx)(n.default,{style:E.divider}),(0,z.jsxs)(l.default,{style:E.optionRow,onPress:()=>s.default.alert("Apple Watch","Connect your Apple Watch to sync workout data."),activeOpacity:.7,children:[(0,z.jsx)(n.default,{style:E.optionIconContainer,children:(0,z.jsx)(v.default,{size:24,color:"#5d6b4a"})}),(0,z.jsxs)(n.default,{style:E.optionTextContainer,children:[(0,z.jsx)(r.default,{style:E.optionTitle,children:"Apple Watch"}),(0,z.jsx)(r.default,{style:E.optionSubtitle,children:"Not connected"})]}),(0,z.jsx)(n.default,{style:E.optionBadge,children:(0,z.jsx)(r.default,{style:E.optionBadgeText,children:"Connect"})})]}),(0,z.jsxs)(l.default,{style:E.optionRow,onPress:()=>s.default.alert("Alerts","Configure alerts for distance milestones and pace notifications."),activeOpacity:.7,children:[(0,z.jsx)(n.default,{style:E.optionIconContainer,children:(0,z.jsx)(p.default,{size:24,color:"#5d6b4a"})}),(0,z.jsxs)(n.default,{style:E.optionTextContainer,children:[(0,z.jsx)(r.default,{style:E.optionTitle,children:"Alerts"}),(0,z.jsx)(r.default,{style:E.optionSubtitle,children:"Distance & pace notifications"})]}),(0,z.jsx)(n.default,{style:[E.optionBadge,E.optionBadgeActive],children:(0,z.jsx)(r.default,{style:[E.optionBadgeText,E.optionBadgeTextActive],children:"Active"})})]})]})]})]}),(0,z.jsx)(h.default,{visible:pe,animationType:"slide",transparent:!0,onRequestClose:Pe,children:(0,z.jsx)(n.default,{style:E.modalOverlay,children:(0,z.jsx)(n.default,{style:E.modalContainer,children:(0,z.jsxs)(n.default,{style:E.modalContent,children:[(0,z.jsx)(r.default,{style:E.modalTitle,children:"Save Trail"}),(0,z.jsx)(r.default,{style:{fontSize:14,marginTop:8},children:"Name"}),(0,z.jsx)(g.default,{placeholder:"Trail name",value:Te,onChangeText:Ce,style:E.input}),(0,z.jsx)(r.default,{style:{fontSize:14,marginTop:8},children:"Description"}),(0,z.jsx)(g.default,{placeholder:"Description",value:Se,onChangeText:ve,style:[E.input,{height:100}],multiline:!0}),(0,z.jsx)(r.default,{style:{fontSize:14,marginTop:8},children:"Photo URL (optional)"}),(0,z.jsx)(g.default,{placeholder:"Photo URL",value:ke,onChangeText:Ie,style:E.input}),(0,z.jsxs)(n.default,{style:{flexDirection:"row",gap:8,marginTop:12},children:[(0,z.jsx)(l.default,{style:E.modalButton,onPress:Pe,children:(0,z.jsx)(r.default,{style:E.modalButtonText,children:"Cancel"})}),(0,z.jsx)(l.default,{style:[E.modalButton,E.modalButtonPrimary],onPress:async()=>{if(!je)return;const t=Object.assign({},je,{name:Te||je.name||"Untitled Trail",description:Se,photo:ke});try{await e(t),be(!1),we(null),N(!1),M([]),q(0),Z(null),de(0),ue(0),ge("0:00"),me(0),xe(0),await x.default.removeItem(P),await x.default.removeItem(D),await x.default.removeItem(F),await x.default.removeItem(R),await x.default.removeItem(A);const o=t.id||null;o?L.push(`/trail/${o}`):s.default.alert("Success","Trail saved successfully!")}catch(o){console.error("Save failed",o),s.default.alert("Error","Failed to save trail")}},children:(0,z.jsx)(r.default,{style:[E.modalButtonText,{color:"#fff"}],children:"Save Trail"})})]})]})})})})]})}const E=i.default.create({container:{flex:1,backgroundColor:"#F8F7F2"},map:Object.assign({},i.default.absoluteFillObject),webContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"#F8F7F2",padding:20},webText:{marginTop:16,fontSize:16,color:"#666",textAlign:"center"},loadingContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"#F8F7F2"},loadingText:{marginTop:16,fontSize:16,color:"#666"},permissionContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"#F8F7F2",padding:32},permissionTitle:{marginTop:16,fontSize:20,fontWeight:"700",color:"#1f2937",textAlign:"center"},permissionText:{marginTop:8,fontSize:16,color:"#6b7280",textAlign:"center"},permissionButton:{marginTop:24,paddingHorizontal:32,paddingVertical:16,backgroundColor:"#5d6b4a",borderRadius:12},permissionButtonText:{fontSize:16,fontWeight:"600",color:"#fff"},statsContainer:{position:"absolute",left:20,right:20,flexDirection:"row",gap:12},statBox:{flex:1,backgroundColor:"rgba(255, 255, 255, 0.95)",borderRadius:16,padding:16,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:8,elevation:4},statLabel:{fontSize:13,color:"#6b7280",fontWeight:"500",marginBottom:4},statValue:{fontSize:24,color:"#1f2937",fontWeight:"700"},controlContainer:{position:"absolute",left:20,right:20,alignItems:"center"},recordButton:{flexDirection:"row",alignItems:"center",gap:12,paddingHorizontal:32,paddingVertical:20,backgroundColor:"#5d6b4a",borderRadius:50,shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:12,elevation:8},recordButtonActive:{backgroundColor:"#dc2626"},recordButtonText:{fontSize:18,fontWeight:"700",color:"#fff"},bottomSheet:{position:"absolute",left:0,right:0,backgroundColor:"#F8F7F2",borderTopLeftRadius:24,borderTopRightRadius:24,shadowColor:"#000",shadowOffset:{width:0,height:-4},shadowOpacity:.15,shadowRadius:16,elevation:20},handleBar:{paddingTop:12,paddingBottom:8,alignItems:"center"},handleContainer:{alignItems:"center",gap:4},handle:{width:40,height:4,backgroundColor:"#d1d5db",borderRadius:2},bottomSheetContent:{flex:1,paddingHorizontal:20,paddingBottom:92},statsGrid:{flexDirection:"row",flexWrap:"wrap",gap:12,marginBottom:20},statItem:{width:"31%",backgroundColor:"#f9fafb",borderRadius:12,padding:12,alignItems:"center"},statItemLabel:{fontSize:11,color:"#6b7280",fontWeight:"600",textTransform:"uppercase",letterSpacing:.5,marginBottom:6},statItemValue:{fontSize:18,color:"#1f2937",fontWeight:"700"},expandedContent:{marginTop:8},divider:{height:1,backgroundColor:"#e5e7eb",marginVertical:16},optionRow:{flexDirection:"row",alignItems:"center",paddingVertical:16,paddingHorizontal:16,backgroundColor:"#f9fafb",borderRadius:12,marginBottom:12},optionIconContainer:{width:48,height:48,borderRadius:24,backgroundColor:"rgba(93, 107, 74, 0.1)",alignItems:"center",justifyContent:"center",marginRight:12},optionTextContainer:{flex:1},optionTitle:{fontSize:16,fontWeight:"600",color:"#1f2937",marginBottom:2},optionSubtitle:{fontSize:13,color:"#6b7280"},optionBadge:{paddingHorizontal:12,paddingVertical:6,borderRadius:12,backgroundColor:"#e5e7eb"},optionBadgeActive:{backgroundColor:"rgba(93, 107, 74, 0.15)"},optionBadgeText:{fontSize:12,fontWeight:"600",color:"#6b7280"},optionBadgeTextActive:{color:"#5d6b4a"},recenterButton:{position:"absolute",top:60,right:20,width:48,height:48,borderRadius:24,backgroundColor:"#ffffff",alignItems:"center",justifyContent:"center",shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.15,shadowRadius:8,elevation:4},modalOverlay:{flex:1,backgroundColor:"rgba(0,0,0,0.4)",justifyContent:"center",alignItems:"center",padding:20},modalContainer:{width:"100%",maxHeight:"90%",backgroundColor:"#fff",borderRadius:12,overflow:"hidden"},modalContent:{padding:20},modalTitle:{fontSize:20,fontWeight:"700",color:"#1f2937",marginBottom:12},input:{borderWidth:1,borderColor:"#e5e7eb",backgroundColor:"#f9fafb",paddingHorizontal:12,paddingVertical:10,borderRadius:8,marginTop:8},modalButton:{flex:1,paddingVertical:12,paddingHorizontal:16,borderRadius:10,backgroundColor:"#e5e7eb",alignItems:"center",justifyContent:"center"},modalButtonPrimary:{backgroundColor:"#5d6b4a",marginLeft:8},modalButtonText:{fontSize:16,fontWeight:"600",color:"#1f2937"}})},1445(e,t,o){"use strict";o.r(t),o.d(t,{ThemedText:()=>s,default:()=>c});var a=o(8587),r=(o(6665),o(6283)),n=o(3668),i=o(397);const l=["style","children"],s=e=>{const{style:t,children:o}=e,n=(0,a.default)(e,l);return(0,i.jsx)(r.default,Object.assign({},n,{style:[d.default,t],children:o}))},d=n.default.create({default:{},androidFix:{paddingRight:2,includeFontPadding:!1}}),c=s},2399(e,t,o){"use strict";o.r(t),o.d(t,{default:()=>m});o(6665);var a=o(3668),r=o(3929),n=o(932),i=o(5648),l=o(530),s=o(1445),d=o(9637),c=o(4494),u=o(1168),f=o(6746),g=o(9269),h=o(397);function m(){const e=(0,d.useRouter)(),{trails:t,isLoading:o}=(0,f.useTrails)();return o?(0,h.jsx)(r.default,{style:y.loadingContainer,children:(0,h.jsx)(l.default,{size:"large",color:"#2563eb"})}):(0,h.jsx)(r.default,{style:y.container,children:(0,h.jsx)(n.default,{data:t,renderItem:({item:t})=>(0,h.jsx)(i.default,{style:y.trailItem,onPress:()=>e.push(`/trail/${t.id}`),children:(0,h.jsxs)(r.default,{style:y.trailHeader,children:[(0,h.jsx)(r.default,{style:y.iconContainer,children:(0,h.jsx)(u.default,{size:24,color:"#2563eb"})}),(0,h.jsxs)(r.default,{style:y.trailInfo,children:[(0,h.jsx)(s.ThemedText,{style:y.trailDate,children:(0,g.formatDate)(t.date)}),(0,h.jsxs)(r.default,{style:y.statsRow,children:[(0,h.jsxs)(r.default,{style:y.statItem,children:[(0,h.jsx)(u.default,{size:16,color:"#6b7280"}),(0,h.jsx)(s.ThemedText,{style:y.statText,children:(0,g.formatDistance)(t.distance)})]}),(0,h.jsxs)(r.default,{style:y.statItem,children:[(0,h.jsx)(c.default,{size:16,color:"#6b7280"}),(0,h.jsx)(s.ThemedText,{style:y.statText,children:(0,g.formatDuration)(t.duration)})]})]})]})]})}),keyExtractor:e=>e.id,contentContainerStyle:0===t.length?y.emptyList:y.list,ListEmptyComponent:()=>(0,h.jsxs)(r.default,{style:y.emptyContainer,children:[(0,h.jsx)(u.default,{size:64,color:"#d1d5db"}),(0,h.jsx)(s.ThemedText,{style:y.emptyTitle,children:"No trails yet"}),(0,h.jsx)(s.ThemedText,{style:y.emptyText,children:"Start recording your first dog walk to see it here!"})]})})})}const y=a.default.create({container:{flex:1,backgroundColor:"#f9fafb"},list:{padding:16,gap:12},emptyList:{flex:1},loadingContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"#f9fafb"},trailItem:{backgroundColor:"#fff",borderRadius:16,padding:16,marginBottom:12,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.05,shadowRadius:8,elevation:2},trailHeader:{flexDirection:"row",alignItems:"center",gap:12},iconContainer:{width:48,height:48,borderRadius:24,backgroundColor:"#eff6ff",justifyContent:"center",alignItems:"center"},trailInfo:{flex:1},trailDate:{fontSize:16,fontWeight:"600",color:"#1f2937",marginBottom:6},statsRow:{flexDirection:"row",gap:16},statItem:{flexDirection:"row",alignItems:"center",gap:6},statText:{fontSize:14,color:"#6b7280",fontWeight:"500"},emptyContainer:{flex:1,justifyContent:"center",alignItems:"center",padding:32},emptyTitle:{fontSize:20,fontWeight:"700",color:"#1f2937",marginTop:16,marginBottom:8},emptyText:{fontSize:16,color:"#6b7280",textAlign:"center",lineHeight:24}})},2598(e,t,o){"use strict";o.r(t),o.d(t,{AccountContext:()=>l,useAccount:()=>s});var a=o(6665),r=o(2790),n=o(3353),i=o(5938);const[l,s]=(0,r.default)(()=>{const{user:e,session:t}=(0,n.useAuth)(),[o,r]=(0,a.useState)(null),[l,s]=(0,a.useState)(!0),d=(0,a.useCallback)(async()=>{if(t?.accessToken){s(!0);try{const e=await fetch(`${i.API_URL}/account/me`,{headers:{Authorization:`Bearer ${t.accessToken}`}});if(e.ok){const t=await e.json();r(t)}else console.error("Failed to fetch account:",e.status),r(null)}catch(e){console.error("Error fetching account:",e),r(null)}finally{s(!1)}}},[t?.accessToken]),c=(0,a.useCallback)(async e=>{if(!t?.accessToken)throw new Error("No active session");try{const o=await fetch(`${i.API_URL}/account/me`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.accessToken}`},body:JSON.stringify(e)});if(!o.ok){const e=await o.json();throw new Error(e.detail?.[0]?.msg||"Failed to update account")}const a=await o.json();return r(a),a}catch(o){throw console.error("Error updating account:",o),o}},[t?.accessToken]),u=(0,a.useCallback)(async()=>{if(!t?.accessToken)throw new Error("No active session");try{const e=await fetch(`${i.API_URL}/account/me`,{method:"DELETE",headers:{Authorization:`Bearer ${t.accessToken}`}});if(!e.ok){const t=await e.json();throw new Error(t.detail?.[0]?.msg||"Failed to delete account")}return r(null),!0}catch(e){throw console.error("Error deleting account:",e),e}},[t?.accessToken]);return(0,a.useEffect)(()=>{t?.accessToken?d():(r(null),s(!1))},[t?.accessToken,d]),(0,a.useMemo)(()=>({userProfile:o,isLoading:l,refreshAccount:d,updateAccount:c,deleteAccount:u}),[o,l,d,c,u])})},2699(e,t,o){"use strict";o.r(t),o.d(t,{default:()=>a});const a=o(3668).default.create({safeContainer:{flex:1,backgroundColor:"#F8F7F2"},container:{flex:1,backgroundColor:"#F8F7F2"},stickyHeader:{backgroundColor:"#F8F7F2",paddingBottom:8},stickySearchContainer:{paddingHorizontal:16,paddingBottom:8,flexDirection:"row",alignItems:"center",gap:8},searchBar:{flex:1,flexDirection:"row",alignItems:"center",backgroundColor:"#f3f4f6",paddingHorizontal:16,paddingVertical:14,borderRadius:28,gap:12,borderWidth:1,borderColor:"#e5e7eb"},demoButton:{backgroundColor:"#5d6b4a",paddingHorizontal:16,paddingVertical:12,borderRadius:24},demoButtonText:{color:"#fff",fontWeight:"bold"},searchPlaceholder:{fontSize:16,color:"#9ca3af",fontWeight:"400"},largeTrailCard:{backgroundColor:"#fff",borderRadius:24,overflow:"hidden",marginBottom:20,shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.1,shadowRadius:16,elevation:4,position:"relative"},largeTrailImage:{width:"100%",height:260,backgroundColor:"#e2e8f0"},bookmarkButton:{position:"absolute",top:20,right:20,width:44,height:44,borderRadius:22,backgroundColor:"rgba(255, 255, 255, 0.95)",justifyContent:"center",alignItems:"center",shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:8,elevation:4},cardGradient:{position:"absolute",top:0,bottom:0,left:0,right:0},cardOverlayContent:{position:"absolute",bottom:0,left:0,right:0,padding:18,paddingBottom:20},overlayTrailName:{fontSize:28,fontWeight:"700",color:"#fff",marginBottom:6,lineHeight:34,textShadowColor:"rgba(0, 0, 0, 0.3)",textShadowOffset:{width:0,height:1},textShadowRadius:4},overlayLocation:{fontSize:16,color:"#fff",marginBottom:16,opacity:.95,textShadowColor:"rgba(0, 0, 0, 0.3)",textShadowOffset:{width:0,height:1},textShadowRadius:4},overlayBadges:{flexDirection:"row",alignItems:"center",gap:12,flexWrap:"wrap"},badge:{flexDirection:"row",alignItems:"center",backgroundColor:"rgba(40, 40, 40, 0.8)",paddingHorizontal:14,paddingVertical:8,borderRadius:20,gap:6},badgeText:{fontSize:14,fontWeight:"600",color:"#fff",textTransform:"capitalize"},categoriesSection:{backgroundColor:"#F8F7F2",paddingTop:8,paddingBottom:16},categoriesScroll:{paddingHorizontal:16,gap:12},categoryButton:{flexDirection:"row",alignItems:"center",paddingHorizontal:24,paddingVertical:14,borderRadius:28,backgroundColor:"#fff",borderWidth:0,gap:8},categoryButtonActive:{backgroundColor:"#5d6b4a"},categoryText:{fontSize:16,fontWeight:"500",color:"#9ca3af"},categoryTextActive:{color:"#fff"},categoryTrailsSection:{paddingHorizontal:16,paddingTop:16},bottomPadding:{height:40},loadingContainer:{paddingVertical:60,alignItems:"center",gap:16},loadingText:{fontSize:14,color:"#64748b"},emptyContainer:{paddingVertical:60,alignItems:"center",gap:16,paddingHorizontal:32},emptyText:{fontSize:16,color:"#64748b",textAlign:"center",lineHeight:24},placeholderImage:{justifyContent:"center",alignItems:"center",backgroundColor:"#282E10"},searchModalContainer:{flex:1,backgroundColor:"#F8F7F2"},searchModalHeader:{flexDirection:"row",alignItems:"center",paddingHorizontal:16,paddingTop:12,paddingBottom:16,gap:12,borderBottomWidth:1,borderBottomColor:"#e5e7eb"},backButton:{width:40,height:40,borderRadius:20,backgroundColor:"#d4d4a0",justifyContent:"center",alignItems:"center"},searchModalInputContainer:{flex:1,flexDirection:"row",alignItems:"center",backgroundColor:"#fff",borderRadius:28,paddingHorizontal:16,paddingVertical:12,borderWidth:1,borderColor:"#9ca3af",gap:12},searchModalInput:{flex:1,fontSize:16,color:"#282E10",padding:0,fontWeight:"400"},clearButton:{width:24,height:24,borderRadius:12,backgroundColor:"#e5e7eb",justifyContent:"center",alignItems:"center"},searchModalContent:{flex:1,paddingTop:12},currentLocationItem:{flexDirection:"row",alignItems:"center",paddingHorizontal:20,paddingVertical:16,gap:16,backgroundColor:"#f9fafb",borderRadius:16,marginHorizontal:16,marginBottom:12},locationIconContainer:{width:48,height:48,borderRadius:24,backgroundColor:"#d4d4a0",justifyContent:"center",alignItems:"center"},locationTextContainer:{flex:1},locationTitle:{fontSize:17,fontWeight:"600",color:"#282E10",marginBottom:4},locationSubtitle:{fontSize:14,color:"#6b7280",fontWeight:"400"},suggestionItem:{flexDirection:"row",alignItems:"center",paddingHorizontal:20,paddingVertical:16,gap:16,backgroundColor:"#f9fafb",borderRadius:16,marginHorizontal:16,marginBottom:12},suggestionIconContainer:{width:48,height:48,borderRadius:24,backgroundColor:"#e5e7eb",justifyContent:"center",alignItems:"center"},suggestionTextContainer:{flex:1},suggestionTitle:{fontSize:17,fontWeight:"600",color:"#282E10",marginBottom:4},suggestionSubtitle:{fontSize:14,color:"#6b7280",fontWeight:"400"}})},3229(e,t,o){"use strict";e.exports=o.p+"static/media/icon.f99e957780228420852c.png"},3353(e,t,o){"use strict";o.r(t),o.d(t,{AuthContext:()=>l,useAuth:()=>s});var a=o(6665),r=o(2790),n=o(5259),i=o(5938);const[l,s]=(0,r.default)(()=>{const[e,t]=(0,a.useState)(null),[o,r]=(0,a.useState)(null),[l,s]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async()=>{try{const e=await n.default.getItem("session");if(e){const o=JSON.parse(e);t(o),r(o.user)}}catch(e){console.error("Error loading session:",e)}finally{s(!1)}})()},[]);const d=(0,a.useCallback)(async e=>{console.log("Requesting OTP for:",e);const t=await fetch(`${i.API_URL}/otp/request`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!t.ok){const e=await t.json();throw new Error(e.detail?.[0]?.msg||"Failed to request OTP")}return!0},[]),c=(0,a.useCallback)(async(e,o)=>{console.log("Verifying OTP for:",e);const a=await fetch(`${i.API_URL}/otp/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,otpCode:o})});if(!a.ok){const e=await a.json();throw new Error(e.detail?.[0]?.msg||"Invalid OTP code")}const l=await a.json();return t(l),r(l.user),await n.default.setItem("session",JSON.stringify(l)),l},[]),u=(0,a.useCallback)(async(e,t)=>{console.log("Requesting registration for:",e);const o=await fetch(`${i.API_URL}/otp/register-request`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,name:t})});if(!o.ok){const e=await o.json();throw new Error(e.detail?.[0]?.msg||"Failed to request registration")}return!0},[]),f=(0,a.useCallback)(async(e,o)=>{console.log("Verifying registration for:",e);const a=await fetch(`${i.API_URL}/otp/register-verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,otpCode:o})});if(!a.ok){const e=await a.json();throw new Error(e.detail?.[0]?.msg||"Invalid OTP code")}const l=await a.json();return t(l),r(l.user),await n.default.setItem("session",JSON.stringify(l)),l},[]),g=(0,a.useCallback)(async()=>{console.log("Signing out user"),t(null),r(null),await n.default.removeItem("session")},[]);return(0,a.useMemo)(()=>({session:e,user:o,isLoading:l,requestOtp:d,verifyOtp:c,requestRegistration:u,verifyRegistration:f,signOut:g,isAuthenticated:!!e}),[e,o,l,d,c,u,f,g])})},3686(e,t,o){"use strict";o.r(t),o.d(t,{default:()=>N});var a=o(6665),r=o(3929),n=o(3668),i=o(530),l=o(5648),s=o(6773),d=o(1690),c=o(9632),u=o(5009),f=o(1445),g=o(9637),h=o(5894),m=o(9895),y=o(8136),x=o(4686),p=o(5427),b=o(5395),j=o(2994),w=o(4164),T=o(9281),C=o(6508),S=o(4494),v=o(1168),k=o(8032),I=o(8948),B=o(5082),z=o(8360),P=o(477),R=o(2964),D=(o(262),o(893)),F=o(6746),A=o(3353),L=o(9269),E=o(9582),O=o(8833),W=o(397);const _=["Forest","Urban","Beach","Mountain","Rural","Park","Shaded","Sunny","Crowded","Quiet","Paved","Trail"],V=["Easy","Moderate","Hard"];function N(){const{id:e}=(0,g.useLocalSearchParams)(),{user:t}=(0,A.useAuth)(),{getTrailById:o,updateTrailName:n,updateTrailPhoto:N,updateTrailDetails:M,getTrailWithUser:$}=(0,F.useTrails)(),[G,U]=(0,a.useState)(void 0),[q,J]=(0,a.useState)(!0),[Y,K]=(0,a.useState)(!1),[Q,X]=(0,a.useState)(""),[Z,ee]=(0,a.useState)(!1),[te,oe]=(0,a.useState)(0),[ae,re]=(0,a.useState)(""),[ne,ie]=(0,a.useState)([]),[le,se]=(0,a.useState)(""),[de,ce]=(0,a.useState)(""),[ue,fe]=(0,a.useState)(!1),ge=(0,a.useRef)(null),he=(0,a.useRef)(new u.default.Value(0)).current,me=(0,O.useSafeAreaInsets)(),ye=({IconComponent:e,emoji:t,size:o=18,color:a})=>(0,W.jsx)(f.ThemedText,{style:{fontSize:o,color:a||void 0},children:t||"\u2022"}),[xe,pe]=(0,a.useState)(!1);(0,a.useEffect)(()=>{be()},[e]);const be=async()=>{if("string"===typeof e){J(!0);try{const t=o(e);if(t)U(t),X(t.name||""),oe(t.rating||0),re(t.review||""),ie(t.environment_tags||[]),se(t.difficulty||""),ce(t.name||"");else{const t=await $(e);t&&(U(t),X(t.name||""),oe(t.rating||0),re(t.review||""),ie(t.environment_tags||[]),se(t.difficulty||""),ce(t.name||""))}}catch(t){console.error("Error loading trail:",t)}finally{J(!1)}}else J(!1)},je=()=>{ge.current&&ge.current.click()};if(q)return(0,W.jsxs)(r.default,{style:H.loadingContainer,children:[(0,W.jsx)(i.default,{size:"large",color:E.default.primary}),(0,W.jsx)(f.ThemedText,{style:H.loadingText,children:"Loading trail..."})]});if(!G)return(0,W.jsxs)(r.default,{style:H.loadingContainer,children:[(0,W.jsx)(v.default,{size:64,color:"#9ca3af"}),(0,W.jsx)(f.ThemedText,{style:H.loadingText,children:"Trail not found"})]});const we=G.coordinates??[],Te=we.length>0?{latitude:we[0].latitude,longitude:we[0].longitude,latitudeDelta:.01,longitudeDelta:.01}:void 0,Ce=G.user_id===t?.id;return(0,W.jsxs)(r.default,{style:H.container,children:[(0,W.jsx)("input",{ref:ge,type:"file",accept:"image/*",style:{display:"none"},onChange:async e=>{const t=e.target.files?.[0];if(t&&G)if(t.type.startsWith("image/")){fe(!0);try{const e=new FileReader;e.onload=async e=>{const t=e.target?.result;await N(G.id,t),U(Object.assign({},G,{photo:t})),d.default.alert("Success","Photo uploaded successfully!"),fe(!1)},e.onerror=()=>{d.default.alert("Error","Failed to read image"),fe(!1)},e.readAsDataURL(t)}catch(o){console.error("Photo upload error:",o),d.default.alert("Error","Failed to upload photo"),fe(!1)}}else d.default.alert("Error","Please select an image file")}}),(0,W.jsxs)(r.default,{style:[H.headerButtons,{top:me.top+12}],children:[(0,W.jsx)(l.default,{style:H.headerButton,onPress:()=>{g.router.back()},children:(0,W.jsx)(b.default,{size:24,color:"#1f2937"})}),(0,W.jsxs)(r.default,{style:H.headerRightButtons,children:[(0,W.jsx)(l.default,{style:H.headerButton,onPress:()=>{d.default.alert("Share","Share functionality coming soon!")},children:(0,W.jsx)(I.default,{size:22,color:"#1f2937"})}),(0,W.jsx)(l.default,{style:H.headerButton,onPress:()=>{pe(!xe)},children:(0,W.jsx)(j.default,{size:22,color:"#1f2937",fill:xe?"#1f2937":"none"})}),(0,W.jsx)(l.default,{style:H.headerButton,onPress:()=>{d.default.alert("Options","Mark as completed option coming soon!")},children:(0,W.jsx)(y.default,{size:22,color:"#1f2937"})})]})]}),(0,W.jsxs)(u.default.ScrollView,{style:H.scrollContainer,contentContainerStyle:H.scrollContent,onScroll:u.default.event([{nativeEvent:{contentOffset:{y:he}}}],{useNativeDriver:!1}),scrollEventThrottle:16,children:[(0,W.jsx)(r.default,{style:H.heroSection,children:G.photo?(0,W.jsxs)(r.default,{style:H.heroImageContainer,children:[(0,W.jsx)(h.Image,{source:{uri:G.photo},style:H.heroImage,contentFit:"cover",cachePolicy:"memory-disk"}),(0,W.jsx)(D.LinearGradient,{colors:["rgba(0,0,0,0)","rgba(0,0,0,0.3)"],style:H.heroGradient}),Ce&&(0,W.jsx)(l.default,{style:H.changePhotoFab,onPress:je,disabled:ue,children:ue?(0,W.jsx)(i.default,{color:"#fff",size:"small"}):(0,W.jsx)(T.default,{size:20,color:"#fff"})})]}):Ce&&(0,W.jsx)(l.default,{style:H.addPhotoContainer,onPress:je,disabled:ue,children:ue?(0,W.jsx)(i.default,{size:"large",color:E.default.primary}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(r.default,{style:H.addPhotoIcon,children:(0,W.jsx)(T.default,{size:32,color:E.default.primary})}),(0,W.jsx)(f.ThemedText,{style:H.addPhotoText,children:"Add a photo"}),(0,W.jsx)(f.ThemedText,{style:H.addPhotoSubtext,children:"Make your trail memorable"})]})})}),(0,W.jsx)(r.default,{style:H.contentWrapper,children:(0,W.jsxs)(r.default,{style:H.content,children:[(0,W.jsxs)(r.default,{style:H.titleSection,children:[Ce&&Y?(0,W.jsxs)(r.default,{style:H.nameEditContainer,children:[(0,W.jsx)(s.default,{style:H.nameInput,value:Q,onChangeText:X,placeholder:"Enter trail name",autoFocus:!0,placeholderTextColor:"#9ca3af"}),(0,W.jsxs)(r.default,{style:H.editButtons,children:[(0,W.jsx)(l.default,{style:[H.iconButton,H.saveIconButton],onPress:async()=>{if(G&&Q.trim())try{await n(G.id,Q.trim()),U(Object.assign({},G,{name:Q.trim()})),K(!1)}catch{d.default.alert("Error","Failed to update trail name. Please try again.")}else K(!1)},children:(0,W.jsx)(C.default,{size:18,color:"#fff"})}),(0,W.jsx)(l.default,{style:[H.iconButton,H.cancelIconButton],onPress:()=>{X(G?.name||""),K(!1)},children:(0,W.jsx)(R.default,{size:18,color:E.default.darkGreen})})]})]}):(0,W.jsx)(r.default,{style:H.titleRow,children:(0,W.jsx)(f.ThemedText,{style:H.title,children:G.name||`Trail ${new Date(G.date).toLocaleDateString()}`})}),G.city&&(0,W.jsxs)(r.default,{style:H.locationRow,children:[(0,W.jsx)(v.default,{size:16,color:E.default.lightGreen}),(0,W.jsxs)(f.ThemedText,{style:H.location,children:[G.city,", ",G.country||"Unknown"]})]}),G.rating&&!Z&&(0,W.jsx)(r.default,{style:H.ratingRow,children:[1,2,3,4,5].map(e=>(0,W.jsx)(B.default,{size:18,color:e<=G.rating?"#f59e0b":"#d1d5db",fill:e<=G.rating?"#f59e0b":"none"},e))})]}),G.review&&!Z&&(0,W.jsx)(r.default,{style:H.reviewCard,children:(0,W.jsx)(f.ThemedText,{style:H.reviewText,children:G.review})}),(0,W.jsxs)(r.default,{style:H.statsSection,children:[(0,W.jsxs)(r.default,{style:H.statCard,children:[(0,W.jsx)(r.default,{style:H.statIconContainer,children:(0,W.jsx)(v.default,{size:20,color:"#ffffff",strokeWidth:2.5})}),(0,W.jsx)(f.ThemedText,{style:H.statLabel,children:"Distance"}),(0,W.jsx)(f.ThemedText,{style:H.statValue,children:(0,L.formatDistance)(G.distance)})]}),(0,W.jsxs)(r.default,{style:H.statCard,children:[(0,W.jsx)(r.default,{style:H.statIconContainer,children:(0,W.jsx)(S.default,{size:20,color:"#ffffff",strokeWidth:2.5})}),(0,W.jsx)(f.ThemedText,{style:H.statLabel,children:"Duration"}),(0,W.jsx)(f.ThemedText,{style:H.statValue,children:(0,L.formatDuration)(G.duration)})]}),G.difficulty&&(0,W.jsxs)(r.default,{style:H.statCard,children:[(0,W.jsx)(r.default,{style:H.statIconContainer,children:(0,W.jsx)(ye,{IconComponent:P.default,emoji:"\u26f0\ufe0f",size:20,color:"#ffffff"})}),(0,W.jsx)(f.ThemedText,{style:H.statLabel,children:"Difficulty"}),(0,W.jsx)(f.ThemedText,{style:H.statValue,children:G.difficulty})]})]}),G.environment_tags&&G.environment_tags.length>0&&!Z&&(0,W.jsxs)(r.default,{style:H.tagsSection,children:[(0,W.jsxs)(r.default,{style:H.sectionHeader,children:[(0,W.jsx)(ye,{IconComponent:z.default,emoji:"\ud83c\udff7\ufe0f",size:18,color:E.default.darkGreen}),(0,W.jsx)(f.ThemedText,{style:H.sectionTitle,children:"Environment"})]}),(0,W.jsx)(r.default,{style:H.tagsGrid,children:G.environment_tags.map((e,t)=>(0,W.jsx)(r.default,{style:H.tagChip,children:(0,W.jsx)(f.ThemedText,{style:H.tagText,children:e})},t))})]}),Ce&&!Z&&(0,W.jsxs)(l.default,{style:H.editDetailsButton,onPress:()=>{ee(!0)},children:[(0,W.jsx)(x.default,{size:18,color:E.default.primary}),(0,W.jsx)(f.ThemedText,{style:H.editDetailsText,children:"Edit Trail Details"})]}),Ce&&Z&&(0,W.jsxs)(r.default,{style:H.editSection,children:[(0,W.jsx)(f.ThemedText,{style:H.editSectionTitle,children:"Trail Name"}),(0,W.jsx)(s.default,{style:H.nameInputInDetails,value:de,onChangeText:ce,placeholder:"Enter trail name",placeholderTextColor:"#9ca3af"}),(0,W.jsx)(f.ThemedText,{style:[H.editSectionTitle,{marginTop:24}],children:"Rating"}),(0,W.jsx)(r.default,{style:H.ratingStars,children:[1,2,3,4,5].map(e=>(0,W.jsx)(l.default,{onPress:()=>{oe(e)},style:H.starButton,children:(0,W.jsx)(B.default,{size:32,color:e<=te?"#f59e0b":"#d1d5db",fill:e<=te?"#f59e0b":"none"})},e))}),(0,W.jsx)(f.ThemedText,{style:[H.editSectionTitle,{marginTop:24}],children:"Review"}),(0,W.jsx)(s.default,{style:H.reviewInput,value:ae,onChangeText:re,placeholder:"Share your experience on this trail...",placeholderTextColor:"#9ca3af",multiline:!0,numberOfLines:4,textAlignVertical:"top"}),(0,W.jsx)(f.ThemedText,{style:[H.editSectionTitle,{marginTop:24}],children:"Difficulty"}),(0,W.jsx)(r.default,{style:H.difficultyOptions,children:V.map(e=>(0,W.jsx)(l.default,{style:[H.difficultyChip,le===e&&H.difficultyChipSelected],onPress:()=>{se(e)},children:(0,W.jsx)(f.ThemedText,{style:[H.difficultyChipText,le===e&&H.difficultyChipTextSelected],children:e})},e))}),(0,W.jsx)(f.ThemedText,{style:[H.editSectionTitle,{marginTop:24}],children:"Environment Tags"}),(0,W.jsx)(r.default,{style:H.tagsGrid,children:_.map(e=>(0,W.jsx)(l.default,{style:[H.editTagChip,ne.includes(e)&&H.editTagChipSelected],onPress:()=>(e=>{ie(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e),children:(0,W.jsx)(f.ThemedText,{style:[H.editTagChipText,ne.includes(e)&&H.editTagChipTextSelected],children:e})},e))}),(0,W.jsxs)(r.default,{style:H.editActionButtons,children:[(0,W.jsxs)(l.default,{style:[H.actionButton,H.cancelActionButton],onPress:()=>{oe(G?.rating||0),re(G?.review||""),ie(G?.environment_tags||[]),se(G?.difficulty||""),ce(G?.name||""),ee(!1)},children:[(0,W.jsx)(R.default,{size:20,color:E.default.darkGreen}),(0,W.jsx)(f.ThemedText,{style:H.cancelActionText,children:"Cancel"})]}),(0,W.jsxs)(l.default,{style:[H.actionButton,H.saveActionButton],onPress:async()=>{if(G)try{de.trim()!==G.name&&await n(G.id,de.trim()),await M(G.id,{rating:te>0?te:void 0,review:ae.trim()||void 0,environment_tags:ne.length>0?ne:void 0,difficulty:le||void 0}),U(Object.assign({},G,{name:de.trim(),rating:te>0?te:void 0,review:ae.trim()||void 0,environment_tags:ne.length>0?ne:void 0,difficulty:le||void 0})),X(de.trim()),ee(!1),d.default.alert("Success","Trail details updated!")}catch{d.default.alert("Error","Failed to update trail details. Please try again.")}},children:[(0,W.jsx)(C.default,{size:20,color:"#fff"}),(0,W.jsx)(f.ThemedText,{style:H.saveActionText,children:"Save"})]})]})]}),(0,W.jsxs)(r.default,{style:H.mapSection,children:[(0,W.jsxs)(r.default,{style:H.sectionHeader,children:[(0,W.jsx)(ye,{IconComponent:k.default,emoji:"\ud83e\udded",size:18,color:E.default.darkGreen}),(0,W.jsx)(f.ThemedText,{style:H.sectionTitle,children:"Route Map"})]}),(0,W.jsx)(r.default,{style:H.mapContainer,children:(0,W.jsx)(m.default,{coordinates:we,style:H.map,initialRegion:Te||void 0,scrollEnabled:!1,zoomEnabled:!1})}),(0,W.jsxs)(l.default,{style:H.directionsButton,onPress:()=>{if(!G||0===(G.coordinates?.length??0))return void d.default.alert("Error","Location not available for this trail");const e=G.coordinates[0].latitude,t=G.coordinates[0].longitude,o=(G.name,`https://www.google.com/maps/search/?api=1&query=${e},${t}`);c.default.canOpenURL(o).then(e=>{e?c.default.openURL(o):d.default.alert("Error","Unable to open maps application")})},children:[(0,W.jsx)(k.default,{size:18,color:"#fff"}),(0,W.jsx)(f.ThemedText,{style:H.directionsButtonText,children:"Get Directions"})]})]}),(0,W.jsxs)(r.default,{children:[(0,W.jsx)(f.ThemedText,{style:H.detailsTitle,children:"Additional Details"}),void 0!==G.maxElevation&&(0,W.jsxs)(r.default,{style:H.detailRow,children:[(0,W.jsx)(r.default,{style:H.detailIcon,children:(0,W.jsx)(ye,{IconComponent:P.default,emoji:"\u26f0\ufe0f",size:18,color:E.default.primary})}),(0,W.jsxs)(r.default,{style:H.detailContent,children:[(0,W.jsx)(f.ThemedText,{style:H.detailLabel,children:"Elevation Gain"}),(0,W.jsxs)(f.ThemedText,{style:H.detailValue,children:[G.maxElevation,"m"]})]})]}),G.pace&&(0,W.jsxs)(r.default,{style:H.detailRow,children:[(0,W.jsx)(r.default,{style:H.detailIcon,children:(0,W.jsx)(ye,{IconComponent:p.default,emoji:"\ud83c\udfc3",size:18,color:E.default.primary})}),(0,W.jsxs)(r.default,{style:H.detailContent,children:[(0,W.jsx)(f.ThemedText,{style:H.detailLabel,children:"Pace"}),(0,W.jsxs)(f.ThemedText,{style:H.detailValue,children:[G.pace," /km"]})]})]}),G.speed&&(0,W.jsxs)(r.default,{style:H.detailRow,children:[(0,W.jsx)(r.default,{style:H.detailIcon,children:(0,W.jsx)(ye,{IconComponent:p.default,emoji:"\u26a1",size:18,color:E.default.primary})}),(0,W.jsxs)(r.default,{style:H.detailContent,children:[(0,W.jsx)(f.ThemedText,{style:H.detailLabel,children:"Max Speed"}),(0,W.jsxs)(f.ThemedText,{style:H.detailValue,children:[G.speed.toFixed(1)," km/h"]})]})]}),(0,W.jsxs)(r.default,{style:H.detailRow,children:[(0,W.jsx)(r.default,{style:H.detailIcon,children:(0,W.jsx)(ye,{IconComponent:w.default,emoji:"\ud83d\udcc5",size:18,color:E.default.primary})}),(0,W.jsxs)(r.default,{style:H.detailContent,children:[(0,W.jsx)(f.ThemedText,{style:H.detailLabel,children:"Date & Time"}),(0,W.jsx)(f.ThemedText,{style:H.detailValue,children:new Date(G.date).toLocaleString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})})]})]})]})]})})]})]})}const H=n.default.create({container:{flex:1,backgroundColor:E.default.background},headerButtons:{position:"absolute",left:0,right:0,zIndex:100,flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingHorizontal:16},headerButton:{width:44,height:44,borderRadius:22,backgroundColor:"#ffffff",justifyContent:"center",alignItems:"center",shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.15,shadowRadius:4,elevation:4},headerRightButtons:{flexDirection:"row",gap:12},scrollContainer:{flex:1},scrollContent:{paddingBottom:32},loadingContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:E.default.background},loadingText:{marginTop:16,fontSize:16,color:E.default.lightGreen,fontWeight:"500"},heroSection:{position:"relative"},heroImageContainer:{width:"100%",height:500,position:"relative"},heroImage:{width:"100%",height:"100%",backgroundColor:"#e5e7eb"},heroGradient:{position:"absolute",bottom:0,left:0,right:0,height:100},changePhotoFab:{position:"absolute",bottom:80,right:20,width:56,height:56,borderRadius:28,backgroundColor:E.default.primary,justifyContent:"center",alignItems:"center",shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:8,elevation:6},addPhotoContainer:{width:"100%",height:280,backgroundColor:E.default.lightGreen,justifyContent:"center",alignItems:"center",paddingHorizontal:32},addPhotoIcon:{width:72,height:72,borderRadius:36,backgroundColor:E.default.background,justifyContent:"center",alignItems:"center",marginBottom:16},addPhotoText:{fontSize:18,fontWeight:"600",color:E.default.darkGreen,marginBottom:4},addPhotoSubtext:{fontSize:14,color:E.default.mediumGreen},contentWrapper:{backgroundColor:E.default.background,borderTopLeftRadius:24,borderTopRightRadius:24,marginTop:-24,zIndex:10},content:{padding:24},titleSection:{marginBottom:20},titleRow:{flexDirection:"row",alignItems:"flex-start",gap:12,marginBottom:8},title:{flex:1,fontSize:32,fontWeight:"700",color:E.default.darkGreen,lineHeight:40},editIconButton:{width:40,height:40,borderRadius:20,backgroundColor:E.default.lightGreen,justifyContent:"center",alignItems:"center",marginTop:4},nameEditContainer:{marginBottom:8},nameInput:{fontSize:28,fontWeight:"700",color:E.default.darkGreen,backgroundColor:"#fff",borderWidth:2,borderColor:E.default.primary,borderRadius:12,padding:12,marginBottom:12},nameInputInDetails:{fontSize:16,color:E.default.darkGreen,backgroundColor:E.default.background,borderWidth:1,borderColor:E.default.lightGreen,borderRadius:12,padding:16},editButtons:{flexDirection:"row",gap:8},iconButton:{width:44,height:44,borderRadius:22,justifyContent:"center",alignItems:"center"},saveIconButton:{backgroundColor:E.default.primary},cancelIconButton:{backgroundColor:E.default.lightGreen},locationRow:{flexDirection:"row",alignItems:"center",gap:6,marginBottom:12},location:{fontSize:16,color:E.default.mediumGreen,fontWeight:"500"},ratingRow:{flexDirection:"row",gap:4},reviewCard:{backgroundColor:"#fff",borderRadius:16,padding:20,marginBottom:24,borderWidth:1,borderColor:E.default.paleYellow},reviewText:{fontSize:16,color:E.default.darkGreen,lineHeight:24},statsSection:{flexDirection:"row",flexWrap:"wrap",gap:12,marginBottom:24},statCard:{flex:1,minWidth:100,backgroundColor:"#fff",borderRadius:16,padding:16,alignItems:"center",shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.05,shadowRadius:8,elevation:2},statIconContainer:{width:44,height:44,borderRadius:22,backgroundColor:E.default.primary,justifyContent:"center",alignItems:"center",marginBottom:12},statLabel:{fontSize:13,color:E.default.mediumGreen,fontWeight:"500",marginBottom:4},statValue:{fontSize:20,color:E.default.darkGreen,fontWeight:"700"},tagsSection:{backgroundColor:"#fff",borderRadius:16,padding:20,marginBottom:20,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.05,shadowRadius:8,elevation:2},sectionHeader:{flexDirection:"row",alignItems:"center",gap:8,marginBottom:16},sectionTitle:{fontSize:18,fontWeight:"700",color:E.default.darkGreen},tagsGrid:{flexDirection:"row",flexWrap:"wrap",gap:8},tagChip:{backgroundColor:E.default.lightGreen,paddingHorizontal:16,paddingVertical:8,borderRadius:20},tagText:{fontSize:14,fontWeight:"500",color:E.default.darkGreen},editDetailsButton:{flexDirection:"row",alignItems:"center",justifyContent:"center",gap:8,backgroundColor:"#fff",borderRadius:12,paddingVertical:14,paddingHorizontal:20,marginBottom:20,borderWidth:2,borderColor:E.default.primary},editDetailsText:{fontSize:16,fontWeight:"600",color:E.default.primary},editSection:{backgroundColor:"#fff",borderRadius:16,padding:20,marginBottom:20,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.05,shadowRadius:8,elevation:2},editSectionTitle:{fontSize:16,fontWeight:"700",color:E.default.darkGreen,marginBottom:12},ratingStars:{flexDirection:"row",gap:8},starButton:{padding:4},reviewInput:{backgroundColor:E.default.background,borderWidth:1,borderColor:E.default.lightGreen,borderRadius:12,padding:16,fontSize:15,color:E.default.darkGreen,minHeight:120},difficultyOptions:{flexDirection:"row",gap:8},difficultyChip:{flex:1,paddingVertical:12,paddingHorizontal:16,borderRadius:12,backgroundColor:E.default.background,borderWidth:2,borderColor:E.default.lightGreen,alignItems:"center"},difficultyChipSelected:{backgroundColor:E.default.primary,borderColor:E.default.primary},difficultyChipText:{fontSize:15,fontWeight:"600",color:E.default.mediumGreen},difficultyChipTextSelected:{color:"#fff"},editTagChip:{paddingHorizontal:16,paddingVertical:8,borderRadius:20,backgroundColor:E.default.background,borderWidth:1.5,borderColor:E.default.lightGreen},editTagChipSelected:{backgroundColor:E.default.primary,borderColor:E.default.primary},editTagChipText:{fontSize:14,fontWeight:"500",color:E.default.mediumGreen},editTagChipTextSelected:{color:"#fff"},editActionButtons:{flexDirection:"row",gap:12,marginTop:24},actionButton:{flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center",gap:8,paddingVertical:14,borderRadius:12},cancelActionButton:{backgroundColor:E.default.background,borderWidth:2,borderColor:E.default.lightGreen},cancelActionText:{fontSize:16,fontWeight:"600",color:E.default.darkGreen},saveActionButton:{backgroundColor:E.default.primary},saveActionText:{fontSize:16,fontWeight:"600",color:"#fff"},mapSection:{marginBottom:20},mapContainer:{height:260,borderRadius:16,overflow:"hidden",marginBottom:12,borderWidth:1,borderColor:E.default.lightGreen},map:{width:"100%",height:"100%"},webMapPlaceholder:{justifyContent:"center",alignItems:"center",backgroundColor:E.default.lightGreen},webMapText:{marginTop:12,fontSize:14,color:E.default.mediumGreen},directionsButton:{flexDirection:"row",alignItems:"center",justifyContent:"center",backgroundColor:E.default.primary,borderRadius:12,paddingVertical:16,paddingHorizontal:24,gap:10,shadowColor:E.default.primary,shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:8,elevation:4},directionsButtonText:{fontSize:16,fontWeight:"700",color:"#fff"},detailsSection:{backgroundColor:"#fff",borderRadius:16,padding:20,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.05,shadowRadius:8,elevation:2},detailsTitle:{fontSize:18,fontWeight:"700",color:E.default.darkGreen,marginBottom:16},detailRow:{flexDirection:"row",alignItems:"flex-start",paddingVertical:12,borderBottomWidth:1,borderBottomColor:E.default.background},detailIcon:{width:36,height:36,borderRadius:18,backgroundColor:E.default.lightGreen,justifyContent:"center",alignItems:"center",marginRight:12},detailContent:{flex:1},detailLabel:{fontSize:13,fontWeight:"600",color:E.default.mediumGreen,marginBottom:2},detailValue:{fontSize:16,color:E.default.darkGreen,fontWeight:"500"}})},3764(e,t,o){"use strict";o.r(t),o.d(t,{default:()=>y});var a=o(6665),r=o(6283),n=o(3929),i=o(6773),l=o(5648),s=o(3668),d=o(4767),c=o(1690),u=o(530),f=o(9637),g=o(3353),h=o(630),m=o(397);function y(){const e=(0,f.useRouter)(),{requestRegistration:t,verifyRegistration:o}=(0,g.useAuth)(),[s,y]=(0,a.useState)(""),[p,b]=(0,a.useState)(""),[j,w]=(0,a.useState)(""),[T,C]=(0,a.useState)("info"),[S,v]=(0,a.useState)(!1);return(0,m.jsx)(d.default,{style:x.container,behavior:"height",children:(0,m.jsxs)(n.default,{style:x.content,children:[(0,m.jsxs)(n.default,{style:x.header,children:[(0,m.jsx)(h.default,{size:64,color:"#5d6b4a"}),(0,m.jsx)(r.default,{style:x.title,children:"Create Account"}),(0,m.jsx)(r.default,{style:x.subtitle,children:"Sign up to start tracking your dog walks"})]}),(0,m.jsxs)(n.default,{style:x.form,children:["info"===T?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(n.default,{style:x.inputContainer,children:[(0,m.jsx)(r.default,{style:x.label,children:"Name"}),(0,m.jsx)(i.default,{style:x.input,placeholder:"Your Name",value:p,onChangeText:b,autoCapitalize:"words",editable:!S})]}),(0,m.jsxs)(n.default,{style:x.inputContainer,children:[(0,m.jsx)(r.default,{style:x.label,children:"Email"}),(0,m.jsx)(i.default,{style:x.input,placeholder:"your@email.com",value:s,onChangeText:y,autoCapitalize:"none",keyboardType:"email-address",autoComplete:"email",editable:!S})]}),(0,m.jsx)(l.default,{style:[x.button,S&&x.buttonDisabled],onPress:async()=>{if(s&&p){0,v(!0);try{await t(s.trim().toLowerCase(),p.trim()),C("otp")}catch(e){0,console.error("Request registration error:",e),c.default.alert("Error",e.message||"Failed to request registration")}finally{v(!1)}}else c.default.alert("Error","Please fill in all fields")},disabled:S,children:S?(0,m.jsx)(u.default,{color:"#fff"}):(0,m.jsx)(r.default,{style:x.buttonText,children:"Send OTP"})})]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(n.default,{style:x.inputContainer,children:[(0,m.jsx)(r.default,{style:x.label,children:"OTP Code"}),(0,m.jsx)(i.default,{style:x.input,placeholder:"Enter 6-digit code",value:j,onChangeText:w,keyboardType:"number-pad",maxLength:6,editable:!S}),(0,m.jsxs)(r.default,{style:x.helperText,children:["Sent to ",s]})]}),(0,m.jsx)(l.default,{style:[x.button,S&&x.buttonDisabled],onPress:async()=>{if(j){0,v(!0);try{await o(s.trim().toLowerCase(),j),e.replace("/")}catch(t){0,console.error("Verify registration error:",t),c.default.alert("Error",t.message||"Invalid OTP code")}finally{v(!1)}}else c.default.alert("Error","Please enter the OTP code")},disabled:S,children:S?(0,m.jsx)(u.default,{color:"#fff"}):(0,m.jsx)(r.default,{style:x.buttonText,children:"Verify & Sign Up"})}),(0,m.jsx)(l.default,{style:x.secondaryButton,onPress:()=>C("info"),disabled:S,children:(0,m.jsx)(r.default,{style:x.secondaryButtonText,children:"Change Info"})})]}),(0,m.jsxs)(n.default,{style:x.footer,children:[(0,m.jsx)(r.default,{style:x.footerText,children:"Already have an account? "}),(0,m.jsx)(l.default,{onPress:()=>{e.push("/login")},children:(0,m.jsx)(r.default,{style:x.linkText,children:"Sign In"})})]})]})]})})}const x=s.default.create({container:{flex:1,backgroundColor:"#F8F7F2"},content:{flex:1,padding:24,justifyContent:"center"},header:{alignItems:"center",marginBottom:48},title:{fontSize:32,fontWeight:"700",color:"#1a1f0a",marginTop:16},subtitle:{fontSize:16,color:"#6b7280",marginTop:8,textAlign:"center"},form:{width:"100%"},inputContainer:{marginBottom:20},label:{fontSize:14,fontWeight:"600",color:"#5d6b4a",marginBottom:8},input:{backgroundColor:"#fff",borderWidth:1,borderColor:"#a8ad8e",borderRadius:12,padding:16,fontSize:16,color:"#1a1f0a"},helperText:{fontSize:12,color:"#6b7280",marginTop:8},button:{backgroundColor:"#5d6b4a",borderRadius:12,padding:16,alignItems:"center",marginTop:12},buttonDisabled:{opacity:.6},buttonText:{fontSize:16,fontWeight:"600",color:"#fff"},secondaryButton:{padding:16,alignItems:"center",marginTop:8},secondaryButtonText:{fontSize:14,fontWeight:"600",color:"#5d6b4a"},footer:{flexDirection:"row",justifyContent:"center",alignItems:"center",marginTop:24},footerText:{fontSize:14,color:"#6b7280"},linkText:{fontSize:14,fontWeight:"600",color:"#5d6b4a"}})},4101(e,t,o){"use strict";o.r(t),o.d(t,{default:()=>y});var a=o(6665),r=o(6283),n=o(3929),i=o(6773),l=o(5648),s=o(3668),d=o(4767),c=o(1690),u=o(530),f=o(9637),g=o(3353),h=o(5894),m=o(397);function y(){const e=(0,f.useRouter)(),{requestOtp:t,verifyOtp:o}=(0,g.useAuth)(),[s,y]=(0,a.useState)(""),[p,b]=(0,a.useState)(""),[j,w]=(0,a.useState)("email"),[T,C]=(0,a.useState)(!1);return(0,m.jsx)(d.default,{style:x.container,behavior:"height",children:(0,m.jsxs)(n.default,{style:x.content,children:[(0,m.jsxs)(n.default,{style:x.header,children:[(0,m.jsx)(h.Image,{source:{uri:"https://pub-e001eb4506b145aa938b5d3badbff6a5.r2.dev/attachments/dae4myluqaizgiwvqbwx1"},style:x.logo,contentFit:"contain"}),(0,m.jsx)(r.default,{style:x.title,children:"Welcome Back"}),(0,m.jsx)(r.default,{style:x.subtitle,children:"Sign in to track your dog walks"})]}),(0,m.jsxs)(n.default,{style:x.form,children:["email"===j?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(n.default,{style:x.inputContainer,children:[(0,m.jsx)(r.default,{style:x.label,children:"Email"}),(0,m.jsx)(i.default,{style:x.input,placeholder:"your@email.com",value:s,onChangeText:y,autoCapitalize:"none",keyboardType:"email-address",autoComplete:"email",editable:!T})]}),(0,m.jsx)(l.default,{style:[x.button,T&&x.buttonDisabled],onPress:async()=>{if(s){0,C(!0);try{await t(s.trim().toLowerCase()),w("otp")}catch(e){0,console.error("Request OTP error:",e),c.default.alert("Error",e.message||"Failed to request OTP")}finally{C(!1)}}else c.default.alert("Error","Please enter your email")},disabled:T,children:T?(0,m.jsx)(u.default,{color:"#fff"}):(0,m.jsx)(r.default,{style:x.buttonText,children:"Send OTP"})})]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(n.default,{style:x.inputContainer,children:[(0,m.jsx)(r.default,{style:x.label,children:"OTP Code"}),(0,m.jsx)(i.default,{style:x.input,placeholder:"Enter 6-digit code",value:p,onChangeText:b,keyboardType:"number-pad",maxLength:6,editable:!T}),(0,m.jsxs)(r.default,{style:x.helperText,children:["Sent to ",s]})]}),(0,m.jsx)(l.default,{style:[x.button,T&&x.buttonDisabled],onPress:async()=>{if(p){0,C(!0);try{await o(s.trim().toLowerCase(),p),e.replace("/")}catch(t){0,console.error("Verify OTP error:",t),c.default.alert("Error",t.message||"Invalid OTP code")}finally{C(!1)}}else c.default.alert("Error","Please enter the OTP code")},disabled:T,children:T?(0,m.jsx)(u.default,{color:"#fff"}):(0,m.jsx)(r.default,{style:x.buttonText,children:"Verify & Sign In"})}),(0,m.jsx)(l.default,{style:x.secondaryButton,onPress:()=>w("email"),disabled:T,children:(0,m.jsx)(r.default,{style:x.secondaryButtonText,children:"Change Email"})})]}),(0,m.jsxs)(n.default,{style:x.footer,children:[(0,m.jsx)(r.default,{style:x.footerText,children:"Don't have an account? "}),(0,m.jsx)(l.default,{onPress:()=>{e.push("/signup")},children:(0,m.jsx)(r.default,{style:x.linkText,children:"Sign Up"})})]})]})]})})}const x=s.default.create({container:{flex:1,backgroundColor:"#F8F7F2"},content:{flex:1,padding:24,justifyContent:"center"},header:{alignItems:"center",marginBottom:48},logo:{width:100,height:100},title:{fontSize:32,fontWeight:"700",color:"#1a1f0a",marginTop:16},subtitle:{fontSize:16,color:"#6b7280",marginTop:8,textAlign:"center"},form:{width:"100%"},inputContainer:{marginBottom:20},label:{fontSize:14,fontWeight:"600",color:"#5d6b4a",marginBottom:8},input:{backgroundColor:"#fff",borderWidth:1,borderColor:"#a8ad8e",borderRadius:12,padding:16,fontSize:16,color:"#1a1f0a"},helperText:{fontSize:12,color:"#6b7280",marginTop:8},button:{backgroundColor:"#5d6b4a",borderRadius:12,padding:16,alignItems:"center",marginTop:12},buttonDisabled:{opacity:.6},buttonText:{fontSize:16,fontWeight:"600",color:"#fff"},secondaryButton:{padding:16,alignItems:"center",marginTop:8},secondaryButtonText:{fontSize:14,fontWeight:"600",color:"#5d6b4a"},footer:{flexDirection:"row",justifyContent:"center",alignItems:"center",marginTop:24},footerText:{fontSize:14,color:"#6b7280"},linkText:{fontSize:14,fontWeight:"600",color:"#5d6b4a"}})},4395(e){e.exports={},e.exports.default=e.exports},4492(e,t,o){"use strict";o.r(t),o.d(t,{customAlphabet:()=>a,nanoid:()=>r});const a=(e,t=21)=>(o=t)=>{let a="",r=0|o;for(;r--;)a+=e[Math.random()*e.length|0];return a},r=(e=21)=>{let t="",o=0|e;for(;o--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[64*Math.random()|0];return t}},4509(e,t,o){"use strict";o.r(t),o.d(t,{default:()=>F});var a=o(6665),r=o(9637),n=o(6283),i=o(3929),l=o(2772),s=o(5648),d=o(530),c=o(5009),u=o(6773),f=o(8264),g=o(932),h=o(5894),m=o(893),y=o(8833),x=o(3087),p=o(2994),b=o(1449),j=o(3048),w=o(1168),T=o(8032),C=o(1858),S=o(5082),v=o(4550),k=o(2964),I=o(6746),B=o(9269),z=o(7627),P=o(2699),R=o(397);const D=[{id:"nearby",name:"Nearby",icon:w.default},{id:"popular",name:"Popular",icon:j.default},{id:"beaches",name:"Beaches",icon:v.default}];function F(){const e=(0,r.useRouter)(),t=(0,y.useSafeAreaInsets)(),{loadNearbyTrails:o,saveTrailBookmark:j,removeTrailBookmark:v,isTrailSaved:F}=(0,I.useTrails)(),[A,L]=(0,a.useState)("nearby"),[E,O]=(0,a.useState)([]),[W,_]=(0,a.useState)(!0),[,V]=(0,a.useState)(void 0),[N,H]=(0,a.useState)({}),[M,$]=(0,a.useState)(""),[G,U]=(0,a.useState)(!1),[q,J]=(0,a.useState)(""),[Y,K]=(0,a.useState)([]),Q=(0,a.useCallback)(async()=>{{J("Current location");try{if(navigator&&navigator.geolocation)return void navigator.geolocation.getCurrentPosition(async e=>{try{const t=await o(e.coords.latitude,e.coords.longitude);O(t)}catch(t){console.error("Failed to load nearby trails with browser location:",t);const e=await o();O(e)}finally{_(!1)}},async()=>{const e=await o();O(e),_(!1)})}catch(e){console.error("Geolocation not available on web:",e)}const t=await o();return O(t),void _(!1)}},[o]);(0,a.useEffect)(()=>{Q()},[Q]),(0,r.useFocusEffect)((0,a.useCallback)(()=>{console.log("Explore tab focused - refreshing nearby trails"),Q()},[Q]));const X=(0,a.useCallback)(()=>{const e=M.toLowerCase(),t=E.filter(t=>{const o=t.name?.toLowerCase()||"",a=t.city?.toLowerCase()||"",r=t.country?.toLowerCase()||"";return o.includes(e)||a.includes(e)||r.includes(e)}).map(e=>({id:e.id,name:e.name||`Trail ${new Date(e.date).toLocaleDateString()}`,location:e.city?`${e.city}, ${e.country||"Unknown"}`:"Location unknown",type:"trail"})).slice(0,6);K(t)},[M,E]);(0,a.useEffect)(()=>{M.trim()?X():K([])},[M,X]);const Z=()=>{U(!1),$(""),K([])},ee=e=>{if(!N[e]){const t=new c.default.Value(1);return H(o=>Object.assign({},o,{[e]:t})),t}return N[e]},te=(0,a.useCallback)(e=>{let t=e;return"popular"===A?t=[...t].sort((e,t)=>(t.rating||0)-(e.rating||0)):"beaches"===A&&(t=t.filter(e=>(e.environment_tags||[]).some(e=>e.toLowerCase().includes("beach")))),t},[A])(E);return(0,R.jsxs)(i.default,{style:P.default.safeContainer,children:[(0,R.jsxs)(l.default,{style:P.default.container,showsVerticalScrollIndicator:!1,stickyHeaderIndices:[0],children:[(0,R.jsxs)(i.default,{style:[P.default.stickyHeader,{paddingTop:t.top+16}],children:[(0,R.jsxs)(i.default,{style:P.default.stickySearchContainer,children:[(0,R.jsxs)(s.default,{style:P.default.searchBar,onPress:()=>{U(!0)},activeOpacity:.7,children:[(0,R.jsx)(C.default,{size:20,color:"#9ca3af"}),(0,R.jsx)(n.default,{style:P.default.searchPlaceholder,children:"Find trails"})]}),(0,R.jsx)(s.default,{style:P.default.demoButton,onPress:()=>e.push("/trail/demo-trail"),children:(0,R.jsx)(n.default,{style:P.default.demoButtonText,children:"Demo"})})]}),(0,R.jsx)(i.default,{style:P.default.categoriesSection,children:(0,R.jsx)(l.default,{horizontal:!0,showsHorizontalScrollIndicator:!1,contentContainerStyle:P.default.categoriesScroll,children:D.map(e=>{const t=e.icon,o=A===e.id;return(0,R.jsxs)(s.default,{style:[P.default.categoryButton,o&&P.default.categoryButtonActive],onPress:()=>{return t=e.id,void L(t);var t},children:[(0,R.jsx)(t,{size:20,color:o?"#fff":"#9ca3af",strokeWidth:2}),(0,R.jsx)(n.default,{style:[P.default.categoryText,o&&P.default.categoryTextActive],children:e.name})]},e.id)})})})]}),(0,R.jsx)(i.default,{style:P.default.categoryTrailsSection,children:W?(0,R.jsxs)(i.default,{style:P.default.loadingContainer,children:[(0,R.jsx)(d.default,{size:"large",color:"#64748b"}),(0,R.jsx)(n.default,{style:P.default.loadingText,children:"Loading trails..."})]}):te.length>0?te.map(t=>{const o=ee(t.id),a=F(t.id);return(0,R.jsxs)(s.default,{style:P.default.largeTrailCard,onPress:()=>{return o=t.id,void e.push(`/trail/${o}`);var o},children:[t.photo?(0,R.jsx)(h.Image,{source:{uri:t.photo},style:P.default.largeTrailImage,contentFit:"cover",cachePolicy:"memory-disk"}):(0,R.jsx)(z.default,{coordinates:t.coordinates,path:t.path,style:P.default.largeTrailImage,startLatitude:t.startLatitude,startLongitude:t.startLongitude}),(0,R.jsx)(m.LinearGradient,{colors:["rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0.25)","rgba(0, 0, 0, 0.6)"],locations:[0,.3,.6,1],style:P.default.cardGradient}),(0,R.jsx)(s.default,{style:P.default.bookmarkButton,onPress:e=>{e.stopPropagation(),(async(e,t=!1)=>{if(!t&&!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))return void console.log("Cannot bookmark mock trail:",e);const o=ee(e),a=F(e);c.default.sequence([c.default.timing(o,{toValue:.6,duration:100,useNativeDriver:!0}),c.default.spring(o,{toValue:1,friction:3,tension:100,useNativeDriver:!0})]).start();try{a?await v(e):await j(e)}catch(r){console.error("Failed to toggle bookmark:",r)}})(t.id,!0)},children:(0,R.jsx)(c.default.View,{style:{transform:[{scale:o}]},children:(0,R.jsx)(p.default,{size:20,color:a?"#000":"#64748b",fill:a?"#000":"none",strokeWidth:2})})}),(0,R.jsxs)(i.default,{style:P.default.cardOverlayContent,children:[(0,R.jsx)(n.default,{style:P.default.overlayTrailName,children:t.name||`Trail ${new Date(t.date).toLocaleDateString()}`}),(0,R.jsx)(n.default,{style:P.default.overlayLocation,children:t.city?`${t.city}, ${t.country||"Unknown"}`:"Location unknown"}),(0,R.jsxs)(i.default,{style:P.default.overlayBadges,children:[t.difficulty&&(0,R.jsxs)(i.default,{style:P.default.badge,children:[(0,R.jsx)(x.default,{size:14,color:"#d4d4a0",strokeWidth:2.5}),(0,R.jsx)(n.default,{style:P.default.badgeText,children:t.difficulty})]}),(0,R.jsxs)(i.default,{style:P.default.badge,children:[(0,R.jsx)(w.default,{size:14,color:"#d4d4a0",strokeWidth:2.5}),(0,R.jsx)(n.default,{style:P.default.badgeText,children:(0,B.formatDistance)(t.distance)})]}),"number"===typeof t.distance_from_user&&(0,R.jsxs)(i.default,{style:P.default.badge,children:[(0,R.jsx)(w.default,{size:14,color:"#d4d4a0",strokeWidth:2.5}),(0,R.jsx)(n.default,{style:P.default.badgeText,children:(0,B.formatDistance)(t.distance_from_user)})]}),t.rating&&(0,R.jsxs)(i.default,{style:P.default.badge,children:[(0,R.jsx)(S.default,{size:14,color:"#fbbf24",fill:"#fbbf24",strokeWidth:2}),(0,R.jsx)(n.default,{style:P.default.badgeText,children:t.rating.toFixed(1)})]})]})]})]},t.id)}):(0,R.jsxs)(i.default,{style:P.default.emptyContainer,children:[(0,R.jsx)(w.default,{size:48,color:"#9ca3af"}),(0,R.jsx)(n.default,{style:P.default.emptyText,children:"No trails found yet. Record a trail to share with others!"})]})}),(0,R.jsx)(i.default,{style:P.default.bottomPadding})]}),(0,R.jsx)(f.default,{visible:G,animationType:"slide",presentationStyle:"fullScreen",onRequestClose:Z,children:(0,R.jsxs)(i.default,{style:[P.default.searchModalContainer,{paddingTop:t.top}],children:[(0,R.jsxs)(i.default,{style:P.default.searchModalHeader,children:[(0,R.jsx)(s.default,{style:P.default.backButton,onPress:Z,children:(0,R.jsx)(b.default,{size:24,color:"#5d6b4a"})}),(0,R.jsxs)(i.default,{style:P.default.searchModalInputContainer,children:[(0,R.jsx)(u.default,{style:P.default.searchModalInput,placeholder:"Find trails",placeholderTextColor:"#9ca3af",value:M,onChangeText:$,autoFocus:!0,returnKeyType:"search"}),M.length>0&&(0,R.jsx)(s.default,{style:P.default.clearButton,onPress:()=>$(""),children:(0,R.jsx)(k.default,{size:20,color:"#64748b"})})]})]}),(0,R.jsxs)(i.default,{style:P.default.searchModalContent,children:[""===M.trim()&&(0,R.jsxs)(s.default,{style:P.default.currentLocationItem,onPress:()=>{U(!1),$(""),K([])},children:[(0,R.jsx)(i.default,{style:P.default.locationIconContainer,children:(0,R.jsx)(T.default,{size:20,color:"#5d6b4a"})}),(0,R.jsxs)(i.default,{style:P.default.locationTextContainer,children:[(0,R.jsx)(n.default,{style:P.default.locationTitle,children:"Current location"}),(0,R.jsx)(n.default,{style:P.default.locationSubtitle,children:q})]})]}),Y.length>0&&(0,R.jsx)(g.default,{data:Y,keyExtractor:e=>e.id,renderItem:({item:t})=>(0,R.jsxs)(s.default,{style:P.default.suggestionItem,onPress:()=>{return o=t.id,U(!1),$(""),K([]),void e.push(`/trail/${o}`);var o},children:[(0,R.jsx)(i.default,{style:P.default.suggestionIconContainer,children:(0,R.jsx)(w.default,{size:20,color:"#64748b"})}),(0,R.jsxs)(i.default,{style:P.default.suggestionTextContainer,children:[(0,R.jsx)(n.default,{style:P.default.suggestionTitle,children:t.name}),(0,R.jsx)(n.default,{style:P.default.suggestionSubtitle,children:t.location})]})]}),showsVerticalScrollIndicator:!1})]})]})})]})}},4674(e,t,o){"use strict";o.r(t),o.d(t,{default:()=>T});var a=o(6665),r=o(6283),n=o(3929),i=o(3668),l=o(5648),s=o(6773),d=o(484),c=o(1690),u=o(2772),f=o(530),g=o(9637),h=o(9908),m=o(262),y=o(9281),x=o(5624),p=o(4043),b=o(8833),j=o(594),w=o(397);function T(){const e=(0,g.useRouter)(),t=(0,b.useSafeAreaInsets)(),{dogProfile:o}=(0,h.useDogs)(),[i,T]=(0,a.useState)(""),[S,v]=(0,a.useState)(""),[k,I]=(0,a.useState)(""),[B,z]=(0,a.useState)(null),[P,R]=(0,a.useState)(null),[D,F]=(0,a.useState)(!1),[A,L]=(0,a.useState)(!1);(0,a.useEffect)(()=>{o&&(console.log("Loading existing dog profile for editing:",o),T(o.name),v(o.nickname||""),I(o.age.toString()),z(o.size),R(o.photo||null))},[o]);const E=async()=>{const{status:e}=await m.requestMediaLibraryPermissionsAsync();if("granted"!==e)return void c.default.alert("Permission needed","We need access to your photo library");L(!0);const t=await m.launchImageLibraryAsync({mediaTypes:["images"],allowsEditing:!0,aspect:[1,1],quality:.7});L(!1),!t.canceled&&t.assets[0]&&R(t.assets[0].uri)},O=async()=>{const{status:e}=await m.requestCameraPermissionsAsync();if("granted"!==e)return void c.default.alert("Permission needed","We need camera access to take photos");L(!0);const t=await m.launchCameraAsync({allowsEditing:!0,aspect:[1,1],quality:.7});L(!1),!t.canceled&&t.assets[0]&&R(t.assets[0].uri)};return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(g.Stack.Screen,{options:{headerShown:!1}}),(0,w.jsxs)(u.default,{style:C.container,contentContainerStyle:[C.content,{paddingTop:t.top+20}],children:[(0,w.jsxs)(n.default,{style:C.header,children:[(0,w.jsx)(r.default,{style:C.title,children:o?"Edit dog profile":"Tell us about your dog"}),(0,w.jsx)(r.default,{style:C.subtitle,children:o?"Update your dog's information":"Let's start with the basics"}),!o&&(0,w.jsxs)(n.default,{style:C.progressContainer,children:[(0,w.jsx)(n.default,{style:[C.progressDot,C.progressDotActive]}),(0,w.jsx)(n.default,{style:C.progressDot})]})]}),(0,w.jsxs)(l.default,{style:C.photoContainer,onPress:()=>{c.default.alert("Add Photo","Choose how you want to add a photo",[{text:"Take Photo",onPress:O},{text:"Choose from Library",onPress:E},{text:"Cancel",style:"cancel"}])},disabled:A,children:[A?(0,w.jsx)(f.default,{size:"large",color:"#FFFE77"}):P?(0,w.jsx)(d.default,{source:{uri:P},style:C.photo}):(0,w.jsxs)(n.default,{style:C.photoPlaceholder,children:[(0,w.jsx)(y.default,{size:32,color:"#FFFE77"}),(0,w.jsx)(r.default,{style:C.photoPlaceholderText,children:"Add Photo"})]}),P&&!A&&(0,w.jsx)(n.default,{style:C.photoOverlay,children:(0,w.jsx)(p.default,{size:24,color:"#1a1f0a"})})]}),(0,w.jsxs)(n.default,{style:C.formSection,children:[(0,w.jsx)(r.default,{style:C.label,children:"Name *"}),(0,w.jsx)(s.default,{style:C.input,value:i,onChangeText:T,placeholder:"Enter your dog's name",placeholderTextColor:"#5a6040",autoCapitalize:"words",testID:"dog-name-input"})]}),(0,w.jsxs)(n.default,{style:C.formSection,children:[(0,w.jsx)(r.default,{style:C.label,children:"Nickname (Optional)"}),(0,w.jsx)(s.default,{style:C.input,value:S,onChangeText:v,placeholder:"Enter a nickname",placeholderTextColor:"#5a6040",autoCapitalize:"words",testID:"dog-nickname-input"})]}),(0,w.jsxs)(n.default,{style:C.formSection,children:[(0,w.jsx)(r.default,{style:C.label,children:"Size *"}),(0,w.jsxs)(l.default,{style:C.pickerButton,onPress:()=>{F(!D)},testID:"size-picker-button",children:[(0,w.jsx)(r.default,{style:[C.pickerButtonText,!B&&C.pickerButtonTextPlaceholder],children:B||"Select size"}),(0,w.jsx)(x.default,{size:20,color:"#a8ad8e"})]}),D&&(0,w.jsx)(n.default,{style:C.pickerOptions,children:j.DOG_SIZES.map(e=>(0,w.jsx)(l.default,{style:[C.pickerOption,B===e&&C.pickerOptionSelected],onPress:()=>{z(e),F(!1)},testID:`size-option-${e}`,children:(0,w.jsx)(r.default,{style:[C.pickerOptionText,B===e&&C.pickerOptionTextSelected],children:e})},e))})]}),(0,w.jsxs)(n.default,{style:C.formSection,children:[(0,w.jsx)(r.default,{style:C.label,children:"Age (years) *"}),(0,w.jsx)(s.default,{style:C.input,value:k,onChangeText:I,placeholder:"Enter age",placeholderTextColor:"#5a6040",keyboardType:"numeric",testID:"dog-age-input"})]}),(0,w.jsx)(l.default,{style:[C.nextButton,{marginBottom:t.bottom+20}],onPress:()=>{if(!i.trim())return void c.default.alert("Missing Information","Please enter your dog's name");if(!B)return void c.default.alert("Missing Information","Please select your dog's size");const t=parseInt(k,10);if(!k||isNaN(t)||t<0||t>30)return void c.default.alert("Invalid Age","Please enter a valid age (0-30 years)");e[o?"replace":"push"]({pathname:"/onboarding/dog-personality",params:{name:i.trim(),nickname:S.trim(),age:t.toString(),size:B,photo:P||"",isEditing:o?"true":"false"}})},testID:"next-button",children:(0,w.jsx)(r.default,{style:C.nextButtonText,children:"Next"})})]})]})}const C=i.default.create({container:{flex:1,backgroundColor:"#1a1f0a"},content:{padding:24},header:{marginBottom:32,alignItems:"center"},title:{fontSize:28,fontWeight:"700",color:"#FFFE77",marginBottom:8,textAlign:"center"},subtitle:{fontSize:16,color:"#a8ad8e",textAlign:"center",marginBottom:24},progressContainer:{flexDirection:"row",gap:8},progressDot:{width:8,height:8,borderRadius:4,backgroundColor:"#3d4520"},progressDotActive:{backgroundColor:"#FFFE77"},photoContainer:{width:140,height:140,borderRadius:70,alignSelf:"center",marginBottom:32,overflow:"hidden"},photo:{width:"100%",height:"100%"},photoPlaceholder:{width:"100%",height:"100%",backgroundColor:"#282E10",justifyContent:"center",alignItems:"center",gap:8},photoPlaceholderText:{fontSize:14,color:"#a8ad8e",fontWeight:"500"},photoOverlay:{position:"absolute",bottom:0,right:0,width:40,height:40,borderRadius:20,backgroundColor:"#FFFE77",justifyContent:"center",alignItems:"center"},formSection:{marginBottom:24},label:{fontSize:15,fontWeight:"600",color:"#FFFE77",marginBottom:8},input:{backgroundColor:"#282E10",borderRadius:12,padding:16,fontSize:16,color:"#FFFE77",borderWidth:1,borderColor:"#3d4520"},pickerButton:{backgroundColor:"#282E10",borderRadius:12,padding:16,flexDirection:"row",justifyContent:"space-between",alignItems:"center",borderWidth:1,borderColor:"#3d4520"},pickerButtonText:{fontSize:16,color:"#FFFE77"},pickerButtonTextPlaceholder:{color:"#5a6040"},pickerOptions:{backgroundColor:"#282E10",borderRadius:12,marginTop:8,borderWidth:1,borderColor:"#3d4520",overflow:"hidden"},pickerOption:{padding:16,borderBottomWidth:1,borderBottomColor:"#1a1f0a"},pickerOptionSelected:{backgroundColor:"rgba(255, 254, 119, 0.15)"},pickerOptionText:{fontSize:16,color:"#a8ad8e"},pickerOptionTextSelected:{color:"#FFFE77",fontWeight:"600"},nextButton:{backgroundColor:"#FFFE77",borderRadius:12,padding:18,alignItems:"center",marginTop:16},nextButtonText:{fontSize:17,fontWeight:"600",color:"#1a1f0a"}})},5111(e,t,o){"use strict";o.r(t),o.d(t,{default:()=>b});var a=o(5227),r=o(4108),n=o(9637),i=o(284),l=o(6665),s=o(3929),d=o(530),c=o(3668),u=o(1015),f=o(3353),g=o(2598),h=o(6746),m=o(9908),y=o(397);i.preventAutoHideAsync();const x=new a.QueryClient;function p(){const{isAuthenticated:e,isLoading:t}=(0,f.useAuth)(),{hasDogProfile:o,isDogProfileLoading:a}=(0,m.useDogs)(),r=(0,n.useSegments)(),i=(0,n.useRouter)();return(0,l.useEffect)(()=>{if(t)return;if(a)return void console.log("Navigation: waiting for dog profiles to finish loading");const n="(tabs)"===r[0],l="login"===r[0]||"signup"===r[0],s="onboarding"===r[0];console.log("Navigation check:",{isAuthenticated:e,hasDogProfile:o,segments:r[0]}),e||!n&&!s?!e||o||s?e&&o&&l&&(console.log("Redirecting to explore: user authenticated with dog profile"),i.replace("/(tabs)/explore")):(console.log("Redirecting to onboarding: no dog profile"),i.replace("/onboarding/dog-basics")):(console.log("Redirecting to login: user not authenticated"),i.replace("/login"))},[e,o,r,t,a,i]),t?(0,y.jsx)(s.default,{style:{flex:1,justifyContent:"center",alignItems:"center"},children:(0,y.jsx)(d.default,{size:"large",color:"#2563eb"})}):(0,y.jsxs)(n.Stack,{screenOptions:{headerBackTitle:"Back"},children:[(0,y.jsx)(n.Stack.Screen,{name:"login",options:{headerShown:!1}}),(0,y.jsx)(n.Stack.Screen,{name:"signup",options:{headerShown:!1}}),(0,y.jsx)(n.Stack.Screen,{name:"(tabs)",options:{headerShown:!1}}),(0,y.jsx)(n.Stack.Screen,{name:"trail/[id]",options:{headerShown:!1}})]})}function b(){return(0,l.useEffect)(()=>{i.hideAsync()},[]),(0,y.jsx)(r.QueryClientProvider,{client:x,children:(0,y.jsx)(f.AuthContext,{children:(0,y.jsx)(g.AccountContext,{children:(0,y.jsx)(m.DogsContext,{children:(0,y.jsx)(h.TrailsContext,{children:(0,y.jsx)(u.GestureHandlerRootView,{style:j.container,children:(0,y.jsx)(p,{})})})})})})})}const j=c.default.create({container:{flex:1}})},5209(e,t,o){"use strict";o.r(t),o.d(t,{default:()=>A});var a=o(6665),r=o(6283),n=o(3929),i=o(3668),l=o(5648),s=o(1690),d=o(5009),c=o(444),u=o(6725),f=o(6773),g=o(8264),h=o(2772),m=o(9895),y=o(675),x=o(5163),p=o(2981),b=o(9637),j=o(5259),w=o(3271),T=o(5624),C=o(2301),S=o(1168),v=o(8032),k=o(8280),I=o(7353),B=o(1047),z=o(6746),P=o(3353),R=o(9269),D=o(397);const F="background-location-task";function A(){const{saveTrail:e,getTrailById:t}=(0,z.useTrails)(),{user:o}=(0,P.useAuth)(),i=(0,b.useLocalSearchParams)(),A=(0,b.useRouter)(),E="string"===typeof i.trailId?i.trailId:void 0,O=E?t(E):void 0,W=(0,a.useRef)(null),[_,V]=(0,a.useState)(!1),[N,H]=(0,a.useState)([]),[M,$]=(0,a.useState)(null),[G,U]=(0,a.useState)(0),[q,J]=(0,a.useState)(null),[Y,K]=(0,a.useState)(!0),[Q,X]=(0,a.useState)(null),Z=(0,a.useRef)(null),ee=(0,a.useRef)(null),te=.5*u.default.get("window").height,oe=280,ae=(0,a.useRef)(new d.default.Value(oe)).current,[re,ne]=(0,a.useState)(!1),[ie,le]=(0,a.useState)(0),[se,de]=(0,a.useState)(0),[ce,ue]=(0,a.useState)("0:00"),[fe,ge]=(0,a.useState)(0),[he,me]=(0,a.useState)(0),[ye,xe]=(0,a.useState)(!1),[pe,be]=(0,a.useState)(null),[je,we]=(0,a.useState)(""),[Te,Ce]=(0,a.useState)(""),[Se,ve]=(0,a.useState)(void 0),[ke,Ie]=(0,a.useState)([]),[Be,ze]=(0,a.useState)(void 0);(0,a.useEffect)(()=>{K(!1)},[]);(0,a.useEffect)(()=>{if(G>0){const e=(0,R.calculateTotalDistance)(N)/1e3;if(e>0){const t=G/60/e,o=Math.floor(t),a=Math.round(60*(t-o));ue(`${o}:${a.toString().padStart(2,"0")}`)}}},[G,N]);const Pe=(0,a.useRef)(0),Re=(0,a.useRef)(c.default.create({onStartShouldSetPanResponder:()=>!0,onMoveShouldSetPanResponder:(e,t)=>Math.abs(t.dy)>5,onPanResponderGrant:()=>{Pe.current=ae._value},onPanResponderMove:(e,t)=>{const o=Pe.current-t.dy;o>=oe&&o<=te&&ae.setValue(o)},onPanResponderRelease:(e,t)=>{const o=(te+oe)/2,a=ae._value;t.dy<-50?De():t.dy>50?Fe():a>o?De():Fe()}})).current,De=()=>{ne(!0),d.default.spring(ae,{toValue:te,useNativeDriver:!1,tension:50,friction:8}).start()},Fe=()=>{ne(!1),d.default.spring(ae,{toValue:oe,useNativeDriver:!1,tension:50,friction:8}).start()},Ae=()=>{xe(!1),be(null)};if(!q)return(0,D.jsxs)(n.default,{style:L.permissionContainer,children:[(0,D.jsx)(S.default,{size:64,color:"#666"}),(0,D.jsx)(r.default,{style:L.permissionTitle,children:"Location Permission Required"}),(0,D.jsx)(r.default,{style:L.permissionText,children:"This app needs access to your location to track your dog walks."}),(0,D.jsx)(l.default,{style:L.permissionButton,onPress:()=>{(async()=>{try{console.log("Requesting location permissions...");const{status:o}=await y.requestForegroundPermissionsAsync();if(console.log("Foreground permission status:",o),"granted"===o){try{const{status:e}=await y.requestBackgroundPermissionsAsync();console.log("Background permission status:",e),"granted"!==e&&s.default.alert("Background Location Required",'To continue recording your trail when the screen is locked, please enable "Allow all the time" in location settings.',[{text:"OK"}])}catch(e){console.warn("Background permission error (non-critical):",e.message)}J(!0);try{const e=await y.getCurrentPositionAsync({accuracy:x.LocationAccuracy.Balanced}),t={latitude:e.coords.latitude,longitude:e.coords.longitude};$(t),console.log("Initial location:",t)}catch(t){console.warn("Error getting initial location:",t.message)}}else J(!1),s.default.alert("Permission Required","Location permission is required to track your walks.",[{text:"OK"}])}catch(o){console.error("Permission error:",o);const e=o.message||"Failed to get location permission";e.includes("NSLocation")||e.includes("Info.plist")?s.default.alert("Configuration Error","This app needs to be built with a custom development build to use location tracking. Expo Go doesn't support background location tracking.\n\nPlease contact support or build a custom development client.",[{text:"OK"}]):s.default.alert("Error",e),J(!1)}finally{K(!1)}})()},children:(0,D.jsx)(r.default,{style:L.permissionButtonText,children:"Grant Permission"})})]});const Le=(0,R.calculateTotalDistance)(N),Ee=O&&_&&N.length>0&&O.coordinates.length>0?Math.min(Le/O.distance*100,100):0,Oe=!!O;return(0,D.jsxs)(n.default,{style:L.container,children:[M&&(0,D.jsx)(m.default,{ref:W,coordinates:N,style:L.map,initialRegion:{latitude:M.latitude,longitude:M.longitude,latitudeDelta:.01,longitudeDelta:.01},showsUserLocation:!0,followsUserLocation:_,showsMyLocationButton:!1}),(0,D.jsx)(l.default,{style:L.recenterButton,onPress:async()=>{if(W.current)try{const e=await y.getCurrentPositionAsync({accuracy:x.LocationAccuracy.Balanced}),t={latitude:e.coords.latitude,longitude:e.coords.longitude};$(t),W.current.animateToRegion({latitude:t.latitude,longitude:t.longitude,latitudeDelta:.01,longitudeDelta:.01},500)}catch(e){console.error("Error getting current location:",e),M&&W.current.animateToRegion({latitude:M.latitude,longitude:M.longitude,latitudeDelta:.01,longitudeDelta:.01},500)}},activeOpacity:.8,children:(0,D.jsx)(v.default,{size:24,color:"#5d6b4a"})}),(0,D.jsxs)(d.default.View,{style:[L.bottomSheet,{height:d.default.add(ae,92),bottom:0}],children:[(0,D.jsx)(n.default,Object.assign({},Re.panHandlers,{style:L.handleBar,children:(0,D.jsxs)(l.default,{style:L.handleContainer,onPress:()=>{re?Fe():De()},activeOpacity:.7,children:[(0,D.jsx)(n.default,{style:L.handle}),re?(0,D.jsx)(T.default,{size:20,color:"#9ca3af"}):(0,D.jsx)(C.default,{size:20,color:"#9ca3af"})]})})),(0,D.jsxs)(n.default,{style:L.bottomSheetContent,children:[(0,D.jsxs)(n.default,{style:L.statsGrid,children:[(0,D.jsxs)(n.default,{style:L.statItem,children:[(0,D.jsx)(r.default,{style:L.statItemLabel,children:"Time"}),(0,D.jsx)(r.default,{style:L.statItemValue,children:(0,R.formatDuration)(G)})]}),(0,D.jsxs)(n.default,{style:L.statItem,children:[(0,D.jsx)(r.default,{style:L.statItemLabel,children:"Distance"}),(0,D.jsx)(r.default,{style:L.statItemValue,children:(0,R.formatDistance)(Le)})]}),(0,D.jsxs)(n.default,{style:L.statItem,children:[(0,D.jsx)(r.default,{style:L.statItemLabel,children:"Elevation"}),(0,D.jsxs)(r.default,{style:L.statItemValue,children:[ie.toFixed(0),"m"]})]}),(0,D.jsxs)(n.default,{style:L.statItem,children:[(0,D.jsx)(r.default,{style:L.statItemLabel,children:"Pace"}),(0,D.jsxs)(r.default,{style:L.statItemValue,children:[ce,"/km"]})]}),(0,D.jsxs)(n.default,{style:L.statItem,children:[(0,D.jsx)(r.default,{style:L.statItemLabel,children:"Speed"}),(0,D.jsxs)(r.default,{style:L.statItemValue,children:[fe.toFixed(1)," km/h"]})]}),Oe&&(0,D.jsxs)(n.default,{style:L.statItem,children:[(0,D.jsx)(r.default,{style:L.statItemLabel,children:"Progress"}),(0,D.jsxs)(r.default,{style:L.statItemValue,children:[Ee.toFixed(0),"%"]})]})]}),(0,D.jsx)(l.default,{style:[L.recordButton,_&&L.recordButtonActive],onPress:_?async()=>{console.log("Stopping recording...");try{await p.isTaskRegisteredAsync(F)&&await y.stopLocationUpdatesAsync(F)}catch(g){console.error("Error stopping background location:",g)}Z.current&&(Z.current.remove(),Z.current=null),ee.current&&(clearInterval(ee.current),ee.current=null);const e=await j.default.getItem("recording_coordinates"),t=e?JSON.parse(e):N,o=await j.default.getItem("recording_max_elevation"),a=o?parseFloat(o):se,r=await j.default.getItem("recording_max_speed"),n=r?parseFloat(r):he,i=await j.default.getItem("recording_start_time"),l=i?Math.floor((Date.now()-parseInt(i))/1e3):G;if(t.length<2)return s.default.alert("No Trail Data","Not enough data to save this trail. Try walking a bit more!"),V(!1),H([]),U(0),await j.default.removeItem("recording_coordinates"),await j.default.removeItem("recording_max_elevation"),await j.default.removeItem("recording_max_speed"),await j.default.removeItem("recording_start_time"),void await j.default.removeItem("recording_last_update");const d=(0,R.calculateTotalDistance)(t),c=d/1e3;let u="0:00";if(c>0){const e=l/60/c,t=Math.floor(e);u=`${t}:${Math.round(60*(e-t)).toString().padStart(2,"0")}`}const f={id:Date.now().toString(),date:Date.now(),distance:d,duration:l,coordinates:t,city:Q?.city,country:Q?.country,pace:u,speed:n,maxElevation:a};be(f),we(f.name||""),Ce(f.description||""),ve(f.photo||void 0),Ie(f.tags||[]),ze(f.difficulty||void 0),xe(!0)}:async()=>{console.log("Starting recording..."),V(!0),H([]),U(0),de(0),me(0);try{const t=Date.now();await j.default.setItem("recording_start_time",t.toString()),await j.default.removeItem("recording_coordinates"),await j.default.removeItem("recording_max_elevation"),await j.default.removeItem("recording_max_speed"),await j.default.removeItem("recording_last_update");const o=await y.getCurrentPositionAsync({accuracy:x.LocationAccuracy.Balanced});X(null);const a={latitude:o.coords.latitude,longitude:o.coords.longitude};await j.default.setItem("recording_coordinates",JSON.stringify([a])),H([a]),$(a);try{await y.startLocationUpdatesAsync(F,{accuracy:x.LocationAccuracy.BestForNavigation,distanceInterval:3,timeInterval:1e3,foregroundService:{notificationTitle:"Recording Trail",notificationBody:"TailTrails is tracking your walk",notificationColor:"#2563eb"},pausesUpdatesAutomatically:!1,showsBackgroundLocationIndicator:!0}),console.log("Background location tracking started successfully")}catch(e){console.warn("Background location not available:",e.message),(e.message?.includes("Background location")||e.message?.includes("UIBackgroundModes"))&&s.default.alert("Background Tracking Unavailable","Background location tracking requires a custom development build. The app will continue recording in foreground mode only. Please keep the app open while recording.",[{text:"OK"}])}Z.current=await y.watchPositionAsync({accuracy:x.LocationAccuracy.BestForNavigation,distanceInterval:3,timeInterval:1e3},async e=>{const t={latitude:e.coords.latitude,longitude:e.coords.longitude};if(console.log("Foreground position update:",t,"Accuracy:",e.coords.accuracy),$(t),H(e=>{const o=[...e,t];return console.log("Total coordinates:",o.length,"Distance:",(0,R.calculateTotalDistance)(o),"m"),j.default.setItem("recording_coordinates",JSON.stringify(o)).catch(e=>{console.error("Error saving coordinates:",e)}),o}),e.coords.altitude){const t=Math.max(0,e.coords.altitude);le(t),t>se&&(de(t),await j.default.setItem("recording_max_elevation",t.toString()))}if(e.coords.speed&&e.coords.speed>0){const t=3.6*e.coords.speed;ge(t),t>he&&(me(t),await j.default.setItem("recording_max_speed",t.toString()))}}),ee.current=setInterval(async()=>{try{const e=await j.default.getItem("recording_start_time");if(e){const t=parseInt(e),o=Math.floor((Date.now()-t)/1e3);U(o)}}catch(e){console.error("Error calculating duration:",e)}},1e3)}catch(t){console.error("Recording error:",t);let e="Failed to start recording. Please try again.";t.message?.includes("rate limit")?e="Please wait a moment before starting a new recording. Location service is temporarily limited.":(t.message?.includes("Background location")||t.message?.includes("UIBackgroundModes"))&&(e="Background location tracking requires a custom development build. Please build the app with EAS or use foreground-only mode."),s.default.alert("Error",e),V(!1)}},activeOpacity:.8,children:_?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(I.default,{size:24,color:"#fff",fill:"#fff"}),(0,D.jsx)(r.default,{style:L.recordButtonText,children:"Stop & Save"})]}):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(k.default,{size:24,color:"#fff",fill:"#fff"}),(0,D.jsx)(r.default,{style:L.recordButtonText,children:"Start Trail"})]})}),re&&(0,D.jsxs)(n.default,{style:L.expandedContent,children:[(0,D.jsx)(n.default,{style:L.divider}),(0,D.jsxs)(l.default,{style:L.optionRow,onPress:()=>{s.default.alert("Apple Watch","Connect your Apple Watch to sync workout data.")},activeOpacity:.7,children:[(0,D.jsx)(n.default,{style:L.optionIconContainer,children:(0,D.jsx)(B.default,{size:24,color:"#5d6b4a"})}),(0,D.jsxs)(n.default,{style:L.optionTextContainer,children:[(0,D.jsx)(r.default,{style:L.optionTitle,children:"Apple Watch"}),(0,D.jsx)(r.default,{style:L.optionSubtitle,children:"Not connected"})]}),(0,D.jsx)(n.default,{style:L.optionBadge,children:(0,D.jsx)(r.default,{style:L.optionBadgeText,children:"Connect"})})]}),(0,D.jsxs)(l.default,{style:L.optionRow,onPress:()=>{s.default.alert("Alerts","Configure alerts for distance milestones and pace notifications.")},activeOpacity:.7,children:[(0,D.jsx)(n.default,{style:L.optionIconContainer,children:(0,D.jsx)(w.default,{size:24,color:"#5d6b4a"})}),(0,D.jsxs)(n.default,{style:L.optionTextContainer,children:[(0,D.jsx)(r.default,{style:L.optionTitle,children:"Alerts"}),(0,D.jsx)(r.default,{style:L.optionSubtitle,children:"Distance & pace notifications"})]}),(0,D.jsx)(n.default,{style:[L.optionBadge,L.optionBadgeActive],children:(0,D.jsx)(r.default,{style:[L.optionBadgeText,L.optionBadgeTextActive],children:"Active"})})]})]})]})]}),(0,D.jsx)(g.default,{visible:ye,animationType:"slide",transparent:!0,onRequestClose:Ae,children:(0,D.jsx)(n.default,{style:L.modalOverlay,children:(0,D.jsx)(n.default,{style:L.modalContainer,children:(0,D.jsxs)(h.default,{contentContainerStyle:L.modalContent,children:[(0,D.jsx)(r.default,{style:L.modalTitle,children:"Save Trail"}),(0,D.jsx)(f.default,{placeholder:"Trail name",value:je,onChangeText:we,style:L.input}),(0,D.jsx)(f.default,{placeholder:"Description",value:Te,onChangeText:Ce,style:[L.input,{height:100}],multiline:!0}),(0,D.jsx)(f.default,{placeholder:"Photo URL (optional)",value:Se,onChangeText:ve,style:L.input}),(0,D.jsxs)(n.default,{style:{flexDirection:"row",gap:8,marginTop:8},children:[(0,D.jsx)(l.default,{style:L.modalButton,onPress:Ae,children:(0,D.jsx)(r.default,{style:L.modalButtonText,children:"Cancel"})}),(0,D.jsx)(l.default,{style:[L.modalButton,L.modalButtonPrimary],onPress:async()=>{if(!pe)return;const t=Object.assign({},pe,{name:je||pe.name||"Untitled Trail",description:Te,photo:Se,tags:ke,difficulty:Be});try{await e(t),xe(!1),be(null),V(!1),H([]),U(0),X(null),le(0),de(0),ue("0:00"),ge(0),me(0),await j.default.removeItem("recording_coordinates"),await j.default.removeItem("recording_max_elevation"),await j.default.removeItem("recording_max_speed"),await j.default.removeItem("recording_start_time"),await j.default.removeItem("recording_last_update");const o=t.id||null;o?A.push(`/trail/${o}`):s.default.alert("Success","Trail saved successfully!")}catch(o){console.error("Save failed",o),s.default.alert("Error","Failed to save trail")}},children:(0,D.jsx)(r.default,{style:[L.modalButtonText,{color:"#fff"}],children:"Save Trail"})})]})]})})})})]})}const L=i.default.create({container:{flex:1,backgroundColor:"#F8F7F2"},map:Object.assign({},i.default.absoluteFillObject),webContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"#F8F7F2",padding:20},webText:{marginTop:16,fontSize:16,color:"#666",textAlign:"center"},loadingContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"#F8F7F2"},loadingText:{marginTop:16,fontSize:16,color:"#666"},permissionContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"#F8F7F2",padding:32},permissionTitle:{marginTop:16,fontSize:20,fontWeight:"700",color:"#1f2937",textAlign:"center"},permissionText:{marginTop:8,fontSize:16,color:"#6b7280",textAlign:"center"},permissionButton:{marginTop:24,paddingHorizontal:32,paddingVertical:16,backgroundColor:"#5d6b4a",borderRadius:12},permissionButtonText:{fontSize:16,fontWeight:"600",color:"#fff"},statsContainer:{position:"absolute",left:20,right:20,flexDirection:"row",gap:12},statBox:{flex:1,backgroundColor:"rgba(255, 255, 255, 0.95)",borderRadius:16,padding:16,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:8,elevation:4},statLabel:{fontSize:13,color:"#6b7280",fontWeight:"500",marginBottom:4},statValue:{fontSize:24,color:"#1f2937",fontWeight:"700"},controlContainer:{position:"absolute",left:20,right:20,alignItems:"center"},recordButton:{flexDirection:"row",alignItems:"center",gap:12,paddingHorizontal:32,paddingVertical:20,backgroundColor:"#5d6b4a",borderRadius:50,shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:12,elevation:8},recordButtonActive:{backgroundColor:"#dc2626"},recordButtonText:{fontSize:18,fontWeight:"700",color:"#fff"},bottomSheet:{position:"absolute",left:0,right:0,backgroundColor:"#F8F7F2",borderTopLeftRadius:24,borderTopRightRadius:24,shadowColor:"#000",shadowOffset:{width:0,height:-4},shadowOpacity:.15,shadowRadius:16,elevation:20},handleBar:{paddingTop:12,paddingBottom:8,alignItems:"center"},handleContainer:{alignItems:"center",gap:4},handle:{width:40,height:4,backgroundColor:"#d1d5db",borderRadius:2},bottomSheetContent:{flex:1,paddingHorizontal:20,paddingBottom:92},statsGrid:{flexDirection:"row",flexWrap:"wrap",gap:12,marginBottom:20},statItem:{width:"31%",backgroundColor:"#f9fafb",borderRadius:12,padding:12,alignItems:"center"},statItemLabel:{fontSize:11,color:"#6b7280",fontWeight:"600",textTransform:"uppercase",letterSpacing:.5,marginBottom:6},statItemValue:{fontSize:18,color:"#1f2937",fontWeight:"700"},expandedContent:{marginTop:8},divider:{height:1,backgroundColor:"#e5e7eb",marginVertical:16},optionRow:{flexDirection:"row",alignItems:"center",paddingVertical:16,paddingHorizontal:16,backgroundColor:"#f9fafb",borderRadius:12,marginBottom:12},optionIconContainer:{width:48,height:48,borderRadius:24,backgroundColor:"rgba(93, 107, 74, 0.1)",alignItems:"center",justifyContent:"center",marginRight:12},optionTextContainer:{flex:1},optionTitle:{fontSize:16,fontWeight:"600",color:"#1f2937",marginBottom:2},optionSubtitle:{fontSize:13,color:"#6b7280"},optionBadge:{paddingHorizontal:12,paddingVertical:6,borderRadius:12,backgroundColor:"#e5e7eb"},optionBadgeActive:{backgroundColor:"rgba(93, 107, 74, 0.15)"},optionBadgeText:{fontSize:12,fontWeight:"600",color:"#6b7280"},optionBadgeTextActive:{color:"#5d6b4a"},modalOverlay:{flex:1,backgroundColor:"rgba(0,0,0,0.4)",justifyContent:"center",alignItems:"center",padding:20},modalContainer:{width:"100%",maxHeight:"90%",backgroundColor:"#fff",borderRadius:12,overflow:"hidden"},modalContent:{padding:20},modalTitle:{fontSize:20,fontWeight:"700",color:"#1f2937",marginBottom:12},input:{borderWidth:1,borderColor:"#e5e7eb",backgroundColor:"#f9fafb",paddingHorizontal:12,paddingVertical:10,borderRadius:8,marginTop:8},modalButton:{flex:1,paddingVertical:12,paddingHorizontal:16,borderRadius:10,backgroundColor:"#e5e7eb",alignItems:"center",justifyContent:"center"},modalButtonPrimary:{backgroundColor:"#5d6b4a",marginLeft:8},modalButtonText:{fontSize:16,fontWeight:"600",color:"#1f2937"},recenterButton:{position:"absolute",top:60,right:20,width:48,height:48,borderRadius:24,backgroundColor:"#ffffff",alignItems:"center",justifyContent:"center",shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.15,shadowRadius:8,elevation:4}})},5250(e,t,o){"use strict";o.r(t),o.d(t,{default:()=>n});var a=o(9637),r=o(397);function n(){return(0,r.jsx)(a.Redirect,{href:"/(tabs)/explore"})}},5625(e,t,o){"use strict";o.r(t),o.d(t,{default:()=>b});o(6665);var a=o(6283),r=o(3929),n=o(3668),i=o(2772),l=o(5648),s=o(9637),d=o(9895),c=o(5395),u=o(4494),f=o(1168),g=o(8032),h=o(477),m=o(9582),y=o(9269),x=o(397);const p={id:"demo-trail",name:"Scenic Coastal Walk",distance:5210,duration:3600,coordinates:[{latitude:50.81999932593175,longitude:-.1443926504884132},{latitude:50.81982005377856,longitude:-.14389605957015306},{latitude:50.8195735534442,longitude:-.14290287773496857},{latitude:50.81976403108945,longitude:-.14245949298612004},{latitude:50.819651985510006,longitude:-.1415904588798469},{latitude:50.819360665744455,longitude:-.141129338740825},{latitude:50.81955114425804,longitude:-.14054407087405707},{latitude:50.8194278935438,longitude:-.1397814491065219},{latitude:50.819282233189426,longitude:-.1389301503892284},{latitude:50.819696803774036,longitude:-.13903656272921694},{latitude:50.81999932593175,longitude:-.13919618123853184},{latitude:50.82010016621547,longitude:-.13853997181101363},{latitude:50.82041389015009,longitude:-.138220734792327},{latitude:50.82055954697452,longitude:-.13852223642078343},{latitude:50.82086206354296,longitude:-.13829167635185513}],city:"Brighton",country:"UK",difficulty:"Easy",pace:"11:32",maxElevation:45};function b(){const e=(0,s.useRouter)();return(0,x.jsxs)(r.default,{style:j.container,children:[(0,x.jsx)(s.Stack.Screen,{options:{title:"Demo Trail",headerShown:!1}}),(0,x.jsxs)(i.default,{style:j.scrollView,children:[(0,x.jsxs)(r.default,{style:j.header,children:[(0,x.jsx)(l.default,{style:j.backButton,onPress:()=>e.back(),children:(0,x.jsx)(c.default,{size:24,color:"#fff"})}),(0,x.jsxs)(r.default,{style:j.headerContent,children:[(0,x.jsx)(a.default,{style:j.title,children:p.name}),(0,x.jsxs)(r.default,{style:j.locationRow,children:[(0,x.jsx)(f.default,{size:16,color:"#fff"}),(0,x.jsxs)(a.default,{style:j.locationText,children:[p.city,", ",p.country]})]})]})]}),(0,x.jsx)(r.default,{style:j.mapContainer,children:(0,x.jsx)(d.default,{coordinates:p.coordinates,style:j.map,scrollEnabled:!0,zoomEnabled:!0})}),(0,x.jsxs)(r.default,{style:j.statsContainer,children:[(0,x.jsxs)(r.default,{style:j.statItem,children:[(0,x.jsx)(g.default,{size:20,color:m.default.primary}),(0,x.jsx)(a.default,{style:j.statValue,children:(0,y.formatDistance)(p.distance)}),(0,x.jsx)(a.default,{style:j.statLabel,children:"Distance"})]}),(0,x.jsxs)(r.default,{style:j.statItem,children:[(0,x.jsx)(u.default,{size:20,color:m.default.primary}),(0,x.jsx)(a.default,{style:j.statValue,children:(0,y.formatDuration)(p.duration)}),(0,x.jsx)(a.default,{style:j.statLabel,children:"Time"})]}),(0,x.jsxs)(r.default,{style:j.statItem,children:[(0,x.jsx)(h.default,{size:20,color:m.default.primary}),(0,x.jsxs)(a.default,{style:j.statValue,children:[p.maxElevation,"m"]}),(0,x.jsx)(a.default,{style:j.statLabel,children:"Elevation"})]})]}),(0,x.jsxs)(r.default,{style:j.section,children:[(0,x.jsx)(a.default,{style:j.sectionTitle,children:"About this trail"}),(0,x.jsx)(a.default,{style:j.description,children:"This is a beautiful coastal walk along the Brighton seafront. Perfect for a morning stroll with your dog. The path is paved and offers stunning views of the English Channel."})]})]})]})}const j=n.default.create({container:{flex:1,backgroundColor:"#fff"},scrollView:{flex:1},header:{height:200,backgroundColor:m.default.primary,justifyContent:"flex-end",padding:20},backButton:{position:"absolute",top:50,left:20,zIndex:10},headerContent:{marginBottom:10},title:{fontSize:28,fontWeight:"bold",color:"#fff",marginBottom:5},locationRow:{flexDirection:"row",alignItems:"center"},locationText:{color:"#fff",marginLeft:5,fontSize:16},mapContainer:{height:300,width:"100%"},map:{flex:1},statsContainer:{flexDirection:"row",justifyContent:"space-around",padding:20,backgroundColor:"#f8f9fa",borderBottomWidth:1,borderBottomColor:"#eee"},statItem:{alignItems:"center"},statValue:{fontSize:18,fontWeight:"bold",marginTop:5,color:"#333"},statLabel:{fontSize:12,color:"#666",marginTop:2},section:{padding:20},sectionTitle:{fontSize:20,fontWeight:"bold",marginBottom:10,color:"#333"},description:{fontSize:16,lineHeight:24,color:"#666"}})},5938(e,t,o){"use strict";o.r(t),o.d(t,{API_URL:()=>a});const a={NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.0",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"54.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_API_URL||"http://localhost:8080";console.log("Current API URL:",a)},6183(e,t,o){"use strict";o.r(t),o.d(t,{default:()=>p});var a=o(6665),r=o(6283),n=o(3929),i=o(3668),l=o(5648),s=o(2772),d=o(1690),c=o(530),u=o(9637),f=o(1449),g=o(8833),h=o(594),m=o(3353),y=o(9908),x=o(397);function p(){const e=(0,u.useRouter)(),t=(0,u.useLocalSearchParams)(),{user:o}=(0,m.useAuth)(),{dogProfile:i,refreshDogProfile:p,createDogProfile:j,updateDogProfile:w}=(0,y.useDogs)(),T=(0,g.useSafeAreaInsets)(),[C,S]=(0,a.useState)([]),[v,k]=(0,a.useState)("Fair"),[I,B]=(0,a.useState)(!1),z="true"===t.isEditing;(0,a.useEffect)(()=>{i&&z&&(console.log("Loading existing personality tags for editing:",i.personality_tags),S(i.personality_tags||[]),k(i.recall_reliability||"Fair"))},[i,z]);return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(u.Stack.Screen,{options:{headerShown:!1}}),(0,x.jsxs)(n.default,{style:[b.container,{paddingTop:T.top+20}],children:[(0,x.jsxs)(s.default,{style:b.scrollView,contentContainerStyle:b.content,children:[(0,x.jsxs)(n.default,{style:b.header,children:[(0,x.jsx)(r.default,{style:b.title,children:"Personality & Behaviour"}),(0,x.jsx)(r.default,{style:b.subtitle,children:"Choose the tags that best describe your dog"}),!z&&(0,x.jsxs)(n.default,{style:b.progressContainer,children:[(0,x.jsx)(n.default,{style:b.progressDot}),(0,x.jsx)(n.default,{style:[b.progressDot,b.progressDotActive]})]})]}),(0,x.jsx)(n.default,{style:b.tagsContainer,children:h.PERSONALITY_TAGS.map(e=>(0,x.jsx)(l.default,{style:[b.tag,C.includes(e)&&b.tagSelected],onPress:()=>(e=>{S(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e),testID:`tag-${e}`,children:(0,x.jsx)(r.default,{style:[b.tagText,C.includes(e)&&b.tagTextSelected],children:e})},e))}),(0,x.jsx)(n.default,{style:b.sectionHeader,children:(0,x.jsx)(r.default,{style:b.sectionTitle,children:"Health & Safety"})}),(0,x.jsxs)(n.default,{style:b.section,children:[(0,x.jsx)(r.default,{style:b.label,children:"Recall Reliability"}),(0,x.jsx)(r.default,{style:b.helperText,children:"How reliably does your dog return when called?"}),(0,x.jsx)(n.default,{style:b.recallContainer,children:h.RECALL_RELIABILITY_OPTIONS.map(e=>(0,x.jsx)(l.default,{style:[b.recallOption,v===e&&b.recallOptionSelected],onPress:()=>{k(e)},testID:`recall-${e}`,children:(0,x.jsx)(r.default,{style:[b.recallText,v===e&&b.recallTextSelected],children:e})},e))})]})]}),(0,x.jsxs)(n.default,{style:[b.footer,{paddingBottom:T.bottom+20}],children:[(0,x.jsxs)(l.default,{style:b.backButton,onPress:()=>{e.back()},disabled:I,testID:"back-button",children:[(0,x.jsx)(f.default,{size:24,color:"#FFFE77"}),(0,x.jsx)(r.default,{style:b.backButtonText,children:"Back"})]}),(0,x.jsx)(l.default,{style:[b.finishButton,I&&b.finishButtonDisabled],onPress:async()=>{if(o){0,B(!0);try{console.log(z?"Updating dog profile for user:":"Creating dog profile for user:",o.id);const a={user_id:o.id,name:t.name,nickname:t.nickname||void 0,size:t.size,age:parseInt(t.age,10),photo:t.photo||void 0,personality_tags:C,recall_reliability:v};console.log("Dog profile data:",a),z&&i?.id?await w(Object.assign({},a,{id:i.id})):await j(a),z?e.replace("/(tabs)/profile"):e.replace("/(tabs)/explore")}catch(a){console.error("Error saving dog profile:",a),d.default.alert("Error",a.message||"Failed to save dog profile"),B(!1)}}else d.default.alert("Error","You must be logged in to create a dog profile")},disabled:I,testID:"finish-button",children:I?(0,x.jsx)(c.default,{color:"#1a1f0a"}):(0,x.jsx)(r.default,{style:b.finishButtonText,children:z?"Save":"Finish"})})]})]})]})}const b=i.default.create({container:{flex:1,backgroundColor:"#1a1f0a"},scrollView:{flex:1},content:{padding:24},header:{marginBottom:32,alignItems:"center"},title:{fontSize:28,fontWeight:"700",color:"#FFFE77",marginBottom:8,textAlign:"center"},subtitle:{fontSize:16,color:"#a8ad8e",textAlign:"center",marginBottom:24,paddingHorizontal:16},progressContainer:{flexDirection:"row",gap:8},progressDot:{width:8,height:8,borderRadius:4,backgroundColor:"#3d4520"},progressDotActive:{backgroundColor:"#FFFE77"},tagsContainer:{flexDirection:"row",flexWrap:"wrap",gap:12},tag:{paddingHorizontal:20,paddingVertical:12,borderRadius:24,backgroundColor:"#282E10",borderWidth:1.5,borderColor:"#3d4520"},tagSelected:{backgroundColor:"rgba(255, 254, 119, 0.15)",borderColor:"#FFFE77"},tagText:{fontSize:15,fontWeight:"500",color:"#a8ad8e"},tagTextSelected:{color:"#FFFE77",fontWeight:"600"},footer:{flexDirection:"row",gap:12,paddingHorizontal:24,paddingTop:20,borderTopWidth:1,borderTopColor:"#3d4520",backgroundColor:"#282E10"},backButton:{flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center",gap:8,backgroundColor:"transparent",borderRadius:12,padding:18,borderWidth:1.5,borderColor:"#FFFE77"},backButtonText:{fontSize:17,fontWeight:"600",color:"#FFFE77"},finishButton:{flex:1,backgroundColor:"#FFFE77",borderRadius:12,padding:18,alignItems:"center",justifyContent:"center"},finishButtonDisabled:{opacity:.6},finishButtonText:{fontSize:17,fontWeight:"600",color:"#1a1f0a"},sectionHeader:{marginTop:32,marginBottom:16},sectionTitle:{fontSize:24,fontWeight:"700",color:"#FFFE77"},section:{marginBottom:24},label:{fontSize:17,fontWeight:"600",color:"#FFFE77",marginBottom:4},helperText:{fontSize:14,color:"#a8ad8e",marginBottom:12},recallContainer:{flexDirection:"row",gap:8},recallOption:{flex:1,paddingVertical:12,paddingHorizontal:16,borderRadius:12,backgroundColor:"#282E10",borderWidth:1.5,borderColor:"#3d4520",alignItems:"center"},recallOptionSelected:{backgroundColor:"rgba(255, 254, 119, 0.15)",borderColor:"#FFFE77"},recallText:{fontSize:14,fontWeight:"500",color:"#a8ad8e"},recallTextSelected:{color:"#FFFE77",fontWeight:"600"}})},6746(e,t,o){"use strict";o.r(t),o.d(t,{TrailsContext:()=>l,useTrails:()=>s});var a=o(6665),r=o(2790),n=o(3353),i=o(5938);const[l,s]=(0,r.default)(()=>{const{user:e,session:t}=(0,n.useAuth)(),[o,r]=(0,a.useState)([]),[l,s]=(0,a.useState)([]),[d,c]=(0,a.useState)(!0),[u,f]=(0,a.useState)(!0),g=(0,a.useCallback)(async()=>{if(e&&t)try{console.log("Loading trails for user:",e.id);const o=await fetch(`${i.API_URL}/trail`,{headers:{Authorization:`Bearer ${t?.accessToken}`}});if(o.ok){const e=await o.json();r(e||[])}else console.error("Failed to load trails:",o.status),r([])}catch(o){console.error("Failed to load trails:",o)}finally{c(!1)}else try{const e=await fetch(`${i.API_URL}/trail`);if(e.ok){const t=await e.json();r(t||[])}else console.error("Failed to load trails (public):",e.status),r([])}catch(a){console.error("Failed to load trails:",a),r([])}finally{c(!1)}},[e,t]),h=(0,a.useCallback)(async()=>{if(!t?.accessToken)return s([]),void f(!1);try{console.log("Loading my trails for user:",e?.id);const o=await fetch(`${i.API_URL}/trail/me`,{headers:{Authorization:`Bearer ${t?.accessToken}`}});if(o.ok){const e=await o.json();s(e||[])}else console.error("Failed to load my trails:",o.status),s([])}catch(o){console.error("Failed to load saved trails:",o),s([])}finally{f(!1)}},[e,t]);(0,a.useEffect)(()=>{g(),h()},[g,h]);const m=(0,a.useCallback)(async o=>{if(!e)throw console.error("No user logged in"),new Error("Must be logged in to save trails");if(!t?.accessToken)throw console.error("No session/access token available"),new Error("Must be logged in to save trails");try{console.log("Saving trail for user via API:",e.id);const a=e=>e&&0!==e.length?e.map(e=>[e.longitude,e.latitude]):[],n={name:o.name,distance:o.distance,duration:o.duration,path:a(o.coordinates),photo:o.photo,city:o.city,country:o.country,description:o.description,tags:o.tags,elevation:o.elevation,surface_type:o.surfaceType,difficulty:o.difficulty,location:o.location,pace:o.pace,speed:o.speed,max_elevation:o.maxElevation,rating:o.rating,review:o.review,environment_tags:o.environment_tags},l=t.accessToken,s=await fetch(`${i.API_URL}/trail/me`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify(n)});if(!s.ok){const e=await s.text();throw console.error("Failed to save trail via API:",s.status,e),new Error("Failed to save trail")}const d=await s.json();return r(e=>[d,...e]),d}catch(a){throw console.error("Failed to save trail:",a),a}},[e,t]),y=(0,a.useCallback)(async e=>{try{if(console.log("Deleting trail via API:",e),!t?.accessToken)throw new Error("Not authenticated");const o=await fetch(`${i.API_URL}/trail/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t.accessToken}`}});if(204!==o.status){const e=await o.text();throw console.error("Failed to delete trail:",o.status,e),new Error("Failed to delete trail")}r(t=>t.filter(t=>t.id!==e))}catch(o){throw console.error("Failed to delete trail:",o),o}},[t]),x=(0,a.useCallback)(e=>{const t=o.find(t=>t.id===e);return t||("demo-trail"===e?{id:"demo-trail",name:"Scenic Coastal Walk",distance:5.2,duration:3600,coordinates:[{latitude:50.81999932593175,longitude:-.1443926504884132},{latitude:50.81982005377856,longitude:-.14389605957015306},{latitude:50.8195735534442,longitude:-.14290287773496857},{latitude:50.81976403108945,longitude:-.14245949298612004},{latitude:50.819651985510006,longitude:-.1415904588798469},{latitude:50.819360665744455,longitude:-.141129338740825},{latitude:50.81955114425804,longitude:-.14054407087405707},{latitude:50.8194278935438,longitude:-.1397814491065219},{latitude:50.819282233189426,longitude:-.1389301503892284},{latitude:50.819696803774036,longitude:-.13903656272921694},{latitude:50.81999932593175,longitude:-.13919618123853184},{latitude:50.82010016621547,longitude:-.13853997181101363},{latitude:50.82041389015009,longitude:-.138220734792327},{latitude:50.82055954697452,longitude:-.13852223642078343},{latitude:50.82086206354296,longitude:-.13829167635185513}],city:"Brighton",country:"UK",difficulty:"Easy",pace:"11:32",maxElevation:45,date:Date.now(),environment_tags:["Beach","Sunny","Paved"],rating:4.5,review:"A beautiful walk along the seafront. Very dog friendly!"}:void 0)},[o]),p=(0,a.useCallback)(async(e,o,a=10)=>{try{if(console.log("Loading nearby trails:",{latitude:e,longitude:o,distanceKm:a}),"number"===typeof e&&"number"===typeof o&&t?.accessToken)try{const r=await fetch(`${i.API_URL}/trail/nearby?latitude=${encodeURIComponent(e)}&longitude=${encodeURIComponent(o)}&distance_km=${encodeURIComponent(a)}`,{headers:{Authorization:`Bearer ${t.accessToken}`}});if(r.ok){return await r.json()}return 404===r.status?(console.warn("Nearby trails endpoint returned 404 (no trails)"),[]):(console.error("Failed to load nearby trails from API:",r.status),[])}catch(r){return console.error("Error calling nearby trails API:",r),[]}return[]}catch(n){return console.error("Failed to load nearby trails:",n),[]}},[t]),b=(0,a.useCallback)(async(e,o)=>{try{if(console.log("Updating trail name via API:",e,o),!t?.accessToken)throw new Error("Not authenticated");const a=await fetch(`${i.API_URL}/trail/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t?.accessToken}`},body:JSON.stringify({name:o})});if(!a.ok){const e=await a.text();throw new Error(e||"Failed to update")}const n=await a.json();r(t=>t.map(t=>t.id===e?n:t))}catch(a){throw console.error("Failed to update trail name:",a),a}},[t]),j=(0,a.useCallback)(async(e,o)=>{try{if(console.log("Updating trail photo via API:",e),!t?.accessToken)throw new Error("Not authenticated");const a=await fetch(`${i.API_URL}/trail/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t?.accessToken}`},body:JSON.stringify({photo:o})});if(!a.ok){const e=await a.text();throw new Error(e||"Failed to update photo")}const n=await a.json();r(t=>t.map(t=>t.id===e?n:t))}catch(a){throw console.error("Failed to update trail photo:",a),a}},[t]),w=(0,a.useCallback)(async(e,o)=>{try{if(console.log("Updating trail details via API:",e,o),!t?.accessToken)throw new Error("Not authenticated");const a=await fetch(`${i.API_URL}/trail/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t?.accessToken}`},body:JSON.stringify(o)});if(!a.ok){const e=await a.text();throw new Error(e||"Failed to update details")}const n=await a.json();r(t=>t.map(t=>t.id===e?n:t))}catch(a){throw console.error("Failed to update trail details:",a),a}},[]),T=(0,a.useCallback)(async e=>{try{console.log("Loading trail with user data via API:",e);const t=await fetch(`${i.API_URL}/trail/${e}`);if(!t.ok)return void console.error("Failed to fetch trail:",t.status);return await t.json()}catch(t){return void console.error("Failed to load trail with user:",t)}},[]),C=(0,a.useCallback)(async t=>{if(!e)throw console.error("No user logged in"),new Error("Must be logged in to save trails");try{console.log("Saving trail bookmark:",t);const e=o.find(e=>e.id===t);e&&s(t=>[e,...t])}catch(a){throw console.error("Failed to save trail bookmark:",a),a}},[e,o]),S=(0,a.useCallback)(async t=>{if(!e)throw console.error("No user logged in"),new Error("Must be logged in to remove saved trails");try{console.log("Removing trail bookmark:",t),s(e=>e.filter(e=>e.id!==t))}catch(o){throw console.error("Failed to remove trail bookmark:",o),o}},[e]),v=(0,a.useCallback)(e=>l.some(t=>t.id===e),[l]);return(0,a.useMemo)(()=>({trails:o,savedTrails:l,isLoading:d,isSavedLoading:u,saveTrail:m,deleteTrail:y,getTrailById:x,updateTrailName:b,updateTrailPhoto:j,updateTrailDetails:w,loadNearbyTrails:p,saveTrailBookmark:C,removeTrailBookmark:S,isTrailSaved:v,getTrailWithUser:T}),[o,l,d,u,m,y,x,b,j,w,p,C,S,v,T])})},7627(e,t,o){"use strict";o.r(t),o.d(t,{default:()=>d});var a=o(6665),r=o(6283),n=o(3929),i=o(3668),l=o(7042),s=(o(1051),o(397));function d({coordinates:e,path:t,style:o,height:i=260,startLatitude:d=null,startLongitude:u=null}){const f=(0,a.useRef)(null),g=(0,a.useRef)(null),h=(0,a.useRef)(null),m=e&&e.length>0?e:Array.isArray(t)?t.map(e=>({latitude:e[1],longitude:e[0]})):[];return(0,a.useEffect)(()=>{if(!f.current)return;const e=null!=d&&null!=u?[u,d]:m.length>0?[m[0].longitude,m[0].latitude]:[0,0],t=new l.Map({container:f.current,style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",center:e,zoom:m.length>0?12:1,interactive:!1});return g.current=t,t.on("load",()=>{if(m&&m.length>1){const e={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:m.map(e=>[e.longitude,e.latitude])}};t.getSource("preview-route")?t.getSource("preview-route").setData(e):(t.addSource("preview-route",{type:"geojson",data:e}),t.addLayer({id:"preview-route",type:"line",source:"preview-route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#5d6b4a","line-width":3}}));const o=new l.LngLatBounds;m.forEach(e=>o.extend([e.longitude,e.latitude])),t.fitBounds(o,{padding:10,maxZoom:16})}else if(m&&1===m.length){const e=m[0];if(h.current)h.current.setLngLat([e.longitude,e.latitude]);else{const o=new l.Marker({color:"#5d6b4a"}).setLngLat([e.longitude,e.latitude]).addTo(t);h.current=o}t.setCenter([e.longitude,e.latitude]),t.setZoom(14)}}),()=>{try{t.remove()}catch(e){}g.current=null,h.current=null}},[JSON.stringify(m),d,u]),(0,s.jsx)(n.default,{style:[c.container,o],children:m&&m.length>0?(0,s.jsx)("div",{ref:f,style:{width:"100%",height:"number"===typeof i?`${i}px`:i}}):(0,s.jsxs)(n.default,{style:c.placeholder,children:[(0,s.jsx)(r.default,{style:c.text,children:"Map Preview (Web)"}),(0,s.jsxs)(r.default,{style:c.subtext,children:[m?.length||0," points recorded"]})]})})}const c=i.default.create({container:{overflow:"hidden",backgroundColor:"#f0f0f0",justifyContent:"center",alignItems:"center"},placeholder:{justifyContent:"center",alignItems:"center",padding:12},text:{color:"#5d6b4a",fontWeight:"bold",fontSize:16},subtext:{color:"#666",fontSize:12,marginTop:4}})},8389(e,t,o){"use strict";o.r(t),o.d(t,{default:()=>E});var a=o(6665),r=o(9637),n=o(6283),i=o(3929),l=o(3668),s=o(2772),d=o(5648),c=o(530),u=o(5009),f=o(6773),g=o(8264),h=o(932),m=o(5894),y=o(893),x=o(8833),p=o(3087),b=o(2994),j=o(5624),w=o(1449),T=o(2301),C=o(3048),S=o(1168),v=o(8032),k=o(1858),I=o(5082),B=o(4550),z=o(2964),P=o(7042),R=o(9269),D=o(7627),F=o(6746),A=o(397);const L=[{id:"nearby",name:"Nearby",icon:S.default},{id:"popular",name:"Popular",icon:C.default},{id:"beaches",name:"Beaches",icon:B.default}];function E(){const e=(0,r.useRouter)(),t=(0,x.useSafeAreaInsets)(),{loadNearbyTrails:o,saveTrailBookmark:l,removeTrailBookmark:C,isTrailSaved:B}=(0,F.useTrails)(),[E,W]=(0,a.useState)("nearby"),[_,V]=(0,a.useState)([]),[N,H]=(0,a.useState)(!0),[,M]=(0,a.useState)(void 0),[$,G]=(0,a.useState)({}),[U,q]=(0,a.useState)(""),[J,Y]=(0,a.useState)(!1),[K,Q]=(0,a.useState)(""),[X,Z]=(0,a.useState)([]),[ee,te]=(0,a.useState)(!1),oe=(0,a.useCallback)(async()=>{Q("Current location");try{if(navigator&&navigator.geolocation)return void navigator.geolocation.getCurrentPosition(async e=>{try{const t=await o(e.coords.latitude,e.coords.longitude);V(t)}catch(t){console.error("Failed to load nearby trails with browser location:",t);const e=await o();V(e)}finally{H(!1)}},async()=>{const e=await o();V(e),H(!1)});const e=await o();V(e)}catch(e){console.error("Failed to load nearby trails (web):",e),V([])}finally{H(!1)}},[o]);(0,a.useEffect)(()=>{oe()},[oe]),(0,r.useFocusEffect)((0,a.useCallback)(()=>{console.log("Explore tab focused - refreshing nearby trails (web)"),oe()},[oe]));const ae=(0,a.useCallback)(()=>{const e=U.toLowerCase(),t=_.filter(t=>{const o=t.name?.toLowerCase()||"",a=t.city?.toLowerCase()||"",r=t.country?.toLowerCase()||"";return o.includes(e)||a.includes(e)||r.includes(e)}).map(e=>({id:e.id,name:e.name||`Trail ${new Date(e.date).toLocaleDateString()}`,location:e.city?`${e.city}, ${e.country||"Unknown"}`:"Location unknown",type:"trail"})).slice(0,6);Z(t)},[U,_]);(0,a.useEffect)(()=>{U.trim()?ae():Z([])},[U,ae]);const re=()=>{Y(!1),q(""),Z([])},ne=e=>{if(!$[e]){const t=new u.default.Value(1);return G(o=>Object.assign({},o,{[e]:t})),t}return $[e]},ie=(0,a.useCallback)(e=>{let t=e;return"popular"===E?t=[...t].sort((e,t)=>(t.rating||0)-(e.rating||0)):"beaches"===E&&(t=t.filter(e=>(e.environment_tags||[]).some(e=>e.toLowerCase().includes("beach")))),t},[E]),le=a.useRef(null),se=a.useRef(null),[de,ce]=(0,a.useState)(null),[ue,fe]=(0,a.useState)(10),[ge,he]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(!ge||!le.current||!ee)return;if(se.current)return;const e=de?[de.longitude,de.latitude]:[0,0],t=new P.Map({container:le.current,style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",center:e,zoom:de?10:1});return se.current=t,t.on("load",()=>{t.getSource("picker")||(t.addSource("picker",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),t.addLayer({id:"picker-layer",type:"circle",source:"picker",paint:{"circle-radius":8,"circle-color":"#2563eb","circle-stroke-color":"#fff","circle-stroke-width":2}}))}),t.on("click",e=>{const o=e.lngLat.lat,a=e.lngLat.lng;ce({latitude:o,longitude:a});const r=t.getSource("picker");r&&r.setData({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[a,o]}}]}),t.flyTo({center:[a,o],zoom:12})}),()=>{try{t.remove()}catch(e){}se.current=null}},[ge,ee,de]);const me=async()=>{H(!0);try{if(de){const e=await o(de.latitude,de.longitude,ue);V(e)}else if(navigator&&navigator.geolocation)navigator.geolocation.getCurrentPosition(async e=>{const t=await o(e.coords.latitude,e.coords.longitude,ue);V(t)},async()=>{const e=await o(void 0,void 0,ue);V(e)});else{const e=await o(void 0,void 0,ue);V(e)}}catch(e){console.error("Search nearby failed:",e)}finally{H(!1)}},ye=ie(_);return(0,A.jsxs)(i.default,{style:O.safeContainer,children:[(0,A.jsxs)(s.default,{style:O.container,showsVerticalScrollIndicator:!1,stickyHeaderIndices:[0],children:[(0,A.jsxs)(i.default,{style:[O.stickyHeader,{paddingTop:t.top+16}],children:[(0,A.jsxs)(i.default,{style:O.stickySearchContainer,children:[(0,A.jsxs)(d.default,{style:O.searchBar,onPress:()=>{Y(!0)},activeOpacity:.7,children:[(0,A.jsx)(k.default,{size:20,color:"#9ca3af"}),(0,A.jsx)(n.default,{style:O.searchPlaceholder,children:"Find trails"})]}),(0,A.jsx)(d.default,{style:O.demoButton,onPress:()=>e.push("/trail/demo-trail"),children:(0,A.jsx)(n.default,{style:O.demoButtonText,children:"Demo"})})]}),(0,A.jsx)(i.default,{style:O.categoriesSection,children:(0,A.jsx)(s.default,{horizontal:!0,showsHorizontalScrollIndicator:!1,contentContainerStyle:O.categoriesScroll,children:L.map(e=>{const t=e.icon,o=E===e.id;return(0,A.jsxs)(d.default,{style:[O.categoryButton,o&&O.categoryButtonActive],onPress:()=>{return t=e.id,void W(t);var t},children:[(0,A.jsx)(t,{size:20,color:o?"#fff":"#9ca3af",strokeWidth:2}),(0,A.jsx)(n.default,{style:[O.categoryText,o&&O.categoryTextActive],children:e.name})]},e.id)})})})]}),(0,A.jsxs)(i.default,{style:{paddingHorizontal:16,paddingVertical:8},children:[(0,A.jsxs)(d.default,{onPress:()=>te(e=>!e),style:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[(0,A.jsx)(n.default,{style:{fontSize:14,fontWeight:"600"},children:"Location & Distance"}),ee?(0,A.jsx)(T.default,{size:20,color:"#5d6b4a"}):(0,A.jsx)(j.default,{size:20,color:"#5d6b4a"})]}),ee?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(n.default,{style:{fontSize:14,fontWeight:"600",marginBottom:8},children:"Pick a location on the map or use your current location"}),(0,A.jsx)("div",{ref:e=>{le.current=e,he(!!e)},style:{width:"100%",height:220,borderRadius:12,overflow:"hidden",marginBottom:8}}),(0,A.jsxs)(i.default,{style:{flexDirection:"row",alignItems:"center",gap:12},children:[(0,A.jsx)(i.default,{style:{flexDirection:"row",gap:8},children:[5,10,25,50].map(e=>(0,A.jsx)(d.default,{style:{paddingHorizontal:12,paddingVertical:8,borderRadius:8,backgroundColor:ue===e?"#5d6b4a":"#fff",borderWidth:1,borderColor:"#e5e7eb"},onPress:()=>fe(e),children:(0,A.jsxs)(n.default,{style:{color:ue===e?"#fff":"#282E10",fontWeight:"600"},children:[e," km"]})},e))}),(0,A.jsx)(d.default,{onPress:me,style:{marginLeft:"auto",paddingHorizontal:16,paddingVertical:10,backgroundColor:"#64748b",borderRadius:10},children:(0,A.jsx)(n.default,{style:{color:"#fff",fontWeight:"700"},children:"Search Nearby"})})]})]}):(0,A.jsxs)(i.default,{style:{flexDirection:"row",alignItems:"center",gap:12},children:[(0,A.jsx)(n.default,{style:{color:"#64748b"},children:de?`${de.latitude.toFixed(4)}, ${de.longitude.toFixed(4)}`:"Using current location"}),(0,A.jsxs)(n.default,{style:{color:"#64748b"},children:[ue," km"]}),(0,A.jsx)(d.default,{onPress:me,style:{marginLeft:"auto",paddingHorizontal:12,paddingVertical:8,backgroundColor:"#64748b",borderRadius:8},children:(0,A.jsx)(n.default,{style:{color:"#fff",fontWeight:"700"},children:"Search"})})]})]}),(0,A.jsx)(i.default,{style:O.categoryTrailsSection,children:N?(0,A.jsxs)(i.default,{style:O.loadingContainer,children:[(0,A.jsx)(c.default,{size:"large",color:"#2563eb"}),(0,A.jsx)(n.default,{style:O.loadingText,children:"Loading trails..."})]}):ye&&ye.length>0?ye.map(t=>{const o=ne(t.id),a=B(t.id);return(0,A.jsxs)(d.default,{style:O.largeTrailCard,onPress:()=>{return o=t.id,void e.push(`/trail/${o}`);var o},children:[t.photo?(0,A.jsx)(m.Image,{source:{uri:t.photo},style:O.largeTrailImage,contentFit:"cover",cachePolicy:"memory-disk"}):(0,A.jsx)(D.default,{coordinates:t.coordinates,path:t.path,style:O.largeTrailImage,startLatitude:t.startLatitude,startLongitude:t.startLongitude}),(0,A.jsx)(y.LinearGradient,{colors:["rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0.25)","rgba(0, 0, 0, 0.6)"],locations:[0,.3,.6,1],style:O.cardGradient}),(0,A.jsx)(d.default,{style:O.bookmarkButton,onPress:e=>{e.stopPropagation(),(async(e,t=!1)=>{if(!t&&!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))return void console.log("Cannot bookmark mock trail:",e);const o=ne(e),a=B(e);u.default.sequence([u.default.timing(o,{toValue:.6,duration:100,useNativeDriver:!0}),u.default.spring(o,{toValue:1,friction:3,tension:100,useNativeDriver:!0})]).start();try{a?await C(e):await l(e)}catch(r){console.error("Failed to toggle bookmark:",r)}})(t.id,!0)},children:(0,A.jsx)(u.default.View,{style:{transform:[{scale:o}]},children:(0,A.jsx)(b.default,{size:20,color:a?"#000":"#64748b",fill:a?"#000":"none",strokeWidth:2})})}),(0,A.jsxs)(i.default,{style:O.cardOverlayContent,children:[(0,A.jsx)(n.default,{style:O.overlayTrailName,children:t.name||`Trail ${new Date(t.date).toLocaleDateString()}`}),(0,A.jsx)(n.default,{style:O.overlayLocation,children:t.city?`${t.city}, ${t.country||"Unknown"}`:"Location unknown"}),(0,A.jsxs)(i.default,{style:O.overlayBadges,children:[t.difficulty&&(0,A.jsxs)(i.default,{style:O.badge,children:[(0,A.jsx)(p.default,{size:14,color:"#d4d4a0",strokeWidth:2.5}),(0,A.jsx)(n.default,{style:O.badgeText,children:t.difficulty})]}),(0,A.jsxs)(i.default,{style:O.badge,children:[(0,A.jsx)(S.default,{size:14,color:"#d4d4a0",strokeWidth:2.5}),(0,A.jsx)(n.default,{style:O.badgeText,children:(0,R.formatDistance)(t.distance)})]}),"number"===typeof t.distance_from_user&&(0,A.jsxs)(i.default,{style:O.badge,children:[(0,A.jsx)(S.default,{size:14,color:"#d4d4a0",strokeWidth:2.5}),(0,A.jsx)(n.default,{style:O.badgeText,children:(0,R.formatDistance)(t.distance_from_user)})]}),t.rating&&(0,A.jsxs)(i.default,{style:O.badge,children:[(0,A.jsx)(I.default,{size:14,color:"#fbbf24",fill:"#fbbf24",strokeWidth:2}),(0,A.jsx)(n.default,{style:O.badgeText,children:t.rating.toFixed(1)})]})]})]})]},t.id)}):(0,A.jsxs)(i.default,{style:O.emptyContainer,children:[(0,A.jsx)(S.default,{size:48,color:"#9ca3af"}),(0,A.jsx)(n.default,{style:O.emptyText,children:"No trails found nearby. Try a wider search or record a trail to share with others."})]})}),(0,A.jsx)(i.default,{style:O.bottomPadding})]}),(0,A.jsx)(g.default,{visible:J,animationType:"slide",presentationStyle:"fullScreen",onRequestClose:re,children:(0,A.jsxs)(i.default,{style:[O.searchModalContainer,{paddingTop:t.top}],children:[(0,A.jsxs)(i.default,{style:O.searchModalHeader,children:[(0,A.jsx)(d.default,{style:O.backButton,onPress:re,children:(0,A.jsx)(w.default,{size:24,color:"#5d6b4a"})}),(0,A.jsxs)(i.default,{style:O.searchModalInputContainer,children:[(0,A.jsx)(f.default,{style:O.searchModalInput,placeholder:"Find trails",placeholderTextColor:"#9ca3af",value:U,onChangeText:q,autoFocus:!0,returnKeyType:"search"}),U.length>0&&(0,A.jsx)(d.default,{style:O.clearButton,onPress:()=>q(""),children:(0,A.jsx)(z.default,{size:20,color:"#64748b"})})]})]}),(0,A.jsxs)(i.default,{style:O.searchModalContent,children:[""===U.trim()&&(0,A.jsxs)(d.default,{style:O.currentLocationItem,onPress:()=>{Y(!1),q(""),Z([])},children:[(0,A.jsx)(i.default,{style:O.locationIconContainer,children:(0,A.jsx)(v.default,{size:20,color:"#5d6b4a"})}),(0,A.jsxs)(i.default,{style:O.locationTextContainer,children:[(0,A.jsx)(n.default,{style:O.locationTitle,children:"Current location"}),(0,A.jsx)(n.default,{style:O.locationSubtitle,children:K})]})]}),X.length>0&&(0,A.jsx)(h.default,{data:X,keyExtractor:e=>e.id,renderItem:({item:t})=>(0,A.jsxs)(d.default,{style:O.suggestionItem,onPress:()=>{return o=t.id,Y(!1),q(""),Z([]),void e.push(`/trail/${o}`);var o},children:[(0,A.jsx)(i.default,{style:O.suggestionIconContainer,children:(0,A.jsx)(S.default,{size:20,color:"#64748b"})}),(0,A.jsxs)(i.default,{style:O.suggestionTextContainer,children:[(0,A.jsx)(n.default,{style:O.suggestionTitle,children:t.name}),(0,A.jsx)(n.default,{style:O.suggestionSubtitle,children:t.location})]})]}),showsVerticalScrollIndicator:!1})]})]})})]})}const O=l.default.create(Object.assign({},o(2699).default))},8415(e,t,o){"use strict";o.r(t),o.d(t,{default:()=>O});var a=o(6665),r=o(3929),n=o(3668),i=o(5648),l=o(1690),s=o(530),d=o(2772),c=o(6773),u=o(8264),f=o(5009),g=o(1445),h=o(5894),m=o(262),y=o(3353),x=o(2598),p=o(9908),b=o(6746),j=o(3087),w=o(2994),T=o(9281),C=o(4522),S=o(1631),v=o(2081),k=o(1168),I=o(5082),B=o(2964),z=o(9582),P=o(8833),R=o(9637),D=o(9269),F=o(893),A=o(7627),L=o(397);const E=o(3229);function O(){const{user:e,signOut:t}=(0,y.useAuth)(),{userProfile:o,updateAccount:n,isLoading:O}=(0,x.useAccount)(),{dogProfile:_,isDogProfileLoading:V}=(0,p.useDogs)(),{trails:N,savedTrails:H,isLoading:M,saveTrailBookmark:$,removeTrailBookmark:G,isTrailSaved:U}=(0,b.useTrails)(),[q,J]=a.useState(!1),[Y,K]=a.useState(!1),[Q,X]=a.useState(""),[Z,ee]=a.useState(""),[te,oe]=a.useState(!1),[ae,re]=a.useState("created"),[ne,ie]=a.useState({}),le=(0,P.useSafeAreaInsets)(),se=(0,R.useRouter)();a.useEffect(()=>{const t=o?.name||e?.email?.split("@")[0]||"",a=o?.photo||E;X(t),ee(a)},[e,o]);const de=N.length,ce=N.reduce((e,t)=>e+(t.duration||0),0),ue=N.reduce((e,t)=>e+t.distance,0),fe=e=>{re(e)},ge=e=>{if(!ne[e]){const t=new f.default.Value(1);return ie(o=>Object.assign({},o,{[e]:t})),t}return ne[e]},he=()=>{se.push("/onboarding/dog-basics")},me=()=>{K(!1);const t=o?.name||e?.email?.split("@")[0]||"",a=o?.photo||E;X(t),ee(a)},ye="created"===ae?N:"saved"===ae?H:[];return(0,L.jsx)(r.default,{style:W.container,children:(0,L.jsxs)(d.default,{style:W.scrollContainer,contentContainerStyle:[W.content,{paddingTop:le.top+16,paddingBottom:le.bottom+20}],children:[(0,L.jsx)(r.default,{style:W.userSection,children:(0,L.jsxs)(r.default,{style:W.userHeader,children:[(0,L.jsx)(i.default,{style:W.userAvatar,onPress:()=>{K(!0)},children:Z?(0,L.jsx)(h.Image,{source:Z,style:W.userAvatarImage,contentFit:"cover",cachePolicy:"memory-disk"}):(0,L.jsx)(r.default,{style:W.initialAvatar,children:(0,L.jsx)(g.ThemedText,{style:W.initialAvatarText,children:(Q||o?.name||e?.email||"A").charAt(0).toUpperCase()})})}),(0,L.jsxs)(r.default,{style:W.userInfo,children:[(0,L.jsx)(g.ThemedText,{style:W.userName,children:o?.name||Q||"Account Holder"}),(0,L.jsxs)(r.default,{style:W.userEmailRow,children:[(0,L.jsx)(v.default,{size:14,color:z.default.primary}),(0,L.jsx)(g.ThemedText,{style:W.userEmail,children:e?.email||"Not available"})]})]})]})}),V?(0,L.jsx)(r.default,{style:W.dogCardContainer,children:(0,L.jsx)(r.default,{style:W.loadingDogCard,children:(0,L.jsx)(s.default,{size:"large",color:z.default.paleYellow})})}):_?(0,L.jsx)(r.default,{style:W.dogCardContainer,children:(0,L.jsxs)(i.default,{style:W.dogCard,onPress:he,children:[(0,L.jsx)(r.default,{style:W.dogPhotoContainer,children:_.photo?(0,L.jsx)(h.Image,{source:_.photo,style:W.dogPhoto,contentFit:"cover",cachePolicy:"memory-disk"}):(0,L.jsx)(r.default,{style:[W.dogPhoto,W.dogPhotoPlaceholder],children:(0,L.jsx)(C.default,{size:40,color:"#9ca3af"})})}),(0,L.jsx)(g.ThemedText,{style:W.dogName,children:_.name}),_.nickname&&(0,L.jsx)(g.ThemedText,{style:W.dogNickname,children:_.nickname}),!_.nickname&&(0,L.jsx)(r.default,{style:W.nicknameSpacing}),(0,L.jsxs)(r.default,{style:W.statsRow,children:[(0,L.jsxs)(r.default,{style:W.statItem,children:[(0,L.jsx)(g.ThemedText,{style:W.statValue,children:de}),(0,L.jsx)(g.ThemedText,{style:W.statLabel,children:"Walks"})]}),(0,L.jsxs)(r.default,{style:W.statItem,children:[(0,L.jsx)(g.ThemedText,{style:W.statValue,children:(e=>{const t=Math.floor(e/3600),o=Math.floor(e%3600/60);return t>0?`${t}.${Math.floor(o/6)}h`:`${o}m`})(ce)}),(0,L.jsx)(g.ThemedText,{style:W.statLabel,children:"Total Time"})]}),(0,L.jsxs)(r.default,{style:W.statItem,children:[(0,L.jsx)(g.ThemedText,{style:W.statValue,children:(0,D.formatDistance)(ue)}),(0,L.jsx)(g.ThemedText,{style:W.statLabel,children:"Total Dist."})]})]}),(0,L.jsxs)(r.default,{style:W.dogInfoRow,children:[(0,L.jsx)(r.default,{style:W.dogInfoBadge,children:(0,L.jsxs)(g.ThemedText,{style:W.dogInfoText,children:[_.age," years"]})}),(0,L.jsx)(r.default,{style:W.dogInfoBadge,children:(0,L.jsxs)(g.ThemedText,{style:W.dogInfoText,children:["Size ",_.size]})})]})]})}):(0,L.jsx)(r.default,{style:W.dogCardContainer,children:(0,L.jsxs)(r.default,{style:W.noDogCard,children:[(0,L.jsx)(C.default,{size:48,color:"#9ca3af"}),(0,L.jsx)(g.ThemedText,{style:W.noDogText,children:"No dog profile yet"}),(0,L.jsx)(i.default,{style:W.addDogButton,onPress:he,children:(0,L.jsx)(g.ThemedText,{style:W.addDogButtonText,children:"Add Dog Profile"})})]})}),(0,L.jsxs)(r.default,{style:W.tabsContainer,children:[(0,L.jsxs)(i.default,{style:[W.tab,"created"===ae&&W.tabActive],onPress:()=>fe("created"),children:[(0,L.jsx)(g.ThemedText,{style:[W.tabCount,"created"===ae&&W.tabCountActive],children:N.length}),(0,L.jsx)(g.ThemedText,{style:[W.tabText,"created"===ae&&W.tabTextActive],children:"Created"})]}),(0,L.jsxs)(i.default,{style:[W.tab,"saved"===ae&&W.tabActive],onPress:()=>fe("saved"),children:[(0,L.jsx)(g.ThemedText,{style:[W.tabCount,"saved"===ae&&W.tabCountActive],children:H.length}),(0,L.jsx)(g.ThemedText,{style:[W.tabText,"saved"===ae&&W.tabTextActive],children:"Saved"})]}),(0,L.jsxs)(i.default,{style:[W.tab,"reviews"===ae&&W.tabActive],onPress:()=>fe("reviews"),children:[(0,L.jsx)(g.ThemedText,{style:[W.tabCount,"reviews"===ae&&W.tabCountActive],children:"0"}),(0,L.jsx)(g.ThemedText,{style:[W.tabText,"reviews"===ae&&W.tabTextActive],children:"Reviews"})]})]}),(0,L.jsx)(r.default,{style:W.trailsSection,children:M?(0,L.jsx)(r.default,{style:W.loadingContainer,children:(0,L.jsx)(s.default,{size:"large",color:z.default.primary})}):ye.length>0?ye.map(e=>{const t=ge(e.id),o=U(e.id);return(0,L.jsxs)(i.default,{style:W.trailCard,onPress:()=>{return t=e.id,void se.push(`/trail/${t}`);var t},children:[e.photo?(0,L.jsx)(h.Image,{source:{uri:e.photo},style:W.trailImage}):(0,L.jsx)(A.default,{coordinates:e.coordinates,path:e.path,style:W.trailImage,startLatitude:e.startLatitude,startLongitude:e.startLongitude}),(0,L.jsx)(F.LinearGradient,{colors:["rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0.25)","rgba(0, 0, 0, 0.6)"],locations:[0,.3,.6,1],style:W.trailGradient}),(0,L.jsx)(i.default,{style:W.bookmarkButton,onPress:t=>{t.stopPropagation(),(async e=>{const t=ge(e),o=U(e);f.default.sequence([f.default.timing(t,{toValue:.6,duration:100,useNativeDriver:!0}),f.default.spring(t,{toValue:1,friction:3,tension:100,useNativeDriver:!0})]).start();try{o?await G(e):await $(e)}catch(a){console.error("Failed to toggle bookmark:",a)}})(e.id)},children:(0,L.jsx)(f.default.View,{style:{transform:[{scale:t}]},children:(0,L.jsx)(w.default,{size:20,color:o?"#000":"#64748b",fill:o?"#000":"none",strokeWidth:2})})}),(0,L.jsxs)(r.default,{style:W.trailContent,children:[(0,L.jsx)(g.ThemedText,{style:W.trailName,children:e.name||`Trail ${new Date(e.date).toLocaleDateString()}`}),(0,L.jsx)(g.ThemedText,{style:W.trailLocation,children:e.city?`${e.city}, ${e.country||"Unknown"}`:"Location unknown"}),(0,L.jsxs)(r.default,{style:W.trailBadges,children:[e.difficulty&&(0,L.jsxs)(r.default,{style:W.trailBadge,children:[(0,L.jsx)(j.default,{size:14,color:"#d4d4a0",strokeWidth:2.5}),(0,L.jsx)(g.ThemedText,{style:W.trailBadgeText,children:e.difficulty})]}),(0,L.jsxs)(r.default,{style:W.trailBadge,children:[(0,L.jsx)(k.default,{size:14,color:"#d4d4a0",strokeWidth:2.5}),(0,L.jsx)(g.ThemedText,{style:W.trailBadgeText,children:(0,D.formatDistance)(e.distance)})]}),e.rating&&(0,L.jsxs)(r.default,{style:W.trailBadge,children:[(0,L.jsx)(I.default,{size:14,color:"#fbbf24",fill:"#fbbf24",strokeWidth:2}),(0,L.jsx)(g.ThemedText,{style:W.trailBadgeText,children:e.rating.toFixed(1)})]})]})]})]},e.id)}):(0,L.jsxs)(r.default,{style:W.emptyContainer,children:[(0,L.jsx)(k.default,{size:48,color:"#9ca3af"}),(0,L.jsx)(g.ThemedText,{style:W.emptyText,children:"created"===ae?"No trails created yet":"saved"===ae?"No trails saved yet":"No reviews yet"})]})}),(0,L.jsx)(i.default,{style:[W.signOutButton,q&&W.signOutButtonDisabled],onPress:async()=>{l.default.alert("Sign Out","Are you sure you want to sign out?",[{text:"Cancel",style:"cancel"},{text:"Sign Out",style:"destructive",onPress:async()=>{J(!0);try{await t()}catch(e){0,l.default.alert("Error",e.message||"Failed to sign out")}finally{J(!1)}}}])},disabled:q,children:q?(0,L.jsx)(s.default,{color:"#fff"}):(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(S.default,{size:20,color:"#fff"}),(0,L.jsx)(g.ThemedText,{style:W.signOutText,children:"Sign Out"})]})}),(0,L.jsx)(u.default,{visible:Y,animationType:"slide",presentationStyle:"pageSheet",onRequestClose:me,children:(0,L.jsxs)(r.default,{style:W.modalContainer,children:[(0,L.jsxs)(r.default,{style:[W.modalHeader,{paddingTop:le.top+20}],children:[(0,L.jsx)(g.ThemedText,{style:W.modalTitle,children:"Edit Profile"}),(0,L.jsx)(i.default,{style:W.closeButton,onPress:me,children:(0,L.jsx)(B.default,{size:24,color:z.default.primary})})]}),(0,L.jsxs)(d.default,{style:W.modalContent,children:[(0,L.jsxs)(r.default,{style:W.photoSection,children:[(0,L.jsxs)(i.default,{style:W.photoContainer,onPress:async()=>{const{status:e}=await m.requestMediaLibraryPermissionsAsync();if("granted"!==e)return void l.default.alert("Permission needed","Please allow access to your photo library");const t=await m.launchImageLibraryAsync({mediaTypes:["images"],allowsEditing:!0,aspect:[1,1],quality:.8});!t.canceled&&t.assets[0]&&ee(t.assets[0].uri)},children:[Z?(0,L.jsx)(h.Image,{source:Z,style:W.editPhoto,contentFit:"cover",cachePolicy:"memory-disk"}):(0,L.jsx)(r.default,{style:[W.editPhoto,W.initialAvatar],children:(0,L.jsx)(g.ThemedText,{style:W.initialAvatarText,children:(Q||o?.name||e?.email||"A").charAt(0).toUpperCase()})}),(0,L.jsx)(r.default,{style:W.cameraOverlay,children:(0,L.jsx)(T.default,{size:24,color:"#fff"})})]}),(0,L.jsx)(g.ThemedText,{style:W.photoHint,children:"Tap to change photo"})]}),(0,L.jsxs)(r.default,{style:W.inputSection,children:[(0,L.jsx)(g.ThemedText,{style:W.inputLabel,children:"Name"}),(0,L.jsx)(c.default,{style:W.input,value:Q,onChangeText:X,placeholder:"Enter your name",placeholderTextColor:"#9ca3af"})]}),(0,L.jsxs)(r.default,{style:W.inputSection,children:[(0,L.jsx)(g.ThemedText,{style:W.inputLabel,children:"Email"}),(0,L.jsx)(r.default,{style:W.disabledInput,children:(0,L.jsx)(g.ThemedText,{style:W.disabledInputText,children:e?.email})}),(0,L.jsx)(g.ThemedText,{style:W.inputHint,children:"Email cannot be changed"})]})]}),(0,L.jsx)(r.default,{style:[W.modalFooter,{paddingBottom:le.bottom+20}],children:(0,L.jsx)(i.default,{style:[W.saveButton,te&&W.saveButtonDisabled],onPress:async()=>{if(Q.trim()){oe(!0);try{await n({name:Q.trim(),photo:"string"===typeof Z&&Z?Z:void 0}),K(!1),l.default.alert("Success","Profile updated successfully!")}catch(e){console.error("Failed to save profile:",e),l.default.alert("Error",e?.message||"Failed to update profile")}finally{oe(!1)}}else l.default.alert("Error","Name cannot be empty")},disabled:te,children:te?(0,L.jsx)(s.default,{color:"#fff"}):(0,L.jsx)(g.ThemedText,{style:W.saveButtonText,children:"Save Changes"})})})]})})]})})}const W=n.default.create({container:{flex:1,backgroundColor:z.default.background},scrollContainer:{flex:1},content:{paddingHorizontal:16},userSection:{marginBottom:24},userHeader:{flexDirection:"row",alignItems:"center"},userAvatar:{width:48,height:48,borderRadius:24,overflow:"hidden",backgroundColor:z.default.lightGreen,borderWidth:2,borderColor:z.default.primary},userAvatarImage:{width:"100%",height:"100%"},userInfo:{marginLeft:12,flex:1},userName:{fontSize:20,fontWeight:"700",color:z.default.darkGreen,marginBottom:2},userEmailRow:{flexDirection:"row",alignItems:"center",gap:6},userEmail:{fontSize:14,color:z.default.primary,opacity:.8},dogCardContainer:{marginBottom:24},dogCard:{backgroundColor:z.default.darkGreen,borderRadius:24,padding:24,alignItems:"center",borderWidth:1,borderColor:z.default.primary},dogPhotoContainer:{marginBottom:16},dogPhoto:{width:100,height:100,borderRadius:50,backgroundColor:z.default.mediumGreen,borderWidth:3,borderColor:z.default.paleYellow},dogPhotoPlaceholder:{justifyContent:"center",alignItems:"center"},dogName:{fontSize:22,fontWeight:"700",color:"#fff",marginBottom:4},dogNickname:{fontSize:14,color:z.default.paleYellow,opacity:.9,marginBottom:16},nicknameSpacing:{height:16},statsRow:{flexDirection:"row",justifyContent:"space-around",width:"100%",marginBottom:20},statItem:{alignItems:"center"},statValue:{fontSize:24,fontWeight:"700",color:"#fff",marginBottom:4},statLabel:{fontSize:13,color:z.default.paleYellow,opacity:.8},dogInfoRow:{flexDirection:"row",gap:12},dogInfoBadge:{backgroundColor:"rgba(255, 255, 255, 0.1)",paddingHorizontal:16,paddingVertical:8,borderRadius:16},dogInfoText:{fontSize:14,color:"#fff",fontWeight:"500"},loadingDogCard:{backgroundColor:z.default.darkGreen,borderRadius:24,padding:48,alignItems:"center",justifyContent:"center",borderWidth:1,borderColor:z.default.primary},noDogCard:{backgroundColor:z.default.darkGreen,borderRadius:24,padding:32,alignItems:"center",gap:12,borderWidth:1,borderColor:z.default.primary},noDogText:{fontSize:16,color:z.default.paleYellow,opacity:.9,textAlign:"center"},addDogButton:{backgroundColor:z.default.primary,paddingHorizontal:20,paddingVertical:12,borderRadius:12,marginTop:8},addDogButtonText:{fontSize:15,fontWeight:"600",color:"#fff"},tabsContainer:{flexDirection:"row",marginBottom:20,gap:12},tab:{flex:1,backgroundColor:"#fff",paddingVertical:16,paddingHorizontal:16,borderRadius:16,alignItems:"center",borderWidth:0},tabActive:{backgroundColor:"#5d6b4a"},tabText:{fontSize:14,fontWeight:"600",color:"#9ca3af"},tabTextActive:{color:"#fff"},tabCount:{fontSize:24,fontWeight:"700",color:z.default.darkGreen,marginBottom:4},tabCountActive:{color:"#fff"},trailsSection:{marginBottom:24},trailCard:{backgroundColor:"#fff",borderRadius:24,overflow:"hidden",marginBottom:20,shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.1,shadowRadius:16,elevation:4,position:"relative"},trailImage:{width:"100%",height:260,backgroundColor:"#e2e8f0"},trailGradient:{position:"absolute",top:0,bottom:0,left:0,right:0},trailContent:{position:"absolute",bottom:0,left:0,right:0,padding:18,paddingBottom:20},trailName:{fontSize:28,fontWeight:"700",color:"#fff",marginBottom:6,lineHeight:34,textShadowColor:"rgba(0, 0, 0, 0.3)",textShadowOffset:{width:0,height:1},textShadowRadius:4},trailLocation:{fontSize:16,color:"#fff",marginBottom:16,opacity:.95,textShadowColor:"rgba(0, 0, 0, 0.3)",textShadowOffset:{width:0,height:1},textShadowRadius:4},trailBadges:{flexDirection:"row",alignItems:"center",gap:12,flexWrap:"wrap"},trailBadge:{flexDirection:"row",alignItems:"center",backgroundColor:"rgba(40, 40, 40, 0.8)",paddingHorizontal:14,paddingVertical:8,borderRadius:20,gap:6},trailBadgeText:{fontSize:14,fontWeight:"600",color:"#fff",textTransform:"capitalize"},bookmarkButton:{position:"absolute",top:20,right:20,width:44,height:44,borderRadius:22,backgroundColor:"rgba(255, 255, 255, 0.95)",justifyContent:"center",alignItems:"center",shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:8,elevation:4,zIndex:10},loadingContainer:{paddingVertical:60,alignItems:"center"},emptyContainer:{paddingVertical:60,alignItems:"center",gap:16,paddingHorizontal:32},emptyText:{fontSize:16,color:z.default.primary,opacity:.7,textAlign:"center",lineHeight:24},signOutButton:{flexDirection:"row",alignItems:"center",justifyContent:"center",gap:12,backgroundColor:"#b91c1c",borderRadius:12,padding:16,marginTop:16,borderWidth:1,borderColor:"#7f1d1d"},signOutButtonDisabled:{opacity:.6},signOutText:{fontSize:16,fontWeight:"600",color:"#fff"},modalContainer:{flex:1,backgroundColor:z.default.background},modalHeader:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:20,paddingBottom:20,backgroundColor:z.default.background,borderBottomWidth:1,borderBottomColor:z.default.lightGreen},modalTitle:{fontSize:24,fontWeight:"700",color:z.default.darkGreen},closeButton:{width:40,height:40,borderRadius:20,backgroundColor:z.default.lightGreen,justifyContent:"center",alignItems:"center"},modalContent:{flex:1,padding:20},photoSection:{alignItems:"center",marginBottom:32,paddingTop:20},photoContainer:{width:120,height:120,borderRadius:60,overflow:"hidden",position:"relative",marginBottom:12},editPhoto:{width:"100%",height:"100%"},cameraOverlay:{position:"absolute",bottom:0,left:0,right:0,height:40,backgroundColor:"rgba(0, 0, 0, 0.5)",justifyContent:"center",alignItems:"center"},photoHint:{fontSize:14,color:"#6b7280"},inputSection:{marginBottom:24},inputLabel:{fontSize:15,fontWeight:"600",color:z.default.primary,marginBottom:8},input:{backgroundColor:"#fff",borderRadius:12,padding:16,fontSize:16,color:z.default.darkGreen,borderWidth:1,borderColor:z.default.lightGreen},disabledInput:{backgroundColor:"#f3f4f6",borderRadius:12,padding:16,borderWidth:1,borderColor:"#e5e7eb"},disabledInputText:{fontSize:16,color:"#9ca3af"},inputHint:{fontSize:13,color:"#9ca3af",marginTop:6},modalFooter:{padding:20,backgroundColor:z.default.background,borderTopWidth:1,borderTopColor:z.default.lightGreen},saveButton:{backgroundColor:z.default.primary,borderRadius:12,padding:16,alignItems:"center"},saveButtonDisabled:{opacity:.6},saveButtonText:{fontSize:16,fontWeight:"600",color:"#fff"},initialAvatar:{width:"100%",height:"100%",backgroundColor:z.default.lightGreen,justifyContent:"center",alignItems:"center"},initialAvatarText:{fontSize:36,fontWeight:"700",color:"#fff"}})},8889(e,t,o){"use strict";o.r(t),o.d(t,{default:()=>x});var a=o(9637),r=o(1168),n=o(8032),i=o(2557),l=o(6665),s=o(5648),d=o(3929),c=o(3668),u=o(5009),f=o(6283),g=o(8833),h=o(397);function m({state:e,descriptors:t,navigation:o}){const a=(0,g.useSafeAreaInsets)(),r=(0,l.useRef)(e.routes.map(()=>new u.default.Value(0))).current;(0,l.useEffect)(()=>{console.log("AnimatedTabBar state.index:",e.index),console.log("AnimatedTabBar routes:",e.routes.map(e=>({name:e.name,key:e.key}))),console.log("AnimatedTabBar descriptors keys:",Object.keys(t)),e.routes.forEach((t,o)=>{u.default.timing(r[o],{toValue:e.index===o?1:0,duration:300,useNativeDriver:!1}).start()})},[e.index,e.routes,r]);const n=Math.max(a.bottom,20);return(0,h.jsx)(d.default,{style:[y.container,{paddingBottom:n}],children:(0,h.jsx)(d.default,{style:y.tabBar,children:e.routes.filter(e=>{const o=t[e.key]?.options;return!(!o||!(o.tabBarLabel||o.title||o.tabBarIcon))}).map((a,n)=>{const{options:i}=t[a.key],l=void 0!==i.tabBarLabel?i.tabBarLabel:void 0!==i.title?i.title:a.name,c=e.index===n,g=r[n],m=g.interpolate({inputRange:[0,1],outputRange:[44,100]}),x=g.interpolate({inputRange:[0,1],outputRange:["rgba(40, 46, 16, 0.6)","rgba(40, 46, 16, 0.9)"]}),p=g.interpolate({inputRange:[0,.5,1],outputRange:[0,0,1]}),b=c?"#FFFE77":"#9ca3af";return(0,h.jsx)(u.default.View,{style:[y.tabButton,{width:m,backgroundColor:x}],children:(0,h.jsx)(s.default,{accessibilityRole:"button",accessibilityState:c?{selected:!0}:{},accessibilityLabel:i.tabBarAccessibilityLabel,onPress:()=>{const e=o.emit({type:"tabPress",target:a.key,canPreventDefault:!0});c||e.defaultPrevented||o.navigate(a.name)},style:y.tabTouchable,children:(0,h.jsxs)(d.default,{style:y.tabContent,children:[(0,h.jsx)(d.default,{style:y.iconWrapper,children:i.tabBarIcon&&i.tabBarIcon({focused:c,color:b,size:22})}),(0,h.jsx)(u.default.View,{style:{opacity:p},children:c&&(0,h.jsx)(f.default,{style:y.label,children:String(l)})})]})})},a.key)})})})}const y=c.default.create({container:{position:"absolute",bottom:0,left:0,right:0,paddingHorizontal:16,paddingTop:12,alignItems:"center"},tabBar:{flexDirection:"row",backgroundColor:"rgba(30, 35, 13, 0.95)",borderRadius:50,paddingVertical:8,paddingHorizontal:8,justifyContent:"center",alignItems:"center",shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:8,elevation:8,gap:6},tabButton:{height:44,borderRadius:22,overflow:"hidden",justifyContent:"center",alignItems:"center"},tabTouchable:{flex:1,width:"100%",justifyContent:"center",alignItems:"center"},tabContent:{flexDirection:"row",alignItems:"center",justifyContent:"center",gap:8,paddingHorizontal:0},iconWrapper:{width:22,height:22,alignItems:"center",justifyContent:"center"},label:{color:"#FFFE77",fontSize:13,fontWeight:"600"}});function x(){return(0,h.jsxs)(a.Tabs,{tabBar:e=>(0,h.jsx)(m,Object.assign({},e)),screenOptions:{headerShown:!1,tabBarActiveTintColor:"#FFFE77",tabBarInactiveTintColor:"#9ca3af"},children:[(0,h.jsx)(a.Tabs.Screen,{name:"explore",options:{title:"Explore",tabBarIcon:({color:e,size:t})=>(0,h.jsx)(r.default,{size:t,color:e})}}),(0,h.jsx)(a.Tabs.Screen,{name:"record",options:{title:"Record",tabBarIcon:({color:e,size:t})=>(0,h.jsx)(n.default,{size:t,color:e})}}),(0,h.jsx)(a.Tabs.Screen,{name:"profile",options:{title:"Profile",tabBarIcon:({color:e,size:t})=>(0,h.jsx)(i.default,{size:t,color:e})}})]})}},8973(e,t,o){"use strict";o.r(t),o.d(t,{default:()=>s});var a=o(9637),r=(o(6665),o(3929)),n=o(6283),i=o(3668),l=o(397);function s(){return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(a.Stack.Screen,{options:{title:"Oops!"}}),(0,l.jsxs)(r.default,{style:d.container,children:[(0,l.jsx)(n.default,{style:d.title,children:"This screen doesn't exist."}),(0,l.jsx)(a.Link,{href:"/",asChild:!0,style:d.link,children:(0,l.jsx)(n.default,{style:d.linkText,children:"Go to home screen!"})})]})]})}const d=i.default.create({container:{flex:1,alignItems:"center",justifyContent:"center",padding:20},title:{fontSize:20,fontWeight:"bold"},link:{marginTop:15,paddingVertical:15},linkText:{fontSize:14,color:"#2e78b7"}})},9269(e,t,o){"use strict";function a(e,t){const o=r(t.latitude-e.latitude),a=r(t.longitude-e.longitude),n=r(e.latitude),i=r(t.latitude),l=Math.sin(o/2)*Math.sin(o/2)+Math.sin(a/2)*Math.sin(a/2)*Math.cos(n)*Math.cos(i);return 6371*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))}function r(e){return e*Math.PI/180}function n(e){if(e.length<2)return 0;let t=0;for(let o=0;o<e.length-1;o++){t+=a(e[o],e[o+1])}return 1e3*t}function i(e){if(e<1e3)return`${Math.round(e)}m`;return`${(e/1e3).toFixed(2)}km`}function l(e){const t=Math.floor(e/3600),o=Math.floor(e%3600/60),a=e%60;return t>0?`${t}h ${o}m`:o>0?`${o}m ${a}s`:`${a}s`}function s(e){const t=new Date(e),o=new Date,a=Math.floor((o.getTime()-t.getTime())/864e5);return 0===a?`Today at ${t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`:1===a?`Yesterday at ${t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`:t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}o.r(t),o.d(t,{calculateDistance:()=>a,calculateTotalDistance:()=>n,formatDate:()=>s,formatDistance:()=>i,formatDuration:()=>l})},9582(e,t,o){"use strict";o.r(t),o.d(t,{default:()=>i});const a="#5d6b4a",r="#FFFE77",n="#F8F7F2",i={primary:a,accent:r,background:n,darkGreen:"#282E10",mediumGreen:"#3d4520",lightGreen:"#a8ad8e",paleYellow:"#d4d4a0",light:{text:"#1a1f0a",background:n,tint:a,tabIconDefault:"#9ca3af",tabIconSelected:r}}},9895(e,t,o){"use strict";o.r(t),o.d(t,{default:()=>d});var a=o(6665),r=o(3929),n=o(7042),i=(o(1051),o(397));const l=(0,a.forwardRef)(({coordinates:e,style:t,initialRegion:o,scrollEnabled:l=!0,zoomEnabled:d=!0},c)=>{const u=useRef(null),f=useRef(null);return useImperativeHandle(c,()=>({animateToRegion:(e,t=500)=>{f.current&&f.current.easeTo({center:[e.longitude,e.latitude],zoom:14,duration:t})},fitToCoordinates:(e,t={})=>{if(f.current&&e.length>0){const o=new n.LngLatBounds;e.forEach(e=>o.extend([e.longitude,e.latitude])),f.current.fitBounds(o,{padding:t.edgePadding||20})}}})),a(()=>{if(!u.current)return;const t=o?[o.longitude,o.latitude]:e.length>0?[e[0].longitude,e[0].latitude]:[0,0],a=o?14:12,r=new n.Map({container:u.current,style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",center:t,zoom:a,interactive:l&&d});return f.current=r,r.on("load",()=>{if(e.length>1){r.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:e.map(e=>[e.longitude,e.latitude])}}}),r.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#5d6b4a","line-width":4}});const t=new n.LngLatBounds;e.forEach(e=>t.extend([e.longitude,e.latitude])),r.fitBounds(t,{padding:20})}}),()=>{r.remove()}},[e,o,l,d]),(0,i.jsx)(r.default,{style:[t,s.container],children:(0,i.jsx)("div",{ref:u,style:{width:"100%",height:"100%"}})})}),s=StyleSheet.create({container:{backgroundColor:"#f3f4f6",overflow:"hidden"}}),d=l},9908(e,t,o){"use strict";o.r(t),o.d(t,{DogsContext:()=>l,useDogs:()=>s});var a=o(6665),r=o(2790),n=o(3353),i=o(5938);const[l,s]=(0,r.default)(()=>{const{user:e,session:t,isLoading:o}=(0,n.useAuth)(),[r,l]=(0,a.useState)([]),[s,d]=(0,a.useState)(null),[c,u]=(0,a.useState)(!0),f=(0,a.useMemo)(()=>r.find(e=>e.id===s)||r[0]||null,[r,s]),g=(0,a.useCallback)(async(e,t)=>{console.log("Loading dog profiles for user:",e),u(!0);try{const e=await fetch(`${i.API_URL}/dog`,{headers:{Authorization:`Bearer ${t}`}});if(e.ok){const t=await e.json();Array.isArray(t)?(l(t),t.length>0&&!s&&d(t[0].id)):t&&"object"===typeof t?(l([t]),d(t.id)):l([])}else l([])}catch(o){console.error("Error loading dog profiles:",o),l([])}finally{u(!1)}},[s]),h=(0,a.useCallback)(async()=>{e&&t&&await g(e.id,t.accessToken)},[e,t,g]);(0,a.useEffect)(()=>{o||(e&&t?g(e.id,t.accessToken):(l([]),u(!1)))},[e,t,g,o]);const m=(0,a.useCallback)(async e=>{if(!t)throw new Error("No session");const o=await fetch(`${i.API_URL}/dog`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.accessToken}`},body:JSON.stringify(e)});if(!o.ok){const e=await o.json();throw new Error(e.detail?.[0]?.msg||"Failed to create dog profile")}const a=await o.json();return l(e=>[...e,a]),d(a.id),a},[t]),y=(0,a.useCallback)(async e=>{if(!t)throw new Error("No session");if(!e.id)throw new Error("Dog ID is required for update");const o=await fetch(`${i.API_URL}/dog/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.accessToken}`},body:JSON.stringify(e)});if(!o.ok){const e=await o.json();throw new Error(e.detail?.[0]?.msg||"Failed to update dog profile")}const a=await o.json();return l(e=>e.map(e=>e.id===a.id?a:e)),a},[t]);return(0,a.useMemo)(()=>({dogProfile:f,dogProfiles:r,activeDogId:s,setActiveDogId:d,isDogProfileLoading:c,hasDogProfile:r.length>0,refreshDogProfile:h,createDogProfile:m,updateDogProfile:y}),[f,r,s,c,h,m,y])})}},t={};function o(a){var r=t[a];if(void 0!==r)return r.exports;var n=t[a]={exports:{}};return e[a].call(n.exports,n,n.exports,o),n.exports}o.m=e,(()=>{var e=[];o.O=(t,a,r,n)=>{if(!a){var i=1/0;for(c=0;c<e.length;c++){for(var[a,r,n]=e[c],l=!0,s=0;s<a.length;s++)(!1&n||i>=n)&&Object.keys(o.O).every(e=>o.O[e](a[s]))?a.splice(s--,1):(l=!1,n<i&&(i=n));if(l){e.splice(c--,1);var d=r();void 0!==d&&(t=d)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[a,r,n]}})(),o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="/",(()=>{var e={792:0};o.O.j=t=>0===e[t];var t=(t,a)=>{var r,n,[i,l,s]=a,d=0;if(i.some(t=>0!==e[t])){for(r in l)o.o(l,r)&&(o.m[r]=l[r]);if(s)var c=s(o)}for(t&&t(a);d<i.length;d++)n=i[d],o.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return o.O(c)},a=self.webpackChunkweb=self.webpackChunkweb||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var a=o.O(void 0,[607],()=>o(389));a=o.O(a)})();
//# sourceMappingURL=main.f587b271.js.map