(()=>{var e={282(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>y});a(6665);var o=a(3929),r=a(6283),l=a(2772),n=a(5648),i=a(1690),d=a(8833),s=a(5395),c=a(480),u=a(9637),f=a(4171),g=a(9582),h=a(3353),m=a(397);function y(){const e=(0,d.useSafeAreaInsets)(),t=(0,u.useRouter)(),a=(0,h.useAuth)(),y=(e,a)=>{a?t.push(a):i.default.alert(e)};return(0,m.jsxs)(o.default,{style:[f.default.container,{paddingTop:e.top}],children:[(0,m.jsxs)(o.default,{style:f.default.header,children:[(0,m.jsx)(n.default,{style:f.default.backButton,onPress:()=>t.push("/profile"),children:(0,m.jsx)(s.default,{size:20,color:g.default.accentPrimary})}),(0,m.jsx)(r.default,{style:f.default.title,children:"Settings"}),(0,m.jsx)(o.default,{style:{width:40}})]}),(0,m.jsxs)(l.default,{contentContainerStyle:f.default.content,children:[(0,m.jsxs)(o.default,{style:f.default.sectionCard,children:[(0,m.jsx)(r.default,{style:f.default.sectionTitle,children:"Your Account"}),(0,m.jsxs)(n.default,{style:f.default.row,onPress:()=>y("Account Information","/settings/account"),children:[(0,m.jsx)(r.default,{style:f.default.rowText,children:"Account Information"}),(0,m.jsx)(c.default,{size:18,color:g.default.accentPrimary})]}),(0,m.jsxs)(n.default,{style:f.default.row,onPress:()=>y("Privacy and Safety","/settings/privacy"),children:[(0,m.jsx)(r.default,{style:f.default.rowText,children:"Privacy and Safety"}),(0,m.jsx)(c.default,{size:18,color:g.default.accentPrimary})]}),(0,m.jsxs)(n.default,{style:f.default.row,onPress:()=>y("Change your password","/settings/password"),children:[(0,m.jsx)(r.default,{style:f.default.rowText,children:"Change your password"}),(0,m.jsx)(c.default,{size:18,color:g.default.accentPrimary})]})]}),(0,m.jsxs)(o.default,{style:f.default.sectionCard,children:[(0,m.jsx)(r.default,{style:f.default.sectionTitle,children:"Dog Profile"}),(0,m.jsxs)(n.default,{style:f.default.row,onPress:()=>y("Dog Information","/settings/dog-info"),children:[(0,m.jsx)(r.default,{style:f.default.rowText,children:"Dog Information"}),(0,m.jsx)(c.default,{size:18,color:g.default.accentPrimary})]}),(0,m.jsxs)(n.default,{style:f.default.row,onPress:()=>y("Edit Tags","/settings/dog-tags"),children:[(0,m.jsx)(r.default,{style:f.default.rowText,children:"Edit Tags"}),(0,m.jsx)(c.default,{size:18,color:g.default.accentPrimary})]})]}),(0,m.jsxs)(n.default,{style:f.default.logoutCard,onPress:async()=>{try{a?.signOut&&await a.signOut()}catch(e){console.error("Logout failed",e),i.default.alert("Error","Failed to logout")}},children:[(0,m.jsx)(r.default,{style:f.default.logoutText,children:"Logout"}),(0,m.jsx)(c.default,{size:18,color:g.default.accentPrimary})]})]})]})}},587(e,t,a){var o={"./(tabs)/_layout.tsx":5210,"./(tabs)/explore.styles.ts":2699,"./(tabs)/explore.tsx":4509,"./(tabs)/explore.web.tsx":8389,"./(tabs)/profile.styles.ts":8745,"./(tabs)/profile.tsx":8415,"./(tabs)/record.styles.ts":1095,"./(tabs)/record.tsx":5209,"./(tabs)/record.web.tsx":745,"./(tabs)/settings.styles.ts":4171,"./(tabs)/settings.tsx":282,"./+not-found.tsx":8973,"./_layout.tsx":6848,"./auth.styles.ts":5632,"./demo.tsx":5625,"./index.tsx":5250,"./login.tsx":4101,"./onboarding/dog-basics.styles.ts":7924,"./onboarding/dog-basics.tsx":4674,"./onboarding/dog-personality.styles.ts":8625,"./onboarding/dog-personality.tsx":6183,"./signup.tsx":3764,"./trail/[id].styles.ts":8776,"./trail/[id].tsx":3686,"./trails.tsx":2399};function r(e){var t=l(e);return a(t)}function l(e){if(!a.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}r.keys=function(){return Object.keys(o)},r.resolve=l,e.exports=r,r.id=587},594(e,t,a){"use strict";a.r(t),a.d(t,{DOG_SIZES:()=>o,PERSONALITY_TAGS:()=>r,RECALL_RELIABILITY_OPTIONS:()=>l});const o=["XS","S","M","L","XL"],r=["Friendly","Shy","Energetic","Calm","Social","Independent","Playful","Curious","Barky","Reactive","Easily Triggered","Gentle","Protective","Anxious","Confident","Food-Motivated","Quiet","Adventurous","Lazy","Affectionate","Dominant","Submissive","Fearful","Obedient","Stubborn","High-Prey-Drive","Leash-Pulling","Good-With-Dogs","Good-With-Kids"],l=["Poor","Fair","Good","Excellent"]},745(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>z});var o=a(6665),r=a(6283),l=a(3929),n=a(5648),i=a(1690),d=a(530),s=a(5009),c=a(444),u=a(6725),f=a(6773),g=a(8264),h=a(7430),m=a(9637),y=a(5259),p=a(3271),x=a(5624),b=a(2301),j=a(1168),w=a(8032),C=a(8280),P=a(7353),k=a(1047),S=a(1095),I=a(9582),T=a(6746),v=a(3353),E=a(9269),_=a(397);const B="recording_coordinates",O="recording_start_time",L="recording_max_elevation",A="recording_max_speed",D="recording_last_update";function z(){const{saveTrail:e,getTrailById:t}=(0,T.useTrails)(),{user:a}=(0,v.useAuth)(),z=(0,m.useLocalSearchParams)(),R=(0,m.useRouter)(),W="string"===typeof z.trailId?z.trailId:void 0,N=W?t(W):void 0,U=(0,o.useRef)(null),[F,M]=(0,o.useState)(!1),[V,G]=(0,o.useState)([]),[$,H]=(0,o.useState)(null),[q,X]=(0,o.useState)(0),[J,K]=(0,o.useState)(null),[Y,Z]=(0,o.useState)(!0),[Q,ee]=(0,o.useState)(null),te=((0,o.useRef)(new Map),(0,o.useRef)(null)),ae=(0,o.useRef)(null),oe=(0,o.useRef)(null),re=.5*u.default.get("window").height,le=280,ne=(0,o.useRef)(new s.default.Value(le)).current,[ie,de]=(0,o.useState)(!1),[se,ce]=(0,o.useState)(0),[ue,fe]=(0,o.useState)(0),[ge,he]=(0,o.useState)("0:00"),[me,ye]=(0,o.useState)(0),[pe,xe]=(0,o.useState)(0),[be,je]=(0,o.useState)(!1),[we,Ce]=(0,o.useState)(null),[Pe,ke]=(0,o.useState)(""),[Se,Ie]=(0,o.useState)(""),[Te,ve]=(0,o.useState)(void 0),Ee=(0,o.useRef)(null),[_e,Be]=(0,o.useState)(void 0);(0,o.useEffect)(()=>{(async()=>{try{if(navigator.permissions&&navigator.permissions.query){const e=await navigator.permissions.query({name:"geolocation"});K("granted"===e.state),e.onchange=()=>K("granted"===e.state)}else try{await new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(()=>e(!0),()=>e(!1),{timeout:5e3})}),K(!0)}catch(e){K(!1)}}catch(t){console.warn("Permission check failed",t),K(null)}finally{Z(!1),Oe()}})()},[]);const Oe=async()=>{try{const e=await y.default.getItem(B);if(e){const t=JSON.parse(e);G(t)}const t=await y.default.getItem(L);t&&fe(parseFloat(t));const a=await y.default.getItem(A);a&&xe(parseFloat(a));const o=await y.default.getItem(O);if(o){const e=Math.floor((Date.now()-parseInt(o))/1e3);X(e),M(!0),Le()}}catch(e){console.error("Error loading recording state:",e)}},Le=()=>{ae.current||(ae.current=setInterval(async()=>{try{const e=await y.default.getItem(O);if(e){const t=Math.floor((Date.now()-parseInt(e))/1e3);X(t)}}catch(e){}},1e3))},Ae=()=>{je(!1),Ce(null)};(0,o.useEffect)(()=>{if(q>0){const e=(0,E.calculateTotalDistance)(V)/1e3;if(e>0){const t=q/60/e,a=Math.floor(t),o=Math.round(60*(t-a));he(`${a}:${o.toString().padStart(2,"0")}`)}}},[q,V]);const De=(0,o.useRef)(0),ze=(0,o.useRef)(c.default.create({onStartShouldSetPanResponder:()=>!0,onMoveShouldSetPanResponder:(e,t)=>Math.abs(t.dy)>5,onPanResponderGrant:()=>{De.current=ne._value},onPanResponderMove:(e,t)=>{const a=De.current-t.dy;a>=le&&a<=re&&ne.setValue(a)},onPanResponderRelease:(e,t)=>{const a=(re+le)/2,o=ne._value;t.dy<-50?Re():t.dy>50?We():o>a?Re():We()}})).current,Re=()=>{de(!0),s.default.spring(ne,{toValue:re,useNativeDriver:!1,tension:50,friction:8}).start()},We=()=>{de(!1),s.default.spring(ne,{toValue:le,useNativeDriver:!1,tension:50,friction:8}).start()};if(Y)return(0,_.jsxs)(l.default,{style:S.default.loadingContainer,children:[(0,_.jsx)(d.default,{size:"large",color:I.default.backgroundPrimary}),(0,_.jsx)(r.default,{style:S.default.loadingText,children:"Checking permissions..."})]});if(!J)return(0,_.jsxs)(l.default,{style:S.default.permissionContainer,children:[(0,_.jsx)(j.default,{size:64,color:"#666"}),(0,_.jsx)(r.default,{style:S.default.permissionTitle,children:"Location Permission Required"}),(0,_.jsx)(r.default,{style:S.default.permissionText,children:"This page needs access to your location to track your walks. Please allow location access in your browser."}),(0,_.jsx)(n.default,{style:S.default.permissionButton,onPress:()=>{navigator.geolocation.getCurrentPosition(()=>K(!0),()=>K(!1))},children:(0,_.jsx)(r.default,{style:S.default.permissionButtonText,children:"Grant Permission"})})]});const Ne=(0,E.calculateTotalDistance)(V),Ue=N&&F&&V.length>0&&N.coordinates.length>0?Math.min(Ne/N.distance*100,100):0,Fe=!!N;return(0,_.jsxs)(l.default,{style:S.default.container,children:[$&&(0,_.jsx)(h.default,{ref:U,coordinates:V,style:S.default.map,initialRegion:{latitude:$.latitude,longitude:$.longitude,latitudeDelta:.01,longitudeDelta:.01},showsUserLocation:!0,followsUserLocation:F,showsMyLocationButton:!1}),(0,_.jsx)(n.default,{style:S.default.recenterButton,onPress:async()=>{if(U.current)try{navigator.geolocation.getCurrentPosition(e=>{const t={latitude:e.coords.latitude,longitude:e.coords.longitude};H(t),U.current.animateToRegion({latitude:t.latitude,longitude:t.longitude,latitudeDelta:.01,longitudeDelta:.01},500)})}catch(e){console.error("Error getting current location:",e)}},activeOpacity:.8,children:(0,_.jsx)(w.default,{size:24,color:"#5d6b4a"})}),(0,_.jsxs)(s.default.View,{style:[S.default.bottomSheet,{height:s.default.add(ne,92),bottom:0}],children:[(0,_.jsx)(l.default,Object.assign({},ze.panHandlers,{style:S.default.handleBar,children:(0,_.jsxs)(n.default,{style:S.default.handleContainer,onPress:()=>{ie?We():Re()},activeOpacity:.7,children:[(0,_.jsx)(l.default,{style:S.default.handle}),ie?(0,_.jsx)(x.default,{size:20,color:"#9ca3af"}):(0,_.jsx)(b.default,{size:20,color:"#9ca3af"})]})})),(0,_.jsxs)(l.default,{style:S.default.bottomSheetContent,children:[(0,_.jsxs)(l.default,{style:S.default.statsGrid,children:[(0,_.jsxs)(l.default,{style:S.default.statItem,children:[(0,_.jsx)(r.default,{style:S.default.statItemLabel,children:"Time"}),(0,_.jsx)(r.default,{style:S.default.statItemValue,children:(0,E.formatDuration)(q)})]}),(0,_.jsxs)(l.default,{style:S.default.statItem,children:[(0,_.jsx)(r.default,{style:S.default.statItemLabel,children:"Distance"}),(0,_.jsx)(r.default,{style:S.default.statItemValue,children:(0,E.formatDistance)(Ne)})]}),(0,_.jsxs)(l.default,{style:S.default.statItem,children:[(0,_.jsx)(r.default,{style:S.default.statItemLabel,children:"Elevation"}),(0,_.jsxs)(r.default,{style:S.default.statItemValue,children:[se.toFixed(0),"m"]})]}),(0,_.jsxs)(l.default,{style:S.default.statItem,children:[(0,_.jsx)(r.default,{style:S.default.statItemLabel,children:"Pace"}),(0,_.jsxs)(r.default,{style:S.default.statItemValue,children:[ge,"/km"]})]}),(0,_.jsxs)(l.default,{style:S.default.statItem,children:[(0,_.jsx)(r.default,{style:S.default.statItemLabel,children:"Speed"}),(0,_.jsxs)(r.default,{style:S.default.statItemValue,children:[me.toFixed(1)," km/h"]})]}),Fe&&(0,_.jsxs)(l.default,{style:S.default.statItem,children:[(0,_.jsx)(r.default,{style:S.default.statItemLabel,children:"Progress"}),(0,_.jsxs)(r.default,{style:S.default.statItemValue,children:[Ue.toFixed(0),"%"]})]})]}),(0,_.jsx)(n.default,{style:[S.default.recordButton,F&&S.default.recordButtonActive],onPress:F?async()=>{console.log("Stopping web recording...");try{null!==te.current&&(navigator.geolocation.clearWatch(te.current),te.current=null),oe.current&&oe.current.release&&(await oe.current.release(),oe.current=null),ae.current&&(clearInterval(ae.current),ae.current=null);const e=await y.default.getItem(B),t=e?JSON.parse(e):V,a=await y.default.getItem(L),o=a?parseFloat(a):ue,r=await y.default.getItem(A),l=r?parseFloat(r):pe,n=await y.default.getItem(O),d=n?Math.floor((Date.now()-parseInt(n))/1e3):q;if(!t||t.length<2)return i.default.alert("No Trail Data","Not enough data to save this trail. Try walking a bit more!"),M(!1),G([]),X(0),await y.default.removeItem(B),await y.default.removeItem(L),await y.default.removeItem(A),await y.default.removeItem(O),void await y.default.removeItem(D);const s=(0,E.calculateTotalDistance)(t),c=s/1e3;let u="0:00";if(c>0){const e=d/60/c,t=Math.floor(e);u=`${t}:${Math.round(60*(e-t)).toString().padStart(2,"0")}`}const f={id:Date.now().toString(),date:Date.now(),distance:s,duration:d,coordinates:t,city:Q?.city,country:Q?.country,pace:u,speed:l,maxElevation:o};Ce(f),ke(f.name||""),Ie(f.description||""),ve(f.photo||void 0),je(!0)}catch(e){console.error("Stop error:",e),i.default.alert("Error","Failed to stop recording"),M(!1)}}:async()=>{console.log("Starting web recording..."),M(!0),G([]),X(0),fe(0),xe(0);try{const t=Date.now();await y.default.setItem(O,t.toString()),await y.default.removeItem(B),await y.default.removeItem(L),await y.default.removeItem(A),await y.default.removeItem(D),navigator.geolocation.getCurrentPosition(async e=>{const t={latitude:e.coords.latitude,longitude:e.coords.longitude};await y.default.setItem(B,JSON.stringify([t])),G([t]),H(t)},e=>{console.warn("Initial geolocation failed",e)},{enableHighAccuracy:!0,timeout:1e4});const a=navigator.geolocation.watchPosition(async e=>{const t={latitude:e.coords.latitude,longitude:e.coords.longitude};H(t),G(e=>{const a=[...e,t];return y.default.setItem(B,JSON.stringify(a)).catch(()=>{}),a}),await y.default.setItem(D,Date.now().toString())},e=>{console.error("watchPosition error",e)},{enableHighAccuracy:!0,maximumAge:0,timeout:1e4});te.current=a;try{navigator.wakeLock&&navigator.wakeLock.request&&(oe.current=await navigator.wakeLock.request("screen"))}catch(e){console.warn("Wake lock request failed",e)}Le()}catch(t){console.error("Recording error:",t),i.default.alert("Error",t?.message||"Failed to start recording"),M(!1)}},activeOpacity:.8,children:F?(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(P.default,{size:24,color:"#fff",fill:"#fff"}),(0,_.jsx)(r.default,{style:S.default.recordButtonText,children:"Stop & Save"})]}):(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(C.default,{size:24,color:"#fff",fill:"#fff"}),(0,_.jsx)(r.default,{style:S.default.recordButtonText,children:"Start Trail"})]})}),ie&&(0,_.jsxs)(l.default,{style:S.default.expandedContent,children:[(0,_.jsx)(l.default,{style:S.default.divider}),(0,_.jsxs)(n.default,{style:S.default.optionRow,onPress:()=>i.default.alert("Apple Watch","Connect your Apple Watch to sync workout data."),activeOpacity:.7,children:[(0,_.jsx)(l.default,{style:S.default.optionIconContainer,children:(0,_.jsx)(k.default,{size:24,color:"#5d6b4a"})}),(0,_.jsxs)(l.default,{style:S.default.optionTextContainer,children:[(0,_.jsx)(r.default,{style:S.default.optionTitle,children:"Apple Watch"}),(0,_.jsx)(r.default,{style:S.default.optionSubtitle,children:"Not connected"})]}),(0,_.jsx)(l.default,{style:S.default.optionBadge,children:(0,_.jsx)(r.default,{style:S.default.optionBadgeText,children:"Connect"})})]}),(0,_.jsxs)(n.default,{style:S.default.optionRow,onPress:()=>i.default.alert("Alerts","Configure alerts for distance milestones and pace notifications."),activeOpacity:.7,children:[(0,_.jsx)(l.default,{style:S.default.optionIconContainer,children:(0,_.jsx)(p.default,{size:24,color:"#5d6b4a"})}),(0,_.jsxs)(l.default,{style:S.default.optionTextContainer,children:[(0,_.jsx)(r.default,{style:S.default.optionTitle,children:"Alerts"}),(0,_.jsx)(r.default,{style:S.default.optionSubtitle,children:"Distance & pace notifications"})]}),(0,_.jsx)(l.default,{style:[S.default.optionBadge,S.default.optionBadgeActive],children:(0,_.jsx)(r.default,{style:[S.default.optionBadgeText,S.default.optionBadgeTextActive],children:"Active"})})]})]})]})]}),(0,_.jsx)(g.default,{visible:be,animationType:"slide",transparent:!0,onRequestClose:Ae,children:(0,_.jsx)(l.default,{style:S.default.modalOverlay,children:(0,_.jsx)(l.default,{style:S.default.modalContainer,children:(0,_.jsxs)(l.default,{style:S.default.modalContent,children:[(0,_.jsx)(r.default,{style:S.default.modalTitle,children:"Save Trail"}),(0,_.jsx)(r.default,{style:{fontSize:14,marginTop:8},children:"Name"}),(0,_.jsx)(f.default,{placeholder:"Trail name",value:Pe,onChangeText:ke,style:S.default.input}),(0,_.jsx)(r.default,{style:{fontSize:14,marginTop:8},children:"Description"}),(0,_.jsx)(f.default,{placeholder:"Description",value:Se,onChangeText:Ie,style:[S.default.input,{height:100}],multiline:!0}),(0,_.jsx)(r.default,{style:{fontSize:14,marginTop:8},children:"Photo (optional)"}),(0,_.jsxs)(l.default,{style:{flexDirection:"row",gap:8,alignItems:"center"},children:[(0,_.jsx)(n.default,{style:[S.default.modalButton,{paddingHorizontal:12}],onPress:()=>Ee.current?.click(),children:(0,_.jsx)(r.default,{style:S.default.modalButtonText,children:"Choose File"})}),(0,_.jsx)(f.default,{placeholder:"Or paste image URL",value:Te,onChangeText:ve,style:[S.default.input,{flex:1}]})]}),(0,_.jsx)("input",{ref:Ee,type:"file",accept:"image/*",style:{display:"none"},onChange:e=>{const t=e.target.files&&e.target.files[0];if(t){Be(t);const e=URL.createObjectURL(t);ve(e)}}}),(0,_.jsxs)(l.default,{style:{flexDirection:"row",gap:8,marginTop:12},children:[(0,_.jsx)(n.default,{style:S.default.modalButton,onPress:Ae,children:(0,_.jsx)(r.default,{style:S.default.modalButtonText,children:"Cancel"})}),(0,_.jsx)(n.default,{style:[S.default.modalButton,S.default.modalButtonPrimary],onPress:async()=>{if(!we)return;const t=Object.assign({},we,{name:Pe||we.name||"Untitled Trail",description:Se,photo:_e||Te});try{await e(t),je(!1),Ce(null),M(!1),G([]),X(0),ee(null),ce(0),fe(0),he("0:00"),ye(0),xe(0),await y.default.removeItem(B),await y.default.removeItem(L),await y.default.removeItem(A),await y.default.removeItem(O),await y.default.removeItem(D),R.push("/(tabs)/profile")}catch(a){console.error("Save failed",a),i.default.alert("Error","Failed to save trail")}},children:(0,_.jsx)(r.default,{style:[S.default.modalButtonText,{color:"#fff"}],children:"Save Trail"})})]})]})})})})]})}},1095(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>l});var o=a(3668),r=a(9582);const l=o.default.create({container:{flex:1,backgroundColor:r.default.backgroundPrimary},map:Object.assign({},o.default.absoluteFillObject),webContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:r.default.backgroundPrimary,padding:20},webText:{marginTop:16,fontSize:16,color:r.default.textMuted,textAlign:"center"},loadingContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:r.default.backgroundPrimary},loadingText:{marginTop:16,fontSize:16,color:r.default.textMuted},permissionContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:r.default.backgroundPrimary,padding:32},permissionTitle:{marginTop:16,fontSize:20,fontWeight:"700",color:r.default.textPrimary,textAlign:"center"},permissionText:{marginTop:8,fontSize:16,color:r.default.textMuted,textAlign:"center"},permissionButton:{marginTop:24,paddingHorizontal:32,paddingVertical:16,backgroundColor:r.default.backgroundPrimary,borderRadius:12},permissionButtonText:{fontSize:16,fontWeight:"600",color:r.default.textMuted},statsContainer:{position:"absolute",left:20,right:20,flexDirection:"row",gap:12},compactRow:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginBottom:12},compactStats:{flexDirection:"row",gap:12,flex:1},compactStatBox:{backgroundColor:r.default.backgroundSecondary,borderRadius:12,paddingVertical:10,paddingHorizontal:14,alignItems:"center",minWidth:110},stopButtonCompact:{marginLeft:12,backgroundColor:"#111",paddingVertical:10,paddingHorizontal:16,borderRadius:12,flexDirection:"row",alignItems:"center",gap:8},stopButtonCompactText:{color:"#fff",fontWeight:"700",marginLeft:6},statBox:{flex:1,backgroundColor:"rgba(255, 255, 255, 0.95)",borderRadius:16,padding:16,shadowColor:r.default.borderSubtle,shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:8,elevation:4},statLabel:{fontSize:13,color:r.default.textMuted,fontWeight:"500",marginBottom:4},statValue:{fontSize:24,color:r.default.textPrimary,fontWeight:"700"},controlContainer:{position:"absolute",left:20,right:20,alignItems:"center"},recordButton:{flexDirection:"row",alignItems:"center",gap:12,paddingHorizontal:32,paddingVertical:20,backgroundColor:r.default.accentSecondary,borderRadius:50,shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:12,elevation:8},recordButtonActive:{backgroundColor:r.default.accentSecondary},recordButtonText:{fontSize:18,fontWeight:"700",color:r.default.backgroundPrimary},bottomSheet:{position:"absolute",left:0,right:0,backgroundColor:r.default.backgroundPrimary,borderTopLeftRadius:24,borderTopRightRadius:24,shadowColor:"#000",shadowOffset:{width:0,height:-4},shadowOpacity:.15,shadowRadius:16,elevation:20},handleBar:{paddingTop:12,paddingBottom:8,alignItems:"center"},handleContainer:{alignItems:"center",gap:4},handle:{width:40,height:4,backgroundColor:r.default.borderSubtle,borderRadius:2},bottomSheetContent:{flex:1,paddingHorizontal:20,paddingBottom:92},statsGrid:{flexDirection:"row",flexWrap:"wrap",gap:12,marginBottom:20},statItem:{width:"31%",backgroundColor:r.default.backgroundSecondary,borderRadius:12,padding:12,alignItems:"center"},statItemLabel:{fontSize:11,color:r.default.textMuted,fontWeight:"600",textTransform:"uppercase",letterSpacing:.5,marginBottom:6},statItemValue:{fontSize:18,color:r.default.textPrimary,fontWeight:"700"},expandedContent:{marginTop:8},divider:{height:1,backgroundColor:r.default.borderSubtle,marginVertical:16},optionRow:{flexDirection:"row",alignItems:"center",paddingVertical:16,paddingHorizontal:16,backgroundColor:r.default.backgroundSecondary,borderRadius:12,marginBottom:12},optionIconContainer:{width:48,height:48,borderRadius:24,backgroundColor:"rgba(93, 107, 74, 0.1)",alignItems:"center",justifyContent:"center",marginRight:12},optionTextContainer:{flex:1},optionTitle:{fontSize:16,fontWeight:"600",color:r.default.textPrimary,marginBottom:2},optionSubtitle:{fontSize:13,color:r.default.textMuted},optionBadge:{paddingHorizontal:12,paddingVertical:6,borderRadius:12,backgroundColor:r.default.borderSubtle},optionBadgeActive:{backgroundColor:"rgba(93, 107, 74, 0.15)"},optionBadgeText:{fontSize:12,fontWeight:"600",color:r.default.textMuted},optionBadgeTextActive:{color:r.default.backgroundPrimary},modalOverlay:{flex:1,backgroundColor:"rgba(0,0,0,0.4)",justifyContent:"center",alignItems:"center",padding:20},modalContainer:{width:"100%",maxHeight:"90%",backgroundColor:"#fff",borderRadius:12,overflow:"hidden"},modalContent:{padding:20},modalTitle:{fontSize:20,fontWeight:"700",color:r.default.backgroundPrimary,marginBottom:12},input:{borderWidth:1,borderColor:"#e5e7eb",backgroundColor:"#f9fafb",paddingHorizontal:12,paddingVertical:10,borderRadius:8,marginTop:8,color:r.default.backgroundPrimary},modalButton:{flex:1,paddingVertical:12,paddingHorizontal:16,borderRadius:10,backgroundColor:"#e5e7eb",alignItems:"center",justifyContent:"center"},modalButtonPrimary:{backgroundColor:"#5d6b4a",marginLeft:8},modalButtonText:{fontSize:16,fontWeight:"600",color:"#1f2937"},recenterButton:{position:"absolute",top:60,left:20,width:48,height:48,borderRadius:24,backgroundColor:r.default.backgroundSecondary,alignItems:"center",justifyContent:"center",shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.15,shadowRadius:8,elevation:4}})},2399(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>y});a(6665);var o=a(3668),r=a(3929),l=a(932),n=a(5648),i=a(530),d=a(6283),s=a(9582),c=a(9637),u=a(4494),f=a(1168),g=a(6746),h=a(9269),m=a(397);function y(){const e=(0,c.useRouter)(),{trails:t,isLoading:a}=(0,g.useTrails)();return a?(0,m.jsx)(r.default,{style:p.loadingContainer,children:(0,m.jsx)(i.default,{size:"large",color:"#2563eb"})}):(0,m.jsx)(r.default,{style:p.container,children:(0,m.jsx)(l.default,{data:t,renderItem:({item:t})=>(0,m.jsx)(n.default,{style:p.trailItem,onPress:()=>e.push(`/trail/${t.id}`),children:(0,m.jsxs)(r.default,{style:p.trailHeader,children:[(0,m.jsx)(r.default,{style:p.iconContainer,children:(0,m.jsx)(f.default,{size:24,color:s.default.backgroundPrimary})}),(0,m.jsxs)(r.default,{style:p.trailInfo,children:[(0,m.jsx)(d.default,{style:p.trailDate,children:(0,h.formatDate)(t.date)}),(0,m.jsxs)(r.default,{style:p.statsRow,children:[(0,m.jsxs)(r.default,{style:p.statItem,children:[(0,m.jsx)(f.default,{size:16,color:s.default.textMuted}),(0,m.jsx)(d.default,{style:p.statText,children:(0,h.formatDistance)(t.distance)})]}),(0,m.jsxs)(r.default,{style:p.statItem,children:[(0,m.jsx)(u.default,{size:16,color:s.default.textMuted}),(0,m.jsx)(d.default,{style:p.statText,children:(0,h.formatDuration)(t.duration)})]})]})]})]})}),keyExtractor:e=>e.id,contentContainerStyle:0===t.length?p.emptyList:p.list,ListEmptyComponent:()=>(0,m.jsxs)(r.default,{style:p.emptyContainer,children:[(0,m.jsx)(f.default,{size:64,color:s.default.borderSubtle}),(0,m.jsx)(d.default,{style:p.emptyTitle,children:"No trails yet"}),(0,m.jsx)(d.default,{style:p.emptyText,children:"Start recording your first dog walk to see it here!"})]})})})}const p=o.default.create({container:{flex:1,backgroundColor:s.default.backgroundSecondary},list:{padding:16,gap:12},emptyList:{flex:1},loadingContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:s.default.backgroundSecondary},trailItem:{backgroundColor:s.default.textPrimary,borderRadius:16,padding:16,marginBottom:12,shadowColor:s.default.backgroundSecondaryVarient,shadowOffset:{width:0,height:2},shadowOpacity:.05,shadowRadius:8,elevation:2},trailHeader:{flexDirection:"row",alignItems:"center",gap:12},iconContainer:{width:48,height:48,borderRadius:24,backgroundColor:s.default.backgroundSecondary,justifyContent:"center",alignItems:"center"},trailInfo:{flex:1},trailDate:{fontSize:16,fontWeight:"600",color:s.default.textPrimary,marginBottom:6},statsRow:{flexDirection:"row",gap:16},statItem:{flexDirection:"row",alignItems:"center",gap:6},statText:{fontSize:14,color:s.default.textMuted,fontWeight:"500"},emptyContainer:{flex:1,justifyContent:"center",alignItems:"center",padding:32},emptyTitle:{fontSize:20,fontWeight:"700",color:"#1f2937",marginTop:16,marginBottom:8},emptyText:{fontSize:16,color:s.default.textMuted,textAlign:"center",lineHeight:24}})},2598(e,t,a){"use strict";a.r(t),a.d(t,{AccountContext:()=>i,useAccount:()=>d});var o=a(6665),r=a(2790),l=a(3353),n=a(5938);const[i,d]=(0,r.default)(()=>{const{user:e,session:t}=(0,l.useAuth)(),[a,r]=(0,o.useState)(null),[i,d]=(0,o.useState)(!0),s=(0,o.useCallback)(async()=>{if(t?.accessToken){d(!0);try{const e=await fetch(`${n.API_URL}/account/me`,{headers:{Authorization:`Bearer ${t.accessToken}`}});if(e.ok){const t=await e.json();r(t)}else console.error("Failed to fetch account:",e.status),r(null)}catch(e){console.error("Error fetching account:",e),r(null)}finally{d(!1)}}},[t?.accessToken]),c=(0,o.useCallback)(async e=>{if(!t?.accessToken)throw new Error("No active session");try{const a=await fetch(`${n.API_URL}/account/me`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.accessToken}`},body:JSON.stringify(e)});if(!a.ok){const e=await a.json();throw new Error(e.detail?.[0]?.msg||"Failed to update account")}const o=await a.json();return r(o),o}catch(a){throw console.error("Error updating account:",a),a}},[t?.accessToken]),u=(0,o.useCallback)(async()=>{if(!t?.accessToken)throw new Error("No active session");try{const e=await fetch(`${n.API_URL}/account/me`,{method:"DELETE",headers:{Authorization:`Bearer ${t.accessToken}`}});if(!e.ok){const t=await e.json();throw new Error(t.detail?.[0]?.msg||"Failed to delete account")}return r(null),!0}catch(e){throw console.error("Error deleting account:",e),e}},[t?.accessToken]);return(0,o.useEffect)(()=>{t?.accessToken?s():(r(null),d(!1))},[t?.accessToken,s]),(0,o.useMemo)(()=>({userProfile:a,isLoading:i,refreshAccount:s,updateAccount:c,deleteAccount:u}),[a,i,s,c,u])})},2634(){},2699(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>l});var o=a(3668),r=a(9582);const l=o.default.create({safeContainer:{flex:1,backgroundColor:r.default.backgroundPrimary},container:{flex:1,backgroundColor:r.default.backgroundPrimary},stickyHeader:{backgroundColor:r.default.backgroundPrimary,paddingBottom:8},stickySearchContainer:{paddingHorizontal:16,paddingBottom:8,flexDirection:"row",alignItems:"center",gap:8},searchBar:{flex:1,flexDirection:"row",alignItems:"center",backgroundColor:r.default.backgroundSecondary,paddingHorizontal:16,paddingVertical:14,borderRadius:28,gap:12,borderWidth:1,borderColor:r.default.borderSubtle},demoButton:{backgroundColor:r.default.backgroundPrimary,paddingHorizontal:16,paddingVertical:12,borderRadius:24},demoButtonText:{color:r.default.textPrimary,fontWeight:"bold"},searchPlaceholder:{fontSize:16,color:r.default.textMuted,fontWeight:"400"},largeTrailCard:{backgroundColor:r.default.textPrimary,borderRadius:24,overflow:"hidden",marginBottom:20,shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.1,shadowRadius:16,elevation:4,position:"relative"},largeTrailImage:{width:"100%",height:260,backgroundColor:r.default.backgroundSecondary},bookmarkButton:{position:"absolute",top:20,right:20,width:44,height:44,borderRadius:22,backgroundColor:"rgba(255, 255, 255, 0.95)",justifyContent:"center",alignItems:"center",shadowColor:r.default.backgroundSecondaryVarient,shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:8,elevation:4},cardGradient:{position:"absolute",top:0,bottom:0,left:0,right:0},cardOverlayContent:{position:"absolute",bottom:0,left:0,right:0,padding:18,paddingBottom:20},overlayTrailName:{fontSize:28,fontWeight:"700",color:r.default.textPrimary,marginBottom:6,lineHeight:34,textShadowColor:"rgba(0, 0, 0, 0.3)",textShadowOffset:{width:0,height:1},textShadowRadius:4},overlayLocation:{fontSize:16,color:r.default.textPrimary,marginBottom:16,opacity:.95,textShadowColor:"rgba(0, 0, 0, 0.3)",textShadowOffset:{width:0,height:1},textShadowRadius:4},overlayBadges:{flexDirection:"row",alignItems:"center",gap:12,flexWrap:"wrap"},badge:{flexDirection:"row",alignItems:"center",backgroundColor:"rgba(40, 40, 40, 0.8)",paddingHorizontal:14,paddingVertical:8,borderRadius:20,gap:6},badgeText:{fontSize:14,fontWeight:"600",color:"#fff",textTransform:"capitalize"},categoriesSection:{backgroundColor:r.default.backgroundPrimary,paddingTop:8,paddingBottom:16},categoriesScroll:{paddingHorizontal:16,gap:12},categoryButton:{flexDirection:"row",alignItems:"center",paddingHorizontal:24,paddingVertical:14,borderRadius:28,backgroundColor:r.default.textPrimary,borderWidth:0,gap:8},categoryButtonActive:{backgroundColor:r.default.backgroundPrimary},categoryText:{fontSize:16,fontWeight:"500",color:r.default.textMuted},categoryTextActive:{color:r.default.textPrimary},categoryTrailsSection:{paddingHorizontal:16,paddingTop:16},bottomPadding:{height:40},loadingContainer:{paddingVertical:60,alignItems:"center",gap:16},loadingText:{fontSize:14,color:r.default.textMuted},emptyContainer:{paddingVertical:60,alignItems:"center",gap:16,paddingHorizontal:32},emptyText:{fontSize:16,color:r.default.textMuted,textAlign:"center",lineHeight:24},placeholderImage:{justifyContent:"center",alignItems:"center",backgroundColor:r.default.textPrimary},searchModalContainer:{flex:1,backgroundColor:r.default.backgroundPrimary},searchModalHeader:{flexDirection:"row",alignItems:"center",paddingHorizontal:16,paddingTop:12,paddingBottom:16,gap:12,borderBottomWidth:1,borderBottomColor:r.default.borderSubtle},backButton:{width:40,height:40,borderRadius:20,backgroundColor:r.default.accentPrimary,justifyContent:"center",alignItems:"center"},searchModalInputContainer:{flex:1,flexDirection:"row",alignItems:"center",backgroundColor:r.default.textPrimary,borderRadius:28,paddingHorizontal:16,paddingVertical:12,borderWidth:1,borderColor:r.default.textMuted,gap:12},searchModalInput:{flex:1,fontSize:16,color:r.default.textPrimary,padding:0,fontWeight:"400"},clearButton:{width:24,height:24,borderRadius:12,backgroundColor:r.default.borderSubtle,justifyContent:"center",alignItems:"center"},searchModalContent:{flex:1,paddingTop:12},currentLocationItem:{flexDirection:"row",alignItems:"center",paddingHorizontal:20,paddingVertical:16,gap:16,backgroundColor:r.default.backgroundSecondary,borderRadius:16,marginHorizontal:16,marginBottom:12},locationIconContainer:{width:48,height:48,borderRadius:24,backgroundColor:r.default.accentPrimary,justifyContent:"center",alignItems:"center"},locationTextContainer:{flex:1},locationTitle:{fontSize:17,fontWeight:"600",color:r.default.textPrimary,marginBottom:4},locationSubtitle:{fontSize:14,color:r.default.textMuted,fontWeight:"400"},suggestionItem:{flexDirection:"row",alignItems:"center",paddingHorizontal:20,paddingVertical:16,gap:16,backgroundColor:r.default.backgroundSecondary,borderRadius:16,marginHorizontal:16,marginBottom:12},suggestionIconContainer:{width:48,height:48,borderRadius:24,backgroundColor:r.default.borderSubtle,justifyContent:"center",alignItems:"center"},suggestionTextContainer:{flex:1},suggestionTitle:{fontSize:17,fontWeight:"600",color:r.default.textPrimary,marginBottom:4},suggestionSubtitle:{fontSize:14,color:r.default.textMuted,fontWeight:"400"}})},3229(e,t,a){"use strict";e.exports=a.p+"static/media/icon.f99e957780228420852c.png"},3353(e,t,a){"use strict";a.r(t),a.d(t,{AuthContext:()=>i,useAuth:()=>d});var o=a(6665),r=a(2790),l=a(5259),n=a(5938);const[i,d]=(0,r.default)(()=>{const[e,t]=(0,o.useState)(null),[a,r]=(0,o.useState)(null),[i,d]=(0,o.useState)(!0);(0,o.useEffect)(()=>{(async()=>{try{const e=await l.default.getItem("session");if(e){const a=JSON.parse(e);t(a),r(a.user)}}catch(e){console.error("Error loading session:",e)}finally{d(!1)}})()},[]);const s=(0,o.useCallback)(async e=>{console.log("Requesting OTP for:",e);const t=await fetch(`${n.API_URL}/otp/request`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!t.ok){const e=await t.json();throw new Error(e.detail?.[0]?.msg||"Failed to request OTP")}return!0},[]),c=(0,o.useCallback)(async(e,a)=>{console.log("Verifying OTP for:",e);const o=await fetch(`${n.API_URL}/otp/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,otpCode:a})});if(!o.ok){const e=await o.json();throw new Error(e.detail?.[0]?.msg||"Invalid OTP code")}const i=await o.json();return t(i),r(i.user),await l.default.setItem("session",JSON.stringify(i)),i},[]),u=(0,o.useCallback)(async(e,t)=>{console.log("Requesting registration for:",e);const a=await fetch(`${n.API_URL}/otp/register-request`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,name:t})});if(!a.ok){const e=await a.json();throw new Error(e.detail?.[0]?.msg||"Failed to request registration")}return!0},[]),f=(0,o.useCallback)(async(e,a)=>{console.log("Verifying registration for:",e);const o=await fetch(`${n.API_URL}/otp/register-verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,otpCode:a})});if(!o.ok){const e=await o.json();throw new Error(e.detail?.[0]?.msg||"Invalid OTP code")}const i=await o.json();return t(i),r(i.user),await l.default.setItem("session",JSON.stringify(i)),i},[]),g=(0,o.useCallback)(async e=>{const o={accessToken:e.accessToken,tokenType:e.tokenType||"bearer",user:e.user||a};return t(o),r(o.user),await l.default.setItem("session",JSON.stringify(o)),o},[a]),h=(0,o.useCallback)(async()=>{console.log("Signing out user"),t(null),r(null),await l.default.removeItem("session")},[]);return(0,o.useMemo)(()=>({session:e,user:a,isLoading:i,requestOtp:s,verifyOtp:c,requestRegistration:u,verifyRegistration:f,signInWithToken:g,signOut:h,isAuthenticated:!!e}),[e,a,i,s,c,u,f,h])})},3686(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>F});var o=a(6665),r=a(3929),l=a(530),n=a(5648),i=a(6773),d=a(1690),s=a(9632),c=a(5009),u=a(6283),f=a(9637),g=a(5894),h=a(7430),m=a(8136),y=a(4686),p=a(5427),x=a(5395),b=a(2994),j=a(4164),w=a(9281),C=a(6508),P=a(4494),k=a(1168),S=a(8032),I=a(8948),T=a(5082),v=a(8360),E=a(477),_=a(2964),B=(a(262),a(893)),O=a(6746),L=a(3353),A=a(9269),D=a(9582),z=a(8833),R=a(8776),W=a(397);const N=["Forest","Urban","Beach","Mountain","Rural","Park","Shaded","Sunny","Crowded","Quiet","Paved","Trail"],U=["Easy","Moderate","Hard"];function F(){const{id:e}=(0,f.useLocalSearchParams)(),{user:t}=(0,L.useAuth)(),{getTrailById:a,updateTrailName:F,updateTrailPhoto:M,updateTrailDetails:V,getTrailWithUser:G}=(0,O.useTrails)(),[$,H]=(0,o.useState)(void 0),[q,X]=(0,o.useState)(!0),[J,K]=(0,o.useState)(!1),[Y,Z]=(0,o.useState)(""),[Q,ee]=(0,o.useState)(!1),[te,ae]=(0,o.useState)(0),[oe,re]=(0,o.useState)(""),[le,ne]=(0,o.useState)([]),[ie,de]=(0,o.useState)(""),[se,ce]=(0,o.useState)(""),[ue,fe]=(0,o.useState)(!1),ge=(0,o.useRef)(null),he=(0,o.useRef)(new c.default.Value(0)).current,me=(0,z.useSafeAreaInsets)(),ye=({IconComponent:e,emoji:t,size:a=18,color:o})=>(0,W.jsx)(u.default,{style:{fontSize:a,color:o||void 0},children:t||"\u2022"}),[pe,xe]=(0,o.useState)(!1);(0,o.useEffect)(()=>{be()},[e]);const be=async()=>{if("string"===typeof e){X(!0);try{const t=a(e);if(t)H(t),Z(t.name||""),ae(t.rating||0),re(t.review||""),ne(t.environment_tags||[]),de(t.difficulty||""),ce(t.name||"");else{const t=await G(e);t&&(H(t),Z(t.name||""),ae(t.rating||0),re(t.review||""),ne(t.environment_tags||[]),de(t.difficulty||""),ce(t.name||""))}}catch(t){console.error("Error loading trail:",t)}finally{X(!1)}}else X(!1)},je=()=>{ge.current&&ge.current.click()};if(q)return(0,W.jsxs)(r.default,{style:R.default.loadingContainer,children:[(0,W.jsx)(l.default,{size:"large",color:D.default.backgroundPrimary}),(0,W.jsx)(u.default,{style:R.default.loadingText,children:"Loading trail..."})]});if(!$)return(0,W.jsxs)(r.default,{style:R.default.loadingContainer,children:[(0,W.jsx)(k.default,{size:64,color:"#9ca3af"}),(0,W.jsx)(u.default,{style:R.default.loadingText,children:"Trail not found"})]});const we=$.coordinates??[],Ce=we.length>0?{latitude:we[0].latitude,longitude:we[0].longitude,latitudeDelta:.01,longitudeDelta:.01}:void 0,Pe=$.user_id===t?.id;return(0,W.jsxs)(r.default,{style:[R.default.container,{paddingTop:me.top+70,paddingBottom:Math.max(16,me.bottom),paddingHorizontal:16+(me.left||0)}],children:[(0,W.jsx)("input",{ref:ge,type:"file",accept:"image/*",style:{display:"none"},onChange:async e=>{const t=e.target.files?.[0];if(t&&$)if(t.type.startsWith("image/")){fe(!0);try{const e=new FileReader;e.onload=async e=>{const t=e.target?.result;await M($.id,t),H(Object.assign({},$,{photo:t})),d.default.alert("Success","Photo uploaded successfully!"),fe(!1)},e.onerror=()=>{d.default.alert("Error","Failed to read image"),fe(!1)},e.readAsDataURL(t)}catch(a){console.error("Photo upload error:",a),d.default.alert("Error","Failed to upload photo"),fe(!1)}}else d.default.alert("Error","Please select an image file")}}),(0,W.jsxs)(r.default,{style:[R.default.headerButtons,{top:me.top+12}],children:[(0,W.jsx)(n.default,{style:R.default.headerButton,onPress:()=>{f.router.back()},children:(0,W.jsx)(x.default,{size:24})}),(0,W.jsxs)(r.default,{style:R.default.headerRightButtons,children:[(0,W.jsx)(n.default,{style:R.default.headerButton,onPress:()=>{d.default.alert("Share","Share functionality coming soon!")},children:(0,W.jsx)(I.default,{size:22})}),(0,W.jsx)(n.default,{style:R.default.headerButton,onPress:()=>{xe(!pe)},children:(0,W.jsx)(b.default,{size:22,fill:pe?D.default.textPrimary:"none"})}),(0,W.jsx)(n.default,{style:R.default.headerButton,onPress:()=>{d.default.alert("Options","Mark as completed option coming soon!")},children:(0,W.jsx)(m.default,{size:22})})]})]}),(0,W.jsxs)(c.default.ScrollView,{style:R.default.scrollContainer,contentContainerStyle:R.default.scrollContent,onScroll:c.default.event([{nativeEvent:{contentOffset:{y:he}}}],{useNativeDriver:!1}),scrollEventThrottle:16,children:[(0,W.jsx)(r.default,{style:R.default.heroSection,children:$.photo?(0,W.jsxs)(r.default,{style:R.default.heroImageContainer,children:[(0,W.jsx)(g.Image,{source:{uri:$.photo},style:R.default.heroImage,contentFit:"cover",cachePolicy:"memory-disk"}),(0,W.jsx)(B.LinearGradient,{colors:["rgba(0,0,0,0)","rgba(0,0,0,0.3)"],style:R.default.heroGradient}),Pe&&(0,W.jsx)(n.default,{style:R.default.changePhotoFab,onPress:je,disabled:ue,children:ue?(0,W.jsx)(l.default,{color:D.default.textPrimary,size:"small"}):(0,W.jsx)(w.default,{size:20,color:D.default.textPrimary})})]}):Pe&&(0,W.jsx)(n.default,{style:R.default.addPhotoContainer,onPress:je,disabled:ue,children:ue?(0,W.jsx)(l.default,{size:"large",color:D.default.backgroundPrimary}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(r.default,{style:R.default.addPhotoIcon,children:(0,W.jsx)(w.default,{size:32,color:D.default.backgroundPrimary})}),(0,W.jsx)(u.default,{style:R.default.addPhotoText,children:"Add a photo"}),(0,W.jsx)(u.default,{style:R.default.addPhotoSubtext,children:"Make your trail memorable"})]})})}),(0,W.jsx)(r.default,{style:R.default.contentWrapper,children:(0,W.jsxs)(r.default,{style:R.default.content,children:[(0,W.jsxs)(r.default,{style:R.default.titleSection,children:[Pe&&J?(0,W.jsxs)(r.default,{style:R.default.nameEditContainer,children:[(0,W.jsx)(i.default,{style:R.default.nameInput,value:Y,onChangeText:Z,placeholder:"Enter trail name",autoFocus:!0,placeholderTextColor:"#9ca3af"}),(0,W.jsxs)(r.default,{style:R.default.editButtons,children:[(0,W.jsx)(n.default,{style:[R.default.iconButton,R.default.saveIconButton],onPress:async()=>{if($&&Y.trim())try{await F($.id,Y.trim()),H(Object.assign({},$,{name:Y.trim()})),K(!1)}catch{d.default.alert("Error","Failed to update trail name. Please try again.")}else K(!1)},children:(0,W.jsx)(C.default,{size:18,color:"#fff"})}),(0,W.jsx)(n.default,{style:[R.default.iconButton,R.default.cancelIconButton],onPress:()=>{Z($?.name||""),K(!1)},children:(0,W.jsx)(_.default,{size:18,color:D.default.textPrimary})})]})]}):(0,W.jsx)(r.default,{style:R.default.titleRow,children:(0,W.jsx)(u.default,{style:R.default.title,children:$.name||`Trail ${new Date($.createdAt??$.date).toLocaleDateString()}`})}),$.city&&(0,W.jsxs)(r.default,{style:R.default.locationRow,children:[(0,W.jsx)(k.default,{size:16,color:D.default.textPrimary}),(0,W.jsxs)(u.default,{style:R.default.location,children:[$.city,", ",$.country||"Unknown"]})]}),$.rating&&!Q&&(0,W.jsx)(r.default,{style:R.default.ratingRow,children:[1,2,3,4,5].map(e=>(0,W.jsx)(T.default,{size:18,color:e<=$.rating?"#f59e0b":"#d1d5db",fill:e<=$.rating?"#f59e0b":"none"},e))})]}),$.review&&!Q&&(0,W.jsx)(r.default,{style:R.default.reviewCard,children:(0,W.jsx)(u.default,{style:R.default.reviewText,children:$.review})}),(0,W.jsxs)(r.default,{style:R.default.statsSection,children:[(0,W.jsxs)(r.default,{style:R.default.statCard,children:[(0,W.jsx)(r.default,{style:R.default.statIconContainer,children:(0,W.jsx)(k.default,{size:20,color:D.default.textPrimary,strokeWidth:2.5})}),(0,W.jsx)(u.default,{style:R.default.statLabel,children:"Distance"}),(0,W.jsx)(u.default,{style:R.default.statValue,children:(0,A.formatDistance)($.distance)})]}),(0,W.jsxs)(r.default,{style:R.default.statCard,children:[(0,W.jsx)(r.default,{style:R.default.statIconContainer,children:(0,W.jsx)(P.default,{size:20,color:D.default.textPrimary,strokeWidth:2.5})}),(0,W.jsx)(u.default,{style:R.default.statLabel,children:"Duration"}),(0,W.jsx)(u.default,{style:R.default.statValue,children:(0,A.formatDuration)($.duration)})]}),$.difficulty&&(0,W.jsxs)(r.default,{style:R.default.statCard,children:[(0,W.jsx)(r.default,{style:R.default.statIconContainer,children:(0,W.jsx)(ye,{IconComponent:E.default,emoji:"\u26f0\ufe0f",size:20,color:D.default.textPrimary})}),(0,W.jsx)(u.default,{style:R.default.statLabel,children:"Difficulty"}),(0,W.jsx)(u.default,{style:R.default.statValue,children:$.difficulty})]})]}),$.environment_tags&&$.environment_tags.length>0&&!Q&&(0,W.jsxs)(r.default,{style:R.default.tagsSection,children:[(0,W.jsxs)(r.default,{style:R.default.sectionHeader,children:[(0,W.jsx)(ye,{IconComponent:v.default,emoji:"\ud83c\udff7\ufe0f",size:18,color:D.default.textPrimary}),(0,W.jsx)(u.default,{style:R.default.sectionTitle,children:"Environment"})]}),(0,W.jsx)(r.default,{style:R.default.tagsGrid,children:$.environment_tags.map((e,t)=>(0,W.jsx)(r.default,{style:R.default.tagChip,children:(0,W.jsx)(u.default,{style:R.default.tagText,children:e})},t))})]}),Pe&&!Q&&(0,W.jsxs)(n.default,{style:R.default.editDetailsButton,onPress:()=>{ee(!0)},children:[(0,W.jsx)(y.default,{size:18,color:D.default.backgroundPrimary}),(0,W.jsx)(u.default,{style:R.default.editDetailsText,children:"Edit Trail Details"})]}),Pe&&Q&&(0,W.jsxs)(r.default,{style:R.default.editSection,children:[(0,W.jsx)(u.default,{style:R.default.editSectionTitle,children:"Trail Name"}),(0,W.jsx)(i.default,{style:R.default.nameInputInDetails,value:se,onChangeText:ce,placeholder:"Enter trail name",placeholderTextColor:"#9ca3af"}),(0,W.jsx)(u.default,{style:[R.default.editSectionTitle,{marginTop:24}],children:"Rating"}),(0,W.jsx)(r.default,{style:R.default.ratingStars,children:[1,2,3,4,5].map(e=>(0,W.jsx)(n.default,{onPress:()=>{ae(e)},style:R.default.starButton,children:(0,W.jsx)(T.default,{size:32,color:e<=te?"#f59e0b":"#d1d5db",fill:e<=te?"#f59e0b":"none"})},e))}),(0,W.jsx)(u.default,{style:[R.default.editSectionTitle,{marginTop:24}],children:"Review"}),(0,W.jsx)(i.default,{style:R.default.reviewInput,value:oe,onChangeText:re,placeholder:"Share your experience on this trail...",placeholderTextColor:"#9ca3af",multiline:!0,numberOfLines:4,textAlignVertical:"top"}),(0,W.jsx)(u.default,{style:[R.default.editSectionTitle,{marginTop:24}],children:"Difficulty"}),(0,W.jsx)(r.default,{style:R.default.difficultyOptions,children:U.map(e=>(0,W.jsx)(n.default,{style:[R.default.difficultyChip,ie===e&&R.default.difficultyChipSelected],onPress:()=>{de(e)},children:(0,W.jsx)(u.default,{style:[R.default.difficultyChipText,ie===e&&R.default.difficultyChipTextSelected],children:e})},e))}),(0,W.jsx)(u.default,{style:[R.default.editSectionTitle,{marginTop:24}],children:"Environment Tags"}),(0,W.jsx)(r.default,{style:R.default.tagsGrid,children:N.map(e=>(0,W.jsx)(n.default,{style:[R.default.editTagChip,le.includes(e)&&R.default.editTagChipSelected],onPress:()=>(e=>{ne(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e),children:(0,W.jsx)(u.default,{style:[R.default.editTagChipText,le.includes(e)&&R.default.editTagChipTextSelected],children:e})},e))}),(0,W.jsxs)(r.default,{style:R.default.editActionButtons,children:[(0,W.jsxs)(n.default,{style:[R.default.actionButton,R.default.cancelActionButton],onPress:()=>{ae($?.rating||0),re($?.review||""),ne($?.environment_tags||[]),de($?.difficulty||""),ce($?.name||""),ee(!1)},children:[(0,W.jsx)(_.default,{size:20,color:D.default.textPrimary}),(0,W.jsx)(u.default,{style:R.default.cancelActionText,children:"Cancel"})]}),(0,W.jsxs)(n.default,{style:[R.default.actionButton,R.default.saveActionButton],onPress:async()=>{if($)try{se.trim()!==$.name&&await F($.id,se.trim()),await V($.id,{rating:te>0?te:void 0,review:oe.trim()||void 0,environment_tags:le.length>0?le:void 0,difficulty:ie||void 0}),H(Object.assign({},$,{name:se.trim(),rating:te>0?te:void 0,review:oe.trim()||void 0,environment_tags:le.length>0?le:void 0,difficulty:ie||void 0})),Z(se.trim()),ee(!1),d.default.alert("Success","Trail details updated!")}catch{d.default.alert("Error","Failed to update trail details. Please try again.")}},children:[(0,W.jsx)(C.default,{size:20,color:"#fff"}),(0,W.jsx)(u.default,{style:R.default.saveActionText,children:"Save"})]})]})]}),(0,W.jsxs)(r.default,{style:R.default.mapSection,children:[(0,W.jsxs)(r.default,{style:R.default.sectionHeader,children:[(0,W.jsx)(ye,{IconComponent:S.default,emoji:"\ud83e\udded",size:18,color:D.default.textPrimary}),(0,W.jsx)(u.default,{style:R.default.sectionTitle,children:"Route Map"})]}),(0,W.jsx)(r.default,{style:R.default.mapContainer,children:(0,W.jsx)(h.default,{coordinates:we,style:R.default.map,initialRegion:Ce||void 0,scrollEnabled:!1,zoomEnabled:!1})}),(0,W.jsxs)(n.default,{style:R.default.directionsButton,onPress:()=>{if(!$||0===($.coordinates?.length??0))return void d.default.alert("Error","Location not available for this trail");const e=$.coordinates[0].latitude,t=$.coordinates[0].longitude,a=($.name,`https://www.google.com/maps/search/?api=1&query=${e},${t}`);s.default.canOpenURL(a).then(e=>{e?s.default.openURL(a):d.default.alert("Error","Unable to open maps application")})},children:[(0,W.jsx)(ye,{IconComponent:S.default,emoji:"\ud83e\udded",size:18,color:"#fff"}),(0,W.jsx)(u.default,{style:R.default.directionsButtonText,children:"Get Directions"})]})]}),(0,W.jsxs)(r.default,{children:[(0,W.jsx)(u.default,{style:R.default.detailsTitle,children:"Additional Details"}),void 0!==$.maxElevation&&(0,W.jsxs)(r.default,{style:R.default.detailRow,children:[(0,W.jsx)(r.default,{style:R.default.detailIcon,children:(0,W.jsx)(ye,{IconComponent:E.default,emoji:"\u26f0\ufe0f",size:18,color:D.default.backgroundPrimary})}),(0,W.jsxs)(r.default,{style:R.default.detailContent,children:[(0,W.jsx)(u.default,{style:R.default.detailLabel,children:"Elevation Gain"}),(0,W.jsxs)(u.default,{style:R.default.detailValue,children:[$.maxElevation,"m"]})]})]}),$.pace&&(0,W.jsxs)(r.default,{style:R.default.detailRow,children:[(0,W.jsx)(r.default,{style:R.default.detailIcon,children:(0,W.jsx)(ye,{IconComponent:p.default,emoji:"\ud83c\udfc3",size:18,color:D.default.backgroundPrimary})}),(0,W.jsxs)(r.default,{style:R.default.detailContent,children:[(0,W.jsx)(u.default,{style:R.default.detailLabel,children:"Pace"}),(0,W.jsxs)(u.default,{style:R.default.detailValue,children:[$.pace," /km"]})]})]}),$.speed&&(0,W.jsxs)(r.default,{style:R.default.detailRow,children:[(0,W.jsx)(r.default,{style:R.default.detailIcon,children:(0,W.jsx)(ye,{IconComponent:p.default,emoji:"\u26a1",size:18,color:D.default.backgroundPrimary})}),(0,W.jsxs)(r.default,{style:R.default.detailContent,children:[(0,W.jsx)(u.default,{style:R.default.detailLabel,children:"Max Speed"}),(0,W.jsxs)(u.default,{style:R.default.detailValue,children:[$.speed.toFixed(1)," km/h"]})]})]}),(0,W.jsxs)(r.default,{style:R.default.detailRow,children:[(0,W.jsx)(r.default,{style:R.default.detailIcon,children:(0,W.jsx)(ye,{IconComponent:j.default,emoji:"\ud83d\udcc5",size:18,color:D.default.backgroundPrimary})}),(0,W.jsxs)(r.default,{style:R.default.detailContent,children:[(0,W.jsx)(u.default,{style:R.default.detailLabel,children:"Date & Time"}),(0,W.jsx)(u.default,{style:R.default.detailValue,children:new Date($.createdAt??$.date).toLocaleString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})})]})]})]})]})})]})]})}},3764(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>w});var o=a(6665),r=a(6283),l=a(3929),n=a(6773),i=a(5648),d=a(4767),s=a(1690),c=a(530),u=a(9637),f=a(3353),g=a(5938),h=a(630),m=a(7705),y=a(8787),p=a(6770),x=a(2035),b=a(5632),j=a(397);function w(){const e=(0,u.useRouter)(),{signInWithToken:t}=(0,f.useAuth)(),[a,y]=(0,o.useState)(""),[w,C]=(0,o.useState)(""),[P,k]=(0,o.useState)(""),[S,I]=(0,o.useState)(!1),T=x.default.expoConfig&&x.default.expoConfig.extra||{},[v,E,_]=p.useAuthRequest({webClientId:"447944956309-t92ug0tqs40adop6mnvifqbmfsi7dtj6.apps.googleusercontent.com",iosClientId:{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.4",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"54.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID||T.EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID,androidClientId:{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.4",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"54.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_GOOGLE_ANDROID_CLIENT_ID||T.EXPO_PUBLIC_GOOGLE_ANDROID_CLIENT_ID,clientId:{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.4",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"54.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_GOOGLE_CLIENT_ID||T.EXPO_PUBLIC_GOOGLE_CLIENT_ID,scopes:["profile","email"],responseType:"token"});o.useEffect(()=>{(async()=>{if("success"===E?.type)try{I(!0);const a=function(e){if(!e)return null;if("string"===typeof e)return e;try{if(e instanceof ArrayBuffer){const t=new Uint8Array(e);let a="";for(let e=0;e<t.length;e++)a+=String.fromCharCode(t[e]);return decodeURIComponent(escape(a))}if(e&&"object"===typeof e&&Array.isArray(e.data)){const t=e.data;let a="";for(let e=0;e<t.length;e++)a+=String.fromCharCode(t[e]);return decodeURIComponent(escape(a))}return String(e)}catch(t){return String(e)}}(E.authentication?.accessToken||E.authentication?.idToken);if(!a)throw new Error("No access token from Google");const o=await(0,m.signInWithGoogle)((0,m.getFirebaseAuth)(),a),r=await(0,g.firebaseAuthExchange)(o.idToken);await t(r),e.replace("/")}catch(a){console.error("Google sign-up error",a),s.default.alert("Google Sign-Up Error",a?.message||String(a))}finally{I(!1)}})()},[E]);return(0,j.jsx)(d.default,{style:b.default.container,behavior:"height",children:(0,j.jsxs)(l.default,{style:b.default.content,children:[(0,j.jsxs)(l.default,{style:b.default.header,children:[(0,j.jsx)(h.default,{size:64,color:"#5d6b4a"}),(0,j.jsx)(r.default,{style:b.default.title,children:"Create Account"}),(0,j.jsx)(r.default,{style:b.default.subtitle,children:"Sign up to start tracking your dog walks"})]}),(0,j.jsxs)(l.default,{style:b.default.form,children:[(0,j.jsxs)(l.default,{style:b.default.inputContainer,children:[(0,j.jsx)(r.default,{style:b.default.label,children:"Name"}),(0,j.jsx)(n.default,{style:b.default.input,placeholder:"Your Name",value:w,onChangeText:C,autoCapitalize:"words",editable:!S})]}),(0,j.jsxs)(l.default,{style:b.default.inputContainer,children:[(0,j.jsx)(r.default,{style:b.default.label,children:"Email"}),(0,j.jsx)(n.default,{style:b.default.input,placeholder:"your@email.com",value:a,onChangeText:y,autoCapitalize:"none",keyboardType:"email-address",autoComplete:"email",editable:!S})]}),(0,j.jsxs)(l.default,{style:b.default.inputContainer,children:[(0,j.jsx)(r.default,{style:b.default.label,children:"Password"}),(0,j.jsx)(n.default,{style:b.default.input,placeholder:"Create a password",value:P,onChangeText:k,secureTextEntry:!0,autoCapitalize:"none",autoComplete:"password",editable:!S})]}),(0,j.jsx)(i.default,{style:[b.default.button,S&&b.default.buttonDisabled],onPress:async()=>{if(a&&w&&P){0,I(!0);try{const o=await(0,m.createUserWithEmailAndPassword)((0,m.getFirebaseAuth)(),a.trim().toLowerCase(),P);w.trim()&&await(0,m.updateProfile)(o.user,{displayName:w.trim()});const r=await o.user.getIdToken(!0),l=await(0,g.firebaseAuthExchange)(r);await t(l),e.replace("/")}catch(o){0,console.error("Firebase sign-up error:",o),s.default.alert("Error",o.message||"Failed to create account")}finally{I(!1)}}else s.default.alert("Error","Please fill in all fields")},disabled:S,children:S?(0,j.jsx)(c.default,{color:"#fff"}):(0,j.jsx)(r.default,{style:b.default.buttonText,children:"Create Account"})}),(0,j.jsxs)(l.default,{style:b.default.footer,children:[(0,j.jsx)(r.default,{style:b.default.footerText,children:"Already have an account? "}),(0,j.jsx)(i.default,{onPress:()=>{e.push("/login")},children:(0,j.jsx)(r.default,{style:b.default.linkText,children:"Sign In"})})]})]})]})})}y.maybeCompleteAuthSession()},4101(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>C});var o=a(6665),r=a(6283),l=a(3929),n=a(6773),i=a(5708),d=a(5648),s=a(4767),c=a(1690),u=a(530),f=a(9637),g=a(3353),h=a(5938),m=a(8787),y=a(6770),p=a(2035),x=a(5894),b=a(7705),j=a(5632),w=a(397);function C(){const e=(0,f.useRouter)(),{signInWithToken:t}=(0,g.useAuth)(),[a,m]=o.useState(""),[C,P]=o.useState(""),[k,S]=o.useState(!1),I=p.default.expoConfig&&p.default.expoConfig.extra||p.default.manifest&&p.default.manifest.extra||{},T={EXPO_PUBLIC_GOOGLE_EXPO_CLIENT_ID:I.EXPO_PUBLIC_GOOGLE_EXPO_CLIENT_ID??{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.4",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"54.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_GOOGLE_EXPO_CLIENT_ID,EXPO_PUBLIC_GOOGLE_CLIENT_ID:I.EXPO_PUBLIC_GOOGLE_CLIENT_ID??{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.4",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"54.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_GOOGLE_CLIENT_ID,EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:I.EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID??{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.4",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"54.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID,EXPO_PUBLIC_GOOGLE_ANDROID_CLIENT_ID:I.EXPO_PUBLIC_GOOGLE_ANDROID_CLIENT_ID??{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.4",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"54.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_GOOGLE_ANDROID_CLIENT_ID};"undefined"===typeof window||T.EXPO_PUBLIC_GOOGLE_EXPO_CLIENT_ID||console.warn("Google web client id (EXPO_PUBLIC_GOOGLE_EXPO_CLIENT_ID) is not defined. Google auth on web requires a webClientId.");const[v,E,_]=y.useAuthRequest({webClientId:"447944956309-t92ug0tqs40adop6mnvifqbmfsi7dtj6.apps.googleusercontent.com",iosClientId:{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.4",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"54.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID||T.EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID,androidClientId:{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.4",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"54.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_GOOGLE_ANDROID_CLIENT_ID||T.EXPO_PUBLIC_GOOGLE_ANDROID_CLIENT_ID,clientId:{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.4",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"54.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_GOOGLE_CLIENT_ID||T.EXPO_PUBLIC_GOOGLE_CLIENT_ID,scopes:["profile","email"],responseType:"token"});o.useEffect(()=>{(async()=>{if("success"===E?.type)try{S(!0);const a=function(e){if(!e)return null;if("string"===typeof e)return e;try{if(e instanceof ArrayBuffer){const t=new Uint8Array(e);let a="";for(let e=0;e<t.length;e++)a+=String.fromCharCode(t[e]);return decodeURIComponent(escape(a))}if(e&&"object"===typeof e&&Array.isArray(e.data)){const t=e.data;let a="";for(let e=0;e<t.length;e++)a+=String.fromCharCode(t[e]);return decodeURIComponent(escape(a))}return String(e)}catch(t){return String(e)}}(E.authentication?.accessToken||E.authentication?.idToken);if(!a)throw new Error("No access token from Google");const o=await(0,b.signInWithGoogle)((0,b.getFirebaseAuth)(),a),r=await(0,h.firebaseAuthExchange)(o.idToken);await t(r),e.replace("/")}catch(a){console.error("Google sign-in error",a),c.default.alert("Google Sign-In Error",a?.message||String(a))}finally{S(!1)}})()},[E]);const B=async()=>{if(console.log("handleSignIn invoked",{email:a,password:C}),a&&C){0,S(!0);try{const o=await(0,b.signInWithEmailAndPassword)((0,b.getFirebaseAuth)(),a.trim().toLowerCase(),C),r=await o.user.getIdToken(),l=await(0,h.firebaseAuthExchange)(r);await t(l),e.replace("/")}catch(o){0,console.error("Firebase sign-in error:",o),c.default.alert("Error",o.message||"Failed to sign in")}finally{S(!1)}}else c.default.alert("Error","Please enter your email and password")};return(0,w.jsx)(s.default,{style:j.default.container,behavior:"height",children:(0,w.jsxs)(l.default,{style:j.default.content,children:[(0,w.jsxs)(l.default,{style:j.default.header,children:[(0,w.jsx)(x.Image,{source:{uri:"https://api.tailtrails.club/assets/logo"},style:j.default.logo,contentFit:"contain"}),(0,w.jsx)(r.default,{style:j.default.title,children:"Welcome Back"}),(0,w.jsx)(r.default,{style:j.default.subtitle,children:"Sign in to track your dog walks"})]}),(0,w.jsxs)(l.default,{style:j.default.form,children:[(0,w.jsxs)(l.default,{style:j.default.inputContainer,children:[(0,w.jsx)(r.default,{style:j.default.label,children:"Email"}),(0,w.jsx)(n.default,{style:j.default.input,placeholder:"your@email.com",value:a,onChangeText:m,autoCapitalize:"none",keyboardType:"email-address",autoComplete:"email",editable:!k})]}),(0,w.jsxs)(l.default,{style:j.default.inputContainer,children:[(0,w.jsx)(r.default,{style:j.default.label,children:"Password"}),(0,w.jsx)(n.default,{style:j.default.input,placeholder:"Enter your password",value:C,onChangeText:P,secureTextEntry:!0,autoCapitalize:"none",autoComplete:"password",editable:!k})]}),(0,w.jsx)(i.default,{style:({pressed:e})=>[j.default.button,k&&j.default.buttonDisabled,e&&j.default.buttonPressed],onPress:B,onKeyDown:e=>{"Enter"===(e?.nativeEvent?.key||e?.key)&&B()},accessibilityRole:"button",disabled:k,children:k?(0,w.jsx)(u.default,{color:"#fff"}):(0,w.jsx)(r.default,{style:j.default.buttonText,children:"Sign In"})}),(0,w.jsxs)(l.default,{style:j.default.footer,children:[(0,w.jsx)(r.default,{style:j.default.footerText,children:"Don't have an account? "}),(0,w.jsx)(d.default,{onPress:()=>{e.push("/signup")},children:(0,w.jsx)(r.default,{style:j.default.linkText,children:"Sign Up"})})]})]})]})})}m.maybeCompleteAuthSession()},4171(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>l});var o=a(3668),r=a(9582);const l=o.default.create({container:{flex:1,backgroundColor:r.default.backgroundPrimary},header:{height:64,paddingHorizontal:16,flexDirection:"row",alignItems:"center",justifyContent:"space-between",borderBottomWidth:0},backButton:{width:40,height:40,borderRadius:20,justifyContent:"center",alignItems:"center"},title:{fontSize:20,fontWeight:"700",color:r.default.accentPrimary},content:{padding:16,gap:16},sectionCard:{backgroundColor:r.default.backgroundSecondary,borderRadius:16,padding:18,shadowColor:r.default.borderSubtle,shadowOffset:{width:0,height:6},shadowOpacity:.06,shadowRadius:12,elevation:3},sectionTitle:{fontSize:18,fontWeight:"700",color:r.default.accentPrimary,marginBottom:12},row:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingVertical:12,borderBottomWidth:1,borderBottomColor:"rgba(255,255,255,0.02)"},rowText:{fontSize:15,color:r.default.accentPrimary},logoutCard:{backgroundColor:r.default.backgroundSecondary,borderRadius:12,padding:16,marginTop:8,flexDirection:"row",alignItems:"center",justifyContent:"space-between"},logoutText:{fontSize:15,color:r.default.accentPrimary}})},4395(e){e.exports={},e.exports.default=e.exports},4492(e,t,a){"use strict";a.r(t),a.d(t,{customAlphabet:()=>o,nanoid:()=>r});const o=(e,t=21)=>(a=t)=>{let o="",r=0|a;for(;r--;)o+=e[Math.random()*e.length|0];return o},r=(e=21)=>{let t="",a=0|e;for(;a--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[64*Math.random()|0];return t}},4509(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>A});var o=a(6665),r=a(9637),l=a(6283),n=a(3929),i=a(2772),d=a(5648),s=a(530),c=a(5009),u=a(6773),f=a(8264),g=a(932),h=a(5894),m=a(893),y=a(8833),p=a(3087),x=a(2994),b=a(1449),j=a(3048),w=a(1168),C=a(8032),P=a(1858),k=a(5082),S=a(4550),I=a(2964),T=a(9582),v=a(6746),E=a(9269),_=a(9600),B=a(2699),O=a(397);const L=[{id:"nearby",name:"Nearby",icon:w.default},{id:"popular",name:"Popular",icon:j.default},{id:"beaches",name:"Beaches",icon:S.default}];function A(){const e=(0,r.useRouter)(),t=(0,y.useSafeAreaInsets)(),{loadNearbyTrails:a,saveTrailBookmark:j,removeTrailBookmark:S,isTrailSaved:A}=(0,v.useTrails)(),[D,z]=(0,o.useState)("nearby"),[R,W]=(0,o.useState)([]),[N,U]=(0,o.useState)(!0),[,F]=(0,o.useState)(void 0),[M,V]=(0,o.useState)({}),[G,$]=(0,o.useState)(""),[H,q]=(0,o.useState)(!1),[X,J]=(0,o.useState)(""),[K,Y]=(0,o.useState)([]),Z=(0,o.useCallback)(async()=>{{J("Current location");try{if(navigator&&navigator.geolocation)return void navigator.geolocation.getCurrentPosition(async e=>{try{const t=await a(e.coords.latitude,e.coords.longitude);W(t)}catch(t){console.error("Failed to load nearby trails with browser location:",t);const e=await a();W(e)}finally{U(!1)}},async()=>{const e=await a();W(e),U(!1)})}catch(e){console.error("Geolocation not available on web:",e)}const t=await a();return W(t),void U(!1)}},[a]);(0,o.useEffect)(()=>{Z()},[Z]),(0,r.useFocusEffect)((0,o.useCallback)(()=>{console.log("Explore tab focused - refreshing nearby trails"),Z()},[Z]));const Q=(0,o.useCallback)(()=>{const e=G.toLowerCase(),t=R.filter(t=>{const a=t.name?.toLowerCase()||"",o=t.city?.toLowerCase()||"",r=t.country?.toLowerCase()||"";return a.includes(e)||o.includes(e)||r.includes(e)}).map(e=>({id:e.id,name:e.name||`Trail ${new Date(e.date).toLocaleDateString()}`,location:e.city?`${e.city}, ${e.country||"Unknown"}`:"Location unknown",type:"trail"})).slice(0,6);Y(t)},[G,R]);(0,o.useEffect)(()=>{G.trim()?Q():Y([])},[G,Q]);const ee=()=>{q(!1),$(""),Y([])},te=e=>{if(!M[e]){const t=new c.default.Value(1);return V(a=>Object.assign({},a,{[e]:t})),t}return M[e]},ae=(0,o.useCallback)(e=>{let t=e;return"popular"===D?t=[...t].sort((e,t)=>(t.rating||0)-(e.rating||0)):"beaches"===D&&(t=t.filter(e=>(e.environment_tags||[]).some(e=>e.toLowerCase().includes("beach")))),t},[D])(R);return(0,O.jsxs)(n.default,{style:B.default.safeContainer,children:[(0,O.jsxs)(i.default,{style:B.default.container,showsVerticalScrollIndicator:!1,stickyHeaderIndices:[0],children:[(0,O.jsxs)(n.default,{style:[B.default.stickyHeader,{paddingTop:t.top+16}],children:[(0,O.jsxs)(n.default,{style:B.default.stickySearchContainer,children:[(0,O.jsxs)(d.default,{style:B.default.searchBar,onPress:()=>{q(!0)},activeOpacity:.7,children:[(0,O.jsx)(P.default,{size:20,color:T.default.textMuted}),(0,O.jsx)(l.default,{style:B.default.searchPlaceholder,children:"Find trails"})]}),(0,O.jsx)(d.default,{style:B.default.demoButton,onPress:()=>e.push("/trail/demo-trail"),children:(0,O.jsx)(l.default,{style:B.default.demoButtonText,children:"Demo"})})]}),(0,O.jsx)(n.default,{style:B.default.categoriesSection,children:(0,O.jsx)(i.default,{horizontal:!0,showsHorizontalScrollIndicator:!1,contentContainerStyle:B.default.categoriesScroll,children:L.map(e=>{const t=e.icon,a=D===e.id;return(0,O.jsxs)(d.default,{style:[B.default.categoryButton,a&&B.default.categoryButtonActive],onPress:()=>{return t=e.id,void z(t);var t},children:[(0,O.jsx)(t,{size:20,color:a?T.default.accentPrimary:T.default.textMuted,strokeWidth:2}),(0,O.jsx)(l.default,{style:[B.default.categoryText,a&&B.default.categoryTextActive],children:e.name})]},e.id)})})})]}),(0,O.jsx)(n.default,{style:B.default.categoryTrailsSection,children:N?(0,O.jsxs)(n.default,{style:B.default.loadingContainer,children:[(0,O.jsx)(s.default,{size:"large",color:T.default.textMuted}),(0,O.jsx)(l.default,{style:B.default.loadingText,children:"Loading trails..."})]}):ae.length>0?ae.map(t=>{const a=te(t.id),o=A(t.id);return(0,O.jsxs)(d.default,{style:B.default.largeTrailCard,onPress:()=>{return a=t.id,void e.push(`/trail/${a}`);var a},children:[t.photo?(0,O.jsx)(h.Image,{source:{uri:t.photo},style:B.default.largeTrailImage,contentFit:"cover",cachePolicy:"memory-disk"}):(0,O.jsx)(_.default,{coordinates:t.coordinates,path:t.path,style:B.default.largeTrailImage,startLatitude:t.startLatitude,startLongitude:t.startLongitude}),(0,O.jsx)(m.LinearGradient,{colors:["rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0.25)","rgba(0, 0, 0, 0.6)"],locations:[0,.3,.6,1],style:B.default.cardGradient}),(0,O.jsx)(d.default,{style:B.default.bookmarkButton,onPress:e=>{e.stopPropagation(),(async(e,t=!1)=>{if(!t&&!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))return void console.log("Cannot bookmark mock trail:",e);const a=te(e),o=A(e);c.default.sequence([c.default.timing(a,{toValue:.6,duration:100,useNativeDriver:!0}),c.default.spring(a,{toValue:1,friction:3,tension:100,useNativeDriver:!0})]).start();try{o?await S(e):await j(e)}catch(r){console.error("Failed to toggle bookmark:",r)}})(t.id,!0)},children:(0,O.jsx)(c.default.View,{style:{transform:[{scale:a}]},children:(0,O.jsx)(x.default,{size:20,color:o?"#000":T.default.textMuted,fill:o?"#000":"none",strokeWidth:2})})}),(0,O.jsxs)(n.default,{style:B.default.cardOverlayContent,children:[(0,O.jsx)(l.default,{style:B.default.overlayTrailName,children:t.name||`Trail ${new Date(t.date).toLocaleDateString()}`}),(0,O.jsxs)(n.default,{style:B.default.overlayBadges,children:[t.difficulty&&(0,O.jsxs)(n.default,{style:B.default.badge,children:[(0,O.jsx)(p.default,{size:14,color:T.default.accentPrimary,strokeWidth:2.5}),(0,O.jsx)(l.default,{style:B.default.badgeText,children:t.difficulty})]}),(0,O.jsxs)(n.default,{style:B.default.badge,children:[(0,O.jsx)(w.default,{size:14,color:T.default.accentPrimary,strokeWidth:2.5}),(0,O.jsx)(l.default,{style:B.default.badgeText,children:(0,E.formatDistance)(t.distance)})]}),"number"===typeof t.distance_from_user&&(0,O.jsxs)(n.default,{style:B.default.badge,children:[(0,O.jsx)(w.default,{size:14,color:T.default.accentPrimary,strokeWidth:2.5}),(0,O.jsx)(l.default,{style:B.default.badgeText,children:(0,E.formatDistance)(t.distance_from_user)})]}),t.rating&&(0,O.jsxs)(n.default,{style:B.default.badge,children:[(0,O.jsx)(k.default,{size:14,color:T.default.accentPrimary,fill:T.default.accentPrimary,strokeWidth:2}),(0,O.jsx)(l.default,{style:B.default.badgeText,children:t.rating.toFixed(1)})]})]})]})]},t.id)}):(0,O.jsxs)(n.default,{style:B.default.emptyContainer,children:[(0,O.jsx)(w.default,{size:48,color:"#9ca3af"}),(0,O.jsx)(l.default,{style:B.default.emptyText,children:"No trails found yet. Record a trail to share with others!"})]})}),(0,O.jsx)(n.default,{style:B.default.bottomPadding})]}),(0,O.jsx)(f.default,{visible:H,animationType:"slide",presentationStyle:"fullScreen",onRequestClose:ee,children:(0,O.jsxs)(n.default,{style:[B.default.searchModalContainer,{paddingTop:t.top}],children:[(0,O.jsxs)(n.default,{style:B.default.searchModalHeader,children:[(0,O.jsx)(d.default,{style:B.default.backButton,onPress:ee,children:(0,O.jsx)(b.default,{size:24,color:"#5d6b4a"})}),(0,O.jsxs)(n.default,{style:B.default.searchModalInputContainer,children:[(0,O.jsx)(u.default,{style:B.default.searchModalInput,placeholder:"Find trails",placeholderTextColor:"#9ca3af",value:G,onChangeText:$,autoFocus:!0,returnKeyType:"search"}),G.length>0&&(0,O.jsx)(d.default,{style:B.default.clearButton,onPress:()=>$(""),children:(0,O.jsx)(I.default,{size:20,color:"#64748b"})})]})]}),(0,O.jsxs)(n.default,{style:B.default.searchModalContent,children:[""===G.trim()&&(0,O.jsxs)(d.default,{style:B.default.currentLocationItem,onPress:()=>{q(!1),$(""),Y([])},children:[(0,O.jsx)(n.default,{style:B.default.locationIconContainer,children:(0,O.jsx)(C.default,{size:20,color:"#5d6b4a"})}),(0,O.jsxs)(n.default,{style:B.default.locationTextContainer,children:[(0,O.jsx)(l.default,{style:B.default.locationTitle,children:"Current location"}),(0,O.jsx)(l.default,{style:B.default.locationSubtitle,children:X})]})]}),K.length>0&&(0,O.jsx)(g.default,{data:K,keyExtractor:e=>e.id,renderItem:({item:t})=>(0,O.jsxs)(d.default,{style:B.default.suggestionItem,onPress:()=>{return a=t.id,q(!1),$(""),Y([]),void e.push(`/trail/${a}`);var a},children:[(0,O.jsx)(n.default,{style:B.default.suggestionIconContainer,children:(0,O.jsx)(w.default,{size:20,color:"#64748b"})}),(0,O.jsxs)(n.default,{style:B.default.suggestionTextContainer,children:[(0,O.jsx)(l.default,{style:B.default.suggestionTitle,children:t.name}),(0,O.jsx)(l.default,{style:B.default.suggestionSubtitle,children:t.location})]})]}),showsVerticalScrollIndicator:!1})]})]})})]})}},4674(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>k});var o=a(6665),r=a(6283),l=a(3929),n=a(5648),i=a(6773),d=a(484),s=a(1690),c=a(2772),u=a(530),f=a(9637),g=a(9908),h=a(262),m=a(9281),y=a(5624),p=a(4043),x=a(2964),b=a(9582),j=a(8833),w=a(7924),C=a(594),P=a(397);function k(){const e=(0,f.useRouter)(),t=(0,j.useSafeAreaInsets)(),{dogProfile:a}=(0,g.useDogs)(),[k,S]=(0,o.useState)(""),[I,T]=(0,o.useState)(""),[v,E]=(0,o.useState)(""),[_,B]=(0,o.useState)(null),[O,L]=(0,o.useState)(null),[A,D]=(0,o.useState)(!1),[z,R]=(0,o.useState)(!1);(0,o.useEffect)(()=>{a&&(console.log("Loading existing dog profile for editing:",a),S(a.name),T(a.nickname||""),E(a.age.toString()),B(a.size),L(a.image||null))},[a]);const W=async()=>{const{status:e}=await h.requestMediaLibraryPermissionsAsync();if("granted"!==e)return void s.default.alert("Permission needed","We need access to your photo library");R(!0);const t=await h.launchImageLibraryAsync({mediaTypes:["images"],allowsEditing:!0,aspect:[1,1],quality:.7});R(!1),!t.canceled&&t.assets[0]&&L(t.assets[0].uri)},N=async()=>{const{status:e}=await h.requestCameraPermissionsAsync();if("granted"!==e)return void s.default.alert("Permission needed","We need camera access to take photos");R(!0);const t=await h.launchCameraAsync({allowsEditing:!0,aspect:[1,1],quality:.7});R(!1),!t.canceled&&t.assets[0]&&L(t.assets[0].uri)};return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(f.Stack.Screen,{options:{headerShown:!1}}),(0,P.jsxs)(c.default,{style:w.default.container,contentContainerStyle:[w.default.content,{paddingTop:t.top+20}],children:[(0,P.jsx)(n.default,{style:[w.default.closeButton,{position:"absolute",right:16,top:t.top+12}],onPress:()=>e.back(),accessibilityLabel:"Close",children:(0,P.jsx)(x.default,{size:20,color:b.default.accentPrimary})}),(0,P.jsxs)(l.default,{style:w.default.header,children:[(0,P.jsx)(r.default,{style:w.default.title,children:a?"Edit dog profile":"Tell us about your dog"}),(0,P.jsx)(r.default,{style:w.default.subtitle,children:a?"Update your dog's information":"Let's start with the basics"}),!a&&(0,P.jsxs)(l.default,{style:w.default.progressContainer,children:[(0,P.jsx)(l.default,{style:[w.default.progressDot,w.default.progressDotActive]}),(0,P.jsx)(l.default,{style:w.default.progressDot})]})]}),(0,P.jsxs)(n.default,{style:w.default.photoContainer,onPress:()=>{s.default.alert("Add Photo","Choose how you want to add a photo",[{text:"Take Photo",onPress:N},{text:"Choose from Library",onPress:W},{text:"Cancel",style:"cancel"}])},disabled:z,children:[z?(0,P.jsx)(u.default,{size:"large",color:"#FFFE77"}):O?(0,P.jsx)(d.default,{source:{uri:O},style:w.default.photo}):(0,P.jsxs)(l.default,{style:w.default.photoPlaceholder,children:[(0,P.jsx)(m.default,{size:32,color:"#FFFE77"}),(0,P.jsx)(r.default,{style:w.default.photoPlaceholderText,children:"Add Photo"})]}),O&&!z&&(0,P.jsx)(l.default,{style:w.default.photoOverlay,children:(0,P.jsx)(p.default,{size:24,color:"#1a1f0a"})})]}),(0,P.jsxs)(l.default,{style:w.default.formSection,children:[(0,P.jsx)(r.default,{style:w.default.label,children:"Name *"}),(0,P.jsx)(i.default,{style:w.default.input,value:k,onChangeText:S,placeholder:"Enter your dog's name",placeholderTextColor:"#5a6040",autoCapitalize:"words",testID:"dog-name-input"})]}),(0,P.jsxs)(l.default,{style:w.default.formSection,children:[(0,P.jsx)(r.default,{style:w.default.label,children:"Nickname (Optional)"}),(0,P.jsx)(i.default,{style:w.default.input,value:I,onChangeText:T,placeholder:"Enter a nickname",placeholderTextColor:"#5a6040",autoCapitalize:"words",testID:"dog-nickname-input"})]}),(0,P.jsxs)(l.default,{style:w.default.formSection,children:[(0,P.jsx)(r.default,{style:w.default.label,children:"Size *"}),(0,P.jsxs)(n.default,{style:w.default.pickerButton,onPress:()=>{D(!A)},testID:"size-picker-button",children:[(0,P.jsx)(r.default,{style:[w.default.pickerButtonText,!_&&w.default.pickerButtonTextPlaceholder],children:_||"Select size"}),(0,P.jsx)(y.default,{size:20,color:"#a8ad8e"})]}),A&&(0,P.jsx)(l.default,{style:w.default.pickerOptions,children:C.DOG_SIZES.map(e=>(0,P.jsx)(n.default,{style:[w.default.pickerOption,_===e&&w.default.pickerOptionSelected],onPress:()=>{B(e),D(!1)},testID:`size-option-${e}`,children:(0,P.jsx)(r.default,{style:[w.default.pickerOptionText,_===e&&w.default.pickerOptionTextSelected],children:e})},e))})]}),(0,P.jsxs)(l.default,{style:w.default.formSection,children:[(0,P.jsx)(r.default,{style:w.default.label,children:"Age (years) *"}),(0,P.jsx)(i.default,{style:w.default.input,value:v,onChangeText:E,placeholder:"Enter age",placeholderTextColor:"#5a6040",keyboardType:"numeric",testID:"dog-age-input"})]}),(0,P.jsx)(n.default,{style:[w.default.nextButton,{marginBottom:t.bottom+20}],onPress:()=>{if(!k.trim())return void s.default.alert("Missing Information","Please enter your dog's name");if(!_)return void s.default.alert("Missing Information","Please select your dog's size");const t=parseInt(v,10);if(!v||isNaN(t)||t<0||t>30)return void s.default.alert("Invalid Age","Please enter a valid age (0-30 years)");e[a?"replace":"push"]({pathname:"/onboarding/dog-personality",params:{name:k.trim(),nickname:I.trim(),age:t.toString(),size:_,image:O||"",isEditing:a?"true":"false"}})},testID:"next-button",children:(0,P.jsx)(r.default,{style:w.default.nextButtonText,children:"Next"})})]})]})}},5209(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>z});var o=a(6665),r=a(6283),l=a(3929),n=a(5648),i=a(1690),d=a(5009),s=a(444),c=a(6725),u=a(6773),f=a(8264),g=a(2772),h=a(7430),m=a(5894),y=a(262),p=a(675),x=a(5163),b=a(2981),j=a(9637),w=a(5259),C=a(5624),P=a(2301),k=a(1168),S=a(8032),I=a(8280),T=a(7353),v=a(4043),E=a(1095),_=a(9582),B=a(6746),O=a(3353),L=a(9269),A=a(397);const D="background-location-task";function z(){const{saveTrail:e,getTrailById:t}=(0,B.useTrails)(),{user:a}=(0,O.useAuth)(),z=(0,j.useLocalSearchParams)(),R=(0,j.useRouter)(),W="string"===typeof z.trailId?z.trailId:void 0,N=W?t(W):void 0,U=(0,o.useRef)(null),[F,M]=(0,o.useState)(!1),[V,G]=(0,o.useState)([]),[$,H]=(0,o.useState)(null),[q,X]=(0,o.useState)(0),[J,K]=(0,o.useState)(null),[Y,Z]=(0,o.useState)(!0),[Q,ee]=(0,o.useState)(null),te=(0,o.useRef)(null),ae=(0,o.useRef)(null),oe=.5*c.default.get("window").height,re=(0,o.useRef)(new d.default.Value(40)).current,[le,ne]=(0,o.useState)(!1),[ie,de]=(0,o.useState)(0),[se,ce]=(0,o.useState)(0),[ue,fe]=(0,o.useState)("0:00"),[ge,he]=(0,o.useState)(0),[me,ye]=(0,o.useState)(0),[pe,xe]=(0,o.useState)(!1),[be,je]=(0,o.useState)(null),[we,Ce]=(0,o.useState)(""),[Pe,ke]=(0,o.useState)(""),[Se,Ie]=(0,o.useState)(void 0),[Te,ve]=(0,o.useState)([]),[Ee,_e]=(0,o.useState)(void 0);(0,o.useEffect)(()=>{Z(!1)},[]);(0,o.useEffect)(()=>{if(q>0){const e=(0,L.calculateTotalDistance)(V)/1e3;if(e>0){const t=q/60/e,a=Math.floor(t),o=Math.round(60*(t-a));fe(`${a}:${o.toString().padStart(2,"0")}`)}}},[q,V]);const Be=(0,o.useRef)(0),Oe=(0,o.useRef)(s.default.create({onStartShouldSetPanResponder:()=>!0,onMoveShouldSetPanResponder:(e,t)=>Math.abs(t.dy)>5,onPanResponderGrant:()=>{Be.current=re._value},onPanResponderMove:(e,t)=>{const a=Be.current-t.dy;a>=40&&a<=oe&&re.setValue(a)},onPanResponderRelease:(e,t)=>{const a=(oe+40)/2,o=re._value;t.dy<-50?Le():t.dy>50?Ae():o>a?Le():Ae()}})).current,Le=()=>{ne(!0),d.default.spring(re,{toValue:oe,useNativeDriver:!1,tension:50,friction:8}).start()},Ae=()=>{ne(!1),d.default.spring(re,{toValue:40,useNativeDriver:!1,tension:50,friction:8}).start()},De=async()=>{console.log("Stopping recording...");try{await b.isTaskRegisteredAsync(D)&&await p.stopLocationUpdatesAsync(D)}catch(g){console.error("Error stopping background location:",g)}te.current&&(te.current.remove(),te.current=null),ae.current&&(clearInterval(ae.current),ae.current=null);const e=await w.default.getItem("recording_coordinates"),t=e?JSON.parse(e):V,a=await w.default.getItem("recording_max_elevation"),o=a?parseFloat(a):se,r=await w.default.getItem("recording_max_speed"),l=r?parseFloat(r):me,n=await w.default.getItem("recording_start_time"),d=n?Math.floor((Date.now()-parseInt(n))/1e3):q;if(t.length<2)return i.default.alert("No Trail Data","Not enough data to save this trail. Try walking a bit more!"),M(!1),G([]),X(0),await w.default.removeItem("recording_coordinates"),await w.default.removeItem("recording_max_elevation"),await w.default.removeItem("recording_max_speed"),await w.default.removeItem("recording_start_time"),void await w.default.removeItem("recording_last_update");const s=(0,L.calculateTotalDistance)(t),c=s/1e3;let u="0:00";if(c>0){const e=d/60/c,t=Math.floor(e);u=`${t}:${Math.round(60*(e-t)).toString().padStart(2,"0")}`}const f={id:Date.now().toString(),date:Date.now(),distance:s,duration:d,coordinates:t,city:Q?.city,country:Q?.country,pace:u,speed:l,maxElevation:o};je(f),Ce(f.name||""),ke(f.description||""),Ie(f.photo||void 0),ve(f.tags||[]),_e(f.difficulty||void 0),xe(!0)},ze=()=>{xe(!1),je(null)};if(!J)return(0,A.jsxs)(l.default,{style:E.default.permissionContainer,children:[(0,A.jsx)(k.default,{size:64,color:"#666"}),(0,A.jsx)(r.default,{style:E.default.permissionTitle,children:"Location Permission Required"}),(0,A.jsx)(r.default,{style:E.default.permissionText,children:"This app needs access to your location to track your dog walks."}),(0,A.jsx)(n.default,{style:E.default.permissionButton,onPress:()=>{(async()=>{try{console.log("Requesting location permissions...");const{status:a}=await p.requestForegroundPermissionsAsync();if(console.log("Foreground permission status:",a),"granted"===a){try{const{status:e}=await p.requestBackgroundPermissionsAsync();console.log("Background permission status:",e),"granted"!==e&&i.default.alert("Background Location Required",'To continue recording your trail when the screen is locked, please enable "Allow all the time" in location settings.',[{text:"OK"}])}catch(e){console.warn("Background permission error (non-critical):",e.message)}K(!0);try{const e=await p.getCurrentPositionAsync({accuracy:x.LocationAccuracy.Balanced}),t={latitude:e.coords.latitude,longitude:e.coords.longitude};H(t),console.log("Initial location:",t)}catch(t){console.warn("Error getting initial location:",t.message)}}else K(!1),i.default.alert("Permission Required","Location permission is required to track your walks.",[{text:"OK"}])}catch(a){console.error("Permission error:",a);const e=a.message||"Failed to get location permission";e.includes("NSLocation")||e.includes("Info.plist")?i.default.alert("Configuration Error","This app needs to be built with a custom development build to use location tracking. Expo Go doesn't support background location tracking.\n\nPlease contact support or build a custom development client.",[{text:"OK"}]):i.default.alert("Error",e),K(!1)}finally{Z(!1)}})()},children:(0,A.jsx)(r.default,{style:E.default.permissionButtonText,children:"Grant Permission"})})]});const Re=(0,L.calculateTotalDistance)(V),We=N&&F&&V.length>0&&N.coordinates.length>0?Math.min(Re/N.distance*100,100):0,Ne=!!N,Ue=le?92:12;return(0,A.jsxs)(l.default,{style:E.default.container,children:[$&&(0,A.jsx)(h.default,{ref:U,coordinates:V,style:E.default.map,initialRegion:{latitude:$.latitude,longitude:$.longitude,latitudeDelta:.01,longitudeDelta:.01},showsUserLocation:!0,followsUserLocation:F,showsMyLocationButton:!1}),(0,A.jsx)(n.default,{style:E.default.recenterButton,onPress:async()=>{if(U.current)try{const e=await p.getCurrentPositionAsync({accuracy:x.LocationAccuracy.Balanced}),t={latitude:e.coords.latitude,longitude:e.coords.longitude};H(t),U.current.animateToRegion({latitude:t.latitude,longitude:t.longitude,latitudeDelta:.01,longitudeDelta:.01},500)}catch(e){console.error("Error getting current location:",e),$&&U.current.animateToRegion({latitude:$.latitude,longitude:$.longitude,latitudeDelta:.01,longitudeDelta:.01},500)}},activeOpacity:.8,children:(0,A.jsx)(S.default,{size:24,color:_.default.accentPrimary})}),(0,A.jsxs)(d.default.View,{style:[E.default.bottomSheet,{height:d.default.add(re,92),bottom:0}],children:[(0,A.jsx)(l.default,Object.assign({},Oe.panHandlers,{style:E.default.handleBar,children:(0,A.jsxs)(n.default,{style:E.default.handleContainer,onPress:()=>{le?Ae():Le()},activeOpacity:.7,children:[(0,A.jsx)(l.default,{style:E.default.handle}),le?(0,A.jsx)(C.default,{size:20,color:"#9ca3af"}):(0,A.jsx)(P.default,{size:20,color:"#9ca3af"})]})})),(0,A.jsxs)(l.default,{style:[E.default.bottomSheetContent,{paddingBottom:Ue}],children:[F?le?(0,A.jsxs)(l.default,{style:E.default.statsGrid,children:[(0,A.jsxs)(l.default,{style:E.default.statItem,children:[(0,A.jsx)(r.default,{style:E.default.statItemLabel,children:"Time"}),(0,A.jsx)(r.default,{style:E.default.statItemValue,children:(0,L.formatDuration)(q)})]}),(0,A.jsxs)(l.default,{style:E.default.statItem,children:[(0,A.jsx)(r.default,{style:E.default.statItemLabel,children:"Distance"}),(0,A.jsx)(r.default,{style:E.default.statItemValue,children:(0,L.formatDistance)(Re)})]}),(0,A.jsxs)(l.default,{style:E.default.statItem,children:[(0,A.jsx)(r.default,{style:E.default.statItemLabel,children:"Elevation"}),(0,A.jsxs)(r.default,{style:E.default.statItemValue,children:[ie.toFixed(0),"m"]})]}),(0,A.jsxs)(l.default,{style:E.default.statItem,children:[(0,A.jsx)(r.default,{style:E.default.statItemLabel,children:"Pace"}),(0,A.jsxs)(r.default,{style:E.default.statItemValue,children:[ue,"/km"]})]}),(0,A.jsxs)(l.default,{style:E.default.statItem,children:[(0,A.jsx)(r.default,{style:E.default.statItemLabel,children:"Speed"}),(0,A.jsxs)(r.default,{style:E.default.statItemValue,children:[ge.toFixed(1)," km/h"]})]}),Ne&&(0,A.jsxs)(l.default,{style:E.default.statItem,children:[(0,A.jsx)(r.default,{style:E.default.statItemLabel,children:"Progress"}),(0,A.jsxs)(r.default,{style:E.default.statItemValue,children:[We.toFixed(0),"%"]})]})]}):(0,A.jsxs)(l.default,{style:E.default.compactRow,children:[(0,A.jsxs)(l.default,{style:E.default.compactStats,children:[(0,A.jsxs)(l.default,{style:E.default.compactStatBox,children:[(0,A.jsx)(r.default,{style:E.default.statItemLabel,children:"Time"}),(0,A.jsx)(r.default,{style:E.default.statItemValue,children:(0,L.formatDuration)(q)})]}),(0,A.jsxs)(l.default,{style:E.default.compactStatBox,children:[(0,A.jsx)(r.default,{style:E.default.statItemLabel,children:"Distance"}),(0,A.jsx)(r.default,{style:E.default.statItemValue,children:(0,L.formatDistance)(Re)})]})]}),(0,A.jsxs)(n.default,{style:E.default.stopButtonCompact,onPress:De,activeOpacity:.8,children:[(0,A.jsx)(T.default,{size:18,color:"#fff",fill:"#fff"}),(0,A.jsx)(r.default,{style:E.default.stopButtonCompactText,children:"Stop"})]})]}):null,F?le?(0,A.jsx)(l.default,{style:E.default.controlContainer,children:(0,A.jsxs)(n.default,{style:E.default.recordButton,onPress:De,activeOpacity:.8,children:[(0,A.jsx)(T.default,{size:20,color:_.default.backgroundPrimary,fill:_.default.backgroundPrimary}),(0,A.jsx)(r.default,{style:E.default.recordButtonText,children:"Stop & Save"})]})}):null:(0,A.jsx)(l.default,{style:E.default.controlContainer,children:(0,A.jsxs)(n.default,{style:E.default.recordButton,onPress:async()=>{console.log("Starting recording..."),M(!0),G([]),X(0),ce(0),ye(0);try{const t=Date.now();await w.default.setItem("recording_start_time",t.toString()),await w.default.removeItem("recording_coordinates"),await w.default.removeItem("recording_max_elevation"),await w.default.removeItem("recording_max_speed"),await w.default.removeItem("recording_last_update");const a=await p.getCurrentPositionAsync({accuracy:x.LocationAccuracy.Balanced});ee(null);const o={latitude:a.coords.latitude,longitude:a.coords.longitude};await w.default.setItem("recording_coordinates",JSON.stringify([o])),G([o]),H(o);try{await p.startLocationUpdatesAsync(D,{accuracy:x.LocationAccuracy.BestForNavigation,distanceInterval:3,timeInterval:1e3,foregroundService:{notificationTitle:"Recording Trail",notificationBody:"TailTrails is tracking your walk",notificationColor:"#2563eb"},pausesUpdatesAutomatically:!1,showsBackgroundLocationIndicator:!0}),console.log("Background location tracking started successfully")}catch(e){console.warn("Background location not available:",e.message),(e.message?.includes("Background location")||e.message?.includes("UIBackgroundModes"))&&i.default.alert("Background Tracking Unavailable","Background location tracking requires a custom development build. The app will continue recording in foreground mode only. Please keep the app open while recording.",[{text:"OK"}])}te.current=await p.watchPositionAsync({accuracy:x.LocationAccuracy.BestForNavigation,distanceInterval:3,timeInterval:1e3},async e=>{const t={latitude:e.coords.latitude,longitude:e.coords.longitude};if(console.log("Foreground position update:",t,"Accuracy:",e.coords.accuracy),H(t),G(e=>{const a=[...e,t];return console.log("Total coordinates:",a.length,"Distance:",(0,L.calculateTotalDistance)(a),"m"),w.default.setItem("recording_coordinates",JSON.stringify(a)).catch(e=>{console.error("Error saving coordinates:",e)}),a}),e.coords.altitude){const t=Math.max(0,e.coords.altitude);de(t),t>se&&(ce(t),await w.default.setItem("recording_max_elevation",t.toString()))}if(e.coords.speed&&e.coords.speed>0){const t=3.6*e.coords.speed;he(t),t>me&&(ye(t),await w.default.setItem("recording_max_speed",t.toString()))}}),ae.current=setInterval(async()=>{try{const e=await w.default.getItem("recording_start_time");if(e){const t=parseInt(e),a=Math.floor((Date.now()-t)/1e3);X(a)}}catch(e){console.error("Error calculating duration:",e)}},1e3)}catch(t){console.error("Recording error:",t);let e="Failed to start recording. Please try again.";t.message?.includes("rate limit")?e="Please wait a moment before starting a new recording. Location service is temporarily limited.":(t.message?.includes("Background location")||t.message?.includes("UIBackgroundModes"))&&(e="Background location tracking requires a custom development build. Please build the app with EAS or use foreground-only mode."),i.default.alert("Error",e),M(!1)}},activeOpacity:.8,children:[(0,A.jsx)(I.default,{size:24,color:_.default.backgroundPrimary,fill:_.default.backgroundPrimary}),(0,A.jsx)(r.default,{style:E.default.recordButtonText,children:"Start Trail"})]})})]})]}),(0,A.jsx)(f.default,{visible:pe,animationType:"slide",transparent:!0,onRequestClose:ze,children:(0,A.jsx)(l.default,{style:E.default.modalOverlay,children:(0,A.jsx)(l.default,{style:E.default.modalContainer,children:(0,A.jsxs)(g.default,{contentContainerStyle:E.default.modalContent,children:[(0,A.jsx)(r.default,{style:E.default.modalTitle,children:"Save Trail"}),(0,A.jsx)(u.default,{placeholder:"Trail name",value:we,onChangeText:Ce,style:E.default.input,placeholderTextColor:_.default.backgroundPrimary}),(0,A.jsx)(u.default,{placeholder:"Description",value:Pe,onChangeText:ke,style:[E.default.input,{height:100}],placeholderTextColor:_.default.backgroundPrimary,multiline:!0}),(0,A.jsx)(n.default,{onPress:async()=>{const{status:e}=await y.requestMediaLibraryPermissionsAsync();if("granted"!==e)return void i.default.alert("Permission needed","Please allow access to your photo library");const t=await y.launchImageLibraryAsync({mediaTypes:["images"],allowsEditing:!0,aspect:[16,9],quality:.8});!t.canceled&&t.assets[0]&&Ie(t.assets[0].uri)},style:[E.default.input,{padding:12,justifyContent:"center",alignItems:"center",flexDirection:"row"}],children:Se?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(m.Image,{source:{uri:Se},style:{width:80,height:60,borderRadius:8,marginRight:12}}),(0,A.jsx)(r.default,{style:{flex:1},children:we||"Selected image"}),(0,A.jsx)(v.default,{size:18,color:_.default.backgroundPrimary})]}):(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(v.default,{size:18,color:_.default.backgroundPrimary}),(0,A.jsx)(r.default,{style:{marginLeft:8,color:_.default.backgroundPrimary},children:"Add Photo (optional)"})]})}),(0,A.jsxs)(l.default,{style:{flexDirection:"row",gap:8,marginTop:8},children:[(0,A.jsx)(n.default,{style:E.default.modalButton,onPress:ze,children:(0,A.jsx)(r.default,{style:E.default.modalButtonText,children:"Cancel"})}),(0,A.jsx)(n.default,{style:[E.default.modalButton,E.default.modalButtonPrimary],onPress:async()=>{if(!be)return;const t=Object.assign({},be,{name:we||be.name||"Untitled Trail",description:Pe,photo:Se,tags:Te,difficulty:Ee});try{await e(t);0,xe(!1),je(null),M(!1),G([]),X(0),ee(null),de(0),ce(0),fe("0:00"),he(0),ye(0),await w.default.removeItem("recording_coordinates"),await w.default.removeItem("recording_max_elevation"),await w.default.removeItem("recording_max_speed"),await w.default.removeItem("recording_start_time"),await w.default.removeItem("recording_last_update"),R.push("/(tabs)/profile")}catch(a){console.error("Save failed",a),i.default.alert("Error","Failed to save trail")}},children:(0,A.jsx)(r.default,{style:[E.default.modalButtonText,{color:"#fff"}],children:"Save Trail"})})]})]})})})})]})}},5210(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>x});var o=a(9637),r=a(1168),l=a(8032),n=a(2557),i=a(6665),d=a(5648),s=a(3929),c=a(5009),u=a(6283),f=a(8833),g=a(3668),h=a(9582);const m=g.default.create({container:{width:"100%",paddingHorizontal:0,paddingTop:0,alignItems:"center"},tabBar:{flexDirection:"row",backgroundColor:h.default.backgroundPrimary,borderRadius:0,paddingVertical:8,paddingHorizontal:8,justifyContent:"space-around",alignItems:"center",shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:8,elevation:8,width:"100%",gap:6},tabButton:{height:64,borderRadius:16,overflow:"hidden",justifyContent:"center",alignItems:"center"},tabTouchable:{flex:1,width:"100%",justifyContent:"center",alignItems:"center"},tabContent:{flexDirection:"column",alignItems:"center",justifyContent:"center",gap:4,paddingHorizontal:0},iconWrapper:{width:22,height:22,alignItems:"center",justifyContent:"center"},label:{color:h.default.textMuted,fontSize:13,fontWeight:"600"},labelActive:{color:h.default.accentPrimary}});var y=a(397);function p({state:e,descriptors:t,navigation:a}){const o=(0,f.useSafeAreaInsets)(),r=(0,i.useRef)(e.routes.map(()=>new c.default.Value(0))).current;(0,i.useEffect)(()=>{console.log("AnimatedTabBar state.index:",e.index),console.log("AnimatedTabBar routes:",e.routes.map(e=>({name:e.name,key:e.key}))),console.log("AnimatedTabBar descriptors keys:",Object.keys(t)),e.routes.forEach((t,a)=>{c.default.timing(r[a],{toValue:e.index===a?1:0,duration:300,useNativeDriver:!1}).start()})},[e.index,e.routes,r]);const l=Math.max(o.bottom,8);return(0,y.jsx)(s.default,{style:m.container,children:(0,y.jsx)(s.default,{style:[m.tabBar,{paddingBottom:l}],children:e.routes.filter(e=>{const a=t[e.key]?.options;return!(!a||!(a.tabBarLabel||a.title||a.tabBarIcon))}).map((o,l)=>{const{options:n}=t[o.key],i=void 0!==n.tabBarLabel?n.tabBarLabel:void 0!==n.title?n.title:o.name,f=e.index===l,g=(r[l],h.default.backgroundPrimary),p=f?h.default.accentPrimary:h.default.textMuted;f?h.default.accentPrimary:h.default.textMuted;return(0,y.jsx)(c.default.View,{style:[m.tabButton,{width:72,backgroundColor:g}],children:(0,y.jsx)(d.default,{accessibilityRole:"button",accessibilityState:f?{selected:!0}:{},accessibilityLabel:n.tabBarAccessibilityLabel,onPress:()=>{const e=a.emit({type:"tabPress",target:o.key,canPreventDefault:!0});f||e.defaultPrevented||a.navigate(o.name)},style:m.tabTouchable,children:(0,y.jsxs)(s.default,{style:m.tabContent,children:[(0,y.jsx)(s.default,{style:m.iconWrapper,children:n.tabBarIcon&&n.tabBarIcon({focused:f,color:p,size:22})}),(0,y.jsx)(c.default.View,{style:{opacity:1},children:(0,y.jsx)(u.default,{style:[m.label,f&&m.labelActive],children:String(i)})})]})})},o.key)})})})}function x(){return(0,y.jsxs)(o.Tabs,{tabBar:e=>(0,y.jsx)(p,Object.assign({},e)),screenOptions:{headerShown:!1,tabBarActiveTintColor:h.default.backgroundSecondaryVarient,tabBarInactiveTintColor:h.default.backgroundPrimary},children:[(0,y.jsx)(o.Tabs.Screen,{name:"explore",options:{title:"Explore",tabBarIcon:({color:e,size:t})=>(0,y.jsx)(r.default,{size:t,color:e})}}),(0,y.jsx)(o.Tabs.Screen,{name:"record",options:{title:"Record",tabBarIcon:({color:e,size:t})=>(0,y.jsx)(l.default,{size:t,color:e})}}),(0,y.jsx)(o.Tabs.Screen,{name:"profile",options:{title:"Profile",tabBarIcon:({color:e,size:t})=>(0,y.jsx)(n.default,{size:t,color:e})}})]})}console.log("[init] components/AnimatedTabBar.tsx loaded")},5250(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>l});var o=a(9637),r=a(397);function l(){return(0,r.jsx)(o.Redirect,{href:"/(tabs)/explore"})}},5625(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>b});a(6665);var o=a(6283),r=a(3929),l=a(3668),n=a(2772),i=a(5648),d=a(9637),s=a(7430),c=a(5395),u=a(4494),f=a(1168),g=a(8032),h=a(477),m=a(9582),y=a(9269),p=a(397);const x={id:"demo-trail",name:"Scenic Coastal Walk",distance:5210,duration:3600,coordinates:[{latitude:50.81999932593175,longitude:-.1443926504884132},{latitude:50.81982005377856,longitude:-.14389605957015306},{latitude:50.8195735534442,longitude:-.14290287773496857},{latitude:50.81976403108945,longitude:-.14245949298612004},{latitude:50.819651985510006,longitude:-.1415904588798469},{latitude:50.819360665744455,longitude:-.141129338740825},{latitude:50.81955114425804,longitude:-.14054407087405707},{latitude:50.8194278935438,longitude:-.1397814491065219},{latitude:50.819282233189426,longitude:-.1389301503892284},{latitude:50.819696803774036,longitude:-.13903656272921694},{latitude:50.81999932593175,longitude:-.13919618123853184},{latitude:50.82010016621547,longitude:-.13853997181101363},{latitude:50.82041389015009,longitude:-.138220734792327},{latitude:50.82055954697452,longitude:-.13852223642078343},{latitude:50.82086206354296,longitude:-.13829167635185513}],city:"Brighton",country:"UK",difficulty:"Easy",pace:"11:32",maxElevation:45};function b(){const e=(0,d.useRouter)();return(0,p.jsxs)(r.default,{style:j.container,children:[(0,p.jsx)(d.Stack.Screen,{options:{title:"Demo Trail",headerShown:!1}}),(0,p.jsxs)(n.default,{style:j.scrollView,children:[(0,p.jsxs)(r.default,{style:j.header,children:[(0,p.jsx)(i.default,{style:j.backButton,onPress:()=>e.back(),children:(0,p.jsx)(c.default,{size:24,color:"#fff"})}),(0,p.jsxs)(r.default,{style:j.headerContent,children:[(0,p.jsx)(o.default,{style:j.title,children:x.name}),(0,p.jsxs)(r.default,{style:j.locationRow,children:[(0,p.jsx)(f.default,{size:16,color:"#fff"}),(0,p.jsxs)(o.default,{style:j.locationText,children:[x.city,", ",x.country]})]})]})]}),(0,p.jsx)(r.default,{style:j.mapContainer,children:(0,p.jsx)(s.default,{coordinates:x.coordinates,style:j.map,scrollEnabled:!0,zoomEnabled:!0})}),(0,p.jsxs)(r.default,{style:j.statsContainer,children:[(0,p.jsxs)(r.default,{style:j.statItem,children:[(0,p.jsx)(g.default,{size:20,color:m.default.backgroundPrimary}),(0,p.jsx)(o.default,{style:j.statValue,children:(0,y.formatDistance)(x.distance)}),(0,p.jsx)(o.default,{style:j.statLabel,children:"Distance"})]}),(0,p.jsxs)(r.default,{style:j.statItem,children:[(0,p.jsx)(u.default,{size:20,color:m.default.backgroundPrimary}),(0,p.jsx)(o.default,{style:j.statValue,children:(0,y.formatDuration)(x.duration)}),(0,p.jsx)(o.default,{style:j.statLabel,children:"Time"})]}),(0,p.jsxs)(r.default,{style:j.statItem,children:[(0,p.jsx)(h.default,{size:20,color:m.default.backgroundPrimary}),(0,p.jsxs)(o.default,{style:j.statValue,children:[x.maxElevation,"m"]}),(0,p.jsx)(o.default,{style:j.statLabel,children:"Elevation"})]})]}),(0,p.jsxs)(r.default,{style:j.section,children:[(0,p.jsx)(o.default,{style:j.sectionTitle,children:"About this trail"}),(0,p.jsx)(o.default,{style:j.description,children:"This is a beautiful coastal walk along the Brighton seafront. Perfect for a morning stroll with your dog. The path is paved and offers stunning views of the English Channel."})]})]})]})}const j=l.default.create({container:{flex:1,backgroundColor:m.default.backgroundPrimary},scrollView:{flex:1},header:{height:200,backgroundColor:m.default.backgroundPrimary,justifyContent:"flex-end",padding:20},backButton:{position:"absolute",top:50,left:20,zIndex:10},headerContent:{marginBottom:10},title:{fontSize:28,fontWeight:"bold",color:"#fff",marginBottom:5},locationRow:{flexDirection:"row",alignItems:"center"},locationText:{color:"#fff",marginLeft:5,fontSize:16},mapContainer:{height:300,width:"100%"},map:{flex:1},statsContainer:{flexDirection:"row",justifyContent:"space-around",padding:20,backgroundColor:m.default.backgroundSecondary,borderBottomWidth:1,borderBottomColor:m.default.borderSubtle},statItem:{alignItems:"center"},statValue:{fontSize:18,fontWeight:"bold",marginTop:5,color:"#333"},statLabel:{fontSize:12,color:"#666",marginTop:2},section:{padding:20},sectionTitle:{fontSize:20,fontWeight:"bold",marginBottom:10,color:"#333"},description:{fontSize:16,lineHeight:24,color:"#666"}})},5632(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>l});var o=a(3668),r=a(9582);const l=o.default.create({container:{flex:1,backgroundColor:r.default.backgroundPrimary},content:{flex:1,padding:24,justifyContent:"center"},header:{alignItems:"center",marginBottom:48},logo:{width:100,height:100},title:{fontSize:32,fontWeight:"700",color:r.default.textPrimary,marginTop:16},subtitle:{fontSize:16,color:r.default.textMuted,marginTop:8,textAlign:"center"},form:{width:"100%"},inputContainer:{marginBottom:20},label:{fontSize:14,fontWeight:"600",color:r.default.textMuted,marginBottom:8},input:{backgroundColor:r.default.backgroundPrimary,borderWidth:1,borderColor:r.default.borderSubtle,borderRadius:12,padding:16,fontSize:16,color:r.default.textPrimary},helperText:{fontSize:12,color:r.default.textMuted,marginTop:8},button:{backgroundColor:r.default.accentSecondary,borderRadius:12,padding:16,alignItems:"center",marginTop:12},buttonDisabled:{opacity:.6},buttonPressed:{transform:[{scale:.997}],opacity:.95},buttonText:{fontSize:16,fontWeight:"600",color:r.default.backgroundPrimary},secondaryButton:{padding:16,alignItems:"center",marginTop:8},secondaryButtonText:{fontSize:14,fontWeight:"600",color:r.default.accentPrimary},footer:{flexDirection:"row",justifyContent:"center",alignItems:"center",marginTop:24},footerText:{fontSize:14,color:r.default.textMuted},linkText:{fontSize:14,fontWeight:"600",color:r.default.accentPrimary}})},5938(e,t,a){"use strict";a.r(t),a.d(t,{API_URL:()=>o,base64UrlToBuffer:()=>r,bufferToBase64Url:()=>l,firebaseAuthExchange:()=>c,webauthnAuthOptions:()=>d,webauthnAuthVerify:()=>s,webauthnRegisterOptions:()=>n,webauthnRegisterVerify:()=>i});const o=("undefined"!==typeof window?window.__EXPO_PUBLIC_API_URL__:void 0)||"https://api.tailtrails.club";function r(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),a="function"===typeof atob?atob(t):Buffer.from(t,"base64").toString("binary"),o=a.length,r=new Uint8Array(o);for(let l=0;l<o;++l)r[l]=a.charCodeAt(l);return r}function l(e){const t=e instanceof Uint8Array?e:new Uint8Array(e);let a="";for(let o=0;o<t.byteLength;o++)a+=String.fromCharCode(t[o]);return("function"===typeof btoa?btoa(a):Buffer.from(a,"binary").toString("base64")).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function n(e,t){const a=await fetch(`${o}/webauthn/register/options`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,name:t})});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.detail||"Failed to get registration options")}return a.json()}async function i(e){const t=await fetch(`${o}/webauthn/register/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.detail||"Failed to verify registration")}return t.json()}async function d(e){const t=await fetch(`${o}/webauthn/auth/options`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.detail||"Failed to get auth options")}return t.json()}async function s(e){const t=await fetch(`${o}/webauthn/auth/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.detail||"Failed to verify authentication")}return t.json()}async function c(e){const t=await fetch(`${o}/auth/firebase`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_token:e})});if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.detail?.[0]?.msg||e.detail||"Failed to authenticate with Firebase")}return t.json()}console.log("Current API URL:",o)},6183(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>x});var o=a(6665),r=a(6283),l=a(3929),n=a(5648),i=a(2772),d=a(1690),s=a(530),c=a(9637),u=a(1449),f=a(8833),g=a(8625),h=a(594),m=a(3353),y=a(9908),p=a(397);function x(){const e=(0,c.useRouter)(),t=(0,c.useLocalSearchParams)(),{user:a}=(0,m.useAuth)(),{dogProfile:x,refreshDogProfile:b,createDogProfile:j,updateDogProfile:w}=(0,y.useDogs)(),C=(0,f.useSafeAreaInsets)(),[P,k]=(0,o.useState)([]),[S,I]=(0,o.useState)("Fair"),[T,v]=(0,o.useState)(!1),E="true"===t.isEditing;(0,o.useEffect)(()=>{x&&E&&(console.log("Loading existing personality tags for editing:",x.personality_tags),k(x.personality_tags||[]),I(x.recall_reliability||"Fair"))},[x,E]);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(c.Stack.Screen,{options:{headerShown:!1}}),(0,p.jsxs)(l.default,{style:[g.default.container,{paddingTop:C.top+20}],children:[(0,p.jsxs)(i.default,{style:g.default.scrollView,contentContainerStyle:g.default.content,children:[(0,p.jsxs)(l.default,{style:g.default.header,children:[(0,p.jsx)(r.default,{style:g.default.title,children:"Personality & Behaviour"}),(0,p.jsx)(r.default,{style:g.default.subtitle,children:"Choose the tags that best describe your dog"}),!E&&(0,p.jsxs)(l.default,{style:g.default.progressContainer,children:[(0,p.jsx)(l.default,{style:g.default.progressDot}),(0,p.jsx)(l.default,{style:[g.default.progressDot,g.default.progressDotActive]})]})]}),(0,p.jsx)(l.default,{style:g.default.tagsContainer,children:h.PERSONALITY_TAGS.map(e=>(0,p.jsx)(n.default,{style:[g.default.tag,P.includes(e)&&g.default.tagSelected],onPress:()=>(e=>{k(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e),testID:`tag-${e}`,children:(0,p.jsx)(r.default,{style:[g.default.tagText,P.includes(e)&&g.default.tagTextSelected],children:e})},e))}),(0,p.jsx)(l.default,{style:g.default.sectionHeader,children:(0,p.jsx)(r.default,{style:g.default.sectionTitle,children:"Health & Safety"})}),(0,p.jsxs)(l.default,{style:g.default.section,children:[(0,p.jsx)(r.default,{style:g.default.label,children:"Recall Reliability"}),(0,p.jsx)(r.default,{style:g.default.helperText,children:"How reliably does your dog return when called?"}),(0,p.jsx)(l.default,{style:g.default.recallContainer,children:h.RECALL_RELIABILITY_OPTIONS.map(e=>(0,p.jsx)(n.default,{style:[g.default.recallOption,S===e&&g.default.recallOptionSelected],onPress:()=>{I(e)},testID:`recall-${e}`,children:(0,p.jsx)(r.default,{style:[g.default.recallText,S===e&&g.default.recallTextSelected],children:e})},e))})]})]}),(0,p.jsxs)(l.default,{style:[g.default.footer,{paddingBottom:C.bottom+20}],children:[(0,p.jsxs)(n.default,{style:g.default.backButton,onPress:()=>e.back(),disabled:T,testID:"back-button",children:[(0,p.jsx)(u.default,{size:24,color:"#FFFE77"}),(0,p.jsx)(r.default,{style:g.default.backButtonText,children:"Back"})]}),(0,p.jsx)(n.default,{style:[g.default.finishButton,T&&g.default.finishButtonDisabled],onPress:async()=>{if(a){0,v(!0);try{console.log(E?"Updating dog profile for user:":"Creating dog profile for user:",a.id);const o={user_id:a.id,name:t.name,nickname:t.nickname||void 0,size:t.size,age:parseInt(t.age,10),image:t.image||void 0,personality_tags:P,recall_reliability:S};console.log("Dog profile data:",o),E&&x?.id?await w(Object.assign({},o,{id:x.id})):await j(o),E?e.replace("/(tabs)/profile"):e.replace("/(tabs)/explore")}catch(o){console.error("Error saving dog profile:",o),d.default.alert("Error",o.message||"Failed to save dog profile"),v(!1)}}else d.default.alert("Error","You must be logged in to create a dog profile")},disabled:T,testID:"finish-button",children:T?(0,p.jsx)(s.default,{color:"#1a1f0a"}):(0,p.jsx)(r.default,{style:g.default.finishButtonText,children:E?"Save":"Finish"})})]})]})]})}},6746(e,t,a){"use strict";a.r(t),a.d(t,{TrailsContext:()=>i,useTrails:()=>d});var o=a(6665),r=a(2790),l=a(3353),n=a(5938);const[i,d]=(0,r.default)(()=>{const{user:e,session:t}=(0,l.useAuth)(),[a,r]=(0,o.useState)([]),[i,d]=(0,o.useState)([]),[s,c]=(0,o.useState)(!0),[u,f]=(0,o.useState)(!0),g=(0,o.useCallback)(async()=>{if(e&&t)try{console.log("Loading trails for user:",e.id);const a=await fetch(`${n.API_URL}/trail`,{headers:{Authorization:`Bearer ${t?.accessToken}`}});if(a.ok){const e=await a.json();r(e||[])}else console.error("Failed to load trails:",a.status),r([])}catch(a){console.error("Failed to load trails:",a)}finally{c(!1)}else try{const e=await fetch(`${n.API_URL}/trail`);if(e.ok){const t=await e.json();r(t||[])}else console.error("Failed to load trails (public):",e.status),r([])}catch(o){console.error("Failed to load trails:",o),r([])}finally{c(!1)}},[e,t]),h=(0,o.useCallback)(async()=>{if(!t?.accessToken)return d([]),void f(!1);try{console.log("Loading my trails for user:",e?.id);const a=await fetch(`${n.API_URL}/trail/me`,{headers:{Authorization:`Bearer ${t?.accessToken}`}});if(a.ok){const e=await a.json();d(e||[])}else console.error("Failed to load my trails:",a.status),d([])}catch(a){console.error("Failed to load saved trails:",a),d([])}finally{f(!1)}},[e,t]);(0,o.useEffect)(()=>{g(),h()},[g,h]);const m=(0,o.useCallback)(async a=>{if(!e)throw console.error("No user logged in"),new Error("Must be logged in to save trails");if(!t?.accessToken)throw console.error("No session/access token available"),new Error("Must be logged in to save trails");try{console.log("Saving trail for user via API:",e.id);const l=e=>e&&0!==e.length?e.map(e=>[e.longitude,e.latitude]):[],i={name:a.name,distance:a.distance,duration:a.duration,path:l(a.coordinates),photo:a.photo,city:a.city,country:a.country,description:a.description,tags:a.tags,elevation:a.elevation,surface_type:a.surfaceType,difficulty:a.difficulty,location:a.location,pace:a.pace,speed:a.speed,max_elevation:a.maxElevation,rating:a.rating,review:a.review,environment_tags:a.environment_tags},d=t.accessToken,s="string"===typeof i.photo&&i.photo&&!i.photo.startsWith("http"),c="object"===typeof i.photo&&null!==i.photo,u=Object.assign({},i);(s||c)&&(u.photo=void 0);const f=await fetch(`${n.API_URL}/trail/me`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify(u)});if(!f.ok){const e=await f.text();throw console.error("Failed to save trail via API:",f.status,e),new Error("Failed to save trail")}const g=await f.json();if(r(e=>[g,...e]),s||c)try{const e=new FormData;if(c)e.append("file",i.photo),e.append("filename",i.photo.name||`trail_${Date.now()}.jpg`);else{const t=i.photo,a=t.split("/"),o=a[a.length-1]||`trail_${Date.now()}.jpg`,r=o.match(/\.([a-zA-Z0-9]+)(?:\?.*)?$/),l="png"===(r?r[1].toLowerCase():"jpg")?"image/png":"image/jpeg";e.append("file",{uri:t,name:o,type:l}),e.append("filename",o)}e.append("trail_id",g.id),e.append("dog_id",""),e.append("user_id","");const t=await fetch(`${n.API_URL}/uploads`,{method:"POST",headers:{Authorization:`Bearer ${d}`,accept:"application/json"},body:e});if(t.ok){const e=await t.json(),a=e.public_url||e.publicUrl||e.url;if(a){const e=await fetch(`${n.API_URL}/trail/${g.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify(Object.assign({},g,{photo:a}))});if(e.ok){const t=await e.json();r(e=>e.map(e=>e.id===t.id?t:e))}else console.error("Failed to patch trail with uploaded photo")}}else console.error("Trail photo upload failed during create:",await t.text())}catch(o){console.error("Error uploading trail photo after create:",o)}return g}catch(l){throw console.error("Failed to save trail:",l),l}},[e,t]),y=(0,o.useCallback)(async e=>{try{if(console.log("Deleting trail via API:",e),!t?.accessToken)throw new Error("Not authenticated");const a=await fetch(`${n.API_URL}/trail/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t.accessToken}`}});if(204!==a.status){const e=await a.text();throw console.error("Failed to delete trail:",a.status,e),new Error("Failed to delete trail")}r(t=>t.filter(t=>t.id!==e))}catch(a){throw console.error("Failed to delete trail:",a),a}},[t]),p=(0,o.useCallback)(e=>{const t=a.find(t=>t.id===e);return t||("demo-trail"===e?{id:"demo-trail",name:"Scenic Coastal Walk",distance:5.2,duration:3600,coordinates:[{latitude:50.81999932593175,longitude:-.1443926504884132},{latitude:50.81982005377856,longitude:-.14389605957015306},{latitude:50.8195735534442,longitude:-.14290287773496857},{latitude:50.81976403108945,longitude:-.14245949298612004},{latitude:50.819651985510006,longitude:-.1415904588798469},{latitude:50.819360665744455,longitude:-.141129338740825},{latitude:50.81955114425804,longitude:-.14054407087405707},{latitude:50.8194278935438,longitude:-.1397814491065219},{latitude:50.819282233189426,longitude:-.1389301503892284},{latitude:50.819696803774036,longitude:-.13903656272921694},{latitude:50.81999932593175,longitude:-.13919618123853184},{latitude:50.82010016621547,longitude:-.13853997181101363},{latitude:50.82041389015009,longitude:-.138220734792327},{latitude:50.82055954697452,longitude:-.13852223642078343},{latitude:50.82086206354296,longitude:-.13829167635185513}],city:"Brighton",country:"UK",difficulty:"Easy",pace:"11:32",maxElevation:45,date:Date.now(),environment_tags:["Beach","Sunny","Paved"],rating:4.5,review:"A beautiful walk along the seafront. Very dog friendly!"}:void 0)},[a]),x=(0,o.useCallback)(async(e,a,o=10)=>{try{if(console.log("Loading nearby trails:",{latitude:e,longitude:a,distanceKm:o}),"number"===typeof e&&"number"===typeof a&&t?.accessToken)try{const r=await fetch(`${n.API_URL}/trail/nearby?latitude=${encodeURIComponent(e)}&longitude=${encodeURIComponent(a)}&distance_km=${encodeURIComponent(o)}`,{headers:{Authorization:`Bearer ${t.accessToken}`}});if(r.ok){return await r.json()}return 404===r.status?(console.warn("Nearby trails endpoint returned 404 (no trails)"),[]):(console.error("Failed to load nearby trails from API:",r.status),[])}catch(r){return console.error("Error calling nearby trails API:",r),[]}return[]}catch(l){return console.error("Failed to load nearby trails:",l),[]}},[t]),b=(0,o.useCallback)(async(e,a)=>{try{if(console.log("Updating trail name via API:",e,a),!t?.accessToken)throw new Error("Not authenticated");const o=await fetch(`${n.API_URL}/trail/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t?.accessToken}`},body:JSON.stringify({name:a})});if(!o.ok){const e=await o.text();throw new Error(e||"Failed to update")}const l=await o.json();r(t=>t.map(t=>t.id===e?l:t))}catch(o){throw console.error("Failed to update trail name:",o),o}},[t]),j=(0,o.useCallback)(async(e,a)=>{try{if(console.log("Updating trail photo via API:",e),!t?.accessToken)throw new Error("Not authenticated");const o=await fetch(`${n.API_URL}/trail/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t?.accessToken}`},body:JSON.stringify({photo:a})});if(!o.ok){const e=await o.text();throw new Error(e||"Failed to update photo")}const l=await o.json();r(t=>t.map(t=>t.id===e?l:t))}catch(o){throw console.error("Failed to update trail photo:",o),o}},[t]),w=(0,o.useCallback)(async(e,a)=>{try{if(console.log("Updating trail details via API:",e,a),!t?.accessToken)throw new Error("Not authenticated");const o=await fetch(`${n.API_URL}/trail/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t?.accessToken}`},body:JSON.stringify(a)});if(!o.ok){const e=await o.text();throw new Error(e||"Failed to update details")}const l=await o.json();r(t=>t.map(t=>t.id===e?l:t))}catch(o){throw console.error("Failed to update trail details:",o),o}},[]),C=(0,o.useCallback)(async e=>{try{console.log("Loading trail with user data via API:",e);const t=await fetch(`${n.API_URL}/trail/${e}`);if(!t.ok)return void console.error("Failed to fetch trail:",t.status);return await t.json()}catch(t){return void console.error("Failed to load trail with user:",t)}},[]),P=(0,o.useCallback)(async t=>{if(!e)throw console.error("No user logged in"),new Error("Must be logged in to save trails");try{console.log("Saving trail bookmark:",t);const e=a.find(e=>e.id===t);e&&d(t=>[e,...t])}catch(o){throw console.error("Failed to save trail bookmark:",o),o}},[e,a]),k=(0,o.useCallback)(async t=>{if(!e)throw console.error("No user logged in"),new Error("Must be logged in to remove saved trails");try{console.log("Removing trail bookmark:",t),d(e=>e.filter(e=>e.id!==t))}catch(a){throw console.error("Failed to remove trail bookmark:",a),a}},[e]),S=(0,o.useCallback)(e=>i.some(t=>t.id===e),[i]);return(0,o.useMemo)(()=>({trails:a,savedTrails:i,isLoading:s,isSavedLoading:u,saveTrail:m,deleteTrail:y,getTrailById:p,updateTrailName:b,updateTrailPhoto:j,updateTrailDetails:w,loadNearbyTrails:x,saveTrailBookmark:P,removeTrailBookmark:k,isTrailSaved:S,getTrailWithUser:C}),[a,i,s,u,m,y,p,b,j,w,x,P,k,S,C])})},6848(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>C});var o=a(5227),r=a(4108),l=a(9637),n=a(284),i=a(6665),d=a(3668),s=a(1015),c=a(3353),u=a(2598),f=a(6746),g=a(9908),h=a(3929),m=a(530),y=a(397);let p=null;try{p=a(8627).default}catch(k){p=null}function x({size:e=200}){return(0,y.jsx)(h.default,{style:b.center,children:(0,y.jsx)(m.default,{size:"large",color:"#2563eb"})})}const b=d.default.create({center:{flex:1,justifyContent:"center",alignItems:"center"}});n.preventAutoHideAsync();const j=new o.QueryClient;function w(){const{isAuthenticated:e,isLoading:t}=(0,c.useAuth)(),{hasDogProfile:a,isDogProfileLoading:o}=(0,g.useDogs)(),r=(0,l.useSegments)(),n=(0,l.useRouter)();return(0,i.useEffect)(()=>{if(t)return;if(o)return void console.log("Navigation: waiting for dog profiles to finish loading");const l="(tabs)"===r[0],i="login"===r[0]||"signup"===r[0],d="onboarding"===r[0];console.log("Navigation check:",{isAuthenticated:e,hasDogProfile:a,segments:r[0]}),e||!l&&!d?!e||a||d?e&&a&&i&&(console.log("Redirecting to explore: user authenticated with dog profile"),n.replace("/(tabs)/explore")):(console.log("Redirecting to onboarding: no dog profile"),n.replace("/onboarding/dog-basics")):(console.log("Redirecting to login: user not authenticated"),n.replace("/login"))},[e,a,r,t,o,n]),t?(0,y.jsx)(x,{}):(0,y.jsxs)(l.Stack,{screenOptions:{headerBackTitle:"Back"},children:[(0,y.jsx)(l.Stack.Screen,{name:"login",options:{headerShown:!1}}),(0,y.jsx)(l.Stack.Screen,{name:"signup",options:{headerShown:!1}}),(0,y.jsx)(l.Stack.Screen,{name:"(tabs)",options:{headerShown:!1}}),(0,y.jsx)(l.Stack.Screen,{name:"trail/[id]",options:{headerShown:!1}})]})}function C(){return(0,i.useEffect)(()=>{n.hideAsync()},[]),(0,y.jsx)(r.QueryClientProvider,{client:j,children:(0,y.jsx)(c.AuthContext,{children:(0,y.jsx)(u.AccountContext,{children:(0,y.jsx)(g.DogsContext,{children:(0,y.jsx)(f.TrailsContext,{children:(0,y.jsx)(s.GestureHandlerRootView,{style:P.container,children:(0,y.jsx)(w,{})})})})})})})}const P=d.default.create({container:{flex:1}})},7430(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>c});var o=a(6665),r=a(3929),l=a(3668),n=a(9582);const i=l.default.create({container:{backgroundColor:n.default.backgroundSecondary,overflow:"hidden"}});var d=a(7042),s=(a(1051),a(397));const c=(0,o.forwardRef)(({coordinates:e,style:t,initialRegion:a,scrollEnabled:l=!0,zoomEnabled:n=!0},c)=>{const u=(0,o.useRef)(null),f=(0,o.useRef)(null);return(0,o.useImperativeHandle)(c,()=>({animateToRegion:(e,t=500)=>{f.current&&f.current.easeTo({center:[e.longitude,e.latitude],zoom:14,duration:t})},fitToCoordinates:(e,t={})=>{if(f.current&&e.length>0){const a=new d.LngLatBounds;e.forEach(e=>a.extend([e.longitude,e.latitude])),f.current.fitBounds(a,{padding:t.edgePadding||20})}}})),(0,o.useEffect)(()=>{if(!u.current)return;const t=a?[a.longitude,a.latitude]:e.length>0?[e[0].longitude,e[0].latitude]:[0,0],o=a?14:12,r=new d.Map({container:u.current,style:"https://api.tailtrails.club/map/style.json",center:t,zoom:o,interactive:l&&n});return f.current=r,r.on("load",()=>{if(e.length>1){r.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:e.map(e=>[e.longitude,e.latitude])}}}),r.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#5d6b4a","line-width":4}});const t=new d.LngLatBounds;e.forEach(e=>t.extend([e.longitude,e.latitude])),r.fitBounds(t,{padding:20})}}),()=>{r.remove()}},[e,a,l,n]),(0,s.jsx)(r.default,{style:[t,i.container],children:(0,s.jsx)("div",{ref:u,style:{width:"100%",height:"100%"}})})})},7705(e,t,a){"use strict";a.r(t),a.d(t,{createUserWithEmailAndPassword:()=>s,default:()=>g,getFirebaseAuth:()=>f,signInWithEmailAndPassword:()=>d,signInWithGoogle:()=>u,updateProfile:()=>c});const o={apiKey:{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.4",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"54.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_FIREBASE_API_KEY,authDomain:{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.4",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"54.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.4",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"54.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.4",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"54.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.4",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"54.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.4",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",newArchEnabled:!0,splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"54.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_FIREBASE_APP_ID};let r=null,l=null;let n=null;function i(){return n||(n=async function(){const{initializeApp:e,getApps:t}=await Promise.all([a.e(684),a.e(908)]).then(a.bind(a,7908)),{getAuth:n,signInWithEmailAndPassword:i,createUserWithEmailAndPassword:d,updateProfile:s}=await Promise.all([a.e(684),a.e(888)]).then(a.bind(a,6888)),c=n(t().length?t()[0]:e(o));return r=c,l="web",{signInWithEmailAndPassword:(e,t,a)=>i(e||c,t,a),createUserWithEmailAndPassword:(e,t,a)=>d(e||c,t,a),updateProfile:(e,t)=>s(e,t),signInWithGoogle:async(e,t,o)=>{const{GoogleAuthProvider:r,signInWithCredential:l}=await Promise.all([a.e(684),a.e(888)]).then(a.bind(a,6888)),n=r.credential(o||null,t||null),i=await l(e||c,n);return{idToken:await i.user.getIdToken(),user:i.user}}}}(),n)}async function d(e,t,a){return(await i()).signInWithEmailAndPassword(e,t,a)}async function s(e,t,a){return(await i()).createUserWithEmailAndPassword(e,t,a)}async function c(e,t){return(await i()).updateProfile(e,t)}async function u(e,t,a){const o=await i();if(!o.signInWithGoogle)throw new Error("Google sign-in not supported by this implementation");return o.signInWithGoogle(e,t,a)}function f(){return r||i().catch(()=>{}),r}const g={getFirebaseAuth:f,signInWithEmailAndPassword:d,createUserWithEmailAndPassword:s,updateProfile:c}},7924(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>l});var o=a(3668),r=a(9582);const l=o.default.create({container:{flex:1,backgroundColor:r.default.backgroundPrimary},content:{padding:24},header:{marginBottom:32,alignItems:"center"},title:{fontSize:28,fontWeight:"700",color:r.default.accentPrimary,marginBottom:8,textAlign:"center"},subtitle:{fontSize:16,color:r.default.accentPrimary,textAlign:"center",marginBottom:24},progressContainer:{flexDirection:"row",gap:8},progressDot:{width:8,height:8,borderRadius:4,backgroundColor:"#3d4520"},progressDotActive:{backgroundColor:r.default.accentPrimary},photoContainer:{width:140,height:140,borderRadius:70,alignSelf:"center",marginBottom:32,overflow:"hidden"},photo:{width:"100%",height:"100%"},photoPlaceholder:{width:"100%",height:"100%",backgroundColor:r.default.backgroundSecondary,justifyContent:"center",alignItems:"center",gap:8},photoPlaceholderText:{fontSize:14,color:r.default.accentPrimary,fontWeight:"500"},photoOverlay:{position:"absolute",bottom:0,right:0,width:40,height:40,borderRadius:20,backgroundColor:r.default.accentPrimary,justifyContent:"center",alignItems:"center"},formSection:{marginBottom:24},label:{fontSize:15,fontWeight:"600",color:r.default.accentPrimary,marginBottom:8},input:{backgroundColor:r.default.backgroundPrimary,borderRadius:12,padding:16,fontSize:16,color:r.default.accentPrimary,borderWidth:1,borderColor:"#3d4520"},pickerButton:{backgroundColor:r.default.backgroundPrimary,borderRadius:12,padding:16,flexDirection:"row",justifyContent:"space-between",alignItems:"center",borderWidth:1,borderColor:"#3d4520"},pickerButtonText:{fontSize:16,color:r.default.accentPrimary},pickerButtonTextPlaceholder:{color:"#5a6040"},pickerOptions:{backgroundColor:"#282E10",borderRadius:12,marginTop:8,borderWidth:1,borderColor:"#3d4520",overflow:"hidden"},pickerOption:{padding:16,borderBottomWidth:1,borderBottomColor:"#1a1f0a"},pickerOptionSelected:{backgroundColor:"rgba(255, 254, 119, 0.15)"},pickerOptionText:{fontSize:16,color:r.default.accentPrimary},pickerOptionTextSelected:{color:r.default.accentPrimary,fontWeight:"600"},nextButton:{backgroundColor:r.default.accentPrimary,borderRadius:12,padding:18,alignItems:"center",marginTop:16},nextButtonText:{fontSize:17,fontWeight:"600",color:r.default.backgroundPrimary},closeButton:{width:40,height:40,borderRadius:20,backgroundColor:r.default.backgroundPrimary,justifyContent:"center",alignItems:"center"}})},8389(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>R});var o=a(6665),r=a(9637),l=a(6283),n=a(3929),i=a(2772),d=a(5648),s=a(530),c=a(5009),u=a(6773),f=a(8264),g=a(932),h=a(5894),m=a(893),y=a(8833),p=a(3087),x=a(2994),b=a(5624),j=a(1449),w=a(2301),C=a(3048),P=a(1168),k=a(8032),S=a(1858),I=a(5082),T=a(4550),v=a(2964),E=a(9582),_=a(7042),B=a(2699),O=a(9269),L=a(9600),A=a(6746),D=a(397);const z=[{id:"nearby",name:"Nearby",icon:P.default},{id:"popular",name:"Popular",icon:C.default},{id:"beaches",name:"Beaches",icon:T.default}];function R(){const e=(0,r.useRouter)(),t=(0,y.useSafeAreaInsets)(),{loadNearbyTrails:a,saveTrailBookmark:C,removeTrailBookmark:T,isTrailSaved:R}=(0,A.useTrails)(),[W,N]=(0,o.useState)("nearby"),[U,F]=(0,o.useState)([]),[M,V]=(0,o.useState)(!0),[,G]=(0,o.useState)(void 0),[$,H]=(0,o.useState)({}),[q,X]=(0,o.useState)(""),[J,K]=(0,o.useState)(!1),[Y,Z]=(0,o.useState)(""),[Q,ee]=(0,o.useState)([]),[te,ae]=(0,o.useState)(!1),oe=(0,o.useCallback)(async()=>{Z("Current location");try{if(navigator&&navigator.geolocation)return void navigator.geolocation.getCurrentPosition(async e=>{try{const t=await a(e.coords.latitude,e.coords.longitude);F(t)}catch(t){console.error("Failed to load nearby trails with browser location:",t);const e=await a();F(e)}finally{V(!1)}},async()=>{const e=await a();F(e),V(!1)});const e=await a();F(e)}catch(e){console.error("Failed to load nearby trails (web):",e),F([])}finally{V(!1)}},[a]);(0,o.useEffect)(()=>{oe()},[oe]),(0,r.useFocusEffect)((0,o.useCallback)(()=>{console.log("Explore tab focused - refreshing nearby trails (web)"),oe()},[oe]));const re=(0,o.useCallback)(()=>{const e=q.toLowerCase(),t=U.filter(t=>{const a=t.name?.toLowerCase()||"",o=t.city?.toLowerCase()||"",r=t.country?.toLowerCase()||"";return a.includes(e)||o.includes(e)||r.includes(e)}).map(e=>({id:e.id,name:e.name||`Trail ${new Date(e.date).toLocaleDateString()}`,location:e.city?`${e.city}, ${e.country||"Unknown"}`:"Location unknown",type:"trail"})).slice(0,6);ee(t)},[q,U]);(0,o.useEffect)(()=>{q.trim()?re():ee([])},[q,re]);const le=()=>{K(!1),X(""),ee([])},ne=e=>{if(!$[e]){const t=new c.default.Value(1);return H(a=>Object.assign({},a,{[e]:t})),t}return $[e]},ie=(0,o.useCallback)(e=>{let t=e;return"popular"===W?t=[...t].sort((e,t)=>(t.rating||0)-(e.rating||0)):"beaches"===W&&(t=t.filter(e=>(e.environment_tags||[]).some(e=>e.toLowerCase().includes("beach")))),t},[W]),de=o.useRef(null),se=o.useRef(null),[ce,ue]=(0,o.useState)(null),[fe,ge]=(0,o.useState)(10),[he,me]=(0,o.useState)(!1);(0,o.useEffect)(()=>{if(!he||!de.current||!te)return;if(se.current)return;const e=ce?[ce.longitude,ce.latitude]:[0,0],t=new _.Map({container:de.current,style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",center:e,zoom:ce?10:1});return se.current=t,t.on("load",()=>{t.getSource("picker")||(t.addSource("picker",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),t.addLayer({id:"picker-layer",type:"circle",source:"picker",paint:{"circle-radius":8,"circle-color":"#2563eb","circle-stroke-color":"#fff","circle-stroke-width":2}}))}),t.on("click",e=>{const a=e.lngLat.lat,o=e.lngLat.lng;ue({latitude:a,longitude:o});const r=t.getSource("picker");r&&r.setData({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[o,a]}}]}),t.flyTo({center:[o,a],zoom:12})}),()=>{try{t.remove()}catch(e){}se.current=null}},[he,te,ce]);const ye=async()=>{V(!0);try{if(ce){const e=await a(ce.latitude,ce.longitude,fe);F(e)}else if(navigator&&navigator.geolocation)navigator.geolocation.getCurrentPosition(async e=>{const t=await a(e.coords.latitude,e.coords.longitude,fe);F(t)},async()=>{const e=await a(void 0,void 0,fe);F(e)});else{const e=await a(void 0,void 0,fe);F(e)}}catch(e){console.error("Search nearby failed:",e)}finally{V(!1)}},pe=ie(U);return(0,D.jsxs)(n.default,{style:B.default.safeContainer,children:[(0,D.jsxs)(i.default,{style:B.default.container,showsVerticalScrollIndicator:!1,stickyHeaderIndices:[0],children:[(0,D.jsxs)(n.default,{style:[B.default.stickyHeader,{paddingTop:t.top+16}],children:[(0,D.jsxs)(n.default,{style:B.default.stickySearchContainer,children:[(0,D.jsxs)(d.default,{style:B.default.searchBar,onPress:()=>{K(!0)},activeOpacity:.7,children:[(0,D.jsx)(S.default,{size:20,color:E.default.textMuted}),(0,D.jsx)(l.default,{style:B.default.searchPlaceholder,children:"Find trails"})]}),(0,D.jsx)(d.default,{style:B.default.demoButton,onPress:()=>e.push("/trail/demo-trail"),children:(0,D.jsx)(l.default,{style:B.default.demoButtonText,children:"Demo"})})]}),(0,D.jsx)(n.default,{style:B.default.categoriesSection,children:(0,D.jsx)(i.default,{horizontal:!0,showsHorizontalScrollIndicator:!1,contentContainerStyle:B.default.categoriesScroll,children:z.map(e=>{const t=e.icon,a=W===e.id;return(0,D.jsxs)(d.default,{style:[B.default.categoryButton,a&&B.default.categoryButtonActive],onPress:()=>{return t=e.id,void N(t);var t},children:[(0,D.jsx)(t,{size:20,color:a?"#fff":"#9ca3af",strokeWidth:2}),(0,D.jsx)(l.default,{style:[B.default.categoryText,a&&B.default.categoryTextActive],children:e.name})]},e.id)})})})]}),(0,D.jsxs)(n.default,{style:{paddingHorizontal:16,paddingVertical:8},children:[(0,D.jsxs)(d.default,{onPress:()=>ae(e=>!e),style:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[(0,D.jsx)(l.default,{style:{fontSize:14,fontWeight:"600"},children:"Location & Distance"}),te?(0,D.jsx)(w.default,{size:20,color:"#5d6b4a"}):(0,D.jsx)(b.default,{size:20,color:"#5d6b4a"})]}),te?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(l.default,{style:{fontSize:14,fontWeight:"600",marginBottom:8},children:"Pick a location on the map or use your current location"}),(0,D.jsx)("div",{ref:e=>{de.current=e,me(!!e)},style:{width:"100%",height:220,borderRadius:12,overflow:"hidden",marginBottom:8}}),(0,D.jsxs)(n.default,{style:{flexDirection:"row",alignItems:"center",gap:12},children:[(0,D.jsx)(n.default,{style:{flexDirection:"row",gap:8},children:[5,10,25,50].map(e=>(0,D.jsx)(d.default,{style:{paddingHorizontal:12,paddingVertical:8,borderRadius:8,backgroundColor:fe===e?"#5d6b4a":"#fff",borderWidth:1,borderColor:"#e5e7eb"},onPress:()=>ge(e),children:(0,D.jsxs)(l.default,{style:{color:fe===e?"#fff":"#282E10",fontWeight:"600"},children:[e," km"]})},e))}),(0,D.jsx)(d.default,{onPress:ye,style:{marginLeft:"auto",paddingHorizontal:16,paddingVertical:10,backgroundColor:"#64748b",borderRadius:10},children:(0,D.jsx)(l.default,{style:{color:"#fff",fontWeight:"700"},children:"Search Nearby"})})]})]}):(0,D.jsxs)(n.default,{style:{flexDirection:"row",alignItems:"center",gap:12},children:[(0,D.jsx)(l.default,{style:{color:"#64748b"},children:ce?`${ce.latitude.toFixed(4)}, ${ce.longitude.toFixed(4)}`:"Using current location"}),(0,D.jsxs)(l.default,{style:{color:"#64748b"},children:[fe," km"]}),(0,D.jsx)(d.default,{onPress:ye,style:{marginLeft:"auto",paddingHorizontal:12,paddingVertical:8,backgroundColor:"#64748b",borderRadius:8},children:(0,D.jsx)(l.default,{style:{color:"#fff",fontWeight:"700"},children:"Search"})})]})]}),(0,D.jsx)(n.default,{style:B.default.categoryTrailsSection,children:M?(0,D.jsxs)(n.default,{style:B.default.loadingContainer,children:[(0,D.jsx)(s.default,{size:"large",color:"#2563eb"}),(0,D.jsx)(l.default,{style:B.default.loadingText,children:"Loading trails..."})]}):pe&&pe.length>0?pe.map(t=>{const a=ne(t.id),o=R(t.id);return(0,D.jsxs)(d.default,{style:B.default.largeTrailCard,onPress:()=>{return a=t.id,void e.push(`/trail/${a}`);var a},children:[t.photo?(0,D.jsx)(h.Image,{source:{uri:t.photo},style:B.default.largeTrailImage,contentFit:"cover",cachePolicy:"memory-disk"}):(0,D.jsx)(L.default,{coordinates:t.coordinates,path:t.path,style:B.default.largeTrailImage,startLatitude:t.startLatitude,startLongitude:t.startLongitude}),(0,D.jsx)(m.LinearGradient,{colors:["rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0.25)","rgba(0, 0, 0, 0.6)"],locations:[0,.3,.6,1],style:B.default.cardGradient}),(0,D.jsx)(d.default,{style:B.default.bookmarkButton,onPress:e=>{e.stopPropagation(),(async(e,t=!1)=>{if(!t&&!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))return void console.log("Cannot bookmark mock trail:",e);const a=ne(e),o=R(e);c.default.sequence([c.default.timing(a,{toValue:.6,duration:100,useNativeDriver:!0}),c.default.spring(a,{toValue:1,friction:3,tension:100,useNativeDriver:!0})]).start();try{o?await T(e):await C(e)}catch(r){console.error("Failed to toggle bookmark:",r)}})(t.id,!0)},children:(0,D.jsx)(c.default.View,{style:{transform:[{scale:a}]},children:(0,D.jsx)(x.default,{size:20,color:o?"#000":"#64748b",fill:o?"#000":"none",strokeWidth:2})})}),(0,D.jsxs)(n.default,{style:B.default.cardOverlayContent,children:[(0,D.jsx)(l.default,{style:B.default.overlayTrailName,children:t.name||`Trail ${new Date(t.date).toLocaleDateString()}`}),(0,D.jsx)(l.default,{style:B.default.overlayLocation,children:t.city?`${t.city}, ${t.country||"Unknown"}`:"Location unknown"}),(0,D.jsxs)(n.default,{style:B.default.overlayBadges,children:[t.difficulty&&(0,D.jsxs)(n.default,{style:B.default.badge,children:[(0,D.jsx)(p.default,{size:14,color:"#d4d4a0",strokeWidth:2.5}),(0,D.jsx)(l.default,{style:B.default.badgeText,children:t.difficulty})]}),(0,D.jsxs)(n.default,{style:B.default.badge,children:[(0,D.jsx)(P.default,{size:14,color:"#d4d4a0",strokeWidth:2.5}),(0,D.jsx)(l.default,{style:B.default.badgeText,children:(0,O.formatDistance)(t.distance)})]}),"number"===typeof t.distance_from_user&&(0,D.jsxs)(n.default,{style:B.default.badge,children:[(0,D.jsx)(P.default,{size:14,color:"#d4d4a0",strokeWidth:2.5}),(0,D.jsx)(l.default,{style:B.default.badgeText,children:(0,O.formatDistance)(t.distance_from_user)})]}),t.rating&&(0,D.jsxs)(n.default,{style:B.default.badge,children:[(0,D.jsx)(I.default,{size:14,color:"#fbbf24",fill:"#fbbf24",strokeWidth:2}),(0,D.jsx)(l.default,{style:B.default.badgeText,children:t.rating.toFixed(1)})]})]})]})]},t.id)}):(0,D.jsxs)(n.default,{style:B.default.emptyContainer,children:[(0,D.jsx)(P.default,{size:48,color:"#9ca3af"}),(0,D.jsx)(l.default,{style:B.default.emptyText,children:"No trails found nearby. Try a wider search or record a trail to share with others."})]})}),(0,D.jsx)(n.default,{style:B.default.bottomPadding})]}),(0,D.jsx)(f.default,{visible:J,animationType:"slide",presentationStyle:"fullScreen",onRequestClose:le,children:(0,D.jsxs)(n.default,{style:[B.default.searchModalContainer,{paddingTop:t.top}],children:[(0,D.jsxs)(n.default,{style:B.default.searchModalHeader,children:[(0,D.jsx)(d.default,{style:B.default.backButton,onPress:le,children:(0,D.jsx)(j.default,{size:24,color:"#5d6b4a"})}),(0,D.jsxs)(n.default,{style:B.default.searchModalInputContainer,children:[(0,D.jsx)(u.default,{style:B.default.searchModalInput,placeholder:"Find trails",placeholderTextColor:"#9ca3af",value:q,onChangeText:X,autoFocus:!0,returnKeyType:"search"}),q.length>0&&(0,D.jsx)(d.default,{style:B.default.clearButton,onPress:()=>X(""),children:(0,D.jsx)(v.default,{size:20,color:"#64748b"})})]})]}),(0,D.jsxs)(n.default,{style:B.default.searchModalContent,children:[""===q.trim()&&(0,D.jsxs)(d.default,{style:B.default.currentLocationItem,onPress:()=>{K(!1),X(""),ee([])},children:[(0,D.jsx)(n.default,{style:B.default.locationIconContainer,children:(0,D.jsx)(k.default,{size:20,color:"#5d6b4a"})}),(0,D.jsxs)(n.default,{style:B.default.locationTextContainer,children:[(0,D.jsx)(l.default,{style:B.default.locationTitle,children:"Current location"}),(0,D.jsx)(l.default,{style:B.default.locationSubtitle,children:Y})]})]}),Q.length>0&&(0,D.jsx)(g.default,{data:Q,keyExtractor:e=>e.id,renderItem:({item:t})=>(0,D.jsxs)(d.default,{style:B.default.suggestionItem,onPress:()=>{return a=t.id,K(!1),X(""),ee([]),void e.push(`/trail/${a}`);var a},children:[(0,D.jsx)(n.default,{style:B.default.suggestionIconContainer,children:(0,D.jsx)(P.default,{size:20,color:"#64748b"})}),(0,D.jsxs)(n.default,{style:B.default.suggestionTextContainer,children:[(0,D.jsx)(l.default,{style:B.default.suggestionTitle,children:t.name}),(0,D.jsx)(l.default,{style:B.default.suggestionSubtitle,children:t.location})]})]}),showsVerticalScrollIndicator:!1})]})]})})]})}},8415(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>N});var o=a(6665),r=a(3929),l=a(5648),n=a(1690),i=a(530),d=a(2772),s=a(6773),c=a(8264),u=a(5009),f=a(6283),g=a(5894),h=a(262),m=a(5938),y=a(3353),p=a(2598),x=a(9908),b=a(6746),j=a(3087),w=a(2994),C=a(9281),P=a(4522),k=a(1631),S=a(2081),I=a(1168),T=a(5082),v=a(6547),E=a(2964),_=a(9582),B=a(8833),O=a(8745),L=a(9637),A=a(9269),D=a(893),z=a(9600),R=a(397);const W=a(3229);function N(){const e=(0,y.useAuth)();if(!e)return(0,R.jsx)(r.default,{style:O.default.container,children:(0,R.jsx)(r.default,{style:O.default.loadingContainer,children:(0,R.jsx)(i.default,{size:"large",color:_.default.backgroundPrimary})})});const{user:t,signOut:a,session:N}=e,{userProfile:U,updateAccount:F,isLoading:M}=(0,p.useAccount)(),{dogProfile:V,isDogProfileLoading:G}=(0,x.useDogs)(),{trails:$,savedTrails:H,isLoading:q,saveTrailBookmark:X,removeTrailBookmark:J,isTrailSaved:K}=(0,b.useTrails)(),[Y,Z]=o.useState(!1),[Q,ee]=o.useState(!1),[te,ae]=o.useState(""),[oe,re]=o.useState(""),[le,ne]=o.useState(!1),[ie,de]=o.useState("created"),[se,ce]=o.useState({}),ue=(0,B.useSafeAreaInsets)(),fe=(0,L.useRouter)();o.useEffect(()=>{const e=U?.name||t?.email?.split("@")[0]||"",a=U?.image||W;ae(e),re(a)},[t,U]);const ge=$.length,he=$.reduce((e,t)=>e+(t.duration||0),0),me=$.reduce((e,t)=>e+t.distance,0),ye=e=>{de(e)},pe=e=>{if(!se[e]){const t=new u.default.Value(1);return ce(a=>Object.assign({},a,{[e]:t})),t}return se[e]},xe=()=>{fe.push("/onboarding/dog-basics")},be=()=>{ee(!1);const e=U?.name||t?.email?.split("@")[0]||"",a=U?.image||W;ae(e),re(a)},je="created"===ie?$:"saved"===ie?H:[];return(0,R.jsx)(r.default,{style:O.default.container,children:(0,R.jsxs)(d.default,{style:O.default.scrollContainer,contentContainerStyle:[O.default.content,{paddingTop:ue.top+16,paddingBottom:ue.bottom+20}],children:[(0,R.jsx)(r.default,{style:O.default.userSection,children:(0,R.jsxs)(r.default,{style:O.default.userHeader,children:[(0,R.jsx)(l.default,{style:O.default.userAvatar,onPress:()=>{ee(!0)},children:oe?(0,R.jsx)(g.Image,{source:oe,style:O.default.userAvatarImage,contentFit:"cover",cachePolicy:"memory-disk"}):(0,R.jsx)(r.default,{style:O.default.initialAvatar,children:(0,R.jsx)(f.default,{style:O.default.initialAvatarText,children:(te||U?.name||t?.email||"A").charAt(0).toUpperCase()})})}),(0,R.jsxs)(r.default,{style:O.default.userInfo,children:[(0,R.jsx)(f.default,{style:O.default.userName,children:U?.name||te||"Account Holder"}),(0,R.jsxs)(r.default,{style:O.default.userEmailRow,children:[(0,R.jsx)(S.default,{size:14,color:_.default.accentPrimary}),(0,R.jsx)(f.default,{style:O.default.userEmail,children:t?.email||"Not available"})]})]}),(0,R.jsx)(l.default,{style:O.default.settingsButton,onPress:()=>fe.push("/settings"),accessibilityLabel:"Open settings",children:(0,R.jsx)(v.default,{size:20,color:_.default.accentSecondary})})]})}),G?(0,R.jsx)(r.default,{style:O.default.dogCardContainer,children:(0,R.jsx)(r.default,{style:O.default.loadingDogCard,children:(0,R.jsx)(i.default,{size:"large",color:_.default.accentPrimary})})}):V?(0,R.jsx)(r.default,{style:O.default.dogCardContainer,children:(0,R.jsxs)(l.default,{style:O.default.dogCard,onPress:xe,children:[(0,R.jsx)(r.default,{style:O.default.dogPhotoContainer,children:V.image?(0,R.jsx)(g.Image,{source:V.image,style:O.default.dogPhoto,contentFit:"cover",cachePolicy:"memory-disk"}):(0,R.jsx)(r.default,{style:[O.default.dogPhoto,O.default.dogPhotoPlaceholder],children:(0,R.jsx)(P.default,{size:40,color:_.default.accentPrimary})})}),(0,R.jsx)(f.default,{style:O.default.dogName,children:V.name}),V.nickname&&(0,R.jsx)(f.default,{style:O.default.dogNickname,children:V.nickname}),!V.nickname&&(0,R.jsx)(r.default,{style:O.default.nicknameSpacing}),(0,R.jsxs)(r.default,{style:O.default.statsRow,children:[(0,R.jsxs)(r.default,{style:O.default.statItem,children:[(0,R.jsx)(f.default,{style:O.default.statValue,children:ge}),(0,R.jsx)(f.default,{style:O.default.statLabel,children:"Walks"})]}),(0,R.jsxs)(r.default,{style:O.default.statItem,children:[(0,R.jsx)(f.default,{style:O.default.statValue,children:(e=>{const t=Math.floor(e/3600),a=Math.floor(e%3600/60);return t>0?`${t}.${Math.floor(a/6)}h`:`${a}m`})(he)}),(0,R.jsx)(f.default,{style:O.default.statLabel,children:"Total Time"})]}),(0,R.jsxs)(r.default,{style:O.default.statItem,children:[(0,R.jsx)(f.default,{style:O.default.statValue,children:(0,A.formatDistance)(me)}),(0,R.jsx)(f.default,{style:O.default.statLabel,children:"Total Dist."})]})]})]})}):(0,R.jsx)(r.default,{style:O.default.dogCardContainer,children:(0,R.jsxs)(r.default,{style:O.default.noDogCard,children:[(0,R.jsx)(P.default,{size:48,color:_.default.textMuted}),(0,R.jsx)(f.default,{style:O.default.noDogText,children:"No dog profile yet"}),(0,R.jsx)(l.default,{style:O.default.addDogButton,onPress:xe,children:(0,R.jsx)(f.default,{style:O.default.addDogButtonText,children:"Add Dog Profile"})})]})}),(0,R.jsxs)(r.default,{style:O.default.tabsContainer,children:[(0,R.jsxs)(l.default,{style:[O.default.tab,"created"===ie&&O.default.tabActive],onPress:()=>ye("created"),children:[(0,R.jsx)(f.default,{style:[O.default.tabCount,"created"===ie&&O.default.tabCountActive],children:$.length}),(0,R.jsx)(f.default,{style:[O.default.tabText,"created"===ie&&O.default.tabTextActive],children:"Created"})]}),(0,R.jsxs)(l.default,{style:[O.default.tab,"saved"===ie&&O.default.tabActive],onPress:()=>ye("saved"),children:[(0,R.jsx)(f.default,{style:[O.default.tabCount,"saved"===ie&&O.default.tabCountActive],children:H.length}),(0,R.jsx)(f.default,{style:[O.default.tabText,"saved"===ie&&O.default.tabTextActive],children:"Saved"})]}),(0,R.jsxs)(l.default,{style:[O.default.tab,"reviews"===ie&&O.default.tabActive],onPress:()=>ye("reviews"),children:[(0,R.jsx)(f.default,{style:[O.default.tabCount,"reviews"===ie&&O.default.tabCountActive],children:"0"}),(0,R.jsx)(f.default,{style:[O.default.tabText,"reviews"===ie&&O.default.tabTextActive],children:"Reviews"})]})]}),(0,R.jsx)(r.default,{style:O.default.trailsSection,children:q?(0,R.jsx)(r.default,{style:O.default.loadingContainer,children:(0,R.jsx)(i.default,{size:"large",color:_.default.backgroundPrimary})}):je.length>0?je.map(e=>{const t=pe(e.id),a=K(e.id);return(0,R.jsxs)(l.default,{style:O.default.trailCard,onPress:()=>{return t=e.id,void fe.push(`/trail/${t}`);var t},children:[e.photo?(0,R.jsx)(g.Image,{source:{uri:e.photo},style:O.default.trailImage}):(0,R.jsx)(z.default,{coordinates:e.coordinates,path:e.path,style:O.default.trailImage,startLatitude:e.startLatitude,startLongitude:e.startLongitude}),(0,R.jsx)(D.LinearGradient,{colors:["rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0.25)","rgba(0, 0, 0, 0.6)"],locations:[0,.3,.6,1],style:O.default.trailGradient}),(0,R.jsx)(l.default,{style:O.default.bookmarkButton,onPress:t=>{t.stopPropagation(),(async e=>{const t=pe(e),a=K(e);u.default.sequence([u.default.timing(t,{toValue:.6,duration:100,useNativeDriver:!0}),u.default.spring(t,{toValue:1,friction:3,tension:100,useNativeDriver:!0})]).start();try{a?await J(e):await X(e)}catch(o){console.error("Failed to toggle bookmark:",o)}})(e.id)},children:(0,R.jsx)(u.default.View,{style:{transform:[{scale:t}]},children:(0,R.jsx)(w.default,{size:20,color:a?"#000":_.default.textMuted,fill:a?"#000":"none",strokeWidth:2})})}),(0,R.jsxs)(r.default,{style:O.default.trailContent,children:[(0,R.jsx)(f.default,{style:O.default.trailName,children:e.name||`Trail ${new Date(e.date).toLocaleDateString()}`}),(0,R.jsx)(f.default,{style:O.default.trailLocation,children:e.city?`${e.city}, ${e.country||"Unknown"}`:"Location unknown"}),(0,R.jsxs)(r.default,{style:O.default.trailBadges,children:[e.difficulty&&(0,R.jsxs)(r.default,{style:O.default.trailBadge,children:[(0,R.jsx)(j.default,{size:14,color:_.default.accentPrimary,strokeWidth:2.5}),(0,R.jsx)(f.default,{style:O.default.trailBadgeText,children:e.difficulty})]}),(0,R.jsxs)(r.default,{style:O.default.trailBadge,children:[(0,R.jsx)(I.default,{size:14,color:_.default.accentPrimary,strokeWidth:2.5}),(0,R.jsx)(f.default,{style:O.default.trailBadgeText,children:(0,A.formatDistance)(e.distance)})]}),e.rating&&(0,R.jsxs)(r.default,{style:O.default.trailBadge,children:[(0,R.jsx)(T.default,{size:14,color:_.default.accentPrimary,fill:_.default.accentPrimary,strokeWidth:2}),(0,R.jsx)(f.default,{style:O.default.trailBadgeText,children:e.rating.toFixed(1)})]})]})]})]},e.id)}):(0,R.jsxs)(r.default,{style:O.default.emptyContainer,children:[(0,R.jsx)(I.default,{size:48,color:_.default.textMuted}),(0,R.jsx)(f.default,{style:O.default.emptyText,children:"created"===ie?"No trails created yet":"saved"===ie?"No trails saved yet":"No reviews yet"})]})}),(0,R.jsx)(l.default,{style:[O.default.signOutButton,Y&&O.default.signOutButtonDisabled],onPress:async()=>{n.default.alert("Sign Out","Are you sure you want to sign out?",[{text:"Cancel",style:"cancel"},{text:"Sign Out",style:"destructive",onPress:async()=>{Z(!0);try{await a()}catch(e){0,n.default.alert("Error",e.message||"Failed to sign out")}finally{Z(!1)}}}])},disabled:Y,children:Y?(0,R.jsx)(i.default,{color:_.default.backgroundPrimary}):(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(k.default,{size:20,color:_.default.backgroundPrimary}),(0,R.jsx)(f.default,{style:O.default.signOutText,children:"Sign Out"})]})}),(0,R.jsx)(c.default,{visible:Q,animationType:"slide",presentationStyle:"pageSheet",onRequestClose:be,children:(0,R.jsxs)(r.default,{style:O.default.modalContainer,children:[(0,R.jsxs)(r.default,{style:[O.default.modalHeader,{paddingTop:ue.top+20}],children:[(0,R.jsx)(f.default,{style:O.default.modalTitle,children:"Edit Profile"}),(0,R.jsx)(l.default,{style:O.default.closeButton,onPress:be,children:(0,R.jsx)(E.default,{size:24,color:_.default.backgroundPrimary})})]}),(0,R.jsxs)(d.default,{style:O.default.modalContent,children:[(0,R.jsxs)(r.default,{style:O.default.photoSection,children:[(0,R.jsxs)(l.default,{style:O.default.photoContainer,onPress:async()=>{const{status:e}=await h.requestMediaLibraryPermissionsAsync();if("granted"!==e)return void n.default.alert("Permission needed","Please allow access to your photo library");const t=await h.launchImageLibraryAsync({mediaTypes:["images"],allowsEditing:!0,aspect:[1,1],quality:.8});!t.canceled&&t.assets[0]&&re(t.assets[0].uri)},children:[oe?(0,R.jsx)(g.Image,{source:oe,style:O.default.editPhoto,contentFit:"cover",cachePolicy:"memory-disk"}):(0,R.jsx)(r.default,{style:[O.default.editPhoto,O.default.initialAvatar],children:(0,R.jsx)(f.default,{style:O.default.initialAvatarText,children:(te||U?.name||t?.email||"A").charAt(0).toUpperCase()})}),(0,R.jsx)(r.default,{style:O.default.cameraOverlay,children:(0,R.jsx)(C.default,{size:24,color:_.default.accentPrimary})})]}),(0,R.jsx)(f.default,{style:O.default.photoHint,children:"Tap to change photo"})]}),(0,R.jsxs)(r.default,{style:O.default.inputSection,children:[(0,R.jsx)(f.default,{style:O.default.inputLabel,children:"Name"}),(0,R.jsx)(s.default,{style:O.default.input,value:te,onChangeText:ae,placeholder:"Enter your name",placeholderTextColor:_.default.textMuted})]}),(0,R.jsxs)(r.default,{style:O.default.inputSection,children:[(0,R.jsx)(f.default,{style:O.default.inputLabel,children:"Email"}),(0,R.jsx)(r.default,{style:O.default.disabledInput,children:(0,R.jsx)(f.default,{style:O.default.disabledInputText,children:t?.email})}),(0,R.jsx)(f.default,{style:O.default.inputHint,children:"Email cannot be changed"})]})]}),(0,R.jsx)(r.default,{style:[O.default.modalFooter,{paddingBottom:ue.bottom+20}],children:(0,R.jsx)(l.default,{style:[O.default.saveButton,le&&O.default.saveButtonDisabled],onPress:async()=>{if(te.trim()){ne(!0);try{let e;if("string"===typeof oe&&oe&&!oe.startsWith("http")){if(!N?.accessToken||!t?.id)throw new Error("No active session for upload");const a=new FormData,o=oe.split("/"),r=o[o.length-1]||`photo_${Date.now()}.jpg`,l=r.match(/\.([a-zA-Z0-9]+)(?:\?.*)?$/),n="png"===(l?l[1].toLowerCase():"jpg")?"image/png":"image/jpeg";a.append("file",{uri:oe,name:r,type:n}),a.append("filename",r),a.append("dog_id",""),a.append("trail_id",""),a.append("user_id",t.id);const i=await fetch(`${m.API_URL}/uploads`,{method:"POST",headers:{Authorization:`Bearer ${N.accessToken}`,accept:"application/json"},body:a});if(!i.ok){const e=await i.text();throw new Error(`Upload failed: ${i.status} ${e}`)}const d=await i.json();if(e=d.public_url||d.publicUrl||d.url,!e)throw new Error("Upload did not return a public URL")}else"string"===typeof oe&&oe.startsWith("http")&&(e=oe);await F({name:te.trim(),image:e}),ee(!1),n.default.alert("Success","Profile updated successfully!")}catch(e){console.error("Failed to save profile:",e),n.default.alert("Error",e?.message||"Failed to update profile")}finally{ne(!1)}}else n.default.alert("Error","Name cannot be empty")},disabled:le,children:le?(0,R.jsx)(i.default,{color:_.default.accentPrimary}):(0,R.jsx)(f.default,{style:O.default.saveButtonText,children:"Save Changes"})})})]})})]})})}},8506(e){function t(){throw new Error("@react-native-firebase is not available in web builds.")}e.exports=t,e.exports.default=t},8625(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>l});var o=a(3668),r=a(9582);const l=o.default.create({container:{flex:1,backgroundColor:r.default.backgroundSecondaryVarient},scrollView:{flex:1},content:{padding:24},header:{marginBottom:32,alignItems:"center"},title:{fontSize:28,fontWeight:"700",color:r.default.accentPrimary,marginBottom:8,textAlign:"center"},subtitle:{fontSize:16,color:r.default.accentPrimary,textAlign:"center",marginBottom:24},progressContainer:{flexDirection:"row",gap:8},progressDot:{width:8,height:8,borderRadius:4,backgroundColor:"#3d4520"},progressDotActive:{backgroundColor:r.default.accentPrimary},tagsContainer:{flexDirection:"row",flexWrap:"wrap",gap:12},tag:{paddingHorizontal:20,paddingVertical:12,borderRadius:24,backgroundColor:"#282E10",borderWidth:1.5,borderColor:"#3d4520"},tagSelected:{backgroundColor:"rgba(255, 254, 119, 0.15)",borderColor:r.default.accentPrimary},tagText:{fontSize:15,fontWeight:"500",color:r.default.accentPrimary},tagTextSelected:{color:r.default.accentPrimary,fontWeight:"600"},sectionHeader:{marginTop:32,marginBottom:16},sectionTitle:{fontSize:24,fontWeight:"700",color:r.default.accentPrimary},section:{marginBottom:24},label:{fontSize:17,fontWeight:"600",color:r.default.accentPrimary,marginBottom:4},helperText:{fontSize:14,color:r.default.accentPrimary,marginBottom:12},recallContainer:{flexDirection:"row",gap:8},recallOption:{flex:1,paddingVertical:12,paddingHorizontal:16,borderRadius:12,backgroundColor:"#282E10",borderWidth:1.5,borderColor:"#3d4520",alignItems:"center"},recallOptionSelected:{backgroundColor:"rgba(255, 254, 119, 0.15)",borderColor:r.default.accentPrimary},recallText:{fontSize:14,fontWeight:"500",color:r.default.accentPrimary},recallTextSelected:{color:r.default.accentPrimary,fontWeight:"600"},footer:{flexDirection:"row",gap:12,paddingHorizontal:24,paddingTop:20,borderTopWidth:1,borderTopColor:"#3d4520",backgroundColor:"#282E10"},backButton:{flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center",gap:8,backgroundColor:"transparent",borderRadius:12,padding:18,borderWidth:1.5,borderColor:r.default.accentPrimary},backButtonText:{fontSize:17,fontWeight:"600",color:r.default.accentPrimary},finishButton:{flex:1,backgroundColor:r.default.accentPrimary,borderRadius:12,padding:18,alignItems:"center",justifyContent:"center"},finishButtonDisabled:{opacity:.6},finishButtonText:{fontSize:17,fontWeight:"600",color:"#1a1f0a"}})},8627(e,t,a){a(6665);function o(e){return null}e.exports=o,e.exports.default=o},8745(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>l});var o=a(3668),r=a(9582);const l=o.default.create({container:{flex:1,backgroundColor:r.default.backgroundPrimary},scrollContainer:{flex:1},content:{paddingHorizontal:16},settingsButton:{width:40,height:40,borderRadius:20,backgroundColor:r.default.backgroundPrimary,justifyContent:"center",alignItems:"center"},userSection:{marginBottom:24},userHeader:{flexDirection:"row",alignItems:"center"},userAvatar:{width:48,height:48,borderRadius:24,overflow:"hidden",backgroundColor:r.default.accentPrimary,borderWidth:2,borderColor:r.default.backgroundPrimary},userAvatarImage:{width:"100%",height:"100%"},userInfo:{marginLeft:12,flex:1},userName:{fontSize:20,fontWeight:"700",color:r.default.accentPrimary,marginBottom:2},userEmailRow:{flexDirection:"row",alignItems:"center",gap:6},userEmail:{fontSize:14,color:r.default.accentPrimary,opacity:.8,marginLeft:6},dogCardContainer:{marginBottom:24},dogCard:{backgroundColor:r.default.backgroundSecondary,borderRadius:24,padding:24,alignItems:"center",borderWidth:0,borderColor:r.default.backgroundPrimary},dogPhotoContainer:{marginBottom:16},dogPhoto:{width:100,height:100,borderRadius:50,backgroundColor:r.default.backgroundSecondaryVarient,borderWidth:0,borderColor:r.default.accentPrimary},dogPhotoPlaceholder:{justifyContent:"center",alignItems:"center"},dogName:{fontSize:22,fontWeight:"700",color:r.default.accentPrimary,marginBottom:4},dogNickname:{fontSize:14,color:r.default.textMuted,opacity:.9,marginBottom:16},nicknameSpacing:{height:16},statsRow:{flexDirection:"row",justifyContent:"space-around",width:"100%",marginBottom:20},statItem:{alignItems:"center"},statValue:{fontSize:24,fontWeight:"700",color:r.default.accentPrimary,marginBottom:4},statLabel:{fontSize:13,color:r.default.textSecondary,opacity:.8},dogInfoRow:{flexDirection:"row",gap:12},dogInfoBadge:{backgroundColor:"rgba(255, 255, 255, 0.2)",paddingHorizontal:16,paddingVertical:8,borderRadius:16},dogInfoText:{fontSize:14,color:r.default.textPrimary,fontWeight:"500"},loadingDogCard:{backgroundColor:r.default.textPrimary,borderRadius:24,padding:48,alignItems:"center",justifyContent:"center",borderWidth:1,borderColor:r.default.backgroundPrimary},noDogCard:{backgroundColor:r.default.textPrimary,borderRadius:24,padding:32,alignItems:"center",gap:12,borderWidth:1,borderColor:r.default.backgroundPrimary},noDogText:{fontSize:16,color:r.default.accentPrimary,opacity:.9,textAlign:"center"},addDogButton:{backgroundColor:r.default.backgroundPrimary,paddingHorizontal:20,paddingVertical:12,borderRadius:12,marginTop:8},addDogButtonText:{fontSize:15,fontWeight:"600",color:r.default.textPrimary},tabsContainer:{flexDirection:"row",marginBottom:20,gap:12},tab:{flex:1,backgroundColor:r.default.backgroundSecondary,paddingVertical:16,paddingHorizontal:16,borderRadius:16,alignItems:"center",borderWidth:0},tabActive:{backgroundColor:r.default.accentPrimary},tabText:{fontSize:14,fontWeight:"600",color:r.default.textMuted},tabTextActive:{color:r.default.backgroundSecondary},tabCount:{fontSize:24,fontWeight:"700",color:r.default.accentPrimary,marginBottom:4},tabCountActive:{color:r.default.backgroundPrimary},trailsSection:{marginBottom:24},trailCard:{backgroundColor:r.default.textPrimary,borderRadius:24,overflow:"hidden",marginBottom:20,shadowColor:r.default.backgroundSecondaryVarient,shadowOffset:{width:0,height:4},shadowOpacity:.1,shadowRadius:16,elevation:4,position:"relative"},trailImage:{width:"100%",height:260,backgroundColor:r.default.backgroundSecondary},loadingContainer:{paddingVertical:40,alignItems:"center",justifyContent:"center"},trailGradient:{position:"absolute",left:0,right:0,bottom:0,height:120},bookmarkButton:{position:"absolute",top:12,right:12,width:44,height:44,borderRadius:22,backgroundColor:"rgba(255,255,255,0.95)",justifyContent:"center",alignItems:"center",borderWidth:1,borderColor:r.default.backgroundSecondary},trailContent:{position:"absolute",left:12,right:12,bottom:12,padding:12},trailName:{fontSize:18,fontWeight:"700",color:r.default.textPrimary,marginBottom:4},trailLocation:{fontSize:13,color:r.default.textPrimary,opacity:.95},trailBadges:{flexDirection:"row",gap:8,marginTop:8},trailBadge:{flexDirection:"row",alignItems:"center",gap:6,backgroundColor:"rgba(255,255,255,0.08)",paddingHorizontal:8,paddingVertical:6,borderRadius:12},trailBadgeText:{fontSize:13,color:r.default.textPrimary},emptyText:{fontSize:16,color:r.default.backgroundPrimary,opacity:.7,textAlign:"center",lineHeight:24},emptyContainer:{alignItems:"center",justifyContent:"center",padding:40},signOutButton:{flexDirection:"row",alignItems:"center",justifyContent:"center",gap:12,backgroundColor:r.default.accentPrimary,borderRadius:12,padding:16,marginTop:16,borderWidth:1,borderColor:r.default.accentPrimary},signOutButtonDisabled:{opacity:.6},signOutText:{fontSize:16,fontWeight:"600",color:r.default.backgroundPrimary},modalContainer:{flex:1,backgroundColor:r.default.backgroundPrimary},modalHeader:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:20,paddingBottom:20,backgroundColor:r.default.backgroundPrimary,borderBottomWidth:1,borderBottomColor:r.default.accentPrimary},modalTitle:{fontSize:24,fontWeight:"700",color:r.default.textPrimary},closeButton:{width:40,height:40,borderRadius:20,backgroundColor:r.default.accentPrimary,justifyContent:"center",alignItems:"center"},inputLabel:{fontSize:15,fontWeight:"600",color:r.default.backgroundPrimary,marginBottom:8},input:{backgroundColor:r.default.backgroundPrimary,borderRadius:12,padding:16,fontSize:16,color:r.default.textPrimary,borderWidth:1,borderColor:r.default.accentPrimary},initialAvatar:{width:"100%",height:"100%",backgroundColor:r.default.accentPrimary,justifyContent:"center",alignItems:"center"},initialAvatarText:{fontSize:36,fontWeight:"700",color:r.default.textPrimary},modalContent:{paddingHorizontal:16,paddingTop:16,paddingBottom:80},photoSection:{alignItems:"center",marginBottom:20},photoContainer:{width:120,height:120,borderRadius:60,overflow:"hidden",justifyContent:"center",alignItems:"center",backgroundColor:r.default.accentPrimary,borderWidth:3,borderColor:r.default.backgroundPrimary},editPhoto:{width:"100%",height:"100%"},cameraOverlay:{position:"absolute",right:8,bottom:8,width:36,height:36,borderRadius:18,backgroundColor:r.default.backgroundPrimary+"22",justifyContent:"center",alignItems:"center"},photoHint:{fontSize:13,color:r.default.textMuted,marginTop:8},inputSection:{marginBottom:16},disabledInput:{backgroundColor:r.default.backgroundPrimary,borderRadius:12,padding:12,borderWidth:1,borderColor:r.default.accentPrimary},disabledInputText:{fontSize:15,color:r.default.backgroundPrimary,opacity:.8},inputHint:{fontSize:12,color:r.default.textMuted,marginTop:6},modalFooter:{paddingHorizontal:16,paddingTop:12,borderTopWidth:1,borderTopColor:r.default.accentPrimary,backgroundColor:r.default.backgroundPrimary},saveButton:{backgroundColor:r.default.backgroundPrimary,paddingVertical:14,borderRadius:12,alignItems:"center",justifyContent:"center"},saveButtonDisabled:{opacity:.6},saveButtonText:{fontSize:16,fontWeight:"700",color:r.default.textPrimary}})},8776(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>l});var o=a(3668),r=a(9582);const l=o.default.create({container:{flex:1,backgroundColor:r.default.backgroundPrimary},headerButtons:{position:"absolute",left:0,right:0,zIndex:100,flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingHorizontal:16},headerButton:{width:44,height:44,borderRadius:22,backgroundColor:r.default.textPrimary,justifyContent:"center",alignItems:"center",shadowColor:r.default.backgroundSecondaryVarient,shadowOffset:{width:0,height:2},shadowOpacity:.15,shadowRadius:4,elevation:4},headerRightButtons:{flexDirection:"row",gap:12},scrollContainer:{flex:1},scrollContent:{paddingBottom:32},loadingContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:r.default.backgroundPrimary},loadingText:{marginTop:16,fontSize:16,color:r.default.accentPrimary,fontWeight:"500"},heroSection:{position:"relative"},heroImageContainer:{width:"100%",height:500,position:"relative"},heroImage:{width:"100%",height:"100%",backgroundColor:r.default.borderSubtle},heroGradient:{position:"absolute",bottom:0,left:0,right:0,height:100},changePhotoFab:{position:"absolute",bottom:80,right:20,width:56,height:56,borderRadius:28,backgroundColor:r.default.backgroundPrimary,justifyContent:"center",alignItems:"center",shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:8,elevation:6},addPhotoContainer:{width:"100%",height:280,backgroundColor:r.default.accentPrimary,justifyContent:"center",alignItems:"center",paddingHorizontal:32},addPhotoIcon:{width:72,height:72,borderRadius:36,backgroundColor:r.default.backgroundPrimary,justifyContent:"center",alignItems:"center",marginBottom:16},addPhotoText:{fontSize:18,fontWeight:"600",color:r.default.textPrimary,marginBottom:4},addPhotoSubtext:{fontSize:14,color:r.default.backgroundSecondary},contentWrapper:{backgroundColor:r.default.backgroundPrimary,borderTopLeftRadius:24,borderTopRightRadius:24,marginTop:-24,zIndex:10},content:{padding:24},titleSection:{marginBottom:20},titleRow:{flexDirection:"row",alignItems:"flex-start",gap:12,marginBottom:8},title:{flex:1,fontSize:32,fontWeight:"700",color:r.default.textPrimary,lineHeight:40},editIconButton:{width:40,height:40,borderRadius:20,backgroundColor:r.default.accentPrimary,justifyContent:"center",alignItems:"center",marginTop:4},nameEditContainer:{marginBottom:8},nameInput:{fontSize:28,fontWeight:"700",color:r.default.textPrimary,backgroundColor:r.default.textPrimary,borderWidth:2,borderColor:r.default.backgroundPrimary,borderRadius:12,padding:12,marginBottom:12},nameInputInDetails:{fontSize:16,color:r.default.textPrimary,backgroundColor:r.default.backgroundPrimary,borderWidth:1,borderColor:r.default.accentPrimary,borderRadius:12,padding:16},editButtons:{flexDirection:"row",gap:8},iconButton:{width:44,height:44,borderRadius:22,justifyContent:"center",alignItems:"center"},saveIconButton:{backgroundColor:r.default.backgroundPrimary},cancelIconButton:{backgroundColor:r.default.accentPrimary},locationRow:{flexDirection:"row",alignItems:"center",gap:6,marginBottom:12},location:{fontSize:16,color:r.default.backgroundSecondary,fontWeight:"500"},ratingRow:{flexDirection:"row",gap:4},reviewCard:{backgroundColor:r.default.backgroundSecondary,borderRadius:16,padding:20,marginBottom:24,borderWidth:1,borderColor:r.default.borderSubtle},reviewText:{fontSize:16,color:r.default.backgroundPrimary,lineHeight:24},statsSection:{flexDirection:"row",flexWrap:"wrap",gap:12,marginBottom:24},statCard:{flex:1,minWidth:100,backgroundColor:r.default.backgroundSecondary,borderRadius:16,padding:16,alignItems:"center",shadowColor:r.default.backgroundSecondaryVarient,shadowOffset:{width:0,height:2},shadowOpacity:.05,shadowRadius:8,elevation:2},statIconContainer:{width:44,height:44,borderRadius:22,backgroundColor:r.default.backgroundPrimary,justifyContent:"center",alignItems:"center",marginBottom:12},statLabel:{fontSize:13,color:r.default.backgroundSecondary,fontWeight:"500",marginBottom:4},statValue:{fontSize:20,color:r.default.backgroundPrimary,fontWeight:"700"},tagsSection:{backgroundColor:r.default.backgroundSecondary,borderRadius:16,padding:20,marginBottom:20,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.05,shadowRadius:8,elevation:2},sectionHeader:{flexDirection:"row",alignItems:"center",gap:8,marginBottom:16},sectionTitle:{fontSize:18,fontWeight:"700",color:r.default.backgroundPrimary},tagsGrid:{flexDirection:"row",flexWrap:"wrap",gap:8},tagChip:{backgroundColor:r.default.backgroundPrimary,paddingHorizontal:16,paddingVertical:8,borderRadius:20},tagText:{fontSize:14,fontWeight:"500",color:r.default.backgroundSecondary},editDetailsButton:{flexDirection:"row",alignItems:"center",justifyContent:"center",gap:8,backgroundColor:r.default.textPrimary,borderRadius:12,paddingVertical:14,paddingHorizontal:20,marginBottom:20,borderWidth:2,borderColor:r.default.backgroundPrimary},editDetailsText:{fontSize:16,fontWeight:"600",color:r.default.backgroundPrimary},editSection:{backgroundColor:r.default.backgroundSecondary,borderRadius:16,padding:20,marginBottom:20,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.05,shadowRadius:8,elevation:2},editSectionTitle:{fontSize:16,fontWeight:"700",color:r.default.textPrimary,marginBottom:12},ratingStars:{flexDirection:"row",gap:8},starButton:{padding:4},reviewInput:{backgroundColor:r.default.backgroundPrimary,borderWidth:1,borderColor:r.default.accentPrimary,borderRadius:12,padding:16,fontSize:15,color:r.default.textPrimary,minHeight:120},difficultyOptions:{flexDirection:"row",gap:8},difficultyChip:{flex:1,paddingVertical:12,paddingHorizontal:16,borderRadius:12,backgroundColor:r.default.backgroundPrimary,borderWidth:2,borderColor:r.default.accentPrimary,alignItems:"center"},difficultyChipSelected:{backgroundColor:r.default.backgroundPrimary,borderColor:r.default.backgroundPrimary},difficultyChipText:{fontSize:15,fontWeight:"600",color:r.default.backgroundSecondary},difficultyChipTextSelected:{color:r.default.textPrimary},editTagChip:{paddingHorizontal:16,paddingVertical:8,borderRadius:20,backgroundColor:r.default.backgroundPrimary,borderWidth:1.5,borderColor:r.default.accentPrimary},editTagChipSelected:{backgroundColor:r.default.backgroundPrimary,borderColor:r.default.backgroundPrimary},editTagChipText:{fontSize:14,fontWeight:"500",color:r.default.backgroundSecondary},editTagChipTextSelected:{color:r.default.textPrimary},editActionButtons:{flexDirection:"row",gap:12,marginTop:24},actionButton:{flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center",gap:8,paddingVertical:14,borderRadius:12},cancelActionButton:{backgroundColor:r.default.backgroundPrimary,borderWidth:2,borderColor:r.default.accentPrimary},cancelActionText:{fontSize:16,fontWeight:"600",color:r.default.textPrimary},saveActionButton:{backgroundColor:r.default.backgroundPrimary},saveActionText:{fontSize:16,fontWeight:"600",color:r.default.textPrimary},mapSection:{marginBottom:20},mapContainer:{height:260,borderRadius:16,overflow:"hidden",marginBottom:12,borderWidth:1,borderColor:r.default.accentPrimary},map:{width:"100%",height:"100%"},webMapPlaceholder:{justifyContent:"center",alignItems:"center",backgroundColor:r.default.accentPrimary},webMapText:{marginTop:12,fontSize:14,color:r.default.backgroundSecondary},directionsButton:{flexDirection:"row",alignItems:"center",justifyContent:"center",backgroundColor:r.default.backgroundPrimary,borderRadius:12,paddingVertical:16,paddingHorizontal:24,gap:10,shadowColor:r.default.backgroundPrimary,shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:8,elevation:4},directionsButtonText:{fontSize:16,fontWeight:"700",color:r.default.textPrimary},detailsSection:{backgroundColor:r.default.backgroundSecondary,borderRadius:16,padding:20,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.05,shadowRadius:8,elevation:2},detailsTitle:{fontSize:18,fontWeight:"700",color:r.default.backgroundPrimary,marginBottom:16},detailRow:{flexDirection:"row",alignItems:"flex-start",paddingVertical:12,borderBottomWidth:1,borderBottomColor:r.default.backgroundPrimary},detailIcon:{width:36,height:36,borderRadius:18,backgroundColor:r.default.accentPrimary,justifyContent:"center",alignItems:"center",marginRight:12},detailContent:{flex:1},detailLabel:{fontSize:13,fontWeight:"600",color:r.default.backgroundSecondary,marginBottom:2},detailValue:{fontSize:16,color:r.default.backgroundPrimary,fontWeight:"500"}})},8973(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>d});var o=a(9637),r=(a(6665),a(3929)),l=a(6283),n=a(3668),i=a(397);function d(){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.Stack.Screen,{options:{title:"Oops!"}}),(0,i.jsxs)(r.default,{style:s.container,children:[(0,i.jsx)(l.default,{style:s.title,children:"This screen doesn't exist."}),(0,i.jsx)(o.Link,{href:"/",asChild:!0,style:s.link,children:(0,i.jsx)(l.default,{style:s.linkText,children:"Go to home screen!"})})]})]})}const s=n.default.create({container:{flex:1,alignItems:"center",justifyContent:"center",padding:20},title:{fontSize:20,fontWeight:"bold"},link:{marginTop:15,paddingVertical:15},linkText:{fontSize:14,color:"#2e78b7"}})},9269(e,t,a){"use strict";function o(e,t){const a=r(t.latitude-e.latitude),o=r(t.longitude-e.longitude),l=r(e.latitude),n=r(t.latitude),i=Math.sin(a/2)*Math.sin(a/2)+Math.sin(o/2)*Math.sin(o/2)*Math.cos(l)*Math.cos(n);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))}function r(e){return e*Math.PI/180}function l(e){if(e.length<2)return 0;let t=0;for(let a=0;a<e.length-1;a++){t+=o(e[a],e[a+1])}return 1e3*t}function n(e){if(e<1e3)return`${Math.round(e)}m`;return`${(e/1e3).toFixed(2)}km`}function i(e){const t=Math.floor(e/3600),a=Math.floor(e%3600/60),o=e%60;return t>0?`${t}h ${a}m`:a>0?`${a}m ${o}s`:`${o}s`}function d(e){const t=new Date(e),a=new Date,o=Math.floor((a.getTime()-t.getTime())/864e5);return 0===o?`Today at ${t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`:1===o?`Yesterday at ${t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`:t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}a.r(t),a.d(t,{calculateDistance:()=>o,calculateTotalDistance:()=>l,formatDate:()=>d,formatDistance:()=>n,formatDuration:()=>i})},9582(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>l,theme:()=>r});const o={backgroundPrimary:"#191E07",backgroundSecondary:"#272F0A",backgroundSecondaryVarient:"#3E481B",accentPrimary:"#FFFE77",accentSecondary:"#D4FF5E",textPrimary:"#FFFFFF",textSecondary:"#BEC056",textMuted:"#A0A883",borderSubtle:"#343A20"},r=o,l=o},9600(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>u});var o=a(6665),r=a(6283),l=a(3929),n=a(3668),i=a(9582);const d=n.default.create({container:{overflow:"hidden",borderRadius:12,backgroundColor:i.default.backgroundSecondary},map:{width:"100%",height:"100%"},placeholder:{justifyContent:"center",alignItems:"center",padding:12},text:{color:i.default.backgroundPrimary,fontWeight:"bold",fontSize:16},subtext:{color:i.default.textMuted,fontSize:12,marginTop:4}});var s=a(7042),c=(a(1051),a(397));function u({coordinates:e,path:t,style:a,height:n=260,startLatitude:i=null,startLongitude:u=null}){const f=(0,o.useRef)(null),g=(0,o.useRef)(null),h=(0,o.useRef)(null),m=e&&e.length>0?e:Array.isArray(t)?t.map(e=>({latitude:e[1],longitude:e[0]})):[];return(0,o.useEffect)(()=>{if(!f.current)return;const e=null!=i&&null!=u?[u,i]:m.length>0?[m[0].longitude,m[0].latitude]:[0,0],t=new s.Map({container:f.current,style:"https://api.tailtrails.club/map/style.json",center:e,zoom:m.length>0?12:1,interactive:!1});return g.current=t,t.on("load",()=>{if(m&&m.length>1){const e={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:m.map(e=>[e.longitude,e.latitude])}};t.getSource("preview-route")?t.getSource("preview-route").setData(e):(t.addSource("preview-route",{type:"geojson",data:e}),t.addLayer({id:"preview-route",type:"line",source:"preview-route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#5d6b4a","line-width":3}}));const a=new s.LngLatBounds;m.forEach(e=>a.extend([e.longitude,e.latitude])),t.fitBounds(a,{padding:10,maxZoom:16})}else if(m&&1===m.length){const e=m[0];if(h.current)h.current.setLngLat([e.longitude,e.latitude]);else{const a=new s.Marker({color:"#5d6b4a"}).setLngLat([e.longitude,e.latitude]).addTo(t);h.current=a}t.setCenter([e.longitude,e.latitude]),t.setZoom(14)}}),()=>{try{t.remove()}catch(e){}g.current=null,h.current=null}},[JSON.stringify(m),i,u]),(0,c.jsx)(l.default,{style:[d.container,a],children:m&&m.length>0?(0,c.jsx)("div",{ref:f,style:{width:"100%",height:"number"===typeof n?`${n}px`:n}}):(0,c.jsxs)(l.default,{style:d.placeholder,children:[(0,c.jsx)(r.default,{style:d.text,children:"Map Preview (Web)"}),(0,c.jsxs)(r.default,{style:d.subtext,children:[m?.length||0," points recorded"]})]})})}},9908(e,t,a){"use strict";a.r(t),a.d(t,{DogsContext:()=>i,useDogs:()=>d});var o=a(6665),r=a(2790),l=a(3353),n=a(5938);const[i,d]=(0,r.default)(()=>{const{user:e,session:t,isLoading:a}=(0,l.useAuth)(),[r,i]=(0,o.useState)([]),[d,s]=(0,o.useState)(null),[c,u]=(0,o.useState)(!0),f=(0,o.useMemo)(()=>r.find(e=>e.id===d)||r[0]||null,[r,d]),g=(0,o.useCallback)(async(e,t)=>{console.log("Loading dog profiles for user:",e),u(!0);try{const e=await fetch(`${n.API_URL}/dog`,{headers:{Authorization:`Bearer ${t}`}});if(e.ok){const t=await e.json();Array.isArray(t)?(i(t),t.length>0&&!d&&s(t[0].id)):t&&"object"===typeof t?(i([t]),s(t.id)):i([])}else i([])}catch(a){console.error("Error loading dog profiles:",a),i([])}finally{u(!1)}},[d]),h=(0,o.useCallback)(async()=>{e&&t&&await g(e.id,t.accessToken)},[e,t,g]);(0,o.useEffect)(()=>{a||(e&&t?g(e.id,t.accessToken):(i([]),u(!1)))},[e,t,g,a]);const m=(0,o.useCallback)(async e=>{if(!t)throw new Error("No session");let a=Object.assign({},e);a.photo&&delete a.photo;const o="string"===typeof e.image&&e.image&&!e.image.startsWith("http");o&&(a.image=void 0),console.log("createDogProfile - payload to create:",a);const r=await fetch(`${n.API_URL}/dog`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.accessToken}`},body:JSON.stringify(a)});if(!r.ok){const e=await r.json();throw new Error(e.detail?.[0]?.msg||"Failed to create dog profile")}const l=await r.json();if(i(e=>[...e,l]),s(l.id),o&&"string"===typeof e.image)try{const a=e.image,o=a.split("/"),r=o[o.length-1]||`dog_${Date.now()}.jpg`,d=r.match(/\.([a-zA-Z0-9]+)(?:\?.*)?$/),s="png"===(d?d[1].toLowerCase():"jpg")?"image/png":"image/jpeg",c=new FormData;c.append("file",{uri:a,name:r,type:s}),c.append("filename",r),c.append("dog_id",l.id),c.append("trail_id",""),c.append("user_id","");const u=await fetch(`${n.API_URL}/uploads`,{method:"POST",headers:{Authorization:`Bearer ${t.accessToken}`,accept:"application/json"},body:c});if(u.ok){const e=await u.json(),a=e.public_url||e.publicUrl||e.url;if(a){const e=await fetch(`${n.API_URL}/dog/${l.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.accessToken}`},body:JSON.stringify(Object.assign({},l,{image:a}))});if(e.ok){const t=await e.json();i(e=>e.map(e=>e.id===t.id?t:e))}else console.error("Failed to patch dog with uploaded image")}}else console.error("Dog image upload failed during create:",await u.text())}catch(d){console.error("Error uploading dog photo after create:",d)}return l},[t]),y=(0,o.useCallback)(async e=>{if(!t)throw new Error("No session");if(!e.id)throw new Error("Dog ID is required for update");console.log("updateDogProfile - incoming profile:",e);let a=Object.assign({},e);if(a.photo&&delete a.photo,"string"===typeof e.image&&e.image&&!e.image.startsWith("http"))try{const o=e.image,r=o.split("/"),l=r[r.length-1]||`dog_${Date.now()}.jpg`,i=l.match(/\.([a-zA-Z0-9]+)(?:\?.*)?$/),d="png"===(i?i[1].toLowerCase():"jpg")?"image/png":"image/jpeg",s=new FormData;s.append("file",{uri:o,name:l,type:d}),s.append("filename",l),s.append("dog_id",e.id),s.append("trail_id",""),s.append("user_id","");const c=await fetch(`${n.API_URL}/uploads`,{method:"POST",headers:{Authorization:`Bearer ${t.accessToken}`,accept:"application/json"},body:s});if(!c.ok){const e=await c.text();throw new Error(`Upload failed: ${c.status} ${e}`)}const u=await c.json(),f=u.public_url||u.publicUrl||u.url;if(!f)throw new Error("Upload did not return a public URL");a.image=f}catch(l){throw console.error("Error uploading dog photo during update:",l),l}console.log("updateDogProfile - profileToSend before PUT:",a);const o=await fetch(`${n.API_URL}/dog/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.accessToken}`},body:JSON.stringify(a)});if(!o.ok){const e=await o.json();throw new Error(e.detail?.[0]?.msg||"Failed to update dog profile")}const r=await o.json();return i(e=>e.map(e=>e.id===r.id?r:e)),r},[t]);return(0,o.useMemo)(()=>({dogProfile:f,dogProfiles:r,activeDogId:d,setActiveDogId:s,isDogProfileLoading:c,hasDogProfile:r.length>0,refreshDogProfile:h,createDogProfile:m,updateDogProfile:y}),[f,r,d,c,h,m,y])})}},t={};function a(o){var r=t[o];if(void 0!==r)return r.exports;var l=t[o]={id:o,loaded:!1,exports:{}};return e[o].call(l.exports,l,l.exports,a),l.loaded=!0,l.exports}a.m=e,(()=>{var e=[];a.O=(t,o,r,l)=>{if(!o){var n=1/0;for(c=0;c<e.length;c++){for(var[o,r,l]=e[c],i=!0,d=0;d<o.length;d++)(!1&l||n>=l)&&Object.keys(a.O).every(e=>a.O[e](o[d]))?o.splice(d--,1):(i=!1,l<n&&(n=l));if(i){e.splice(c--,1);var s=r();void 0!==s&&(t=s)}}return t}l=l||0;for(var c=e.length;c>0&&e[c-1][2]>l;c--)e[c]=e[c-1];e[c]=[o,r,l]}})(),a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce((t,o)=>(a.f[o](e,t),t),[])),a.u=e=>"static/js/"+e+"."+{684:"391f8fe8",888:"f30dea73",908:"45e2e76e"}[e]+".chunk.js",a.miniCssF=e=>{},a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="web:";a.l=(o,r,l,n)=>{if(e[o])e[o].push(r);else{var i,d;if(void 0!==l)for(var s=document.getElementsByTagName("script"),c=0;c<s.length;c++){var u=s[c];if(u.getAttribute("src")==o||u.getAttribute("data-webpack")==t+l){i=u;break}}i||(d=!0,(i=document.createElement("script")).charset="utf-8",a.nc&&i.setAttribute("nonce",a.nc),i.setAttribute("data-webpack",t+l),i.src=o),e[o]=[r];var f=(t,a)=>{i.onerror=i.onload=null,clearTimeout(g);var r=e[o];if(delete e[o],i.parentNode&&i.parentNode.removeChild(i),r&&r.forEach(e=>e(a)),t)return t(a)},g=setTimeout(f.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=f.bind(null,i.onerror),i.onload=f.bind(null,i.onload),d&&document.head.appendChild(i)}}})(),a.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),a.p="/",(()=>{var e={792:0};a.f.j=(t,o)=>{var r=a.o(e,t)?e[t]:void 0;if(0!==r)if(r)o.push(r[2]);else{var l=new Promise((a,o)=>r=e[t]=[a,o]);o.push(r[2]=l);var n=a.p+a.u(t),i=new Error;a.l(n,o=>{if(a.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var l=o&&("load"===o.type?"missing":o.type),n=o&&o.target&&o.target.src;i.message="Loading chunk "+t+" failed.\n("+l+": "+n+")",i.name="ChunkLoadError",i.type=l,i.request=n,r[1](i)}},"chunk-"+t,t)}},a.O.j=t=>0===e[t];var t=(t,o)=>{var r,l,[n,i,d]=o,s=0;if(n.some(t=>0!==e[t])){for(r in i)a.o(i,r)&&(a.m[r]=i[r]);if(d)var c=d(a)}for(t&&t(o);s<n.length;s++)l=n[s],a.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return a.O(c)},o=self.webpackChunkweb=self.webpackChunkweb||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var o=a.O(void 0,[346],()=>a(389));o=a.O(o)})();
//# sourceMappingURL=main.325191e0.js.map