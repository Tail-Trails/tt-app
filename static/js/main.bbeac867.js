(()=>{var e={587(e,t,a){var o={"./(tabs)/_layout.tsx":5210,"./(tabs)/explore.styles.ts":2699,"./(tabs)/explore.tsx":4509,"./(tabs)/explore.web.tsx":8389,"./(tabs)/profile.styles.ts":8745,"./(tabs)/profile.tsx":8415,"./(tabs)/record.styles.ts":1095,"./(tabs)/record.tsx":5209,"./(tabs)/record.web.tsx":745,"./+not-found.tsx":8973,"./_layout.tsx":7990,"./demo.tsx":5625,"./index.tsx":5250,"./login.tsx":4101,"./onboarding/dog-basics.tsx":4674,"./onboarding/dog-personality.tsx":6183,"./signup.tsx":3764,"./trail/[id].tsx":3686,"./trails.tsx":2399};function l(e){var t=r(e);return a(t)}function r(e){if(!a.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}l.keys=function(){return Object.keys(o)},l.resolve=r,e.exports=l,l.id=587},594(e,t,a){"use strict";a.r(t),a.d(t,{DOG_SIZES:()=>o,PERSONALITY_TAGS:()=>l,RECALL_RELIABILITY_OPTIONS:()=>r});const o=["XS","S","M","L","XL"],l=["Friendly","Shy","Energetic","Calm","Social","Independent","Playful","Curious","Barky","Reactive","Easily Triggered","Gentle","Protective","Anxious","Confident","Food-Motivated","Quiet","Adventurous","Lazy","Affectionate","Dominant","Submissive","Fearful","Obedient","Stubborn","High-Prey-Drive","Leash-Pulling","Good-With-Dogs","Good-With-Kids"],r=["Poor","Fair","Good","Excellent"]},745(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>A});var o=a(6665),l=a(6283),r=a(3929),n=a(5648),i=a(1690),s=a(530),d=a(5009),c=a(444),u=a(6725),f=a(6773),g=a(8264),h=a(7430),y=a(9637),m=a(5259),p=a(3271),x=a(5624),b=a(2301),j=a(1168),w=a(8032),C=a(8280),S=a(7353),v=a(1047),T=a(1095),k=a(6746),I=a(3353),B=a(9269),z=a(397);const P="recording_coordinates",R="recording_start_time",D="recording_max_elevation",F="recording_max_speed",L="recording_last_update";function A(){const{saveTrail:e,getTrailById:t}=(0,k.useTrails)(),{user:a}=(0,I.useAuth)(),A=(0,y.useLocalSearchParams)(),E=(0,y.useRouter)(),O="string"===typeof A.trailId?A.trailId:void 0,W=O?t(O):void 0,_=(0,o.useRef)(null),[V,N]=(0,o.useState)(!1),[M,$]=(0,o.useState)([]),[G,H]=(0,o.useState)(null),[U,q]=(0,o.useState)(0),[J,Y]=(0,o.useState)(null),[K,Q]=(0,o.useState)(!0),[Z,X]=(0,o.useState)(null),ee=((0,o.useRef)(new Map),(0,o.useRef)(null)),te=(0,o.useRef)(null),ae=(0,o.useRef)(null),oe=.5*u.default.get("window").height,le=280,re=(0,o.useRef)(new d.default.Value(le)).current,[ne,ie]=(0,o.useState)(!1),[se,de]=(0,o.useState)(0),[ce,ue]=(0,o.useState)(0),[fe,ge]=(0,o.useState)("0:00"),[he,ye]=(0,o.useState)(0),[me,pe]=(0,o.useState)(0),[xe,be]=(0,o.useState)(!1),[je,we]=(0,o.useState)(null),[Ce,Se]=(0,o.useState)(""),[ve,Te]=(0,o.useState)(""),[ke,Ie]=(0,o.useState)(void 0);(0,o.useEffect)(()=>{(async()=>{try{if(navigator.permissions&&navigator.permissions.query){const e=await navigator.permissions.query({name:"geolocation"});Y("granted"===e.state),e.onchange=()=>Y("granted"===e.state)}else try{await new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(()=>e(!0),()=>e(!1),{timeout:5e3})}),Y(!0)}catch(e){Y(!1)}}catch(t){console.warn("Permission check failed",t),Y(null)}finally{Q(!1),Be()}})()},[]);const Be=async()=>{try{const e=await m.default.getItem(P);if(e){const t=JSON.parse(e);$(t)}const t=await m.default.getItem(D);t&&ue(parseFloat(t));const a=await m.default.getItem(F);a&&pe(parseFloat(a));const o=await m.default.getItem(R);if(o){const e=Math.floor((Date.now()-parseInt(o))/1e3);q(e),N(!0),ze()}}catch(e){console.error("Error loading recording state:",e)}},ze=()=>{te.current||(te.current=setInterval(async()=>{try{const e=await m.default.getItem(R);if(e){const t=Math.floor((Date.now()-parseInt(e))/1e3);q(t)}}catch(e){}},1e3))},Pe=()=>{be(!1),we(null)};(0,o.useEffect)(()=>{if(U>0){const e=(0,B.calculateTotalDistance)(M)/1e3;if(e>0){const t=U/60/e,a=Math.floor(t),o=Math.round(60*(t-a));ge(`${a}:${o.toString().padStart(2,"0")}`)}}},[U,M]);const Re=(0,o.useRef)(0),De=(0,o.useRef)(c.default.create({onStartShouldSetPanResponder:()=>!0,onMoveShouldSetPanResponder:(e,t)=>Math.abs(t.dy)>5,onPanResponderGrant:()=>{Re.current=re._value},onPanResponderMove:(e,t)=>{const a=Re.current-t.dy;a>=le&&a<=oe&&re.setValue(a)},onPanResponderRelease:(e,t)=>{const a=(oe+le)/2,o=re._value;t.dy<-50?Fe():t.dy>50?Le():o>a?Fe():Le()}})).current,Fe=()=>{ie(!0),d.default.spring(re,{toValue:oe,useNativeDriver:!1,tension:50,friction:8}).start()},Le=()=>{ie(!1),d.default.spring(re,{toValue:le,useNativeDriver:!1,tension:50,friction:8}).start()};if(K)return(0,z.jsxs)(r.default,{style:T.default.loadingContainer,children:[(0,z.jsx)(s.default,{size:"large",color:"#5d6b4a"}),(0,z.jsx)(l.default,{style:T.default.loadingText,children:"Checking permissions..."})]});if(!J)return(0,z.jsxs)(r.default,{style:T.default.permissionContainer,children:[(0,z.jsx)(j.default,{size:64,color:"#666"}),(0,z.jsx)(l.default,{style:T.default.permissionTitle,children:"Location Permission Required"}),(0,z.jsx)(l.default,{style:T.default.permissionText,children:"This page needs access to your location to track your walks. Please allow location access in your browser."}),(0,z.jsx)(n.default,{style:T.default.permissionButton,onPress:()=>{navigator.geolocation.getCurrentPosition(()=>Y(!0),()=>Y(!1))},children:(0,z.jsx)(l.default,{style:T.default.permissionButtonText,children:"Grant Permission"})})]});const Ae=(0,B.calculateTotalDistance)(M),Ee=W&&V&&M.length>0&&W.coordinates.length>0?Math.min(Ae/W.distance*100,100):0,Oe=!!W;return(0,z.jsxs)(r.default,{style:T.default.container,children:[G&&(0,z.jsx)(h.default,{ref:_,coordinates:M,style:T.default.map,initialRegion:{latitude:G.latitude,longitude:G.longitude,latitudeDelta:.01,longitudeDelta:.01},showsUserLocation:!0,followsUserLocation:V,showsMyLocationButton:!1}),(0,z.jsx)(n.default,{style:T.default.recenterButton,onPress:async()=>{if(_.current)try{navigator.geolocation.getCurrentPosition(e=>{const t={latitude:e.coords.latitude,longitude:e.coords.longitude};H(t),_.current.animateToRegion({latitude:t.latitude,longitude:t.longitude,latitudeDelta:.01,longitudeDelta:.01},500)})}catch(e){console.error("Error getting current location:",e)}},activeOpacity:.8,children:(0,z.jsx)(w.default,{size:24,color:"#5d6b4a"})}),(0,z.jsxs)(d.default.View,{style:[T.default.bottomSheet,{height:d.default.add(re,92),bottom:0}],children:[(0,z.jsx)(r.default,Object.assign({},De.panHandlers,{style:T.default.handleBar,children:(0,z.jsxs)(n.default,{style:T.default.handleContainer,onPress:()=>{ne?Le():Fe()},activeOpacity:.7,children:[(0,z.jsx)(r.default,{style:T.default.handle}),ne?(0,z.jsx)(x.default,{size:20,color:"#9ca3af"}):(0,z.jsx)(b.default,{size:20,color:"#9ca3af"})]})})),(0,z.jsxs)(r.default,{style:T.default.bottomSheetContent,children:[(0,z.jsxs)(r.default,{style:T.default.statsGrid,children:[(0,z.jsxs)(r.default,{style:T.default.statItem,children:[(0,z.jsx)(l.default,{style:T.default.statItemLabel,children:"Time"}),(0,z.jsx)(l.default,{style:T.default.statItemValue,children:(0,B.formatDuration)(U)})]}),(0,z.jsxs)(r.default,{style:T.default.statItem,children:[(0,z.jsx)(l.default,{style:T.default.statItemLabel,children:"Distance"}),(0,z.jsx)(l.default,{style:T.default.statItemValue,children:(0,B.formatDistance)(Ae)})]}),(0,z.jsxs)(r.default,{style:T.default.statItem,children:[(0,z.jsx)(l.default,{style:T.default.statItemLabel,children:"Elevation"}),(0,z.jsxs)(l.default,{style:T.default.statItemValue,children:[se.toFixed(0),"m"]})]}),(0,z.jsxs)(r.default,{style:T.default.statItem,children:[(0,z.jsx)(l.default,{style:T.default.statItemLabel,children:"Pace"}),(0,z.jsxs)(l.default,{style:T.default.statItemValue,children:[fe,"/km"]})]}),(0,z.jsxs)(r.default,{style:T.default.statItem,children:[(0,z.jsx)(l.default,{style:T.default.statItemLabel,children:"Speed"}),(0,z.jsxs)(l.default,{style:T.default.statItemValue,children:[he.toFixed(1)," km/h"]})]}),Oe&&(0,z.jsxs)(r.default,{style:T.default.statItem,children:[(0,z.jsx)(l.default,{style:T.default.statItemLabel,children:"Progress"}),(0,z.jsxs)(l.default,{style:T.default.statItemValue,children:[Ee.toFixed(0),"%"]})]})]}),(0,z.jsx)(n.default,{style:[T.default.recordButton,V&&T.default.recordButtonActive],onPress:V?async()=>{console.log("Stopping web recording...");try{null!==ee.current&&(navigator.geolocation.clearWatch(ee.current),ee.current=null),ae.current&&ae.current.release&&(await ae.current.release(),ae.current=null),te.current&&(clearInterval(te.current),te.current=null);const e=await m.default.getItem(P),t=e?JSON.parse(e):M,a=await m.default.getItem(D),o=a?parseFloat(a):ce,l=await m.default.getItem(F),r=l?parseFloat(l):me,n=await m.default.getItem(R),s=n?Math.floor((Date.now()-parseInt(n))/1e3):U;if(!t||t.length<2)return i.default.alert("No Trail Data","Not enough data to save this trail. Try walking a bit more!"),N(!1),$([]),q(0),await m.default.removeItem(P),await m.default.removeItem(D),await m.default.removeItem(F),await m.default.removeItem(R),void await m.default.removeItem(L);const d=(0,B.calculateTotalDistance)(t),c=d/1e3;let u="0:00";if(c>0){const e=s/60/c,t=Math.floor(e);u=`${t}:${Math.round(60*(e-t)).toString().padStart(2,"0")}`}const f={id:Date.now().toString(),date:Date.now(),distance:d,duration:s,coordinates:t,city:Z?.city,country:Z?.country,pace:u,speed:r,maxElevation:o};we(f),Se(f.name||""),Te(f.description||""),Ie(f.photo||void 0),be(!0)}catch(e){console.error("Stop error:",e),i.default.alert("Error","Failed to stop recording"),N(!1)}}:async()=>{console.log("Starting web recording..."),N(!0),$([]),q(0),ue(0),pe(0);try{const t=Date.now();await m.default.setItem(R,t.toString()),await m.default.removeItem(P),await m.default.removeItem(D),await m.default.removeItem(F),await m.default.removeItem(L),navigator.geolocation.getCurrentPosition(async e=>{const t={latitude:e.coords.latitude,longitude:e.coords.longitude};await m.default.setItem(P,JSON.stringify([t])),$([t]),H(t)},e=>{console.warn("Initial geolocation failed",e)},{enableHighAccuracy:!0,timeout:1e4});const a=navigator.geolocation.watchPosition(async e=>{const t={latitude:e.coords.latitude,longitude:e.coords.longitude};H(t),$(e=>{const a=[...e,t];return m.default.setItem(P,JSON.stringify(a)).catch(()=>{}),a}),await m.default.setItem(L,Date.now().toString())},e=>{console.error("watchPosition error",e)},{enableHighAccuracy:!0,maximumAge:0,timeout:1e4});ee.current=a;try{navigator.wakeLock&&navigator.wakeLock.request&&(ae.current=await navigator.wakeLock.request("screen"))}catch(e){console.warn("Wake lock request failed",e)}ze()}catch(t){console.error("Recording error:",t),i.default.alert("Error",t?.message||"Failed to start recording"),N(!1)}},activeOpacity:.8,children:V?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(S.default,{size:24,color:"#fff",fill:"#fff"}),(0,z.jsx)(l.default,{style:T.default.recordButtonText,children:"Stop & Save"})]}):(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(C.default,{size:24,color:"#fff",fill:"#fff"}),(0,z.jsx)(l.default,{style:T.default.recordButtonText,children:"Start Trail"})]})}),ne&&(0,z.jsxs)(r.default,{style:T.default.expandedContent,children:[(0,z.jsx)(r.default,{style:T.default.divider}),(0,z.jsxs)(n.default,{style:T.default.optionRow,onPress:()=>i.default.alert("Apple Watch","Connect your Apple Watch to sync workout data."),activeOpacity:.7,children:[(0,z.jsx)(r.default,{style:T.default.optionIconContainer,children:(0,z.jsx)(v.default,{size:24,color:"#5d6b4a"})}),(0,z.jsxs)(r.default,{style:T.default.optionTextContainer,children:[(0,z.jsx)(l.default,{style:T.default.optionTitle,children:"Apple Watch"}),(0,z.jsx)(l.default,{style:T.default.optionSubtitle,children:"Not connected"})]}),(0,z.jsx)(r.default,{style:T.default.optionBadge,children:(0,z.jsx)(l.default,{style:T.default.optionBadgeText,children:"Connect"})})]}),(0,z.jsxs)(n.default,{style:T.default.optionRow,onPress:()=>i.default.alert("Alerts","Configure alerts for distance milestones and pace notifications."),activeOpacity:.7,children:[(0,z.jsx)(r.default,{style:T.default.optionIconContainer,children:(0,z.jsx)(p.default,{size:24,color:"#5d6b4a"})}),(0,z.jsxs)(r.default,{style:T.default.optionTextContainer,children:[(0,z.jsx)(l.default,{style:T.default.optionTitle,children:"Alerts"}),(0,z.jsx)(l.default,{style:T.default.optionSubtitle,children:"Distance & pace notifications"})]}),(0,z.jsx)(r.default,{style:[T.default.optionBadge,T.default.optionBadgeActive],children:(0,z.jsx)(l.default,{style:[T.default.optionBadgeText,T.default.optionBadgeTextActive],children:"Active"})})]})]})]})]}),(0,z.jsx)(g.default,{visible:xe,animationType:"slide",transparent:!0,onRequestClose:Pe,children:(0,z.jsx)(r.default,{style:T.default.modalOverlay,children:(0,z.jsx)(r.default,{style:T.default.modalContainer,children:(0,z.jsxs)(r.default,{style:T.default.modalContent,children:[(0,z.jsx)(l.default,{style:T.default.modalTitle,children:"Save Trail"}),(0,z.jsx)(l.default,{style:{fontSize:14,marginTop:8},children:"Name"}),(0,z.jsx)(f.default,{placeholder:"Trail name",value:Ce,onChangeText:Se,style:T.default.input}),(0,z.jsx)(l.default,{style:{fontSize:14,marginTop:8},children:"Description"}),(0,z.jsx)(f.default,{placeholder:"Description",value:ve,onChangeText:Te,style:[T.default.input,{height:100}],multiline:!0}),(0,z.jsx)(l.default,{style:{fontSize:14,marginTop:8},children:"Photo URL (optional)"}),(0,z.jsx)(f.default,{placeholder:"Photo URL",value:ke,onChangeText:Ie,style:T.default.input}),(0,z.jsxs)(r.default,{style:{flexDirection:"row",gap:8,marginTop:12},children:[(0,z.jsx)(n.default,{style:T.default.modalButton,onPress:Pe,children:(0,z.jsx)(l.default,{style:T.default.modalButtonText,children:"Cancel"})}),(0,z.jsx)(n.default,{style:[T.default.modalButton,T.default.modalButtonPrimary],onPress:async()=>{if(!je)return;const t=Object.assign({},je,{name:Ce||je.name||"Untitled Trail",description:ve,photo:ke});try{await e(t),be(!1),we(null),N(!1),$([]),q(0),X(null),de(0),ue(0),ge("0:00"),ye(0),pe(0),await m.default.removeItem(P),await m.default.removeItem(D),await m.default.removeItem(F),await m.default.removeItem(R),await m.default.removeItem(L);const a=t.id||null;a?E.push(`/trail/${a}`):i.default.alert("Success","Trail saved successfully!")}catch(a){console.error("Save failed",a),i.default.alert("Error","Failed to save trail")}},children:(0,z.jsx)(l.default,{style:[T.default.modalButtonText,{color:"#fff"}],children:"Save Trail"})})]})]})})})})]})}},1095(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>l});var o=a(3668);const l=o.default.create({container:{flex:1,backgroundColor:"#F8F7F2"},map:Object.assign({},o.default.absoluteFillObject),webContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"#F8F7F2",padding:20},webText:{marginTop:16,fontSize:16,color:"#666",textAlign:"center"},loadingContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"#F8F7F2"},loadingText:{marginTop:16,fontSize:16,color:"#666"},permissionContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"#F8F7F2",padding:32},permissionTitle:{marginTop:16,fontSize:20,fontWeight:"700",color:"#1f2937",textAlign:"center"},permissionText:{marginTop:8,fontSize:16,color:"#6b7280",textAlign:"center"},permissionButton:{marginTop:24,paddingHorizontal:32,paddingVertical:16,backgroundColor:"#5d6b4a",borderRadius:12},permissionButtonText:{fontSize:16,fontWeight:"600",color:"#fff"},statsContainer:{position:"absolute",left:20,right:20,flexDirection:"row",gap:12},statBox:{flex:1,backgroundColor:"rgba(255, 255, 255, 0.95)",borderRadius:16,padding:16,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:8,elevation:4},statLabel:{fontSize:13,color:"#6b7280",fontWeight:"500",marginBottom:4},statValue:{fontSize:24,color:"#1f2937",fontWeight:"700"},controlContainer:{position:"absolute",left:20,right:20,alignItems:"center"},recordButton:{flexDirection:"row",alignItems:"center",gap:12,paddingHorizontal:32,paddingVertical:20,backgroundColor:"#5d6b4a",borderRadius:50,shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:12,elevation:8},recordButtonActive:{backgroundColor:"#dc2626"},recordButtonText:{fontSize:18,fontWeight:"700",color:"#fff"},bottomSheet:{position:"absolute",left:0,right:0,backgroundColor:"#F8F7F2",borderTopLeftRadius:24,borderTopRightRadius:24,shadowColor:"#000",shadowOffset:{width:0,height:-4},shadowOpacity:.15,shadowRadius:16,elevation:20},handleBar:{paddingTop:12,paddingBottom:8,alignItems:"center"},handleContainer:{alignItems:"center",gap:4},handle:{width:40,height:4,backgroundColor:"#d1d5db",borderRadius:2},bottomSheetContent:{flex:1,paddingHorizontal:20,paddingBottom:92},statsGrid:{flexDirection:"row",flexWrap:"wrap",gap:12,marginBottom:20},statItem:{width:"31%",backgroundColor:"#f9fafb",borderRadius:12,padding:12,alignItems:"center"},statItemLabel:{fontSize:11,color:"#6b7280",fontWeight:"600",textTransform:"uppercase",letterSpacing:.5,marginBottom:6},statItemValue:{fontSize:18,color:"#1f2937",fontWeight:"700"},expandedContent:{marginTop:8},divider:{height:1,backgroundColor:"#e5e7eb",marginVertical:16},optionRow:{flexDirection:"row",alignItems:"center",paddingVertical:16,paddingHorizontal:16,backgroundColor:"#f9fafb",borderRadius:12,marginBottom:12},optionIconContainer:{width:48,height:48,borderRadius:24,backgroundColor:"rgba(93, 107, 74, 0.1)",alignItems:"center",justifyContent:"center",marginRight:12},optionTextContainer:{flex:1},optionTitle:{fontSize:16,fontWeight:"600",color:"#1f2937",marginBottom:2},optionSubtitle:{fontSize:13,color:"#6b7280"},optionBadge:{paddingHorizontal:12,paddingVertical:6,borderRadius:12,backgroundColor:"#e5e7eb"},optionBadgeActive:{backgroundColor:"rgba(93, 107, 74, 0.15)"},optionBadgeText:{fontSize:12,fontWeight:"600",color:"#6b7280"},optionBadgeTextActive:{color:"#5d6b4a"},modalOverlay:{flex:1,backgroundColor:"rgba(0,0,0,0.4)",justifyContent:"center",alignItems:"center",padding:20},modalContainer:{width:"100%",maxHeight:"90%",backgroundColor:"#fff",borderRadius:12,overflow:"hidden"},modalContent:{padding:20},modalTitle:{fontSize:20,fontWeight:"700",color:"#1f2937",marginBottom:12},input:{borderWidth:1,borderColor:"#e5e7eb",backgroundColor:"#f9fafb",paddingHorizontal:12,paddingVertical:10,borderRadius:8,marginTop:8},modalButton:{flex:1,paddingVertical:12,paddingHorizontal:16,borderRadius:10,backgroundColor:"#e5e7eb",alignItems:"center",justifyContent:"center"},modalButtonPrimary:{backgroundColor:"#5d6b4a",marginLeft:8},modalButtonText:{fontSize:16,fontWeight:"600",color:"#1f2937"},recenterButton:{position:"absolute",top:60,right:20,width:48,height:48,borderRadius:24,backgroundColor:"#ffffff",alignItems:"center",justifyContent:"center",shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.15,shadowRadius:8,elevation:4}})},2399(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>y});a(6665);var o=a(3668),l=a(3929),r=a(932),n=a(5648),i=a(530),s=a(6283),d=a(9637),c=a(4494),u=a(1168),f=a(6746),g=a(9269),h=a(397);function y(){const e=(0,d.useRouter)(),{trails:t,isLoading:a}=(0,f.useTrails)();return a?(0,h.jsx)(l.default,{style:m.loadingContainer,children:(0,h.jsx)(i.default,{size:"large",color:"#2563eb"})}):(0,h.jsx)(l.default,{style:m.container,children:(0,h.jsx)(r.default,{data:t,renderItem:({item:t})=>(0,h.jsx)(n.default,{style:m.trailItem,onPress:()=>e.push(`/trail/${t.id}`),children:(0,h.jsxs)(l.default,{style:m.trailHeader,children:[(0,h.jsx)(l.default,{style:m.iconContainer,children:(0,h.jsx)(u.default,{size:24,color:"#2563eb"})}),(0,h.jsxs)(l.default,{style:m.trailInfo,children:[(0,h.jsx)(s.default,{style:m.trailDate,children:(0,g.formatDate)(t.date)}),(0,h.jsxs)(l.default,{style:m.statsRow,children:[(0,h.jsxs)(l.default,{style:m.statItem,children:[(0,h.jsx)(u.default,{size:16,color:"#6b7280"}),(0,h.jsx)(s.default,{style:m.statText,children:(0,g.formatDistance)(t.distance)})]}),(0,h.jsxs)(l.default,{style:m.statItem,children:[(0,h.jsx)(c.default,{size:16,color:"#6b7280"}),(0,h.jsx)(s.default,{style:m.statText,children:(0,g.formatDuration)(t.duration)})]})]})]})]})}),keyExtractor:e=>e.id,contentContainerStyle:0===t.length?m.emptyList:m.list,ListEmptyComponent:()=>(0,h.jsxs)(l.default,{style:m.emptyContainer,children:[(0,h.jsx)(u.default,{size:64,color:"#d1d5db"}),(0,h.jsx)(s.default,{style:m.emptyTitle,children:"No trails yet"}),(0,h.jsx)(s.default,{style:m.emptyText,children:"Start recording your first dog walk to see it here!"})]})})})}const m=o.default.create({container:{flex:1,backgroundColor:"#f9fafb"},list:{padding:16,gap:12},emptyList:{flex:1},loadingContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:"#f9fafb"},trailItem:{backgroundColor:"#fff",borderRadius:16,padding:16,marginBottom:12,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.05,shadowRadius:8,elevation:2},trailHeader:{flexDirection:"row",alignItems:"center",gap:12},iconContainer:{width:48,height:48,borderRadius:24,backgroundColor:"#eff6ff",justifyContent:"center",alignItems:"center"},trailInfo:{flex:1},trailDate:{fontSize:16,fontWeight:"600",color:"#1f2937",marginBottom:6},statsRow:{flexDirection:"row",gap:16},statItem:{flexDirection:"row",alignItems:"center",gap:6},statText:{fontSize:14,color:"#6b7280",fontWeight:"500"},emptyContainer:{flex:1,justifyContent:"center",alignItems:"center",padding:32},emptyTitle:{fontSize:20,fontWeight:"700",color:"#1f2937",marginTop:16,marginBottom:8},emptyText:{fontSize:16,color:"#6b7280",textAlign:"center",lineHeight:24}})},2598(e,t,a){"use strict";a.r(t),a.d(t,{AccountContext:()=>i,useAccount:()=>s});var o=a(6665),l=a(2790),r=a(3353),n=a(5938);const[i,s]=(0,l.default)(()=>{const{user:e,session:t}=(0,r.useAuth)(),[a,l]=(0,o.useState)(null),[i,s]=(0,o.useState)(!0),d=(0,o.useCallback)(async()=>{if(t?.accessToken){s(!0);try{const e=await fetch(`${n.API_URL}/account/me`,{headers:{Authorization:`Bearer ${t.accessToken}`}});if(e.ok){const t=await e.json();l(t)}else console.error("Failed to fetch account:",e.status),l(null)}catch(e){console.error("Error fetching account:",e),l(null)}finally{s(!1)}}},[t?.accessToken]),c=(0,o.useCallback)(async e=>{if(!t?.accessToken)throw new Error("No active session");try{const a=await fetch(`${n.API_URL}/account/me`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.accessToken}`},body:JSON.stringify(e)});if(!a.ok){const e=await a.json();throw new Error(e.detail?.[0]?.msg||"Failed to update account")}const o=await a.json();return l(o),o}catch(a){throw console.error("Error updating account:",a),a}},[t?.accessToken]),u=(0,o.useCallback)(async()=>{if(!t?.accessToken)throw new Error("No active session");try{const e=await fetch(`${n.API_URL}/account/me`,{method:"DELETE",headers:{Authorization:`Bearer ${t.accessToken}`}});if(!e.ok){const t=await e.json();throw new Error(t.detail?.[0]?.msg||"Failed to delete account")}return l(null),!0}catch(e){throw console.error("Error deleting account:",e),e}},[t?.accessToken]);return(0,o.useEffect)(()=>{t?.accessToken?d():(l(null),s(!1))},[t?.accessToken,d]),(0,o.useMemo)(()=>({userProfile:a,isLoading:i,refreshAccount:d,updateAccount:c,deleteAccount:u}),[a,i,d,c,u])})},2699(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>o});const o=a(3668).default.create({safeContainer:{flex:1,backgroundColor:"#F8F7F2"},container:{flex:1,backgroundColor:"#F8F7F2"},stickyHeader:{backgroundColor:"#F8F7F2",paddingBottom:8},stickySearchContainer:{paddingHorizontal:16,paddingBottom:8,flexDirection:"row",alignItems:"center",gap:8},searchBar:{flex:1,flexDirection:"row",alignItems:"center",backgroundColor:"#f3f4f6",paddingHorizontal:16,paddingVertical:14,borderRadius:28,gap:12,borderWidth:1,borderColor:"#e5e7eb"},demoButton:{backgroundColor:"#5d6b4a",paddingHorizontal:16,paddingVertical:12,borderRadius:24},demoButtonText:{color:"#fff",fontWeight:"bold"},searchPlaceholder:{fontSize:16,color:"#9ca3af",fontWeight:"400"},largeTrailCard:{backgroundColor:"#fff",borderRadius:24,overflow:"hidden",marginBottom:20,shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.1,shadowRadius:16,elevation:4,position:"relative"},largeTrailImage:{width:"100%",height:260,backgroundColor:"#e2e8f0"},bookmarkButton:{position:"absolute",top:20,right:20,width:44,height:44,borderRadius:22,backgroundColor:"rgba(255, 255, 255, 0.95)",justifyContent:"center",alignItems:"center",shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:8,elevation:4},cardGradient:{position:"absolute",top:0,bottom:0,left:0,right:0},cardOverlayContent:{position:"absolute",bottom:0,left:0,right:0,padding:18,paddingBottom:20},overlayTrailName:{fontSize:28,fontWeight:"700",color:"#fff",marginBottom:6,lineHeight:34,textShadowColor:"rgba(0, 0, 0, 0.3)",textShadowOffset:{width:0,height:1},textShadowRadius:4},overlayLocation:{fontSize:16,color:"#fff",marginBottom:16,opacity:.95,textShadowColor:"rgba(0, 0, 0, 0.3)",textShadowOffset:{width:0,height:1},textShadowRadius:4},overlayBadges:{flexDirection:"row",alignItems:"center",gap:12,flexWrap:"wrap"},badge:{flexDirection:"row",alignItems:"center",backgroundColor:"rgba(40, 40, 40, 0.8)",paddingHorizontal:14,paddingVertical:8,borderRadius:20,gap:6},badgeText:{fontSize:14,fontWeight:"600",color:"#fff",textTransform:"capitalize"},categoriesSection:{backgroundColor:"#F8F7F2",paddingTop:8,paddingBottom:16},categoriesScroll:{paddingHorizontal:16,gap:12},categoryButton:{flexDirection:"row",alignItems:"center",paddingHorizontal:24,paddingVertical:14,borderRadius:28,backgroundColor:"#fff",borderWidth:0,gap:8},categoryButtonActive:{backgroundColor:"#5d6b4a"},categoryText:{fontSize:16,fontWeight:"500",color:"#9ca3af"},categoryTextActive:{color:"#fff"},categoryTrailsSection:{paddingHorizontal:16,paddingTop:16},bottomPadding:{height:40},loadingContainer:{paddingVertical:60,alignItems:"center",gap:16},loadingText:{fontSize:14,color:"#64748b"},emptyContainer:{paddingVertical:60,alignItems:"center",gap:16,paddingHorizontal:32},emptyText:{fontSize:16,color:"#64748b",textAlign:"center",lineHeight:24},placeholderImage:{justifyContent:"center",alignItems:"center",backgroundColor:"#282E10"},searchModalContainer:{flex:1,backgroundColor:"#F8F7F2"},searchModalHeader:{flexDirection:"row",alignItems:"center",paddingHorizontal:16,paddingTop:12,paddingBottom:16,gap:12,borderBottomWidth:1,borderBottomColor:"#e5e7eb"},backButton:{width:40,height:40,borderRadius:20,backgroundColor:"#d4d4a0",justifyContent:"center",alignItems:"center"},searchModalInputContainer:{flex:1,flexDirection:"row",alignItems:"center",backgroundColor:"#fff",borderRadius:28,paddingHorizontal:16,paddingVertical:12,borderWidth:1,borderColor:"#9ca3af",gap:12},searchModalInput:{flex:1,fontSize:16,color:"#282E10",padding:0,fontWeight:"400"},clearButton:{width:24,height:24,borderRadius:12,backgroundColor:"#e5e7eb",justifyContent:"center",alignItems:"center"},searchModalContent:{flex:1,paddingTop:12},currentLocationItem:{flexDirection:"row",alignItems:"center",paddingHorizontal:20,paddingVertical:16,gap:16,backgroundColor:"#f9fafb",borderRadius:16,marginHorizontal:16,marginBottom:12},locationIconContainer:{width:48,height:48,borderRadius:24,backgroundColor:"#d4d4a0",justifyContent:"center",alignItems:"center"},locationTextContainer:{flex:1},locationTitle:{fontSize:17,fontWeight:"600",color:"#282E10",marginBottom:4},locationSubtitle:{fontSize:14,color:"#6b7280",fontWeight:"400"},suggestionItem:{flexDirection:"row",alignItems:"center",paddingHorizontal:20,paddingVertical:16,gap:16,backgroundColor:"#f9fafb",borderRadius:16,marginHorizontal:16,marginBottom:12},suggestionIconContainer:{width:48,height:48,borderRadius:24,backgroundColor:"#e5e7eb",justifyContent:"center",alignItems:"center"},suggestionTextContainer:{flex:1},suggestionTitle:{fontSize:17,fontWeight:"600",color:"#282E10",marginBottom:4},suggestionSubtitle:{fontSize:14,color:"#6b7280",fontWeight:"400"}})},3229(e,t,a){"use strict";e.exports=a.p+"static/media/icon.f99e957780228420852c.png"},3353(e,t,a){"use strict";a.r(t),a.d(t,{AuthContext:()=>i,useAuth:()=>s});var o=a(6665),l=a(2790),r=a(5259),n=a(5938);const[i,s]=(0,l.default)(()=>{const[e,t]=(0,o.useState)(null),[a,l]=(0,o.useState)(null),[i,s]=(0,o.useState)(!0);(0,o.useEffect)(()=>{(async()=>{try{const e=await r.default.getItem("session");if(e){const a=JSON.parse(e);t(a),l(a.user)}}catch(e){console.error("Error loading session:",e)}finally{s(!1)}})()},[]);const d=(0,o.useCallback)(async e=>{console.log("Requesting OTP for:",e);const t=await fetch(`${n.API_URL}/otp/request`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!t.ok){const e=await t.json();throw new Error(e.detail?.[0]?.msg||"Failed to request OTP")}return!0},[]),c=(0,o.useCallback)(async(e,a)=>{console.log("Verifying OTP for:",e);const o=await fetch(`${n.API_URL}/otp/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,otpCode:a})});if(!o.ok){const e=await o.json();throw new Error(e.detail?.[0]?.msg||"Invalid OTP code")}const i=await o.json();return t(i),l(i.user),await r.default.setItem("session",JSON.stringify(i)),i},[]),u=(0,o.useCallback)(async(e,t)=>{console.log("Requesting registration for:",e);const a=await fetch(`${n.API_URL}/otp/register-request`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,name:t})});if(!a.ok){const e=await a.json();throw new Error(e.detail?.[0]?.msg||"Failed to request registration")}return!0},[]),f=(0,o.useCallback)(async(e,a)=>{console.log("Verifying registration for:",e);const o=await fetch(`${n.API_URL}/otp/register-verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,otpCode:a})});if(!o.ok){const e=await o.json();throw new Error(e.detail?.[0]?.msg||"Invalid OTP code")}const i=await o.json();return t(i),l(i.user),await r.default.setItem("session",JSON.stringify(i)),i},[]),g=(0,o.useCallback)(async()=>{console.log("Signing out user"),t(null),l(null),await r.default.removeItem("session")},[]);return(0,o.useMemo)(()=>({session:e,user:a,isLoading:i,requestOtp:d,verifyOtp:c,requestRegistration:u,verifyRegistration:f,signOut:g,isAuthenticated:!!e}),[e,a,i,d,c,u,f,g])})},3686(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>N});var o=a(6665),l=a(3929),r=a(3668),n=a(530),i=a(5648),s=a(6773),d=a(1690),c=a(9632),u=a(5009),f=a(6283),g=a(9637),h=a(5894),y=a(7430),m=a(8136),p=a(4686),x=a(5427),b=a(5395),j=a(2994),w=a(4164),C=a(9281),S=a(6508),v=a(4494),T=a(1168),k=a(8032),I=a(8948),B=a(5082),z=a(8360),P=a(477),R=a(2964),D=(a(262),a(893)),F=a(6746),L=a(3353),A=a(9269),E=a(9582),O=a(8833),W=a(397);const _=["Forest","Urban","Beach","Mountain","Rural","Park","Shaded","Sunny","Crowded","Quiet","Paved","Trail"],V=["Easy","Moderate","Hard"];function N(){const{id:e}=(0,g.useLocalSearchParams)(),{user:t}=(0,L.useAuth)(),{getTrailById:a,updateTrailName:r,updateTrailPhoto:N,updateTrailDetails:$,getTrailWithUser:G}=(0,F.useTrails)(),[H,U]=(0,o.useState)(void 0),[q,J]=(0,o.useState)(!0),[Y,K]=(0,o.useState)(!1),[Q,Z]=(0,o.useState)(""),[X,ee]=(0,o.useState)(!1),[te,ae]=(0,o.useState)(0),[oe,le]=(0,o.useState)(""),[re,ne]=(0,o.useState)([]),[ie,se]=(0,o.useState)(""),[de,ce]=(0,o.useState)(""),[ue,fe]=(0,o.useState)(!1),ge=(0,o.useRef)(null),he=(0,o.useRef)(new u.default.Value(0)).current,ye=(0,O.useSafeAreaInsets)(),me=({IconComponent:e,emoji:t,size:a=18,color:o})=>(0,W.jsx)(f.default,{style:{fontSize:a,color:o||void 0},children:t||"\u2022"}),[pe,xe]=(0,o.useState)(!1);(0,o.useEffect)(()=>{be()},[e]);const be=async()=>{if("string"===typeof e){J(!0);try{const t=a(e);if(t)U(t),Z(t.name||""),ae(t.rating||0),le(t.review||""),ne(t.environment_tags||[]),se(t.difficulty||""),ce(t.name||"");else{const t=await G(e);t&&(U(t),Z(t.name||""),ae(t.rating||0),le(t.review||""),ne(t.environment_tags||[]),se(t.difficulty||""),ce(t.name||""))}}catch(t){console.error("Error loading trail:",t)}finally{J(!1)}}else J(!1)},je=()=>{ge.current&&ge.current.click()};if(q)return(0,W.jsxs)(l.default,{style:M.loadingContainer,children:[(0,W.jsx)(n.default,{size:"large",color:E.default.primary}),(0,W.jsx)(f.default,{style:M.loadingText,children:"Loading trail..."})]});if(!H)return(0,W.jsxs)(l.default,{style:M.loadingContainer,children:[(0,W.jsx)(T.default,{size:64,color:"#9ca3af"}),(0,W.jsx)(f.default,{style:M.loadingText,children:"Trail not found"})]});const we=H.coordinates??[],Ce=we.length>0?{latitude:we[0].latitude,longitude:we[0].longitude,latitudeDelta:.01,longitudeDelta:.01}:void 0,Se=H.user_id===t?.id;return(0,W.jsxs)(l.default,{style:M.container,children:[(0,W.jsx)("input",{ref:ge,type:"file",accept:"image/*",style:{display:"none"},onChange:async e=>{const t=e.target.files?.[0];if(t&&H)if(t.type.startsWith("image/")){fe(!0);try{const e=new FileReader;e.onload=async e=>{const t=e.target?.result;await N(H.id,t),U(Object.assign({},H,{photo:t})),d.default.alert("Success","Photo uploaded successfully!"),fe(!1)},e.onerror=()=>{d.default.alert("Error","Failed to read image"),fe(!1)},e.readAsDataURL(t)}catch(a){console.error("Photo upload error:",a),d.default.alert("Error","Failed to upload photo"),fe(!1)}}else d.default.alert("Error","Please select an image file")}}),(0,W.jsxs)(l.default,{style:[M.headerButtons,{top:ye.top+12}],children:[(0,W.jsx)(i.default,{style:M.headerButton,onPress:()=>{g.router.back()},children:(0,W.jsx)(b.default,{size:24,color:"#1f2937"})}),(0,W.jsxs)(l.default,{style:M.headerRightButtons,children:[(0,W.jsx)(i.default,{style:M.headerButton,onPress:()=>{d.default.alert("Share","Share functionality coming soon!")},children:(0,W.jsx)(I.default,{size:22,color:"#1f2937"})}),(0,W.jsx)(i.default,{style:M.headerButton,onPress:()=>{xe(!pe)},children:(0,W.jsx)(j.default,{size:22,color:"#1f2937",fill:pe?"#1f2937":"none"})}),(0,W.jsx)(i.default,{style:M.headerButton,onPress:()=>{d.default.alert("Options","Mark as completed option coming soon!")},children:(0,W.jsx)(m.default,{size:22,color:"#1f2937"})})]})]}),(0,W.jsxs)(u.default.ScrollView,{style:M.scrollContainer,contentContainerStyle:M.scrollContent,onScroll:u.default.event([{nativeEvent:{contentOffset:{y:he}}}],{useNativeDriver:!1}),scrollEventThrottle:16,children:[(0,W.jsx)(l.default,{style:M.heroSection,children:H.photo?(0,W.jsxs)(l.default,{style:M.heroImageContainer,children:[(0,W.jsx)(h.Image,{source:{uri:H.photo},style:M.heroImage,contentFit:"cover",cachePolicy:"memory-disk"}),(0,W.jsx)(D.LinearGradient,{colors:["rgba(0,0,0,0)","rgba(0,0,0,0.3)"],style:M.heroGradient}),Se&&(0,W.jsx)(i.default,{style:M.changePhotoFab,onPress:je,disabled:ue,children:ue?(0,W.jsx)(n.default,{color:"#fff",size:"small"}):(0,W.jsx)(C.default,{size:20,color:"#fff"})})]}):Se&&(0,W.jsx)(i.default,{style:M.addPhotoContainer,onPress:je,disabled:ue,children:ue?(0,W.jsx)(n.default,{size:"large",color:E.default.primary}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(l.default,{style:M.addPhotoIcon,children:(0,W.jsx)(C.default,{size:32,color:E.default.primary})}),(0,W.jsx)(f.default,{style:M.addPhotoText,children:"Add a photo"}),(0,W.jsx)(f.default,{style:M.addPhotoSubtext,children:"Make your trail memorable"})]})})}),(0,W.jsx)(l.default,{style:M.contentWrapper,children:(0,W.jsxs)(l.default,{style:M.content,children:[(0,W.jsxs)(l.default,{style:M.titleSection,children:[Se&&Y?(0,W.jsxs)(l.default,{style:M.nameEditContainer,children:[(0,W.jsx)(s.default,{style:M.nameInput,value:Q,onChangeText:Z,placeholder:"Enter trail name",autoFocus:!0,placeholderTextColor:"#9ca3af"}),(0,W.jsxs)(l.default,{style:M.editButtons,children:[(0,W.jsx)(i.default,{style:[M.iconButton,M.saveIconButton],onPress:async()=>{if(H&&Q.trim())try{await r(H.id,Q.trim()),U(Object.assign({},H,{name:Q.trim()})),K(!1)}catch{d.default.alert("Error","Failed to update trail name. Please try again.")}else K(!1)},children:(0,W.jsx)(S.default,{size:18,color:"#fff"})}),(0,W.jsx)(i.default,{style:[M.iconButton,M.cancelIconButton],onPress:()=>{Z(H?.name||""),K(!1)},children:(0,W.jsx)(R.default,{size:18,color:E.default.darkGreen})})]})]}):(0,W.jsx)(l.default,{style:M.titleRow,children:(0,W.jsx)(f.default,{style:M.title,children:H.name||`Trail ${new Date(H.date).toLocaleDateString()}`})}),H.city&&(0,W.jsxs)(l.default,{style:M.locationRow,children:[(0,W.jsx)(T.default,{size:16,color:E.default.lightGreen}),(0,W.jsxs)(f.default,{style:M.location,children:[H.city,", ",H.country||"Unknown"]})]}),H.rating&&!X&&(0,W.jsx)(l.default,{style:M.ratingRow,children:[1,2,3,4,5].map(e=>(0,W.jsx)(B.default,{size:18,color:e<=H.rating?"#f59e0b":"#d1d5db",fill:e<=H.rating?"#f59e0b":"none"},e))})]}),H.review&&!X&&(0,W.jsx)(l.default,{style:M.reviewCard,children:(0,W.jsx)(f.default,{style:M.reviewText,children:H.review})}),(0,W.jsxs)(l.default,{style:M.statsSection,children:[(0,W.jsxs)(l.default,{style:M.statCard,children:[(0,W.jsx)(l.default,{style:M.statIconContainer,children:(0,W.jsx)(T.default,{size:20,color:"#ffffff",strokeWidth:2.5})}),(0,W.jsx)(f.default,{style:M.statLabel,children:"Distance"}),(0,W.jsx)(f.default,{style:M.statValue,children:(0,A.formatDistance)(H.distance)})]}),(0,W.jsxs)(l.default,{style:M.statCard,children:[(0,W.jsx)(l.default,{style:M.statIconContainer,children:(0,W.jsx)(v.default,{size:20,color:"#ffffff",strokeWidth:2.5})}),(0,W.jsx)(f.default,{style:M.statLabel,children:"Duration"}),(0,W.jsx)(f.default,{style:M.statValue,children:(0,A.formatDuration)(H.duration)})]}),H.difficulty&&(0,W.jsxs)(l.default,{style:M.statCard,children:[(0,W.jsx)(l.default,{style:M.statIconContainer,children:(0,W.jsx)(me,{IconComponent:P.default,emoji:"\u26f0\ufe0f",size:20,color:"#ffffff"})}),(0,W.jsx)(f.default,{style:M.statLabel,children:"Difficulty"}),(0,W.jsx)(f.default,{style:M.statValue,children:H.difficulty})]})]}),H.environment_tags&&H.environment_tags.length>0&&!X&&(0,W.jsxs)(l.default,{style:M.tagsSection,children:[(0,W.jsxs)(l.default,{style:M.sectionHeader,children:[(0,W.jsx)(me,{IconComponent:z.default,emoji:"\ud83c\udff7\ufe0f",size:18,color:E.default.darkGreen}),(0,W.jsx)(f.default,{style:M.sectionTitle,children:"Environment"})]}),(0,W.jsx)(l.default,{style:M.tagsGrid,children:H.environment_tags.map((e,t)=>(0,W.jsx)(l.default,{style:M.tagChip,children:(0,W.jsx)(f.default,{style:M.tagText,children:e})},t))})]}),Se&&!X&&(0,W.jsxs)(i.default,{style:M.editDetailsButton,onPress:()=>{ee(!0)},children:[(0,W.jsx)(p.default,{size:18,color:E.default.primary}),(0,W.jsx)(f.default,{style:M.editDetailsText,children:"Edit Trail Details"})]}),Se&&X&&(0,W.jsxs)(l.default,{style:M.editSection,children:[(0,W.jsx)(f.default,{style:M.editSectionTitle,children:"Trail Name"}),(0,W.jsx)(s.default,{style:M.nameInputInDetails,value:de,onChangeText:ce,placeholder:"Enter trail name",placeholderTextColor:"#9ca3af"}),(0,W.jsx)(f.default,{style:[M.editSectionTitle,{marginTop:24}],children:"Rating"}),(0,W.jsx)(l.default,{style:M.ratingStars,children:[1,2,3,4,5].map(e=>(0,W.jsx)(i.default,{onPress:()=>{ae(e)},style:M.starButton,children:(0,W.jsx)(B.default,{size:32,color:e<=te?"#f59e0b":"#d1d5db",fill:e<=te?"#f59e0b":"none"})},e))}),(0,W.jsx)(f.default,{style:[M.editSectionTitle,{marginTop:24}],children:"Review"}),(0,W.jsx)(s.default,{style:M.reviewInput,value:oe,onChangeText:le,placeholder:"Share your experience on this trail...",placeholderTextColor:"#9ca3af",multiline:!0,numberOfLines:4,textAlignVertical:"top"}),(0,W.jsx)(f.default,{style:[M.editSectionTitle,{marginTop:24}],children:"Difficulty"}),(0,W.jsx)(l.default,{style:M.difficultyOptions,children:V.map(e=>(0,W.jsx)(i.default,{style:[M.difficultyChip,ie===e&&M.difficultyChipSelected],onPress:()=>{se(e)},children:(0,W.jsx)(f.default,{style:[M.difficultyChipText,ie===e&&M.difficultyChipTextSelected],children:e})},e))}),(0,W.jsx)(f.default,{style:[M.editSectionTitle,{marginTop:24}],children:"Environment Tags"}),(0,W.jsx)(l.default,{style:M.tagsGrid,children:_.map(e=>(0,W.jsx)(i.default,{style:[M.editTagChip,re.includes(e)&&M.editTagChipSelected],onPress:()=>(e=>{ne(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e),children:(0,W.jsx)(f.default,{style:[M.editTagChipText,re.includes(e)&&M.editTagChipTextSelected],children:e})},e))}),(0,W.jsxs)(l.default,{style:M.editActionButtons,children:[(0,W.jsxs)(i.default,{style:[M.actionButton,M.cancelActionButton],onPress:()=>{ae(H?.rating||0),le(H?.review||""),ne(H?.environment_tags||[]),se(H?.difficulty||""),ce(H?.name||""),ee(!1)},children:[(0,W.jsx)(R.default,{size:20,color:E.default.darkGreen}),(0,W.jsx)(f.default,{style:M.cancelActionText,children:"Cancel"})]}),(0,W.jsxs)(i.default,{style:[M.actionButton,M.saveActionButton],onPress:async()=>{if(H)try{de.trim()!==H.name&&await r(H.id,de.trim()),await $(H.id,{rating:te>0?te:void 0,review:oe.trim()||void 0,environment_tags:re.length>0?re:void 0,difficulty:ie||void 0}),U(Object.assign({},H,{name:de.trim(),rating:te>0?te:void 0,review:oe.trim()||void 0,environment_tags:re.length>0?re:void 0,difficulty:ie||void 0})),Z(de.trim()),ee(!1),d.default.alert("Success","Trail details updated!")}catch{d.default.alert("Error","Failed to update trail details. Please try again.")}},children:[(0,W.jsx)(S.default,{size:20,color:"#fff"}),(0,W.jsx)(f.default,{style:M.saveActionText,children:"Save"})]})]})]}),(0,W.jsxs)(l.default,{style:M.mapSection,children:[(0,W.jsxs)(l.default,{style:M.sectionHeader,children:[(0,W.jsx)(me,{IconComponent:k.default,emoji:"\ud83e\udded",size:18,color:E.default.darkGreen}),(0,W.jsx)(f.default,{style:M.sectionTitle,children:"Route Map"})]}),(0,W.jsx)(l.default,{style:M.mapContainer,children:(0,W.jsx)(y.default,{coordinates:we,style:M.map,initialRegion:Ce||void 0,scrollEnabled:!1,zoomEnabled:!1})}),(0,W.jsxs)(i.default,{style:M.directionsButton,onPress:()=>{if(!H||0===(H.coordinates?.length??0))return void d.default.alert("Error","Location not available for this trail");const e=H.coordinates[0].latitude,t=H.coordinates[0].longitude,a=(H.name,`https://www.google.com/maps/search/?api=1&query=${e},${t}`);c.default.canOpenURL(a).then(e=>{e?c.default.openURL(a):d.default.alert("Error","Unable to open maps application")})},children:[(0,W.jsx)(k.default,{size:18,color:"#fff"}),(0,W.jsx)(f.default,{style:M.directionsButtonText,children:"Get Directions"})]})]}),(0,W.jsxs)(l.default,{children:[(0,W.jsx)(f.default,{style:M.detailsTitle,children:"Additional Details"}),void 0!==H.maxElevation&&(0,W.jsxs)(l.default,{style:M.detailRow,children:[(0,W.jsx)(l.default,{style:M.detailIcon,children:(0,W.jsx)(me,{IconComponent:P.default,emoji:"\u26f0\ufe0f",size:18,color:E.default.primary})}),(0,W.jsxs)(l.default,{style:M.detailContent,children:[(0,W.jsx)(f.default,{style:M.detailLabel,children:"Elevation Gain"}),(0,W.jsxs)(f.default,{style:M.detailValue,children:[H.maxElevation,"m"]})]})]}),H.pace&&(0,W.jsxs)(l.default,{style:M.detailRow,children:[(0,W.jsx)(l.default,{style:M.detailIcon,children:(0,W.jsx)(me,{IconComponent:x.default,emoji:"\ud83c\udfc3",size:18,color:E.default.primary})}),(0,W.jsxs)(l.default,{style:M.detailContent,children:[(0,W.jsx)(f.default,{style:M.detailLabel,children:"Pace"}),(0,W.jsxs)(f.default,{style:M.detailValue,children:[H.pace," /km"]})]})]}),H.speed&&(0,W.jsxs)(l.default,{style:M.detailRow,children:[(0,W.jsx)(l.default,{style:M.detailIcon,children:(0,W.jsx)(me,{IconComponent:x.default,emoji:"\u26a1",size:18,color:E.default.primary})}),(0,W.jsxs)(l.default,{style:M.detailContent,children:[(0,W.jsx)(f.default,{style:M.detailLabel,children:"Max Speed"}),(0,W.jsxs)(f.default,{style:M.detailValue,children:[H.speed.toFixed(1)," km/h"]})]})]}),(0,W.jsxs)(l.default,{style:M.detailRow,children:[(0,W.jsx)(l.default,{style:M.detailIcon,children:(0,W.jsx)(me,{IconComponent:w.default,emoji:"\ud83d\udcc5",size:18,color:E.default.primary})}),(0,W.jsxs)(l.default,{style:M.detailContent,children:[(0,W.jsx)(f.default,{style:M.detailLabel,children:"Date & Time"}),(0,W.jsx)(f.default,{style:M.detailValue,children:new Date(H.date).toLocaleString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})})]})]})]})]})})]})]})}const M=r.default.create({container:{flex:1,backgroundColor:E.default.background},headerButtons:{position:"absolute",left:0,right:0,zIndex:100,flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingHorizontal:16},headerButton:{width:44,height:44,borderRadius:22,backgroundColor:"#ffffff",justifyContent:"center",alignItems:"center",shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.15,shadowRadius:4,elevation:4},headerRightButtons:{flexDirection:"row",gap:12},scrollContainer:{flex:1},scrollContent:{paddingBottom:32},loadingContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:E.default.background},loadingText:{marginTop:16,fontSize:16,color:E.default.lightGreen,fontWeight:"500"},heroSection:{position:"relative"},heroImageContainer:{width:"100%",height:500,position:"relative"},heroImage:{width:"100%",height:"100%",backgroundColor:"#e5e7eb"},heroGradient:{position:"absolute",bottom:0,left:0,right:0,height:100},changePhotoFab:{position:"absolute",bottom:80,right:20,width:56,height:56,borderRadius:28,backgroundColor:E.default.primary,justifyContent:"center",alignItems:"center",shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:8,elevation:6},addPhotoContainer:{width:"100%",height:280,backgroundColor:E.default.lightGreen,justifyContent:"center",alignItems:"center",paddingHorizontal:32},addPhotoIcon:{width:72,height:72,borderRadius:36,backgroundColor:E.default.background,justifyContent:"center",alignItems:"center",marginBottom:16},addPhotoText:{fontSize:18,fontWeight:"600",color:E.default.darkGreen,marginBottom:4},addPhotoSubtext:{fontSize:14,color:E.default.mediumGreen},contentWrapper:{backgroundColor:E.default.background,borderTopLeftRadius:24,borderTopRightRadius:24,marginTop:-24,zIndex:10},content:{padding:24},titleSection:{marginBottom:20},titleRow:{flexDirection:"row",alignItems:"flex-start",gap:12,marginBottom:8},title:{flex:1,fontSize:32,fontWeight:"700",color:E.default.darkGreen,lineHeight:40},editIconButton:{width:40,height:40,borderRadius:20,backgroundColor:E.default.lightGreen,justifyContent:"center",alignItems:"center",marginTop:4},nameEditContainer:{marginBottom:8},nameInput:{fontSize:28,fontWeight:"700",color:E.default.darkGreen,backgroundColor:"#fff",borderWidth:2,borderColor:E.default.primary,borderRadius:12,padding:12,marginBottom:12},nameInputInDetails:{fontSize:16,color:E.default.darkGreen,backgroundColor:E.default.background,borderWidth:1,borderColor:E.default.lightGreen,borderRadius:12,padding:16},editButtons:{flexDirection:"row",gap:8},iconButton:{width:44,height:44,borderRadius:22,justifyContent:"center",alignItems:"center"},saveIconButton:{backgroundColor:E.default.primary},cancelIconButton:{backgroundColor:E.default.lightGreen},locationRow:{flexDirection:"row",alignItems:"center",gap:6,marginBottom:12},location:{fontSize:16,color:E.default.mediumGreen,fontWeight:"500"},ratingRow:{flexDirection:"row",gap:4},reviewCard:{backgroundColor:"#fff",borderRadius:16,padding:20,marginBottom:24,borderWidth:1,borderColor:E.default.paleYellow},reviewText:{fontSize:16,color:E.default.darkGreen,lineHeight:24},statsSection:{flexDirection:"row",flexWrap:"wrap",gap:12,marginBottom:24},statCard:{flex:1,minWidth:100,backgroundColor:"#fff",borderRadius:16,padding:16,alignItems:"center",shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.05,shadowRadius:8,elevation:2},statIconContainer:{width:44,height:44,borderRadius:22,backgroundColor:E.default.primary,justifyContent:"center",alignItems:"center",marginBottom:12},statLabel:{fontSize:13,color:E.default.mediumGreen,fontWeight:"500",marginBottom:4},statValue:{fontSize:20,color:E.default.darkGreen,fontWeight:"700"},tagsSection:{backgroundColor:"#fff",borderRadius:16,padding:20,marginBottom:20,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.05,shadowRadius:8,elevation:2},sectionHeader:{flexDirection:"row",alignItems:"center",gap:8,marginBottom:16},sectionTitle:{fontSize:18,fontWeight:"700",color:E.default.darkGreen},tagsGrid:{flexDirection:"row",flexWrap:"wrap",gap:8},tagChip:{backgroundColor:E.default.lightGreen,paddingHorizontal:16,paddingVertical:8,borderRadius:20},tagText:{fontSize:14,fontWeight:"500",color:E.default.darkGreen},editDetailsButton:{flexDirection:"row",alignItems:"center",justifyContent:"center",gap:8,backgroundColor:"#fff",borderRadius:12,paddingVertical:14,paddingHorizontal:20,marginBottom:20,borderWidth:2,borderColor:E.default.primary},editDetailsText:{fontSize:16,fontWeight:"600",color:E.default.primary},editSection:{backgroundColor:"#fff",borderRadius:16,padding:20,marginBottom:20,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.05,shadowRadius:8,elevation:2},editSectionTitle:{fontSize:16,fontWeight:"700",color:E.default.darkGreen,marginBottom:12},ratingStars:{flexDirection:"row",gap:8},starButton:{padding:4},reviewInput:{backgroundColor:E.default.background,borderWidth:1,borderColor:E.default.lightGreen,borderRadius:12,padding:16,fontSize:15,color:E.default.darkGreen,minHeight:120},difficultyOptions:{flexDirection:"row",gap:8},difficultyChip:{flex:1,paddingVertical:12,paddingHorizontal:16,borderRadius:12,backgroundColor:E.default.background,borderWidth:2,borderColor:E.default.lightGreen,alignItems:"center"},difficultyChipSelected:{backgroundColor:E.default.primary,borderColor:E.default.primary},difficultyChipText:{fontSize:15,fontWeight:"600",color:E.default.mediumGreen},difficultyChipTextSelected:{color:"#fff"},editTagChip:{paddingHorizontal:16,paddingVertical:8,borderRadius:20,backgroundColor:E.default.background,borderWidth:1.5,borderColor:E.default.lightGreen},editTagChipSelected:{backgroundColor:E.default.primary,borderColor:E.default.primary},editTagChipText:{fontSize:14,fontWeight:"500",color:E.default.mediumGreen},editTagChipTextSelected:{color:"#fff"},editActionButtons:{flexDirection:"row",gap:12,marginTop:24},actionButton:{flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center",gap:8,paddingVertical:14,borderRadius:12},cancelActionButton:{backgroundColor:E.default.background,borderWidth:2,borderColor:E.default.lightGreen},cancelActionText:{fontSize:16,fontWeight:"600",color:E.default.darkGreen},saveActionButton:{backgroundColor:E.default.primary},saveActionText:{fontSize:16,fontWeight:"600",color:"#fff"},mapSection:{marginBottom:20},mapContainer:{height:260,borderRadius:16,overflow:"hidden",marginBottom:12,borderWidth:1,borderColor:E.default.lightGreen},map:{width:"100%",height:"100%"},webMapPlaceholder:{justifyContent:"center",alignItems:"center",backgroundColor:E.default.lightGreen},webMapText:{marginTop:12,fontSize:14,color:E.default.mediumGreen},directionsButton:{flexDirection:"row",alignItems:"center",justifyContent:"center",backgroundColor:E.default.primary,borderRadius:12,paddingVertical:16,paddingHorizontal:24,gap:10,shadowColor:E.default.primary,shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:8,elevation:4},directionsButtonText:{fontSize:16,fontWeight:"700",color:"#fff"},detailsSection:{backgroundColor:"#fff",borderRadius:16,padding:20,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.05,shadowRadius:8,elevation:2},detailsTitle:{fontSize:18,fontWeight:"700",color:E.default.darkGreen,marginBottom:16},detailRow:{flexDirection:"row",alignItems:"flex-start",paddingVertical:12,borderBottomWidth:1,borderBottomColor:E.default.background},detailIcon:{width:36,height:36,borderRadius:18,backgroundColor:E.default.lightGreen,justifyContent:"center",alignItems:"center",marginRight:12},detailContent:{flex:1},detailLabel:{fontSize:13,fontWeight:"600",color:E.default.mediumGreen,marginBottom:2},detailValue:{fontSize:16,color:E.default.darkGreen,fontWeight:"500"}})},3764(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>m});var o=a(6665),l=a(6283),r=a(3929),n=a(6773),i=a(5648),s=a(3668),d=a(4767),c=a(1690),u=a(530),f=a(9637),g=a(3353),h=a(630),y=a(397);function m(){const e=(0,f.useRouter)(),{requestRegistration:t,verifyRegistration:a}=(0,g.useAuth)(),[s,m]=(0,o.useState)(""),[x,b]=(0,o.useState)(""),[j,w]=(0,o.useState)(""),[C,S]=(0,o.useState)("info"),[v,T]=(0,o.useState)(!1);return(0,y.jsx)(d.default,{style:p.container,behavior:"height",children:(0,y.jsxs)(r.default,{style:p.content,children:[(0,y.jsxs)(r.default,{style:p.header,children:[(0,y.jsx)(h.default,{size:64,color:"#5d6b4a"}),(0,y.jsx)(l.default,{style:p.title,children:"Create Account"}),(0,y.jsx)(l.default,{style:p.subtitle,children:"Sign up to start tracking your dog walks"})]}),(0,y.jsxs)(r.default,{style:p.form,children:["info"===C?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(r.default,{style:p.inputContainer,children:[(0,y.jsx)(l.default,{style:p.label,children:"Name"}),(0,y.jsx)(n.default,{style:p.input,placeholder:"Your Name",value:x,onChangeText:b,autoCapitalize:"words",editable:!v})]}),(0,y.jsxs)(r.default,{style:p.inputContainer,children:[(0,y.jsx)(l.default,{style:p.label,children:"Email"}),(0,y.jsx)(n.default,{style:p.input,placeholder:"your@email.com",value:s,onChangeText:m,autoCapitalize:"none",keyboardType:"email-address",autoComplete:"email",editable:!v})]}),(0,y.jsx)(i.default,{style:[p.button,v&&p.buttonDisabled],onPress:async()=>{if(s&&x){0,T(!0);try{await t(s.trim().toLowerCase(),x.trim()),S("otp")}catch(e){0,console.error("Request registration error:",e),c.default.alert("Error",e.message||"Failed to request registration")}finally{T(!1)}}else c.default.alert("Error","Please fill in all fields")},disabled:v,children:v?(0,y.jsx)(u.default,{color:"#fff"}):(0,y.jsx)(l.default,{style:p.buttonText,children:"Send OTP"})})]}):(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(r.default,{style:p.inputContainer,children:[(0,y.jsx)(l.default,{style:p.label,children:"OTP Code"}),(0,y.jsx)(n.default,{style:p.input,placeholder:"Enter 6-digit code",value:j,onChangeText:w,keyboardType:"number-pad",maxLength:6,editable:!v}),(0,y.jsxs)(l.default,{style:p.helperText,children:["Sent to ",s]})]}),(0,y.jsx)(i.default,{style:[p.button,v&&p.buttonDisabled],onPress:async()=>{if(j){0,T(!0);try{await a(s.trim().toLowerCase(),j),e.replace("/")}catch(t){0,console.error("Verify registration error:",t),c.default.alert("Error",t.message||"Invalid OTP code")}finally{T(!1)}}else c.default.alert("Error","Please enter the OTP code")},disabled:v,children:v?(0,y.jsx)(u.default,{color:"#fff"}):(0,y.jsx)(l.default,{style:p.buttonText,children:"Verify & Sign Up"})}),(0,y.jsx)(i.default,{style:p.secondaryButton,onPress:()=>S("info"),disabled:v,children:(0,y.jsx)(l.default,{style:p.secondaryButtonText,children:"Change Info"})})]}),(0,y.jsxs)(r.default,{style:p.footer,children:[(0,y.jsx)(l.default,{style:p.footerText,children:"Already have an account? "}),(0,y.jsx)(i.default,{onPress:()=>{e.push("/login")},children:(0,y.jsx)(l.default,{style:p.linkText,children:"Sign In"})})]})]})]})})}const p=s.default.create({container:{flex:1,backgroundColor:"#F8F7F2"},content:{flex:1,padding:24,justifyContent:"center"},header:{alignItems:"center",marginBottom:48},title:{fontSize:32,fontWeight:"700",color:"#1a1f0a",marginTop:16},subtitle:{fontSize:16,color:"#6b7280",marginTop:8,textAlign:"center"},form:{width:"100%"},inputContainer:{marginBottom:20},label:{fontSize:14,fontWeight:"600",color:"#5d6b4a",marginBottom:8},input:{backgroundColor:"#fff",borderWidth:1,borderColor:"#a8ad8e",borderRadius:12,padding:16,fontSize:16,color:"#1a1f0a"},helperText:{fontSize:12,color:"#6b7280",marginTop:8},button:{backgroundColor:"#5d6b4a",borderRadius:12,padding:16,alignItems:"center",marginTop:12},buttonDisabled:{opacity:.6},buttonText:{fontSize:16,fontWeight:"600",color:"#fff"},secondaryButton:{padding:16,alignItems:"center",marginTop:8},secondaryButtonText:{fontSize:14,fontWeight:"600",color:"#5d6b4a"},footer:{flexDirection:"row",justifyContent:"center",alignItems:"center",marginTop:24},footerText:{fontSize:14,color:"#6b7280"},linkText:{fontSize:14,fontWeight:"600",color:"#5d6b4a"}})},4101(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>m});var o=a(6665),l=a(6283),r=a(3929),n=a(6773),i=a(5648),s=a(3668),d=a(4767),c=a(1690),u=a(530),f=a(9637),g=a(3353),h=a(5894),y=a(397);function m(){const e=(0,f.useRouter)(),{requestOtp:t,verifyOtp:a}=(0,g.useAuth)(),[s,m]=(0,o.useState)(""),[x,b]=(0,o.useState)(""),[j,w]=(0,o.useState)("email"),[C,S]=(0,o.useState)(!1);return(0,y.jsx)(d.default,{style:p.container,behavior:"height",children:(0,y.jsxs)(r.default,{style:p.content,children:[(0,y.jsxs)(r.default,{style:p.header,children:[(0,y.jsx)(h.Image,{source:{uri:"https://pub-e001eb4506b145aa938b5d3badbff6a5.r2.dev/attachments/dae4myluqaizgiwvqbwx1"},style:p.logo,contentFit:"contain"}),(0,y.jsx)(l.default,{style:p.title,children:"Welcome Back"}),(0,y.jsx)(l.default,{style:p.subtitle,children:"Sign in to track your dog walks"})]}),(0,y.jsxs)(r.default,{style:p.form,children:["email"===j?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(r.default,{style:p.inputContainer,children:[(0,y.jsx)(l.default,{style:p.label,children:"Email"}),(0,y.jsx)(n.default,{style:p.input,placeholder:"your@email.com",value:s,onChangeText:m,autoCapitalize:"none",keyboardType:"email-address",autoComplete:"email",editable:!C})]}),(0,y.jsx)(i.default,{style:[p.button,C&&p.buttonDisabled],onPress:async()=>{if(s){0,S(!0);try{await t(s.trim().toLowerCase()),w("otp")}catch(e){0,console.error("Request OTP error:",e),c.default.alert("Error",e.message||"Failed to request OTP")}finally{S(!1)}}else c.default.alert("Error","Please enter your email")},disabled:C,children:C?(0,y.jsx)(u.default,{color:"#fff"}):(0,y.jsx)(l.default,{style:p.buttonText,children:"Send OTP"})})]}):(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(r.default,{style:p.inputContainer,children:[(0,y.jsx)(l.default,{style:p.label,children:"OTP Code"}),(0,y.jsx)(n.default,{style:p.input,placeholder:"Enter 6-digit code",value:x,onChangeText:b,keyboardType:"number-pad",maxLength:6,editable:!C}),(0,y.jsxs)(l.default,{style:p.helperText,children:["Sent to ",s]})]}),(0,y.jsx)(i.default,{style:[p.button,C&&p.buttonDisabled],onPress:async()=>{if(x){0,S(!0);try{await a(s.trim().toLowerCase(),x),e.replace("/")}catch(t){0,console.error("Verify OTP error:",t),c.default.alert("Error",t.message||"Invalid OTP code")}finally{S(!1)}}else c.default.alert("Error","Please enter the OTP code")},disabled:C,children:C?(0,y.jsx)(u.default,{color:"#fff"}):(0,y.jsx)(l.default,{style:p.buttonText,children:"Verify & Sign In"})}),(0,y.jsx)(i.default,{style:p.secondaryButton,onPress:()=>w("email"),disabled:C,children:(0,y.jsx)(l.default,{style:p.secondaryButtonText,children:"Change Email"})})]}),(0,y.jsxs)(r.default,{style:p.footer,children:[(0,y.jsx)(l.default,{style:p.footerText,children:"Don't have an account? "}),(0,y.jsx)(i.default,{onPress:()=>{e.push("/signup")},children:(0,y.jsx)(l.default,{style:p.linkText,children:"Sign Up"})})]})]})]})})}const p=s.default.create({container:{flex:1,backgroundColor:"#F8F7F2"},content:{flex:1,padding:24,justifyContent:"center"},header:{alignItems:"center",marginBottom:48},logo:{width:100,height:100},title:{fontSize:32,fontWeight:"700",color:"#1a1f0a",marginTop:16},subtitle:{fontSize:16,color:"#6b7280",marginTop:8,textAlign:"center"},form:{width:"100%"},inputContainer:{marginBottom:20},label:{fontSize:14,fontWeight:"600",color:"#5d6b4a",marginBottom:8},input:{backgroundColor:"#fff",borderWidth:1,borderColor:"#a8ad8e",borderRadius:12,padding:16,fontSize:16,color:"#1a1f0a"},helperText:{fontSize:12,color:"#6b7280",marginTop:8},button:{backgroundColor:"#5d6b4a",borderRadius:12,padding:16,alignItems:"center",marginTop:12},buttonDisabled:{opacity:.6},buttonText:{fontSize:16,fontWeight:"600",color:"#fff"},secondaryButton:{padding:16,alignItems:"center",marginTop:8},secondaryButtonText:{fontSize:14,fontWeight:"600",color:"#5d6b4a"},footer:{flexDirection:"row",justifyContent:"center",alignItems:"center",marginTop:24},footerText:{fontSize:14,color:"#6b7280"},linkText:{fontSize:14,fontWeight:"600",color:"#5d6b4a"}})},4395(e){e.exports={},e.exports.default=e.exports},4492(e,t,a){"use strict";a.r(t),a.d(t,{customAlphabet:()=>o,nanoid:()=>l});const o=(e,t=21)=>(a=t)=>{let o="",l=0|a;for(;l--;)o+=e[Math.random()*e.length|0];return o},l=(e=21)=>{let t="",a=0|e;for(;a--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[64*Math.random()|0];return t}},4509(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>F});var o=a(6665),l=a(9637),r=a(6283),n=a(3929),i=a(2772),s=a(5648),d=a(530),c=a(5009),u=a(6773),f=a(8264),g=a(932),h=a(5894),y=a(893),m=a(8833),p=a(3087),x=a(2994),b=a(1449),j=a(3048),w=a(1168),C=a(8032),S=a(1858),v=a(5082),T=a(4550),k=a(2964),I=a(6746),B=a(9269),z=a(9600),P=a(2699),R=a(397);const D=[{id:"nearby",name:"Nearby",icon:w.default},{id:"popular",name:"Popular",icon:j.default},{id:"beaches",name:"Beaches",icon:T.default}];function F(){const e=(0,l.useRouter)(),t=(0,m.useSafeAreaInsets)(),{loadNearbyTrails:a,saveTrailBookmark:j,removeTrailBookmark:T,isTrailSaved:F}=(0,I.useTrails)(),[L,A]=(0,o.useState)("nearby"),[E,O]=(0,o.useState)([]),[W,_]=(0,o.useState)(!0),[,V]=(0,o.useState)(void 0),[N,M]=(0,o.useState)({}),[$,G]=(0,o.useState)(""),[H,U]=(0,o.useState)(!1),[q,J]=(0,o.useState)(""),[Y,K]=(0,o.useState)([]),Q=(0,o.useCallback)(async()=>{{J("Current location");try{if(navigator&&navigator.geolocation)return void navigator.geolocation.getCurrentPosition(async e=>{try{const t=await a(e.coords.latitude,e.coords.longitude);O(t)}catch(t){console.error("Failed to load nearby trails with browser location:",t);const e=await a();O(e)}finally{_(!1)}},async()=>{const e=await a();O(e),_(!1)})}catch(e){console.error("Geolocation not available on web:",e)}const t=await a();return O(t),void _(!1)}},[a]);(0,o.useEffect)(()=>{Q()},[Q]),(0,l.useFocusEffect)((0,o.useCallback)(()=>{console.log("Explore tab focused - refreshing nearby trails"),Q()},[Q]));const Z=(0,o.useCallback)(()=>{const e=$.toLowerCase(),t=E.filter(t=>{const a=t.name?.toLowerCase()||"",o=t.city?.toLowerCase()||"",l=t.country?.toLowerCase()||"";return a.includes(e)||o.includes(e)||l.includes(e)}).map(e=>({id:e.id,name:e.name||`Trail ${new Date(e.date).toLocaleDateString()}`,location:e.city?`${e.city}, ${e.country||"Unknown"}`:"Location unknown",type:"trail"})).slice(0,6);K(t)},[$,E]);(0,o.useEffect)(()=>{$.trim()?Z():K([])},[$,Z]);const X=()=>{U(!1),G(""),K([])},ee=e=>{if(!N[e]){const t=new c.default.Value(1);return M(a=>Object.assign({},a,{[e]:t})),t}return N[e]},te=(0,o.useCallback)(e=>{let t=e;return"popular"===L?t=[...t].sort((e,t)=>(t.rating||0)-(e.rating||0)):"beaches"===L&&(t=t.filter(e=>(e.environment_tags||[]).some(e=>e.toLowerCase().includes("beach")))),t},[L])(E);return(0,R.jsxs)(n.default,{style:P.default.safeContainer,children:[(0,R.jsxs)(i.default,{style:P.default.container,showsVerticalScrollIndicator:!1,stickyHeaderIndices:[0],children:[(0,R.jsxs)(n.default,{style:[P.default.stickyHeader,{paddingTop:t.top+16}],children:[(0,R.jsxs)(n.default,{style:P.default.stickySearchContainer,children:[(0,R.jsxs)(s.default,{style:P.default.searchBar,onPress:()=>{U(!0)},activeOpacity:.7,children:[(0,R.jsx)(S.default,{size:20,color:"#9ca3af"}),(0,R.jsx)(r.default,{style:P.default.searchPlaceholder,children:"Find trails"})]}),(0,R.jsx)(s.default,{style:P.default.demoButton,onPress:()=>e.push("/trail/demo-trail"),children:(0,R.jsx)(r.default,{style:P.default.demoButtonText,children:"Demo"})})]}),(0,R.jsx)(n.default,{style:P.default.categoriesSection,children:(0,R.jsx)(i.default,{horizontal:!0,showsHorizontalScrollIndicator:!1,contentContainerStyle:P.default.categoriesScroll,children:D.map(e=>{const t=e.icon,a=L===e.id;return(0,R.jsxs)(s.default,{style:[P.default.categoryButton,a&&P.default.categoryButtonActive],onPress:()=>{return t=e.id,void A(t);var t},children:[(0,R.jsx)(t,{size:20,color:a?"#fff":"#9ca3af",strokeWidth:2}),(0,R.jsx)(r.default,{style:[P.default.categoryText,a&&P.default.categoryTextActive],children:e.name})]},e.id)})})})]}),(0,R.jsx)(n.default,{style:P.default.categoryTrailsSection,children:W?(0,R.jsxs)(n.default,{style:P.default.loadingContainer,children:[(0,R.jsx)(d.default,{size:"large",color:"#64748b"}),(0,R.jsx)(r.default,{style:P.default.loadingText,children:"Loading trails..."})]}):te.length>0?te.map(t=>{const a=ee(t.id),o=F(t.id);return(0,R.jsxs)(s.default,{style:P.default.largeTrailCard,onPress:()=>{return a=t.id,void e.push(`/trail/${a}`);var a},children:[t.photo?(0,R.jsx)(h.Image,{source:{uri:t.photo},style:P.default.largeTrailImage,contentFit:"cover",cachePolicy:"memory-disk"}):(0,R.jsx)(z.default,{coordinates:t.coordinates,path:t.path,style:P.default.largeTrailImage,startLatitude:t.startLatitude,startLongitude:t.startLongitude}),(0,R.jsx)(y.LinearGradient,{colors:["rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0.25)","rgba(0, 0, 0, 0.6)"],locations:[0,.3,.6,1],style:P.default.cardGradient}),(0,R.jsx)(s.default,{style:P.default.bookmarkButton,onPress:e=>{e.stopPropagation(),(async(e,t=!1)=>{if(!t&&!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))return void console.log("Cannot bookmark mock trail:",e);const a=ee(e),o=F(e);c.default.sequence([c.default.timing(a,{toValue:.6,duration:100,useNativeDriver:!0}),c.default.spring(a,{toValue:1,friction:3,tension:100,useNativeDriver:!0})]).start();try{o?await T(e):await j(e)}catch(l){console.error("Failed to toggle bookmark:",l)}})(t.id,!0)},children:(0,R.jsx)(c.default.View,{style:{transform:[{scale:a}]},children:(0,R.jsx)(x.default,{size:20,color:o?"#000":"#64748b",fill:o?"#000":"none",strokeWidth:2})})}),(0,R.jsxs)(n.default,{style:P.default.cardOverlayContent,children:[(0,R.jsx)(r.default,{style:P.default.overlayTrailName,children:t.name||`Trail ${new Date(t.date).toLocaleDateString()}`}),(0,R.jsx)(r.default,{style:P.default.overlayLocation,children:t.city?`${t.city}, ${t.country||"Unknown"}`:"Location unknown"}),(0,R.jsxs)(n.default,{style:P.default.overlayBadges,children:[t.difficulty&&(0,R.jsxs)(n.default,{style:P.default.badge,children:[(0,R.jsx)(p.default,{size:14,color:"#d4d4a0",strokeWidth:2.5}),(0,R.jsx)(r.default,{style:P.default.badgeText,children:t.difficulty})]}),(0,R.jsxs)(n.default,{style:P.default.badge,children:[(0,R.jsx)(w.default,{size:14,color:"#d4d4a0",strokeWidth:2.5}),(0,R.jsx)(r.default,{style:P.default.badgeText,children:(0,B.formatDistance)(t.distance)})]}),"number"===typeof t.distance_from_user&&(0,R.jsxs)(n.default,{style:P.default.badge,children:[(0,R.jsx)(w.default,{size:14,color:"#d4d4a0",strokeWidth:2.5}),(0,R.jsx)(r.default,{style:P.default.badgeText,children:(0,B.formatDistance)(t.distance_from_user)})]}),t.rating&&(0,R.jsxs)(n.default,{style:P.default.badge,children:[(0,R.jsx)(v.default,{size:14,color:"#fbbf24",fill:"#fbbf24",strokeWidth:2}),(0,R.jsx)(r.default,{style:P.default.badgeText,children:t.rating.toFixed(1)})]})]})]})]},t.id)}):(0,R.jsxs)(n.default,{style:P.default.emptyContainer,children:[(0,R.jsx)(w.default,{size:48,color:"#9ca3af"}),(0,R.jsx)(r.default,{style:P.default.emptyText,children:"No trails found yet. Record a trail to share with others!"})]})}),(0,R.jsx)(n.default,{style:P.default.bottomPadding})]}),(0,R.jsx)(f.default,{visible:H,animationType:"slide",presentationStyle:"fullScreen",onRequestClose:X,children:(0,R.jsxs)(n.default,{style:[P.default.searchModalContainer,{paddingTop:t.top}],children:[(0,R.jsxs)(n.default,{style:P.default.searchModalHeader,children:[(0,R.jsx)(s.default,{style:P.default.backButton,onPress:X,children:(0,R.jsx)(b.default,{size:24,color:"#5d6b4a"})}),(0,R.jsxs)(n.default,{style:P.default.searchModalInputContainer,children:[(0,R.jsx)(u.default,{style:P.default.searchModalInput,placeholder:"Find trails",placeholderTextColor:"#9ca3af",value:$,onChangeText:G,autoFocus:!0,returnKeyType:"search"}),$.length>0&&(0,R.jsx)(s.default,{style:P.default.clearButton,onPress:()=>G(""),children:(0,R.jsx)(k.default,{size:20,color:"#64748b"})})]})]}),(0,R.jsxs)(n.default,{style:P.default.searchModalContent,children:[""===$.trim()&&(0,R.jsxs)(s.default,{style:P.default.currentLocationItem,onPress:()=>{U(!1),G(""),K([])},children:[(0,R.jsx)(n.default,{style:P.default.locationIconContainer,children:(0,R.jsx)(C.default,{size:20,color:"#5d6b4a"})}),(0,R.jsxs)(n.default,{style:P.default.locationTextContainer,children:[(0,R.jsx)(r.default,{style:P.default.locationTitle,children:"Current location"}),(0,R.jsx)(r.default,{style:P.default.locationSubtitle,children:q})]})]}),Y.length>0&&(0,R.jsx)(g.default,{data:Y,keyExtractor:e=>e.id,renderItem:({item:t})=>(0,R.jsxs)(s.default,{style:P.default.suggestionItem,onPress:()=>{return a=t.id,U(!1),G(""),K([]),void e.push(`/trail/${a}`);var a},children:[(0,R.jsx)(n.default,{style:P.default.suggestionIconContainer,children:(0,R.jsx)(w.default,{size:20,color:"#64748b"})}),(0,R.jsxs)(n.default,{style:P.default.suggestionTextContainer,children:[(0,R.jsx)(r.default,{style:P.default.suggestionTitle,children:t.name}),(0,R.jsx)(r.default,{style:P.default.suggestionSubtitle,children:t.location})]})]}),showsVerticalScrollIndicator:!1})]})]})})]})}},4674(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>C});var o=a(6665),l=a(6283),r=a(3929),n=a(3668),i=a(5648),s=a(6773),d=a(484),c=a(1690),u=a(2772),f=a(530),g=a(9637),h=a(9908),y=a(262),m=a(9281),p=a(5624),x=a(4043),b=a(8833),j=a(594),w=a(397);function C(){const e=(0,g.useRouter)(),t=(0,b.useSafeAreaInsets)(),{dogProfile:a}=(0,h.useDogs)(),[n,C]=(0,o.useState)(""),[v,T]=(0,o.useState)(""),[k,I]=(0,o.useState)(""),[B,z]=(0,o.useState)(null),[P,R]=(0,o.useState)(null),[D,F]=(0,o.useState)(!1),[L,A]=(0,o.useState)(!1);(0,o.useEffect)(()=>{a&&(console.log("Loading existing dog profile for editing:",a),C(a.name),T(a.nickname||""),I(a.age.toString()),z(a.size),R(a.photo||null))},[a]);const E=async()=>{const{status:e}=await y.requestMediaLibraryPermissionsAsync();if("granted"!==e)return void c.default.alert("Permission needed","We need access to your photo library");A(!0);const t=await y.launchImageLibraryAsync({mediaTypes:["images"],allowsEditing:!0,aspect:[1,1],quality:.7});A(!1),!t.canceled&&t.assets[0]&&R(t.assets[0].uri)},O=async()=>{const{status:e}=await y.requestCameraPermissionsAsync();if("granted"!==e)return void c.default.alert("Permission needed","We need camera access to take photos");A(!0);const t=await y.launchCameraAsync({allowsEditing:!0,aspect:[1,1],quality:.7});A(!1),!t.canceled&&t.assets[0]&&R(t.assets[0].uri)};return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(g.Stack.Screen,{options:{headerShown:!1}}),(0,w.jsxs)(u.default,{style:S.container,contentContainerStyle:[S.content,{paddingTop:t.top+20}],children:[(0,w.jsxs)(r.default,{style:S.header,children:[(0,w.jsx)(l.default,{style:S.title,children:a?"Edit dog profile":"Tell us about your dog"}),(0,w.jsx)(l.default,{style:S.subtitle,children:a?"Update your dog's information":"Let's start with the basics"}),!a&&(0,w.jsxs)(r.default,{style:S.progressContainer,children:[(0,w.jsx)(r.default,{style:[S.progressDot,S.progressDotActive]}),(0,w.jsx)(r.default,{style:S.progressDot})]})]}),(0,w.jsxs)(i.default,{style:S.photoContainer,onPress:()=>{c.default.alert("Add Photo","Choose how you want to add a photo",[{text:"Take Photo",onPress:O},{text:"Choose from Library",onPress:E},{text:"Cancel",style:"cancel"}])},disabled:L,children:[L?(0,w.jsx)(f.default,{size:"large",color:"#FFFE77"}):P?(0,w.jsx)(d.default,{source:{uri:P},style:S.photo}):(0,w.jsxs)(r.default,{style:S.photoPlaceholder,children:[(0,w.jsx)(m.default,{size:32,color:"#FFFE77"}),(0,w.jsx)(l.default,{style:S.photoPlaceholderText,children:"Add Photo"})]}),P&&!L&&(0,w.jsx)(r.default,{style:S.photoOverlay,children:(0,w.jsx)(x.default,{size:24,color:"#1a1f0a"})})]}),(0,w.jsxs)(r.default,{style:S.formSection,children:[(0,w.jsx)(l.default,{style:S.label,children:"Name *"}),(0,w.jsx)(s.default,{style:S.input,value:n,onChangeText:C,placeholder:"Enter your dog's name",placeholderTextColor:"#5a6040",autoCapitalize:"words",testID:"dog-name-input"})]}),(0,w.jsxs)(r.default,{style:S.formSection,children:[(0,w.jsx)(l.default,{style:S.label,children:"Nickname (Optional)"}),(0,w.jsx)(s.default,{style:S.input,value:v,onChangeText:T,placeholder:"Enter a nickname",placeholderTextColor:"#5a6040",autoCapitalize:"words",testID:"dog-nickname-input"})]}),(0,w.jsxs)(r.default,{style:S.formSection,children:[(0,w.jsx)(l.default,{style:S.label,children:"Size *"}),(0,w.jsxs)(i.default,{style:S.pickerButton,onPress:()=>{F(!D)},testID:"size-picker-button",children:[(0,w.jsx)(l.default,{style:[S.pickerButtonText,!B&&S.pickerButtonTextPlaceholder],children:B||"Select size"}),(0,w.jsx)(p.default,{size:20,color:"#a8ad8e"})]}),D&&(0,w.jsx)(r.default,{style:S.pickerOptions,children:j.DOG_SIZES.map(e=>(0,w.jsx)(i.default,{style:[S.pickerOption,B===e&&S.pickerOptionSelected],onPress:()=>{z(e),F(!1)},testID:`size-option-${e}`,children:(0,w.jsx)(l.default,{style:[S.pickerOptionText,B===e&&S.pickerOptionTextSelected],children:e})},e))})]}),(0,w.jsxs)(r.default,{style:S.formSection,children:[(0,w.jsx)(l.default,{style:S.label,children:"Age (years) *"}),(0,w.jsx)(s.default,{style:S.input,value:k,onChangeText:I,placeholder:"Enter age",placeholderTextColor:"#5a6040",keyboardType:"numeric",testID:"dog-age-input"})]}),(0,w.jsx)(i.default,{style:[S.nextButton,{marginBottom:t.bottom+20}],onPress:()=>{if(!n.trim())return void c.default.alert("Missing Information","Please enter your dog's name");if(!B)return void c.default.alert("Missing Information","Please select your dog's size");const t=parseInt(k,10);if(!k||isNaN(t)||t<0||t>30)return void c.default.alert("Invalid Age","Please enter a valid age (0-30 years)");e[a?"replace":"push"]({pathname:"/onboarding/dog-personality",params:{name:n.trim(),nickname:v.trim(),age:t.toString(),size:B,photo:P||"",isEditing:a?"true":"false"}})},testID:"next-button",children:(0,w.jsx)(l.default,{style:S.nextButtonText,children:"Next"})})]})]})}const S=n.default.create({container:{flex:1,backgroundColor:"#1a1f0a"},content:{padding:24},header:{marginBottom:32,alignItems:"center"},title:{fontSize:28,fontWeight:"700",color:"#FFFE77",marginBottom:8,textAlign:"center"},subtitle:{fontSize:16,color:"#a8ad8e",textAlign:"center",marginBottom:24},progressContainer:{flexDirection:"row",gap:8},progressDot:{width:8,height:8,borderRadius:4,backgroundColor:"#3d4520"},progressDotActive:{backgroundColor:"#FFFE77"},photoContainer:{width:140,height:140,borderRadius:70,alignSelf:"center",marginBottom:32,overflow:"hidden"},photo:{width:"100%",height:"100%"},photoPlaceholder:{width:"100%",height:"100%",backgroundColor:"#282E10",justifyContent:"center",alignItems:"center",gap:8},photoPlaceholderText:{fontSize:14,color:"#a8ad8e",fontWeight:"500"},photoOverlay:{position:"absolute",bottom:0,right:0,width:40,height:40,borderRadius:20,backgroundColor:"#FFFE77",justifyContent:"center",alignItems:"center"},formSection:{marginBottom:24},label:{fontSize:15,fontWeight:"600",color:"#FFFE77",marginBottom:8},input:{backgroundColor:"#282E10",borderRadius:12,padding:16,fontSize:16,color:"#FFFE77",borderWidth:1,borderColor:"#3d4520"},pickerButton:{backgroundColor:"#282E10",borderRadius:12,padding:16,flexDirection:"row",justifyContent:"space-between",alignItems:"center",borderWidth:1,borderColor:"#3d4520"},pickerButtonText:{fontSize:16,color:"#FFFE77"},pickerButtonTextPlaceholder:{color:"#5a6040"},pickerOptions:{backgroundColor:"#282E10",borderRadius:12,marginTop:8,borderWidth:1,borderColor:"#3d4520",overflow:"hidden"},pickerOption:{padding:16,borderBottomWidth:1,borderBottomColor:"#1a1f0a"},pickerOptionSelected:{backgroundColor:"rgba(255, 254, 119, 0.15)"},pickerOptionText:{fontSize:16,color:"#a8ad8e"},pickerOptionTextSelected:{color:"#FFFE77",fontWeight:"600"},nextButton:{backgroundColor:"#FFFE77",borderRadius:12,padding:18,alignItems:"center",marginTop:16},nextButtonText:{fontSize:17,fontWeight:"600",color:"#1a1f0a"}})},5209(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>L});var o=a(6665),l=a(6283),r=a(3929),n=a(5648),i=a(1690),s=a(5009),d=a(444),c=a(6725),u=a(6773),f=a(8264),g=a(2772),h=a(7430),y=a(675),m=a(5163),p=a(2981),x=a(9637),b=a(5259),j=a(3271),w=a(5624),C=a(2301),S=a(1168),v=a(8032),T=a(8280),k=a(7353),I=a(1047),B=a(1095),z=a(6746),P=a(3353),R=a(9269),D=a(397);const F="background-location-task";function L(){const{saveTrail:e,getTrailById:t}=(0,z.useTrails)(),{user:a}=(0,P.useAuth)(),L=(0,x.useLocalSearchParams)(),A=(0,x.useRouter)(),E="string"===typeof L.trailId?L.trailId:void 0,O=E?t(E):void 0,W=(0,o.useRef)(null),[_,V]=(0,o.useState)(!1),[N,M]=(0,o.useState)([]),[$,G]=(0,o.useState)(null),[H,U]=(0,o.useState)(0),[q,J]=(0,o.useState)(null),[Y,K]=(0,o.useState)(!0),[Q,Z]=(0,o.useState)(null),X=(0,o.useRef)(null),ee=(0,o.useRef)(null),te=.5*c.default.get("window").height,ae=280,oe=(0,o.useRef)(new s.default.Value(ae)).current,[le,re]=(0,o.useState)(!1),[ne,ie]=(0,o.useState)(0),[se,de]=(0,o.useState)(0),[ce,ue]=(0,o.useState)("0:00"),[fe,ge]=(0,o.useState)(0),[he,ye]=(0,o.useState)(0),[me,pe]=(0,o.useState)(!1),[xe,be]=(0,o.useState)(null),[je,we]=(0,o.useState)(""),[Ce,Se]=(0,o.useState)(""),[ve,Te]=(0,o.useState)(void 0),[ke,Ie]=(0,o.useState)([]),[Be,ze]=(0,o.useState)(void 0);(0,o.useEffect)(()=>{K(!1)},[]);(0,o.useEffect)(()=>{if(H>0){const e=(0,R.calculateTotalDistance)(N)/1e3;if(e>0){const t=H/60/e,a=Math.floor(t),o=Math.round(60*(t-a));ue(`${a}:${o.toString().padStart(2,"0")}`)}}},[H,N]);const Pe=(0,o.useRef)(0),Re=(0,o.useRef)(d.default.create({onStartShouldSetPanResponder:()=>!0,onMoveShouldSetPanResponder:(e,t)=>Math.abs(t.dy)>5,onPanResponderGrant:()=>{Pe.current=oe._value},onPanResponderMove:(e,t)=>{const a=Pe.current-t.dy;a>=ae&&a<=te&&oe.setValue(a)},onPanResponderRelease:(e,t)=>{const a=(te+ae)/2,o=oe._value;t.dy<-50?De():t.dy>50?Fe():o>a?De():Fe()}})).current,De=()=>{re(!0),s.default.spring(oe,{toValue:te,useNativeDriver:!1,tension:50,friction:8}).start()},Fe=()=>{re(!1),s.default.spring(oe,{toValue:ae,useNativeDriver:!1,tension:50,friction:8}).start()},Le=()=>{pe(!1),be(null)};if(!q)return(0,D.jsxs)(r.default,{style:B.default.permissionContainer,children:[(0,D.jsx)(S.default,{size:64,color:"#666"}),(0,D.jsx)(l.default,{style:B.default.permissionTitle,children:"Location Permission Required"}),(0,D.jsx)(l.default,{style:B.default.permissionText,children:"This app needs access to your location to track your dog walks."}),(0,D.jsx)(n.default,{style:B.default.permissionButton,onPress:()=>{(async()=>{try{console.log("Requesting location permissions...");const{status:a}=await y.requestForegroundPermissionsAsync();if(console.log("Foreground permission status:",a),"granted"===a){try{const{status:e}=await y.requestBackgroundPermissionsAsync();console.log("Background permission status:",e),"granted"!==e&&i.default.alert("Background Location Required",'To continue recording your trail when the screen is locked, please enable "Allow all the time" in location settings.',[{text:"OK"}])}catch(e){console.warn("Background permission error (non-critical):",e.message)}J(!0);try{const e=await y.getCurrentPositionAsync({accuracy:m.LocationAccuracy.Balanced}),t={latitude:e.coords.latitude,longitude:e.coords.longitude};G(t),console.log("Initial location:",t)}catch(t){console.warn("Error getting initial location:",t.message)}}else J(!1),i.default.alert("Permission Required","Location permission is required to track your walks.",[{text:"OK"}])}catch(a){console.error("Permission error:",a);const e=a.message||"Failed to get location permission";e.includes("NSLocation")||e.includes("Info.plist")?i.default.alert("Configuration Error","This app needs to be built with a custom development build to use location tracking. Expo Go doesn't support background location tracking.\n\nPlease contact support or build a custom development client.",[{text:"OK"}]):i.default.alert("Error",e),J(!1)}finally{K(!1)}})()},children:(0,D.jsx)(l.default,{style:B.default.permissionButtonText,children:"Grant Permission"})})]});const Ae=(0,R.calculateTotalDistance)(N),Ee=O&&_&&N.length>0&&O.coordinates.length>0?Math.min(Ae/O.distance*100,100):0,Oe=!!O;return(0,D.jsxs)(r.default,{style:B.default.container,children:[$&&(0,D.jsx)(h.default,{ref:W,coordinates:N,style:B.default.map,initialRegion:{latitude:$.latitude,longitude:$.longitude,latitudeDelta:.01,longitudeDelta:.01},showsUserLocation:!0,followsUserLocation:_,showsMyLocationButton:!1}),(0,D.jsx)(n.default,{style:B.default.recenterButton,onPress:async()=>{if(W.current)try{const e=await y.getCurrentPositionAsync({accuracy:m.LocationAccuracy.Balanced}),t={latitude:e.coords.latitude,longitude:e.coords.longitude};G(t),W.current.animateToRegion({latitude:t.latitude,longitude:t.longitude,latitudeDelta:.01,longitudeDelta:.01},500)}catch(e){console.error("Error getting current location:",e),$&&W.current.animateToRegion({latitude:$.latitude,longitude:$.longitude,latitudeDelta:.01,longitudeDelta:.01},500)}},activeOpacity:.8,children:(0,D.jsx)(v.default,{size:24,color:"#5d6b4a"})}),(0,D.jsxs)(s.default.View,{style:[B.default.bottomSheet,{height:s.default.add(oe,92),bottom:0}],children:[(0,D.jsx)(r.default,Object.assign({},Re.panHandlers,{style:B.default.handleBar,children:(0,D.jsxs)(n.default,{style:B.default.handleContainer,onPress:()=>{le?Fe():De()},activeOpacity:.7,children:[(0,D.jsx)(r.default,{style:B.default.handle}),le?(0,D.jsx)(w.default,{size:20,color:"#9ca3af"}):(0,D.jsx)(C.default,{size:20,color:"#9ca3af"})]})})),(0,D.jsxs)(r.default,{style:B.default.bottomSheetContent,children:[(0,D.jsxs)(r.default,{style:B.default.statsGrid,children:[(0,D.jsxs)(r.default,{style:B.default.statItem,children:[(0,D.jsx)(l.default,{style:B.default.statItemLabel,children:"Time"}),(0,D.jsx)(l.default,{style:B.default.statItemValue,children:(0,R.formatDuration)(H)})]}),(0,D.jsxs)(r.default,{style:B.default.statItem,children:[(0,D.jsx)(l.default,{style:B.default.statItemLabel,children:"Distance"}),(0,D.jsx)(l.default,{style:B.default.statItemValue,children:(0,R.formatDistance)(Ae)})]}),(0,D.jsxs)(r.default,{style:B.default.statItem,children:[(0,D.jsx)(l.default,{style:B.default.statItemLabel,children:"Elevation"}),(0,D.jsxs)(l.default,{style:B.default.statItemValue,children:[ne.toFixed(0),"m"]})]}),(0,D.jsxs)(r.default,{style:B.default.statItem,children:[(0,D.jsx)(l.default,{style:B.default.statItemLabel,children:"Pace"}),(0,D.jsxs)(l.default,{style:B.default.statItemValue,children:[ce,"/km"]})]}),(0,D.jsxs)(r.default,{style:B.default.statItem,children:[(0,D.jsx)(l.default,{style:B.default.statItemLabel,children:"Speed"}),(0,D.jsxs)(l.default,{style:B.default.statItemValue,children:[fe.toFixed(1)," km/h"]})]}),Oe&&(0,D.jsxs)(r.default,{style:B.default.statItem,children:[(0,D.jsx)(l.default,{style:B.default.statItemLabel,children:"Progress"}),(0,D.jsxs)(l.default,{style:B.default.statItemValue,children:[Ee.toFixed(0),"%"]})]})]}),(0,D.jsx)(n.default,{style:[B.default.recordButton,_&&B.default.recordButtonActive],onPress:_?async()=>{console.log("Stopping recording...");try{await p.isTaskRegisteredAsync(F)&&await y.stopLocationUpdatesAsync(F)}catch(g){console.error("Error stopping background location:",g)}X.current&&(X.current.remove(),X.current=null),ee.current&&(clearInterval(ee.current),ee.current=null);const e=await b.default.getItem("recording_coordinates"),t=e?JSON.parse(e):N,a=await b.default.getItem("recording_max_elevation"),o=a?parseFloat(a):se,l=await b.default.getItem("recording_max_speed"),r=l?parseFloat(l):he,n=await b.default.getItem("recording_start_time"),s=n?Math.floor((Date.now()-parseInt(n))/1e3):H;if(t.length<2)return i.default.alert("No Trail Data","Not enough data to save this trail. Try walking a bit more!"),V(!1),M([]),U(0),await b.default.removeItem("recording_coordinates"),await b.default.removeItem("recording_max_elevation"),await b.default.removeItem("recording_max_speed"),await b.default.removeItem("recording_start_time"),void await b.default.removeItem("recording_last_update");const d=(0,R.calculateTotalDistance)(t),c=d/1e3;let u="0:00";if(c>0){const e=s/60/c,t=Math.floor(e);u=`${t}:${Math.round(60*(e-t)).toString().padStart(2,"0")}`}const f={id:Date.now().toString(),date:Date.now(),distance:d,duration:s,coordinates:t,city:Q?.city,country:Q?.country,pace:u,speed:r,maxElevation:o};be(f),we(f.name||""),Se(f.description||""),Te(f.photo||void 0),Ie(f.tags||[]),ze(f.difficulty||void 0),pe(!0)}:async()=>{console.log("Starting recording..."),V(!0),M([]),U(0),de(0),ye(0);try{const t=Date.now();await b.default.setItem("recording_start_time",t.toString()),await b.default.removeItem("recording_coordinates"),await b.default.removeItem("recording_max_elevation"),await b.default.removeItem("recording_max_speed"),await b.default.removeItem("recording_last_update");const a=await y.getCurrentPositionAsync({accuracy:m.LocationAccuracy.Balanced});Z(null);const o={latitude:a.coords.latitude,longitude:a.coords.longitude};await b.default.setItem("recording_coordinates",JSON.stringify([o])),M([o]),G(o);try{await y.startLocationUpdatesAsync(F,{accuracy:m.LocationAccuracy.BestForNavigation,distanceInterval:3,timeInterval:1e3,foregroundService:{notificationTitle:"Recording Trail",notificationBody:"TailTrails is tracking your walk",notificationColor:"#2563eb"},pausesUpdatesAutomatically:!1,showsBackgroundLocationIndicator:!0}),console.log("Background location tracking started successfully")}catch(e){console.warn("Background location not available:",e.message),(e.message?.includes("Background location")||e.message?.includes("UIBackgroundModes"))&&i.default.alert("Background Tracking Unavailable","Background location tracking requires a custom development build. The app will continue recording in foreground mode only. Please keep the app open while recording.",[{text:"OK"}])}X.current=await y.watchPositionAsync({accuracy:m.LocationAccuracy.BestForNavigation,distanceInterval:3,timeInterval:1e3},async e=>{const t={latitude:e.coords.latitude,longitude:e.coords.longitude};if(console.log("Foreground position update:",t,"Accuracy:",e.coords.accuracy),G(t),M(e=>{const a=[...e,t];return console.log("Total coordinates:",a.length,"Distance:",(0,R.calculateTotalDistance)(a),"m"),b.default.setItem("recording_coordinates",JSON.stringify(a)).catch(e=>{console.error("Error saving coordinates:",e)}),a}),e.coords.altitude){const t=Math.max(0,e.coords.altitude);ie(t),t>se&&(de(t),await b.default.setItem("recording_max_elevation",t.toString()))}if(e.coords.speed&&e.coords.speed>0){const t=3.6*e.coords.speed;ge(t),t>he&&(ye(t),await b.default.setItem("recording_max_speed",t.toString()))}}),ee.current=setInterval(async()=>{try{const e=await b.default.getItem("recording_start_time");if(e){const t=parseInt(e),a=Math.floor((Date.now()-t)/1e3);U(a)}}catch(e){console.error("Error calculating duration:",e)}},1e3)}catch(t){console.error("Recording error:",t);let e="Failed to start recording. Please try again.";t.message?.includes("rate limit")?e="Please wait a moment before starting a new recording. Location service is temporarily limited.":(t.message?.includes("Background location")||t.message?.includes("UIBackgroundModes"))&&(e="Background location tracking requires a custom development build. Please build the app with EAS or use foreground-only mode."),i.default.alert("Error",e),V(!1)}},activeOpacity:.8,children:_?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(k.default,{size:24,color:"#fff",fill:"#fff"}),(0,D.jsx)(l.default,{style:B.default.recordButtonText,children:"Stop & Save"})]}):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(T.default,{size:24,color:"#fff",fill:"#fff"}),(0,D.jsx)(l.default,{style:B.default.recordButtonText,children:"Start Trail"})]})}),le&&(0,D.jsxs)(r.default,{style:B.default.expandedContent,children:[(0,D.jsx)(r.default,{style:B.default.divider}),(0,D.jsxs)(n.default,{style:B.default.optionRow,onPress:()=>{i.default.alert("Apple Watch","Connect your Apple Watch to sync workout data.")},activeOpacity:.7,children:[(0,D.jsx)(r.default,{style:B.default.optionIconContainer,children:(0,D.jsx)(I.default,{size:24,color:"#5d6b4a"})}),(0,D.jsxs)(r.default,{style:B.default.optionTextContainer,children:[(0,D.jsx)(l.default,{style:B.default.optionTitle,children:"Apple Watch"}),(0,D.jsx)(l.default,{style:B.default.optionSubtitle,children:"Not connected"})]}),(0,D.jsx)(r.default,{style:B.default.optionBadge,children:(0,D.jsx)(l.default,{style:B.default.optionBadgeText,children:"Connect"})})]}),(0,D.jsxs)(n.default,{style:B.default.optionRow,onPress:()=>{i.default.alert("Alerts","Configure alerts for distance milestones and pace notifications.")},activeOpacity:.7,children:[(0,D.jsx)(r.default,{style:B.default.optionIconContainer,children:(0,D.jsx)(j.default,{size:24,color:"#5d6b4a"})}),(0,D.jsxs)(r.default,{style:B.default.optionTextContainer,children:[(0,D.jsx)(l.default,{style:B.default.optionTitle,children:"Alerts"}),(0,D.jsx)(l.default,{style:B.default.optionSubtitle,children:"Distance & pace notifications"})]}),(0,D.jsx)(r.default,{style:[B.default.optionBadge,B.default.optionBadgeActive],children:(0,D.jsx)(l.default,{style:[B.default.optionBadgeText,B.default.optionBadgeTextActive],children:"Active"})})]})]})]})]}),(0,D.jsx)(f.default,{visible:me,animationType:"slide",transparent:!0,onRequestClose:Le,children:(0,D.jsx)(r.default,{style:B.default.modalOverlay,children:(0,D.jsx)(r.default,{style:B.default.modalContainer,children:(0,D.jsxs)(g.default,{contentContainerStyle:B.default.modalContent,children:[(0,D.jsx)(l.default,{style:B.default.modalTitle,children:"Save Trail"}),(0,D.jsx)(u.default,{placeholder:"Trail name",value:je,onChangeText:we,style:B.default.input}),(0,D.jsx)(u.default,{placeholder:"Description",value:Ce,onChangeText:Se,style:[B.default.input,{height:100}],multiline:!0}),(0,D.jsx)(u.default,{placeholder:"Photo URL (optional)",value:ve,onChangeText:Te,style:B.default.input}),(0,D.jsxs)(r.default,{style:{flexDirection:"row",gap:8,marginTop:8},children:[(0,D.jsx)(n.default,{style:B.default.modalButton,onPress:Le,children:(0,D.jsx)(l.default,{style:B.default.modalButtonText,children:"Cancel"})}),(0,D.jsx)(n.default,{style:[B.default.modalButton,B.default.modalButtonPrimary],onPress:async()=>{if(!xe)return;const t=Object.assign({},xe,{name:je||xe.name||"Untitled Trail",description:Ce,photo:ve,tags:ke,difficulty:Be});try{await e(t),pe(!1),be(null),V(!1),M([]),U(0),Z(null),ie(0),de(0),ue("0:00"),ge(0),ye(0),await b.default.removeItem("recording_coordinates"),await b.default.removeItem("recording_max_elevation"),await b.default.removeItem("recording_max_speed"),await b.default.removeItem("recording_start_time"),await b.default.removeItem("recording_last_update");const a=t.id||null;a?A.push(`/trail/${a}`):i.default.alert("Success","Trail saved successfully!")}catch(a){console.error("Save failed",a),i.default.alert("Error","Failed to save trail")}},children:(0,D.jsx)(l.default,{style:[B.default.modalButtonText,{color:"#fff"}],children:"Save Trail"})})]})]})})})})]})}},5210(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>m});var o=a(9637),l=a(1168),r=a(8032),n=a(2557),i=a(6665),s=a(5648),d=a(3929),c=a(5009),u=a(6283),f=a(8833);const g=a(3668).default.create({container:{width:"100%",paddingHorizontal:0,paddingTop:0,alignItems:"center"},tabBar:{flexDirection:"row",backgroundColor:"rgba(30, 35, 13, 0.95)",borderRadius:0,paddingVertical:8,paddingHorizontal:8,justifyContent:"space-around",alignItems:"center",shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:8,elevation:8,width:"100%",gap:6},tabButton:{height:44,borderRadius:22,overflow:"hidden",justifyContent:"center",alignItems:"center"},tabTouchable:{flex:1,width:"100%",justifyContent:"center",alignItems:"center"},tabContent:{flexDirection:"row",alignItems:"center",justifyContent:"center",gap:8,paddingHorizontal:0},iconWrapper:{width:22,height:22,alignItems:"center",justifyContent:"center"},label:{color:"#FFFE77",fontSize:13,fontWeight:"600"}});var h=a(397);function y({state:e,descriptors:t,navigation:a}){const o=(0,f.useSafeAreaInsets)(),l=(0,i.useRef)(e.routes.map(()=>new c.default.Value(0))).current;(0,i.useEffect)(()=>{console.log("AnimatedTabBar state.index:",e.index),console.log("AnimatedTabBar routes:",e.routes.map(e=>({name:e.name,key:e.key}))),console.log("AnimatedTabBar descriptors keys:",Object.keys(t)),e.routes.forEach((t,a)=>{c.default.timing(l[a],{toValue:e.index===a?1:0,duration:300,useNativeDriver:!1}).start()})},[e.index,e.routes,l]);const r=Math.max(o.bottom,8);return(0,h.jsx)(d.default,{style:g.container,children:(0,h.jsx)(d.default,{style:[g.tabBar,{paddingBottom:r}],children:e.routes.filter(e=>{const a=t[e.key]?.options;return!(!a||!(a.tabBarLabel||a.title||a.tabBarIcon))}).map((o,r)=>{const{options:n}=t[o.key],i=void 0!==n.tabBarLabel?n.tabBarLabel:void 0!==n.title?n.title:o.name,f=e.index===r,y=l[r],m=y.interpolate({inputRange:[0,1],outputRange:[44,100]}),p=y.interpolate({inputRange:[0,1],outputRange:["rgba(40, 46, 16, 0.6)","rgba(40, 46, 16, 0.9)"]}),x=y.interpolate({inputRange:[0,.5,1],outputRange:[0,0,1]}),b=f?"#FFFE77":"#9ca3af";return(0,h.jsx)(c.default.View,{style:[g.tabButton,{width:m,backgroundColor:p}],children:(0,h.jsx)(s.default,{accessibilityRole:"button",accessibilityState:f?{selected:!0}:{},accessibilityLabel:n.tabBarAccessibilityLabel,onPress:()=>{const e=a.emit({type:"tabPress",target:o.key,canPreventDefault:!0});f||e.defaultPrevented||a.navigate(o.name)},style:g.tabTouchable,children:(0,h.jsxs)(d.default,{style:g.tabContent,children:[(0,h.jsx)(d.default,{style:g.iconWrapper,children:n.tabBarIcon&&n.tabBarIcon({focused:f,color:b,size:22})}),(0,h.jsx)(c.default.View,{style:{opacity:x},children:f&&(0,h.jsx)(u.default,{style:g.label,children:String(i)})})]})})},o.key)})})})}function m(){return(0,h.jsxs)(o.Tabs,{tabBar:e=>(0,h.jsx)(y,Object.assign({},e)),screenOptions:{headerShown:!1,tabBarActiveTintColor:"#FFFE77",tabBarInactiveTintColor:"#9ca3af"},children:[(0,h.jsx)(o.Tabs.Screen,{name:"explore",options:{title:"Explore",tabBarIcon:({color:e,size:t})=>(0,h.jsx)(l.default,{size:t,color:e})}}),(0,h.jsx)(o.Tabs.Screen,{name:"record",options:{title:"Record",tabBarIcon:({color:e,size:t})=>(0,h.jsx)(r.default,{size:t,color:e})}}),(0,h.jsx)(o.Tabs.Screen,{name:"profile",options:{title:"Profile",tabBarIcon:({color:e,size:t})=>(0,h.jsx)(n.default,{size:t,color:e})}})]})}console.log("[init] components/AnimatedTabBar.tsx loaded")},5250(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>r});var o=a(9637),l=a(397);function r(){return(0,l.jsx)(o.Redirect,{href:"/(tabs)/explore"})}},5625(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>b});a(6665);var o=a(6283),l=a(3929),r=a(3668),n=a(2772),i=a(5648),s=a(9637),d=a(7430),c=a(5395),u=a(4494),f=a(1168),g=a(8032),h=a(477),y=a(9582),m=a(9269),p=a(397);const x={id:"demo-trail",name:"Scenic Coastal Walk",distance:5210,duration:3600,coordinates:[{latitude:50.81999932593175,longitude:-.1443926504884132},{latitude:50.81982005377856,longitude:-.14389605957015306},{latitude:50.8195735534442,longitude:-.14290287773496857},{latitude:50.81976403108945,longitude:-.14245949298612004},{latitude:50.819651985510006,longitude:-.1415904588798469},{latitude:50.819360665744455,longitude:-.141129338740825},{latitude:50.81955114425804,longitude:-.14054407087405707},{latitude:50.8194278935438,longitude:-.1397814491065219},{latitude:50.819282233189426,longitude:-.1389301503892284},{latitude:50.819696803774036,longitude:-.13903656272921694},{latitude:50.81999932593175,longitude:-.13919618123853184},{latitude:50.82010016621547,longitude:-.13853997181101363},{latitude:50.82041389015009,longitude:-.138220734792327},{latitude:50.82055954697452,longitude:-.13852223642078343},{latitude:50.82086206354296,longitude:-.13829167635185513}],city:"Brighton",country:"UK",difficulty:"Easy",pace:"11:32",maxElevation:45};function b(){const e=(0,s.useRouter)();return(0,p.jsxs)(l.default,{style:j.container,children:[(0,p.jsx)(s.Stack.Screen,{options:{title:"Demo Trail",headerShown:!1}}),(0,p.jsxs)(n.default,{style:j.scrollView,children:[(0,p.jsxs)(l.default,{style:j.header,children:[(0,p.jsx)(i.default,{style:j.backButton,onPress:()=>e.back(),children:(0,p.jsx)(c.default,{size:24,color:"#fff"})}),(0,p.jsxs)(l.default,{style:j.headerContent,children:[(0,p.jsx)(o.default,{style:j.title,children:x.name}),(0,p.jsxs)(l.default,{style:j.locationRow,children:[(0,p.jsx)(f.default,{size:16,color:"#fff"}),(0,p.jsxs)(o.default,{style:j.locationText,children:[x.city,", ",x.country]})]})]})]}),(0,p.jsx)(l.default,{style:j.mapContainer,children:(0,p.jsx)(d.default,{coordinates:x.coordinates,style:j.map,scrollEnabled:!0,zoomEnabled:!0})}),(0,p.jsxs)(l.default,{style:j.statsContainer,children:[(0,p.jsxs)(l.default,{style:j.statItem,children:[(0,p.jsx)(g.default,{size:20,color:y.default.primary}),(0,p.jsx)(o.default,{style:j.statValue,children:(0,m.formatDistance)(x.distance)}),(0,p.jsx)(o.default,{style:j.statLabel,children:"Distance"})]}),(0,p.jsxs)(l.default,{style:j.statItem,children:[(0,p.jsx)(u.default,{size:20,color:y.default.primary}),(0,p.jsx)(o.default,{style:j.statValue,children:(0,m.formatDuration)(x.duration)}),(0,p.jsx)(o.default,{style:j.statLabel,children:"Time"})]}),(0,p.jsxs)(l.default,{style:j.statItem,children:[(0,p.jsx)(h.default,{size:20,color:y.default.primary}),(0,p.jsxs)(o.default,{style:j.statValue,children:[x.maxElevation,"m"]}),(0,p.jsx)(o.default,{style:j.statLabel,children:"Elevation"})]})]}),(0,p.jsxs)(l.default,{style:j.section,children:[(0,p.jsx)(o.default,{style:j.sectionTitle,children:"About this trail"}),(0,p.jsx)(o.default,{style:j.description,children:"This is a beautiful coastal walk along the Brighton seafront. Perfect for a morning stroll with your dog. The path is paved and offers stunning views of the English Channel."})]})]})]})}const j=r.default.create({container:{flex:1,backgroundColor:"#fff"},scrollView:{flex:1},header:{height:200,backgroundColor:y.default.primary,justifyContent:"flex-end",padding:20},backButton:{position:"absolute",top:50,left:20,zIndex:10},headerContent:{marginBottom:10},title:{fontSize:28,fontWeight:"bold",color:"#fff",marginBottom:5},locationRow:{flexDirection:"row",alignItems:"center"},locationText:{color:"#fff",marginLeft:5,fontSize:16},mapContainer:{height:300,width:"100%"},map:{flex:1},statsContainer:{flexDirection:"row",justifyContent:"space-around",padding:20,backgroundColor:"#f8f9fa",borderBottomWidth:1,borderBottomColor:"#eee"},statItem:{alignItems:"center"},statValue:{fontSize:18,fontWeight:"bold",marginTop:5,color:"#333"},statLabel:{fontSize:12,color:"#666",marginTop:2},section:{padding:20},sectionTitle:{fontSize:20,fontWeight:"bold",marginBottom:10,color:"#333"},description:{fontSize:16,lineHeight:24,color:"#666"}})},5938(e,t,a){"use strict";a.r(t),a.d(t,{API_URL:()=>o});const o=("undefined"!==typeof window?window.__EXPO_PUBLIC_API_URL__:void 0)||"https://api.tailtrails.club";console.log("Current API URL:",o)},6183(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>x});var o=a(6665),l=a(6283),r=a(3929),n=a(3668),i=a(5648),s=a(2772),d=a(1690),c=a(530),u=a(9637),f=a(1449),g=a(8833),h=a(594),y=a(3353),m=a(9908),p=a(397);function x(){const e=(0,u.useRouter)(),t=(0,u.useLocalSearchParams)(),{user:a}=(0,y.useAuth)(),{dogProfile:n,refreshDogProfile:x,createDogProfile:j,updateDogProfile:w}=(0,m.useDogs)(),C=(0,g.useSafeAreaInsets)(),[S,v]=(0,o.useState)([]),[T,k]=(0,o.useState)("Fair"),[I,B]=(0,o.useState)(!1),z="true"===t.isEditing;(0,o.useEffect)(()=>{n&&z&&(console.log("Loading existing personality tags for editing:",n.personality_tags),v(n.personality_tags||[]),k(n.recall_reliability||"Fair"))},[n,z]);return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(u.Stack.Screen,{options:{headerShown:!1}}),(0,p.jsxs)(r.default,{style:[b.container,{paddingTop:C.top+20}],children:[(0,p.jsxs)(s.default,{style:b.scrollView,contentContainerStyle:b.content,children:[(0,p.jsxs)(r.default,{style:b.header,children:[(0,p.jsx)(l.default,{style:b.title,children:"Personality & Behaviour"}),(0,p.jsx)(l.default,{style:b.subtitle,children:"Choose the tags that best describe your dog"}),!z&&(0,p.jsxs)(r.default,{style:b.progressContainer,children:[(0,p.jsx)(r.default,{style:b.progressDot}),(0,p.jsx)(r.default,{style:[b.progressDot,b.progressDotActive]})]})]}),(0,p.jsx)(r.default,{style:b.tagsContainer,children:h.PERSONALITY_TAGS.map(e=>(0,p.jsx)(i.default,{style:[b.tag,S.includes(e)&&b.tagSelected],onPress:()=>(e=>{v(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e),testID:`tag-${e}`,children:(0,p.jsx)(l.default,{style:[b.tagText,S.includes(e)&&b.tagTextSelected],children:e})},e))}),(0,p.jsx)(r.default,{style:b.sectionHeader,children:(0,p.jsx)(l.default,{style:b.sectionTitle,children:"Health & Safety"})}),(0,p.jsxs)(r.default,{style:b.section,children:[(0,p.jsx)(l.default,{style:b.label,children:"Recall Reliability"}),(0,p.jsx)(l.default,{style:b.helperText,children:"How reliably does your dog return when called?"}),(0,p.jsx)(r.default,{style:b.recallContainer,children:h.RECALL_RELIABILITY_OPTIONS.map(e=>(0,p.jsx)(i.default,{style:[b.recallOption,T===e&&b.recallOptionSelected],onPress:()=>{k(e)},testID:`recall-${e}`,children:(0,p.jsx)(l.default,{style:[b.recallText,T===e&&b.recallTextSelected],children:e})},e))})]})]}),(0,p.jsxs)(r.default,{style:[b.footer,{paddingBottom:C.bottom+20}],children:[(0,p.jsxs)(i.default,{style:b.backButton,onPress:()=>{e.back()},disabled:I,testID:"back-button",children:[(0,p.jsx)(f.default,{size:24,color:"#FFFE77"}),(0,p.jsx)(l.default,{style:b.backButtonText,children:"Back"})]}),(0,p.jsx)(i.default,{style:[b.finishButton,I&&b.finishButtonDisabled],onPress:async()=>{if(a){0,B(!0);try{console.log(z?"Updating dog profile for user:":"Creating dog profile for user:",a.id);const o={user_id:a.id,name:t.name,nickname:t.nickname||void 0,size:t.size,age:parseInt(t.age,10),photo:t.photo||void 0,personality_tags:S,recall_reliability:T};console.log("Dog profile data:",o),z&&n?.id?await w(Object.assign({},o,{id:n.id})):await j(o),z?e.replace("/(tabs)/profile"):e.replace("/(tabs)/explore")}catch(o){console.error("Error saving dog profile:",o),d.default.alert("Error",o.message||"Failed to save dog profile"),B(!1)}}else d.default.alert("Error","You must be logged in to create a dog profile")},disabled:I,testID:"finish-button",children:I?(0,p.jsx)(c.default,{color:"#1a1f0a"}):(0,p.jsx)(l.default,{style:b.finishButtonText,children:z?"Save":"Finish"})})]})]})]})}const b=n.default.create({container:{flex:1,backgroundColor:"#1a1f0a"},scrollView:{flex:1},content:{padding:24},header:{marginBottom:32,alignItems:"center"},title:{fontSize:28,fontWeight:"700",color:"#FFFE77",marginBottom:8,textAlign:"center"},subtitle:{fontSize:16,color:"#a8ad8e",textAlign:"center",marginBottom:24,paddingHorizontal:16},progressContainer:{flexDirection:"row",gap:8},progressDot:{width:8,height:8,borderRadius:4,backgroundColor:"#3d4520"},progressDotActive:{backgroundColor:"#FFFE77"},tagsContainer:{flexDirection:"row",flexWrap:"wrap",gap:12},tag:{paddingHorizontal:20,paddingVertical:12,borderRadius:24,backgroundColor:"#282E10",borderWidth:1.5,borderColor:"#3d4520"},tagSelected:{backgroundColor:"rgba(255, 254, 119, 0.15)",borderColor:"#FFFE77"},tagText:{fontSize:15,fontWeight:"500",color:"#a8ad8e"},tagTextSelected:{color:"#FFFE77",fontWeight:"600"},footer:{flexDirection:"row",gap:12,paddingHorizontal:24,paddingTop:20,borderTopWidth:1,borderTopColor:"#3d4520",backgroundColor:"#282E10"},backButton:{flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center",gap:8,backgroundColor:"transparent",borderRadius:12,padding:18,borderWidth:1.5,borderColor:"#FFFE77"},backButtonText:{fontSize:17,fontWeight:"600",color:"#FFFE77"},finishButton:{flex:1,backgroundColor:"#FFFE77",borderRadius:12,padding:18,alignItems:"center",justifyContent:"center"},finishButtonDisabled:{opacity:.6},finishButtonText:{fontSize:17,fontWeight:"600",color:"#1a1f0a"},sectionHeader:{marginTop:32,marginBottom:16},sectionTitle:{fontSize:24,fontWeight:"700",color:"#FFFE77"},section:{marginBottom:24},label:{fontSize:17,fontWeight:"600",color:"#FFFE77",marginBottom:4},helperText:{fontSize:14,color:"#a8ad8e",marginBottom:12},recallContainer:{flexDirection:"row",gap:8},recallOption:{flex:1,paddingVertical:12,paddingHorizontal:16,borderRadius:12,backgroundColor:"#282E10",borderWidth:1.5,borderColor:"#3d4520",alignItems:"center"},recallOptionSelected:{backgroundColor:"rgba(255, 254, 119, 0.15)",borderColor:"#FFFE77"},recallText:{fontSize:14,fontWeight:"500",color:"#a8ad8e"},recallTextSelected:{color:"#FFFE77",fontWeight:"600"}})},6746(e,t,a){"use strict";a.r(t),a.d(t,{TrailsContext:()=>i,useTrails:()=>s});var o=a(6665),l=a(2790),r=a(3353),n=a(5938);const[i,s]=(0,l.default)(()=>{const{user:e,session:t}=(0,r.useAuth)(),[a,l]=(0,o.useState)([]),[i,s]=(0,o.useState)([]),[d,c]=(0,o.useState)(!0),[u,f]=(0,o.useState)(!0),g=(0,o.useCallback)(async()=>{if(e&&t)try{console.log("Loading trails for user:",e.id);const a=await fetch(`${n.API_URL}/trail`,{headers:{Authorization:`Bearer ${t?.accessToken}`}});if(a.ok){const e=await a.json();l(e||[])}else console.error("Failed to load trails:",a.status),l([])}catch(a){console.error("Failed to load trails:",a)}finally{c(!1)}else try{const e=await fetch(`${n.API_URL}/trail`);if(e.ok){const t=await e.json();l(t||[])}else console.error("Failed to load trails (public):",e.status),l([])}catch(o){console.error("Failed to load trails:",o),l([])}finally{c(!1)}},[e,t]),h=(0,o.useCallback)(async()=>{if(!t?.accessToken)return s([]),void f(!1);try{console.log("Loading my trails for user:",e?.id);const a=await fetch(`${n.API_URL}/trail/me`,{headers:{Authorization:`Bearer ${t?.accessToken}`}});if(a.ok){const e=await a.json();s(e||[])}else console.error("Failed to load my trails:",a.status),s([])}catch(a){console.error("Failed to load saved trails:",a),s([])}finally{f(!1)}},[e,t]);(0,o.useEffect)(()=>{g(),h()},[g,h]);const y=(0,o.useCallback)(async a=>{if(!e)throw console.error("No user logged in"),new Error("Must be logged in to save trails");if(!t?.accessToken)throw console.error("No session/access token available"),new Error("Must be logged in to save trails");try{console.log("Saving trail for user via API:",e.id);const o=e=>e&&0!==e.length?e.map(e=>[e.longitude,e.latitude]):[],r={name:a.name,distance:a.distance,duration:a.duration,path:o(a.coordinates),photo:a.photo,city:a.city,country:a.country,description:a.description,tags:a.tags,elevation:a.elevation,surface_type:a.surfaceType,difficulty:a.difficulty,location:a.location,pace:a.pace,speed:a.speed,max_elevation:a.maxElevation,rating:a.rating,review:a.review,environment_tags:a.environment_tags},i=t.accessToken,s=await fetch(`${n.API_URL}/trail/me`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(r)});if(!s.ok){const e=await s.text();throw console.error("Failed to save trail via API:",s.status,e),new Error("Failed to save trail")}const d=await s.json();return l(e=>[d,...e]),d}catch(o){throw console.error("Failed to save trail:",o),o}},[e,t]),m=(0,o.useCallback)(async e=>{try{if(console.log("Deleting trail via API:",e),!t?.accessToken)throw new Error("Not authenticated");const a=await fetch(`${n.API_URL}/trail/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t.accessToken}`}});if(204!==a.status){const e=await a.text();throw console.error("Failed to delete trail:",a.status,e),new Error("Failed to delete trail")}l(t=>t.filter(t=>t.id!==e))}catch(a){throw console.error("Failed to delete trail:",a),a}},[t]),p=(0,o.useCallback)(e=>{const t=a.find(t=>t.id===e);return t||("demo-trail"===e?{id:"demo-trail",name:"Scenic Coastal Walk",distance:5.2,duration:3600,coordinates:[{latitude:50.81999932593175,longitude:-.1443926504884132},{latitude:50.81982005377856,longitude:-.14389605957015306},{latitude:50.8195735534442,longitude:-.14290287773496857},{latitude:50.81976403108945,longitude:-.14245949298612004},{latitude:50.819651985510006,longitude:-.1415904588798469},{latitude:50.819360665744455,longitude:-.141129338740825},{latitude:50.81955114425804,longitude:-.14054407087405707},{latitude:50.8194278935438,longitude:-.1397814491065219},{latitude:50.819282233189426,longitude:-.1389301503892284},{latitude:50.819696803774036,longitude:-.13903656272921694},{latitude:50.81999932593175,longitude:-.13919618123853184},{latitude:50.82010016621547,longitude:-.13853997181101363},{latitude:50.82041389015009,longitude:-.138220734792327},{latitude:50.82055954697452,longitude:-.13852223642078343},{latitude:50.82086206354296,longitude:-.13829167635185513}],city:"Brighton",country:"UK",difficulty:"Easy",pace:"11:32",maxElevation:45,date:Date.now(),environment_tags:["Beach","Sunny","Paved"],rating:4.5,review:"A beautiful walk along the seafront. Very dog friendly!"}:void 0)},[a]),x=(0,o.useCallback)(async(e,a,o=10)=>{try{if(console.log("Loading nearby trails:",{latitude:e,longitude:a,distanceKm:o}),"number"===typeof e&&"number"===typeof a&&t?.accessToken)try{const l=await fetch(`${n.API_URL}/trail/nearby?latitude=${encodeURIComponent(e)}&longitude=${encodeURIComponent(a)}&distance_km=${encodeURIComponent(o)}`,{headers:{Authorization:`Bearer ${t.accessToken}`}});if(l.ok){return await l.json()}return 404===l.status?(console.warn("Nearby trails endpoint returned 404 (no trails)"),[]):(console.error("Failed to load nearby trails from API:",l.status),[])}catch(l){return console.error("Error calling nearby trails API:",l),[]}return[]}catch(r){return console.error("Failed to load nearby trails:",r),[]}},[t]),b=(0,o.useCallback)(async(e,a)=>{try{if(console.log("Updating trail name via API:",e,a),!t?.accessToken)throw new Error("Not authenticated");const o=await fetch(`${n.API_URL}/trail/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t?.accessToken}`},body:JSON.stringify({name:a})});if(!o.ok){const e=await o.text();throw new Error(e||"Failed to update")}const r=await o.json();l(t=>t.map(t=>t.id===e?r:t))}catch(o){throw console.error("Failed to update trail name:",o),o}},[t]),j=(0,o.useCallback)(async(e,a)=>{try{if(console.log("Updating trail photo via API:",e),!t?.accessToken)throw new Error("Not authenticated");const o=await fetch(`${n.API_URL}/trail/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t?.accessToken}`},body:JSON.stringify({photo:a})});if(!o.ok){const e=await o.text();throw new Error(e||"Failed to update photo")}const r=await o.json();l(t=>t.map(t=>t.id===e?r:t))}catch(o){throw console.error("Failed to update trail photo:",o),o}},[t]),w=(0,o.useCallback)(async(e,a)=>{try{if(console.log("Updating trail details via API:",e,a),!t?.accessToken)throw new Error("Not authenticated");const o=await fetch(`${n.API_URL}/trail/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t?.accessToken}`},body:JSON.stringify(a)});if(!o.ok){const e=await o.text();throw new Error(e||"Failed to update details")}const r=await o.json();l(t=>t.map(t=>t.id===e?r:t))}catch(o){throw console.error("Failed to update trail details:",o),o}},[]),C=(0,o.useCallback)(async e=>{try{console.log("Loading trail with user data via API:",e);const t=await fetch(`${n.API_URL}/trail/${e}`);if(!t.ok)return void console.error("Failed to fetch trail:",t.status);return await t.json()}catch(t){return void console.error("Failed to load trail with user:",t)}},[]),S=(0,o.useCallback)(async t=>{if(!e)throw console.error("No user logged in"),new Error("Must be logged in to save trails");try{console.log("Saving trail bookmark:",t);const e=a.find(e=>e.id===t);e&&s(t=>[e,...t])}catch(o){throw console.error("Failed to save trail bookmark:",o),o}},[e,a]),v=(0,o.useCallback)(async t=>{if(!e)throw console.error("No user logged in"),new Error("Must be logged in to remove saved trails");try{console.log("Removing trail bookmark:",t),s(e=>e.filter(e=>e.id!==t))}catch(a){throw console.error("Failed to remove trail bookmark:",a),a}},[e]),T=(0,o.useCallback)(e=>i.some(t=>t.id===e),[i]);return(0,o.useMemo)(()=>({trails:a,savedTrails:i,isLoading:d,isSavedLoading:u,saveTrail:y,deleteTrail:m,getTrailById:p,updateTrailName:b,updateTrailPhoto:j,updateTrailDetails:w,loadNearbyTrails:x,saveTrailBookmark:S,removeTrailBookmark:v,isTrailSaved:T,getTrailWithUser:C}),[a,i,d,u,y,m,p,b,j,w,x,S,v,T,C])})},7430(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>s});var o=a(6665),l=a(3929);const r=a(3668).default.create({container:{backgroundColor:"#f3f4f6",overflow:"hidden"}});var n=a(7042),i=(a(1051),a(397));const s=(0,o.forwardRef)(({coordinates:e,style:t,initialRegion:a,scrollEnabled:s=!0,zoomEnabled:d=!0},c)=>{const u=(0,o.useRef)(null),f=(0,o.useRef)(null);return(0,o.useImperativeHandle)(c,()=>({animateToRegion:(e,t=500)=>{f.current&&f.current.easeTo({center:[e.longitude,e.latitude],zoom:14,duration:t})},fitToCoordinates:(e,t={})=>{if(f.current&&e.length>0){const a=new n.LngLatBounds;e.forEach(e=>a.extend([e.longitude,e.latitude])),f.current.fitBounds(a,{padding:t.edgePadding||20})}}})),(0,o.useEffect)(()=>{if(!u.current)return;const t=a?[a.longitude,a.latitude]:e.length>0?[e[0].longitude,e[0].latitude]:[0,0],o=a?14:12,l=new n.Map({container:u.current,style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",center:t,zoom:o,interactive:s&&d});return f.current=l,l.on("load",()=>{if(e.length>1){l.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:e.map(e=>[e.longitude,e.latitude])}}}),l.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#5d6b4a","line-width":4}});const t=new n.LngLatBounds;e.forEach(e=>t.extend([e.longitude,e.latitude])),l.fitBounds(t,{padding:20})}}),()=>{l.remove()}},[e,a,s,d]),(0,i.jsx)(l.default,{style:[t,r.container],children:(0,i.jsx)("div",{ref:u,style:{width:"100%",height:"100%"}})})})},7990(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>S});var o=a(5227),l=a(4108),r=a(9637),n=a(284),i=a(6665),s=a(3929),d=a(530),c=a(3668),u=a(1015),f=a(3353),g=a(2598),h=a(6746),y=a(9908),m=a(9582),p=a(414),x=a(397);const b=(0,i.createContext)({theme:null,setThemeMode:()=>{}}),j=({children:e})=>{const t=p.default.getColorScheme(),[a,o]=(0,i.useState)("light"===t?"light":"dark");(0,i.useEffect)(()=>{(0,m.setTheme)(a)},[a]);return(0,x.jsx)(b.Provider,{value:{theme:a,setThemeMode:e=>{if(null===e){const e=p.default.getColorScheme();(0,m.setTheme)("dark"===e?"dark":"light"),o("dark"===e?"dark":"light")}else(0,m.setTheme)(e),o(e)}},children:e})};n.preventAutoHideAsync();const w=new o.QueryClient;function C(){const{isAuthenticated:e,isLoading:t}=(0,f.useAuth)(),{hasDogProfile:a,isDogProfileLoading:o}=(0,y.useDogs)(),l=(0,r.useSegments)(),n=(0,r.useRouter)();return(0,i.useEffect)(()=>{if(t)return;if(o)return void console.log("Navigation: waiting for dog profiles to finish loading");const r="(tabs)"===l[0],i="login"===l[0]||"signup"===l[0],s="onboarding"===l[0];console.log("Navigation check:",{isAuthenticated:e,hasDogProfile:a,segments:l[0]}),e||!r&&!s?!e||a||s?e&&a&&i&&(console.log("Redirecting to explore: user authenticated with dog profile"),n.replace("/(tabs)/explore")):(console.log("Redirecting to onboarding: no dog profile"),n.replace("/onboarding/dog-basics")):(console.log("Redirecting to login: user not authenticated"),n.replace("/login"))},[e,a,l,t,o,n]),t?(0,x.jsx)(s.default,{style:{flex:1,justifyContent:"center",alignItems:"center"},children:(0,x.jsx)(d.default,{size:"large",color:"#2563eb"})}):(0,x.jsxs)(r.Stack,{screenOptions:{headerBackTitle:"Back"},children:[(0,x.jsx)(r.Stack.Screen,{name:"login",options:{headerShown:!1}}),(0,x.jsx)(r.Stack.Screen,{name:"signup",options:{headerShown:!1}}),(0,x.jsx)(r.Stack.Screen,{name:"(tabs)",options:{headerShown:!1}}),(0,x.jsx)(r.Stack.Screen,{name:"trail/[id]",options:{headerShown:!1}})]})}function S(){return(0,i.useEffect)(()=>{n.hideAsync()},[]),(0,x.jsx)(l.QueryClientProvider,{client:w,children:(0,x.jsx)(f.AuthContext,{children:(0,x.jsx)(g.AccountContext,{children:(0,x.jsx)(j,{children:(0,x.jsx)(y.DogsContext,{children:(0,x.jsx)(h.TrailsContext,{children:(0,x.jsx)(u.GestureHandlerRootView,{style:v.container,children:(0,x.jsx)(C,{})})})})})})})})}const v=c.default.create({container:{flex:1}})},8389(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>E});var o=a(6665),l=a(9637),r=a(6283),n=a(3929),i=a(2772),s=a(5648),d=a(530),c=a(5009),u=a(6773),f=a(8264),g=a(932),h=a(5894),y=a(893),m=a(8833),p=a(3087),x=a(2994),b=a(5624),j=a(1449),w=a(2301),C=a(3048),S=a(1168),v=a(8032),T=a(1858),k=a(5082),I=a(4550),B=a(2964),z=a(7042),P=a(2699),R=a(9269),D=a(9600),F=a(6746),L=a(397);const A=[{id:"nearby",name:"Nearby",icon:S.default},{id:"popular",name:"Popular",icon:C.default},{id:"beaches",name:"Beaches",icon:I.default}];function E(){const e=(0,l.useRouter)(),t=(0,m.useSafeAreaInsets)(),{loadNearbyTrails:a,saveTrailBookmark:C,removeTrailBookmark:I,isTrailSaved:E}=(0,F.useTrails)(),[O,W]=(0,o.useState)("nearby"),[_,V]=(0,o.useState)([]),[N,M]=(0,o.useState)(!0),[,$]=(0,o.useState)(void 0),[G,H]=(0,o.useState)({}),[U,q]=(0,o.useState)(""),[J,Y]=(0,o.useState)(!1),[K,Q]=(0,o.useState)(""),[Z,X]=(0,o.useState)([]),[ee,te]=(0,o.useState)(!1),ae=(0,o.useCallback)(async()=>{Q("Current location");try{if(navigator&&navigator.geolocation)return void navigator.geolocation.getCurrentPosition(async e=>{try{const t=await a(e.coords.latitude,e.coords.longitude);V(t)}catch(t){console.error("Failed to load nearby trails with browser location:",t);const e=await a();V(e)}finally{M(!1)}},async()=>{const e=await a();V(e),M(!1)});const e=await a();V(e)}catch(e){console.error("Failed to load nearby trails (web):",e),V([])}finally{M(!1)}},[a]);(0,o.useEffect)(()=>{ae()},[ae]),(0,l.useFocusEffect)((0,o.useCallback)(()=>{console.log("Explore tab focused - refreshing nearby trails (web)"),ae()},[ae]));const oe=(0,o.useCallback)(()=>{const e=U.toLowerCase(),t=_.filter(t=>{const a=t.name?.toLowerCase()||"",o=t.city?.toLowerCase()||"",l=t.country?.toLowerCase()||"";return a.includes(e)||o.includes(e)||l.includes(e)}).map(e=>({id:e.id,name:e.name||`Trail ${new Date(e.date).toLocaleDateString()}`,location:e.city?`${e.city}, ${e.country||"Unknown"}`:"Location unknown",type:"trail"})).slice(0,6);X(t)},[U,_]);(0,o.useEffect)(()=>{U.trim()?oe():X([])},[U,oe]);const le=()=>{Y(!1),q(""),X([])},re=e=>{if(!G[e]){const t=new c.default.Value(1);return H(a=>Object.assign({},a,{[e]:t})),t}return G[e]},ne=(0,o.useCallback)(e=>{let t=e;return"popular"===O?t=[...t].sort((e,t)=>(t.rating||0)-(e.rating||0)):"beaches"===O&&(t=t.filter(e=>(e.environment_tags||[]).some(e=>e.toLowerCase().includes("beach")))),t},[O]),ie=o.useRef(null),se=o.useRef(null),[de,ce]=(0,o.useState)(null),[ue,fe]=(0,o.useState)(10),[ge,he]=(0,o.useState)(!1);(0,o.useEffect)(()=>{if(!ge||!ie.current||!ee)return;if(se.current)return;const e=de?[de.longitude,de.latitude]:[0,0],t=new z.Map({container:ie.current,style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",center:e,zoom:de?10:1});return se.current=t,t.on("load",()=>{t.getSource("picker")||(t.addSource("picker",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),t.addLayer({id:"picker-layer",type:"circle",source:"picker",paint:{"circle-radius":8,"circle-color":"#2563eb","circle-stroke-color":"#fff","circle-stroke-width":2}}))}),t.on("click",e=>{const a=e.lngLat.lat,o=e.lngLat.lng;ce({latitude:a,longitude:o});const l=t.getSource("picker");l&&l.setData({type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[o,a]}}]}),t.flyTo({center:[o,a],zoom:12})}),()=>{try{t.remove()}catch(e){}se.current=null}},[ge,ee,de]);const ye=async()=>{M(!0);try{if(de){const e=await a(de.latitude,de.longitude,ue);V(e)}else if(navigator&&navigator.geolocation)navigator.geolocation.getCurrentPosition(async e=>{const t=await a(e.coords.latitude,e.coords.longitude,ue);V(t)},async()=>{const e=await a(void 0,void 0,ue);V(e)});else{const e=await a(void 0,void 0,ue);V(e)}}catch(e){console.error("Search nearby failed:",e)}finally{M(!1)}},me=ne(_);return(0,L.jsxs)(n.default,{style:P.default.safeContainer,children:[(0,L.jsxs)(i.default,{style:P.default.container,showsVerticalScrollIndicator:!1,stickyHeaderIndices:[0],children:[(0,L.jsxs)(n.default,{style:[P.default.stickyHeader,{paddingTop:t.top+16}],children:[(0,L.jsxs)(n.default,{style:P.default.stickySearchContainer,children:[(0,L.jsxs)(s.default,{style:P.default.searchBar,onPress:()=>{Y(!0)},activeOpacity:.7,children:[(0,L.jsx)(T.default,{size:20,color:"#9ca3af"}),(0,L.jsx)(r.default,{style:P.default.searchPlaceholder,children:"Find trails"})]}),(0,L.jsx)(s.default,{style:P.default.demoButton,onPress:()=>e.push("/trail/demo-trail"),children:(0,L.jsx)(r.default,{style:P.default.demoButtonText,children:"Demo"})})]}),(0,L.jsx)(n.default,{style:P.default.categoriesSection,children:(0,L.jsx)(i.default,{horizontal:!0,showsHorizontalScrollIndicator:!1,contentContainerStyle:P.default.categoriesScroll,children:A.map(e=>{const t=e.icon,a=O===e.id;return(0,L.jsxs)(s.default,{style:[P.default.categoryButton,a&&P.default.categoryButtonActive],onPress:()=>{return t=e.id,void W(t);var t},children:[(0,L.jsx)(t,{size:20,color:a?"#fff":"#9ca3af",strokeWidth:2}),(0,L.jsx)(r.default,{style:[P.default.categoryText,a&&P.default.categoryTextActive],children:e.name})]},e.id)})})})]}),(0,L.jsxs)(n.default,{style:{paddingHorizontal:16,paddingVertical:8},children:[(0,L.jsxs)(s.default,{onPress:()=>te(e=>!e),style:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[(0,L.jsx)(r.default,{style:{fontSize:14,fontWeight:"600"},children:"Location & Distance"}),ee?(0,L.jsx)(w.default,{size:20,color:"#5d6b4a"}):(0,L.jsx)(b.default,{size:20,color:"#5d6b4a"})]}),ee?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(r.default,{style:{fontSize:14,fontWeight:"600",marginBottom:8},children:"Pick a location on the map or use your current location"}),(0,L.jsx)("div",{ref:e=>{ie.current=e,he(!!e)},style:{width:"100%",height:220,borderRadius:12,overflow:"hidden",marginBottom:8}}),(0,L.jsxs)(n.default,{style:{flexDirection:"row",alignItems:"center",gap:12},children:[(0,L.jsx)(n.default,{style:{flexDirection:"row",gap:8},children:[5,10,25,50].map(e=>(0,L.jsx)(s.default,{style:{paddingHorizontal:12,paddingVertical:8,borderRadius:8,backgroundColor:ue===e?"#5d6b4a":"#fff",borderWidth:1,borderColor:"#e5e7eb"},onPress:()=>fe(e),children:(0,L.jsxs)(r.default,{style:{color:ue===e?"#fff":"#282E10",fontWeight:"600"},children:[e," km"]})},e))}),(0,L.jsx)(s.default,{onPress:ye,style:{marginLeft:"auto",paddingHorizontal:16,paddingVertical:10,backgroundColor:"#64748b",borderRadius:10},children:(0,L.jsx)(r.default,{style:{color:"#fff",fontWeight:"700"},children:"Search Nearby"})})]})]}):(0,L.jsxs)(n.default,{style:{flexDirection:"row",alignItems:"center",gap:12},children:[(0,L.jsx)(r.default,{style:{color:"#64748b"},children:de?`${de.latitude.toFixed(4)}, ${de.longitude.toFixed(4)}`:"Using current location"}),(0,L.jsxs)(r.default,{style:{color:"#64748b"},children:[ue," km"]}),(0,L.jsx)(s.default,{onPress:ye,style:{marginLeft:"auto",paddingHorizontal:12,paddingVertical:8,backgroundColor:"#64748b",borderRadius:8},children:(0,L.jsx)(r.default,{style:{color:"#fff",fontWeight:"700"},children:"Search"})})]})]}),(0,L.jsx)(n.default,{style:P.default.categoryTrailsSection,children:N?(0,L.jsxs)(n.default,{style:P.default.loadingContainer,children:[(0,L.jsx)(d.default,{size:"large",color:"#2563eb"}),(0,L.jsx)(r.default,{style:P.default.loadingText,children:"Loading trails..."})]}):me&&me.length>0?me.map(t=>{const a=re(t.id),o=E(t.id);return(0,L.jsxs)(s.default,{style:P.default.largeTrailCard,onPress:()=>{return a=t.id,void e.push(`/trail/${a}`);var a},children:[t.photo?(0,L.jsx)(h.Image,{source:{uri:t.photo},style:P.default.largeTrailImage,contentFit:"cover",cachePolicy:"memory-disk"}):(0,L.jsx)(D.default,{coordinates:t.coordinates,path:t.path,style:P.default.largeTrailImage,startLatitude:t.startLatitude,startLongitude:t.startLongitude}),(0,L.jsx)(y.LinearGradient,{colors:["rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0.25)","rgba(0, 0, 0, 0.6)"],locations:[0,.3,.6,1],style:P.default.cardGradient}),(0,L.jsx)(s.default,{style:P.default.bookmarkButton,onPress:e=>{e.stopPropagation(),(async(e,t=!1)=>{if(!t&&!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))return void console.log("Cannot bookmark mock trail:",e);const a=re(e),o=E(e);c.default.sequence([c.default.timing(a,{toValue:.6,duration:100,useNativeDriver:!0}),c.default.spring(a,{toValue:1,friction:3,tension:100,useNativeDriver:!0})]).start();try{o?await I(e):await C(e)}catch(l){console.error("Failed to toggle bookmark:",l)}})(t.id,!0)},children:(0,L.jsx)(c.default.View,{style:{transform:[{scale:a}]},children:(0,L.jsx)(x.default,{size:20,color:o?"#000":"#64748b",fill:o?"#000":"none",strokeWidth:2})})}),(0,L.jsxs)(n.default,{style:P.default.cardOverlayContent,children:[(0,L.jsx)(r.default,{style:P.default.overlayTrailName,children:t.name||`Trail ${new Date(t.date).toLocaleDateString()}`}),(0,L.jsx)(r.default,{style:P.default.overlayLocation,children:t.city?`${t.city}, ${t.country||"Unknown"}`:"Location unknown"}),(0,L.jsxs)(n.default,{style:P.default.overlayBadges,children:[t.difficulty&&(0,L.jsxs)(n.default,{style:P.default.badge,children:[(0,L.jsx)(p.default,{size:14,color:"#d4d4a0",strokeWidth:2.5}),(0,L.jsx)(r.default,{style:P.default.badgeText,children:t.difficulty})]}),(0,L.jsxs)(n.default,{style:P.default.badge,children:[(0,L.jsx)(S.default,{size:14,color:"#d4d4a0",strokeWidth:2.5}),(0,L.jsx)(r.default,{style:P.default.badgeText,children:(0,R.formatDistance)(t.distance)})]}),"number"===typeof t.distance_from_user&&(0,L.jsxs)(n.default,{style:P.default.badge,children:[(0,L.jsx)(S.default,{size:14,color:"#d4d4a0",strokeWidth:2.5}),(0,L.jsx)(r.default,{style:P.default.badgeText,children:(0,R.formatDistance)(t.distance_from_user)})]}),t.rating&&(0,L.jsxs)(n.default,{style:P.default.badge,children:[(0,L.jsx)(k.default,{size:14,color:"#fbbf24",fill:"#fbbf24",strokeWidth:2}),(0,L.jsx)(r.default,{style:P.default.badgeText,children:t.rating.toFixed(1)})]})]})]})]},t.id)}):(0,L.jsxs)(n.default,{style:P.default.emptyContainer,children:[(0,L.jsx)(S.default,{size:48,color:"#9ca3af"}),(0,L.jsx)(r.default,{style:P.default.emptyText,children:"No trails found nearby. Try a wider search or record a trail to share with others."})]})}),(0,L.jsx)(n.default,{style:P.default.bottomPadding})]}),(0,L.jsx)(f.default,{visible:J,animationType:"slide",presentationStyle:"fullScreen",onRequestClose:le,children:(0,L.jsxs)(n.default,{style:[P.default.searchModalContainer,{paddingTop:t.top}],children:[(0,L.jsxs)(n.default,{style:P.default.searchModalHeader,children:[(0,L.jsx)(s.default,{style:P.default.backButton,onPress:le,children:(0,L.jsx)(j.default,{size:24,color:"#5d6b4a"})}),(0,L.jsxs)(n.default,{style:P.default.searchModalInputContainer,children:[(0,L.jsx)(u.default,{style:P.default.searchModalInput,placeholder:"Find trails",placeholderTextColor:"#9ca3af",value:U,onChangeText:q,autoFocus:!0,returnKeyType:"search"}),U.length>0&&(0,L.jsx)(s.default,{style:P.default.clearButton,onPress:()=>q(""),children:(0,L.jsx)(B.default,{size:20,color:"#64748b"})})]})]}),(0,L.jsxs)(n.default,{style:P.default.searchModalContent,children:[""===U.trim()&&(0,L.jsxs)(s.default,{style:P.default.currentLocationItem,onPress:()=>{Y(!1),q(""),X([])},children:[(0,L.jsx)(n.default,{style:P.default.locationIconContainer,children:(0,L.jsx)(v.default,{size:20,color:"#5d6b4a"})}),(0,L.jsxs)(n.default,{style:P.default.locationTextContainer,children:[(0,L.jsx)(r.default,{style:P.default.locationTitle,children:"Current location"}),(0,L.jsx)(r.default,{style:P.default.locationSubtitle,children:K})]})]}),Z.length>0&&(0,L.jsx)(g.default,{data:Z,keyExtractor:e=>e.id,renderItem:({item:t})=>(0,L.jsxs)(s.default,{style:P.default.suggestionItem,onPress:()=>{return a=t.id,Y(!1),q(""),X([]),void e.push(`/trail/${a}`);var a},children:[(0,L.jsx)(n.default,{style:P.default.suggestionIconContainer,children:(0,L.jsx)(S.default,{size:20,color:"#64748b"})}),(0,L.jsxs)(n.default,{style:P.default.suggestionTextContainer,children:[(0,L.jsx)(r.default,{style:P.default.suggestionTitle,children:t.name}),(0,L.jsx)(r.default,{style:P.default.suggestionSubtitle,children:t.location})]})]}),showsVerticalScrollIndicator:!1})]})]})})]})}},8415(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>O});var o=a(6665),l=a(3929),r=a(5648),n=a(1690),i=a(530),s=a(2772),d=a(6773),c=a(8264),u=a(5009),f=a(6283),g=a(5894),h=a(262),y=a(3353),m=a(2598),p=a(9908),x=a(6746),b=a(3087),j=a(2994),w=a(9281),C=a(4522),S=a(1631),v=a(2081),T=a(1168),k=a(5082),I=a(2964),B=a(9582),z=a(8833),P=a(8745),R=a(9637),D=a(9269),F=a(893),L=a(9600),A=a(397);const E=a(3229);function O(){const{user:e,signOut:t}=(0,y.useAuth)(),{userProfile:a,updateAccount:O,isLoading:W}=(0,m.useAccount)(),{dogProfile:_,isDogProfileLoading:V}=(0,p.useDogs)(),{trails:N,savedTrails:M,isLoading:$,saveTrailBookmark:G,removeTrailBookmark:H,isTrailSaved:U}=(0,x.useTrails)(),[q,J]=o.useState(!1),[Y,K]=o.useState(!1),[Q,Z]=o.useState(""),[X,ee]=o.useState(""),[te,ae]=o.useState(!1),[oe,le]=o.useState("created"),[re,ne]=o.useState({}),ie=(0,z.useSafeAreaInsets)(),se=(0,R.useRouter)();o.useEffect(()=>{const t=a?.name||e?.email?.split("@")[0]||"",o=a?.photo||E;Z(t),ee(o)},[e,a]);const de=N.length,ce=N.reduce((e,t)=>e+(t.duration||0),0),ue=N.reduce((e,t)=>e+t.distance,0),fe=e=>{le(e)},ge=e=>{if(!re[e]){const t=new u.default.Value(1);return ne(a=>Object.assign({},a,{[e]:t})),t}return re[e]},he=()=>{se.push("/onboarding/dog-basics")},ye=()=>{K(!1);const t=a?.name||e?.email?.split("@")[0]||"",o=a?.photo||E;Z(t),ee(o)},me="created"===oe?N:"saved"===oe?M:[];return(0,A.jsx)(l.default,{style:P.default.container,children:(0,A.jsxs)(s.default,{style:P.default.scrollContainer,contentContainerStyle:[P.default.content,{paddingTop:ie.top+16,paddingBottom:ie.bottom+20}],children:[(0,A.jsx)(l.default,{style:P.default.userSection,children:(0,A.jsxs)(l.default,{style:P.default.userHeader,children:[(0,A.jsx)(r.default,{style:P.default.userAvatar,onPress:()=>{K(!0)},children:X?(0,A.jsx)(g.Image,{source:X,style:P.default.userAvatarImage,contentFit:"cover",cachePolicy:"memory-disk"}):(0,A.jsx)(l.default,{style:P.default.initialAvatar,children:(0,A.jsx)(f.default,{style:P.default.initialAvatarText,children:(Q||a?.name||e?.email||"A").charAt(0).toUpperCase()})})}),(0,A.jsxs)(l.default,{style:P.default.userInfo,children:[(0,A.jsx)(f.default,{style:P.default.userName,children:a?.name||Q||"Account Holder"}),(0,A.jsxs)(l.default,{style:P.default.userEmailRow,children:[(0,A.jsx)(v.default,{size:14,color:B.default.primary}),(0,A.jsx)(f.default,{style:P.default.userEmail,children:e?.email||"Not available"})]})]})]})}),V?(0,A.jsx)(l.default,{style:P.default.dogCardContainer,children:(0,A.jsx)(l.default,{style:P.default.loadingDogCard,children:(0,A.jsx)(i.default,{size:"large",color:B.default.paleYellow})})}):_?(0,A.jsx)(l.default,{style:P.default.dogCardContainer,children:(0,A.jsxs)(r.default,{style:P.default.dogCard,onPress:he,children:[(0,A.jsx)(l.default,{style:P.default.dogPhotoContainer,children:_.photo?(0,A.jsx)(g.Image,{source:_.photo,style:P.default.dogPhoto,contentFit:"cover",cachePolicy:"memory-disk"}):(0,A.jsx)(l.default,{style:[P.default.dogPhoto,P.default.dogPhotoPlaceholder],children:(0,A.jsx)(C.default,{size:40,color:"#9ca3af"})})}),(0,A.jsx)(f.default,{style:P.default.dogName,children:_.name}),_.nickname&&(0,A.jsx)(f.default,{style:P.default.dogNickname,children:_.nickname}),!_.nickname&&(0,A.jsx)(l.default,{style:P.default.nicknameSpacing}),(0,A.jsxs)(l.default,{style:P.default.statsRow,children:[(0,A.jsxs)(l.default,{style:P.default.statItem,children:[(0,A.jsx)(f.default,{style:P.default.statValue,children:de}),(0,A.jsx)(f.default,{style:P.default.statLabel,children:"Walks"})]}),(0,A.jsxs)(l.default,{style:P.default.statItem,children:[(0,A.jsx)(f.default,{style:P.default.statValue,children:(e=>{const t=Math.floor(e/3600),a=Math.floor(e%3600/60);return t>0?`${t}.${Math.floor(a/6)}h`:`${a}m`})(ce)}),(0,A.jsx)(f.default,{style:P.default.statLabel,children:"Total Time"})]}),(0,A.jsxs)(l.default,{style:P.default.statItem,children:[(0,A.jsx)(f.default,{style:P.default.statValue,children:(0,D.formatDistance)(ue)}),(0,A.jsx)(f.default,{style:P.default.statLabel,children:"Total Dist."})]})]}),(0,A.jsxs)(l.default,{style:P.default.dogInfoRow,children:[(0,A.jsx)(l.default,{style:P.default.dogInfoBadge,children:(0,A.jsxs)(f.default,{style:P.default.dogInfoText,children:[_.age," years"]})}),(0,A.jsx)(l.default,{style:P.default.dogInfoBadge,children:(0,A.jsxs)(f.default,{style:P.default.dogInfoText,children:["Size ",_.size]})})]})]})}):(0,A.jsx)(l.default,{style:P.default.dogCardContainer,children:(0,A.jsxs)(l.default,{style:P.default.noDogCard,children:[(0,A.jsx)(C.default,{size:48,color:"#9ca3af"}),(0,A.jsx)(f.default,{style:P.default.noDogText,children:"No dog profile yet"}),(0,A.jsx)(r.default,{style:P.default.addDogButton,onPress:he,children:(0,A.jsx)(f.default,{style:P.default.addDogButtonText,children:"Add Dog Profile"})})]})}),(0,A.jsxs)(l.default,{style:P.default.tabsContainer,children:[(0,A.jsxs)(r.default,{style:[P.default.tab,"created"===oe&&P.default.tabActive],onPress:()=>fe("created"),children:[(0,A.jsx)(f.default,{style:[P.default.tabCount,"created"===oe&&P.default.tabCountActive],children:N.length}),(0,A.jsx)(f.default,{style:[P.default.tabText,"created"===oe&&P.default.tabTextActive],children:"Created"})]}),(0,A.jsxs)(r.default,{style:[P.default.tab,"saved"===oe&&P.default.tabActive],onPress:()=>fe("saved"),children:[(0,A.jsx)(f.default,{style:[P.default.tabCount,"saved"===oe&&P.default.tabCountActive],children:M.length}),(0,A.jsx)(f.default,{style:[P.default.tabText,"saved"===oe&&P.default.tabTextActive],children:"Saved"})]}),(0,A.jsxs)(r.default,{style:[P.default.tab,"reviews"===oe&&P.default.tabActive],onPress:()=>fe("reviews"),children:[(0,A.jsx)(f.default,{style:[P.default.tabCount,"reviews"===oe&&P.default.tabCountActive],children:"0"}),(0,A.jsx)(f.default,{style:[P.default.tabText,"reviews"===oe&&P.default.tabTextActive],children:"Reviews"})]})]}),(0,A.jsx)(l.default,{style:P.default.trailsSection,children:$?(0,A.jsx)(l.default,{style:P.default.loadingContainer,children:(0,A.jsx)(i.default,{size:"large",color:B.default.primary})}):me.length>0?me.map(e=>{const t=ge(e.id),a=U(e.id);return(0,A.jsxs)(r.default,{style:P.default.trailCard,onPress:()=>{return t=e.id,void se.push(`/trail/${t}`);var t},children:[e.photo?(0,A.jsx)(g.Image,{source:{uri:e.photo},style:P.default.trailImage}):(0,A.jsx)(L.default,{coordinates:e.coordinates,path:e.path,style:P.default.trailImage,startLatitude:e.startLatitude,startLongitude:e.startLongitude}),(0,A.jsx)(F.LinearGradient,{colors:["rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0.25)","rgba(0, 0, 0, 0.6)"],locations:[0,.3,.6,1],style:P.default.trailGradient}),(0,A.jsx)(r.default,{style:P.default.bookmarkButton,onPress:t=>{t.stopPropagation(),(async e=>{const t=ge(e),a=U(e);u.default.sequence([u.default.timing(t,{toValue:.6,duration:100,useNativeDriver:!0}),u.default.spring(t,{toValue:1,friction:3,tension:100,useNativeDriver:!0})]).start();try{a?await H(e):await G(e)}catch(o){console.error("Failed to toggle bookmark:",o)}})(e.id)},children:(0,A.jsx)(u.default.View,{style:{transform:[{scale:t}]},children:(0,A.jsx)(j.default,{size:20,color:a?"#000":"#64748b",fill:a?"#000":"none",strokeWidth:2})})}),(0,A.jsxs)(l.default,{style:P.default.trailContent,children:[(0,A.jsx)(f.default,{style:P.default.trailName,children:e.name||`Trail ${new Date(e.date).toLocaleDateString()}`}),(0,A.jsx)(f.default,{style:P.default.trailLocation,children:e.city?`${e.city}, ${e.country||"Unknown"}`:"Location unknown"}),(0,A.jsxs)(l.default,{style:P.default.trailBadges,children:[e.difficulty&&(0,A.jsxs)(l.default,{style:P.default.trailBadge,children:[(0,A.jsx)(b.default,{size:14,color:"#d4d4a0",strokeWidth:2.5}),(0,A.jsx)(f.default,{style:P.default.trailBadgeText,children:e.difficulty})]}),(0,A.jsxs)(l.default,{style:P.default.trailBadge,children:[(0,A.jsx)(T.default,{size:14,color:"#d4d4a0",strokeWidth:2.5}),(0,A.jsx)(f.default,{style:P.default.trailBadgeText,children:(0,D.formatDistance)(e.distance)})]}),e.rating&&(0,A.jsxs)(l.default,{style:P.default.trailBadge,children:[(0,A.jsx)(k.default,{size:14,color:"#fbbf24",fill:"#fbbf24",strokeWidth:2}),(0,A.jsx)(f.default,{style:P.default.trailBadgeText,children:e.rating.toFixed(1)})]})]})]})]},e.id)}):(0,A.jsxs)(l.default,{style:P.default.emptyContainer,children:[(0,A.jsx)(T.default,{size:48,color:"#9ca3af"}),(0,A.jsx)(f.default,{style:P.default.emptyText,children:"created"===oe?"No trails created yet":"saved"===oe?"No trails saved yet":"No reviews yet"})]})}),(0,A.jsx)(r.default,{style:[P.default.signOutButton,q&&P.default.signOutButtonDisabled],onPress:async()=>{n.default.alert("Sign Out","Are you sure you want to sign out?",[{text:"Cancel",style:"cancel"},{text:"Sign Out",style:"destructive",onPress:async()=>{J(!0);try{await t()}catch(e){0,n.default.alert("Error",e.message||"Failed to sign out")}finally{J(!1)}}}])},disabled:q,children:q?(0,A.jsx)(i.default,{color:"#fff"}):(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(S.default,{size:20,color:"#fff"}),(0,A.jsx)(f.default,{style:P.default.signOutText,children:"Sign Out"})]})}),(0,A.jsx)(c.default,{visible:Y,animationType:"slide",presentationStyle:"pageSheet",onRequestClose:ye,children:(0,A.jsxs)(l.default,{style:P.default.modalContainer,children:[(0,A.jsxs)(l.default,{style:[P.default.modalHeader,{paddingTop:ie.top+20}],children:[(0,A.jsx)(f.default,{style:P.default.modalTitle,children:"Edit Profile"}),(0,A.jsx)(r.default,{style:P.default.closeButton,onPress:ye,children:(0,A.jsx)(I.default,{size:24,color:B.default.primary})})]}),(0,A.jsxs)(s.default,{style:P.default.modalContent,children:[(0,A.jsxs)(l.default,{style:P.default.photoSection,children:[(0,A.jsxs)(r.default,{style:P.default.photoContainer,onPress:async()=>{const{status:e}=await h.requestMediaLibraryPermissionsAsync();if("granted"!==e)return void n.default.alert("Permission needed","Please allow access to your photo library");const t=await h.launchImageLibraryAsync({mediaTypes:["images"],allowsEditing:!0,aspect:[1,1],quality:.8});!t.canceled&&t.assets[0]&&ee(t.assets[0].uri)},children:[X?(0,A.jsx)(g.Image,{source:X,style:P.default.editPhoto,contentFit:"cover",cachePolicy:"memory-disk"}):(0,A.jsx)(l.default,{style:[P.default.editPhoto,P.default.initialAvatar],children:(0,A.jsx)(f.default,{style:P.default.initialAvatarText,children:(Q||a?.name||e?.email||"A").charAt(0).toUpperCase()})}),(0,A.jsx)(l.default,{style:P.default.cameraOverlay,children:(0,A.jsx)(w.default,{size:24,color:"#fff"})})]}),(0,A.jsx)(f.default,{style:P.default.photoHint,children:"Tap to change photo"})]}),(0,A.jsxs)(l.default,{style:P.default.inputSection,children:[(0,A.jsx)(f.default,{style:P.default.inputLabel,children:"Name"}),(0,A.jsx)(d.default,{style:P.default.input,value:Q,onChangeText:Z,placeholder:"Enter your name",placeholderTextColor:"#9ca3af"})]}),(0,A.jsxs)(l.default,{style:P.default.inputSection,children:[(0,A.jsx)(f.default,{style:P.default.inputLabel,children:"Email"}),(0,A.jsx)(l.default,{style:P.default.disabledInput,children:(0,A.jsx)(f.default,{style:P.default.disabledInputText,children:e?.email})}),(0,A.jsx)(f.default,{style:P.default.inputHint,children:"Email cannot be changed"})]})]}),(0,A.jsx)(l.default,{style:[P.default.modalFooter,{paddingBottom:ie.bottom+20}],children:(0,A.jsx)(r.default,{style:[P.default.saveButton,te&&P.default.saveButtonDisabled],onPress:async()=>{if(Q.trim()){ae(!0);try{await O({name:Q.trim(),photo:"string"===typeof X&&X?X:void 0}),K(!1),n.default.alert("Success","Profile updated successfully!")}catch(e){console.error("Failed to save profile:",e),n.default.alert("Error",e?.message||"Failed to update profile")}finally{ae(!1)}}else n.default.alert("Error","Name cannot be empty")},disabled:te,children:te?(0,A.jsx)(i.default,{color:"#fff"}):(0,A.jsx)(f.default,{style:P.default.saveButtonText,children:"Save Changes"})})})]})})]})})}},8745(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>r});var o=a(3668),l=a(9582);const r=o.default.create({container:{flex:1,backgroundColor:l.default.background},scrollContainer:{flex:1},content:{paddingHorizontal:16},userSection:{marginBottom:24},userHeader:{flexDirection:"row",alignItems:"center"},userAvatar:{width:48,height:48,borderRadius:24,overflow:"hidden",backgroundColor:l.default.lightGreen,borderWidth:2,borderColor:l.default.primary},userAvatarImage:{width:"100%",height:"100%"},userInfo:{marginLeft:12,flex:1},userName:{fontSize:20,fontWeight:"700",color:l.default.darkGreen,marginBottom:2},userEmailRow:{flexDirection:"row",alignItems:"center",gap:6},userEmail:{fontSize:14,color:l.default.primary,opacity:.8},dogCardContainer:{marginBottom:24},dogCard:{backgroundColor:l.default.darkGreen,borderRadius:24,padding:24,alignItems:"center",borderWidth:1,borderColor:l.default.primary},dogPhotoContainer:{marginBottom:16},dogPhoto:{width:100,height:100,borderRadius:50,backgroundColor:l.default.mediumGreen,borderWidth:3,borderColor:l.default.paleYellow},dogPhotoPlaceholder:{justifyContent:"center",alignItems:"center"},dogName:{fontSize:22,fontWeight:"700",color:"#fff",marginBottom:4},dogNickname:{fontSize:14,color:l.default.paleYellow,opacity:.9,marginBottom:16},nicknameSpacing:{height:16},statsRow:{flexDirection:"row",justifyContent:"space-around",width:"100%",marginBottom:20},statItem:{alignItems:"center"},statValue:{fontSize:24,fontWeight:"700",color:"#fff",marginBottom:4},statLabel:{fontSize:13,color:l.default.paleYellow,opacity:.8},dogInfoRow:{flexDirection:"row",gap:12},dogInfoBadge:{backgroundColor:"rgba(255, 255, 255, 0.1)",paddingHorizontal:16,paddingVertical:8,borderRadius:16},dogInfoText:{fontSize:14,color:"#fff",fontWeight:"500"},loadingDogCard:{backgroundColor:l.default.darkGreen,borderRadius:24,padding:48,alignItems:"center",justifyContent:"center",borderWidth:1,borderColor:l.default.primary},noDogCard:{backgroundColor:l.default.darkGreen,borderRadius:24,padding:32,alignItems:"center",gap:12,borderWidth:1,borderColor:l.default.primary},noDogText:{fontSize:16,color:l.default.paleYellow,opacity:.9,textAlign:"center"},addDogButton:{backgroundColor:l.default.primary,paddingHorizontal:20,paddingVertical:12,borderRadius:12,marginTop:8},addDogButtonText:{fontSize:15,fontWeight:"600",color:"#fff"},tabsContainer:{flexDirection:"row",marginBottom:20,gap:12},tab:{flex:1,backgroundColor:"#fff",paddingVertical:16,paddingHorizontal:16,borderRadius:16,alignItems:"center",borderWidth:0},tabActive:{backgroundColor:"#5d6b4a"},tabText:{fontSize:14,fontWeight:"600",color:"#9ca3af"},tabTextActive:{color:"#fff"},tabCount:{fontSize:24,fontWeight:"700",color:l.default.darkGreen,marginBottom:4},tabCountActive:{color:"#fff"},trailsSection:{marginBottom:24},trailCard:{backgroundColor:"#fff",borderRadius:24,overflow:"hidden",marginBottom:20,shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.1,shadowRadius:16,elevation:4,position:"relative"},trailImage:{width:"100%",height:260,backgroundColor:"#e2e8f0"},trailGradient:{position:"absolute",top:0,bottom:0,left:0,right:0},trailContent:{position:"absolute",bottom:0,left:0,right:0,padding:18,paddingBottom:20},trailName:{fontSize:28,fontWeight:"700",color:"#fff",marginBottom:6,lineHeight:34,textShadowColor:"rgba(0, 0, 0, 0.3)",textShadowOffset:{width:0,height:1},textShadowRadius:4},trailLocation:{fontSize:16,color:"#fff",marginBottom:16,opacity:.95,textShadowColor:"rgba(0, 0, 0, 0.3)",textShadowOffset:{width:0,height:1},textShadowRadius:4},trailBadges:{flexDirection:"row",alignItems:"center",gap:12,flexWrap:"wrap"},trailBadge:{flexDirection:"row",alignItems:"center",backgroundColor:"rgba(40, 40, 40, 0.8)",paddingHorizontal:14,paddingVertical:8,borderRadius:20,gap:6},trailBadgeText:{fontSize:14,fontWeight:"600",color:"#fff",textTransform:"capitalize"},bookmarkButton:{position:"absolute",top:20,right:20,width:44,height:44,borderRadius:22,backgroundColor:"rgba(255, 255, 255, 0.95)",justifyContent:"center",alignItems:"center",shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:8,elevation:4,zIndex:10},loadingContainer:{paddingVertical:60,alignItems:"center"},emptyContainer:{paddingVertical:60,alignItems:"center",gap:16,paddingHorizontal:32},emptyText:{fontSize:16,color:l.default.primary,opacity:.7,textAlign:"center",lineHeight:24},signOutButton:{flexDirection:"row",alignItems:"center",justifyContent:"center",gap:12,backgroundColor:"#b91c1c",borderRadius:12,padding:16,marginTop:16,borderWidth:1,borderColor:"#7f1d1d"},signOutButtonDisabled:{opacity:.6},signOutText:{fontSize:16,fontWeight:"600",color:"#fff"},modalContainer:{flex:1,backgroundColor:l.default.background},modalHeader:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:20,paddingBottom:20,backgroundColor:l.default.background,borderBottomWidth:1,borderBottomColor:l.default.lightGreen},modalTitle:{fontSize:24,fontWeight:"700",color:l.default.darkGreen},closeButton:{width:40,height:40,borderRadius:20,backgroundColor:l.default.lightGreen,justifyContent:"center",alignItems:"center"},modalContent:{flex:1,padding:20},photoSection:{alignItems:"center",marginBottom:32,paddingTop:20},photoContainer:{width:120,height:120,borderRadius:60,overflow:"hidden",position:"relative",marginBottom:12},editPhoto:{width:"100%",height:"100%"},cameraOverlay:{position:"absolute",bottom:0,left:0,right:0,height:40,backgroundColor:"rgba(0, 0, 0, 0.5)",justifyContent:"center",alignItems:"center"},photoHint:{fontSize:14,color:"#6b7280"},inputSection:{marginBottom:24},inputLabel:{fontSize:15,fontWeight:"600",color:l.default.primary,marginBottom:8},input:{backgroundColor:"#fff",borderRadius:12,padding:16,fontSize:16,color:l.default.darkGreen,borderWidth:1,borderColor:l.default.lightGreen},disabledInput:{backgroundColor:"#f3f4f6",borderRadius:12,padding:16,borderWidth:1,borderColor:"#e5e7eb"},disabledInputText:{fontSize:16,color:"#9ca3af"},inputHint:{fontSize:13,color:"#9ca3af",marginTop:6},modalFooter:{padding:20,backgroundColor:l.default.background,borderTopWidth:1,borderTopColor:l.default.lightGreen},saveButton:{backgroundColor:l.default.primary,borderRadius:12,padding:16,alignItems:"center"},saveButtonDisabled:{opacity:.6},saveButtonText:{fontSize:16,fontWeight:"600",color:"#fff"},initialAvatar:{width:"100%",height:"100%",backgroundColor:l.default.lightGreen,justifyContent:"center",alignItems:"center"},initialAvatarText:{fontSize:36,fontWeight:"700",color:"#fff"}})},8973(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>s});var o=a(9637),l=(a(6665),a(3929)),r=a(6283),n=a(3668),i=a(397);function s(){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.Stack.Screen,{options:{title:"Oops!"}}),(0,i.jsxs)(l.default,{style:d.container,children:[(0,i.jsx)(r.default,{style:d.title,children:"This screen doesn't exist."}),(0,i.jsx)(o.Link,{href:"/",asChild:!0,style:d.link,children:(0,i.jsx)(r.default,{style:d.linkText,children:"Go to home screen!"})})]})]})}const d=n.default.create({container:{flex:1,alignItems:"center",justifyContent:"center",padding:20},title:{fontSize:20,fontWeight:"bold"},link:{marginTop:15,paddingVertical:15},linkText:{fontSize:14,color:"#2e78b7"}})},9269(e,t,a){"use strict";function o(e,t){const a=l(t.latitude-e.latitude),o=l(t.longitude-e.longitude),r=l(e.latitude),n=l(t.latitude),i=Math.sin(a/2)*Math.sin(a/2)+Math.sin(o/2)*Math.sin(o/2)*Math.cos(r)*Math.cos(n);return 6371*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))}function l(e){return e*Math.PI/180}function r(e){if(e.length<2)return 0;let t=0;for(let a=0;a<e.length-1;a++){t+=o(e[a],e[a+1])}return 1e3*t}function n(e){if(e<1e3)return`${Math.round(e)}m`;return`${(e/1e3).toFixed(2)}km`}function i(e){const t=Math.floor(e/3600),a=Math.floor(e%3600/60),o=e%60;return t>0?`${t}h ${a}m`:a>0?`${a}m ${o}s`:`${o}s`}function s(e){const t=new Date(e),a=new Date,o=Math.floor((a.getTime()-t.getTime())/864e5);return 0===o?`Today at ${t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`:1===o?`Yesterday at ${t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`:t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}a.r(t),a.d(t,{calculateDistance:()=>o,calculateTotalDistance:()=>r,formatDate:()=>s,formatDistance:()=>n,formatDuration:()=>i})},9582(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>c,setTheme:()=>d});var o=a(414);const l={primary:"#5d6b4a",accent:"#FFFE77",background:"#F8F7F2",darkGreen:"#282E10",mediumGreen:"#3d4520",lightGreen:"#a8ad8e",paleYellow:"#d4d4a0",surface:"#f3f4f6",border:"#e5e7eb",muted:"#6b7280",tabBarBg:"rgba(40,46,16,0.95)",light:{text:"#1a1f0a",background:"#F8F7F2",tint:"#5d6b4a",tabIconDefault:"#9ca3af",tabIconSelected:"#FFFE77"}},r={primary:"#86a06a",accent:"#FFFE77",background:"#071009",darkGreen:"#e6f0d9",mediumGreen:"#223015",lightGreen:"#6b7b56",paleYellow:"#bfb77a",surface:"#0f1a14",border:"#123019",muted:"#9ca3af",tabBarBg:"rgba(10,12,6,0.95)",light:{text:"#eef7e6",background:"#071009",tint:"#86a06a",tabIconDefault:"#9ca3af",tabIconSelected:"#FFFE77"}},n="dark"===o.default.getColorScheme()?r:l,i=Object.assign({},n);function s(e){Object.keys(i).forEach(e=>delete i[e]),Object.assign(i,e)}function d(e){s("dark"===e?r:"light"===e?l:"dark"===o.default.getColorScheme()?r:l)}o.default&&"function"===typeof o.default.addChangeListener&&o.default.addChangeListener(e=>{s("dark"===(e.colorScheme||o.default.getColorScheme())?r:l)});const c=i},9600(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>d});var o=a(6665),l=a(6283),r=a(3929);const n=a(3668).default.create({container:{overflow:"hidden",borderRadius:12,backgroundColor:"#f3f4f6"},map:{width:"100%",height:"100%"},placeholder:{justifyContent:"center",alignItems:"center",padding:12},text:{color:"#5d6b4a",fontWeight:"bold",fontSize:16},subtext:{color:"#666",fontSize:12,marginTop:4}});var i=a(7042),s=(a(1051),a(397));function d({coordinates:e,path:t,style:a,height:d=260,startLatitude:c=null,startLongitude:u=null}){const f=(0,o.useRef)(null),g=(0,o.useRef)(null),h=(0,o.useRef)(null),y=e&&e.length>0?e:Array.isArray(t)?t.map(e=>({latitude:e[1],longitude:e[0]})):[];return(0,o.useEffect)(()=>{if(!f.current)return;const e=null!=c&&null!=u?[u,c]:y.length>0?[y[0].longitude,y[0].latitude]:[0,0],t=new i.Map({container:f.current,style:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",center:e,zoom:y.length>0?12:1,interactive:!1});return g.current=t,t.on("load",()=>{if(y&&y.length>1){const e={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:y.map(e=>[e.longitude,e.latitude])}};t.getSource("preview-route")?t.getSource("preview-route").setData(e):(t.addSource("preview-route",{type:"geojson",data:e}),t.addLayer({id:"preview-route",type:"line",source:"preview-route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#5d6b4a","line-width":3}}));const a=new i.LngLatBounds;y.forEach(e=>a.extend([e.longitude,e.latitude])),t.fitBounds(a,{padding:10,maxZoom:16})}else if(y&&1===y.length){const e=y[0];if(h.current)h.current.setLngLat([e.longitude,e.latitude]);else{const a=new i.Marker({color:"#5d6b4a"}).setLngLat([e.longitude,e.latitude]).addTo(t);h.current=a}t.setCenter([e.longitude,e.latitude]),t.setZoom(14)}}),()=>{try{t.remove()}catch(e){}g.current=null,h.current=null}},[JSON.stringify(y),c,u]),(0,s.jsx)(r.default,{style:[n.container,a],children:y&&y.length>0?(0,s.jsx)("div",{ref:f,style:{width:"100%",height:"number"===typeof d?`${d}px`:d}}):(0,s.jsxs)(r.default,{style:n.placeholder,children:[(0,s.jsx)(l.default,{style:n.text,children:"Map Preview (Web)"}),(0,s.jsxs)(l.default,{style:n.subtext,children:[y?.length||0," points recorded"]})]})})}},9908(e,t,a){"use strict";a.r(t),a.d(t,{DogsContext:()=>i,useDogs:()=>s});var o=a(6665),l=a(2790),r=a(3353),n=a(5938);const[i,s]=(0,l.default)(()=>{const{user:e,session:t,isLoading:a}=(0,r.useAuth)(),[l,i]=(0,o.useState)([]),[s,d]=(0,o.useState)(null),[c,u]=(0,o.useState)(!0),f=(0,o.useMemo)(()=>l.find(e=>e.id===s)||l[0]||null,[l,s]),g=(0,o.useCallback)(async(e,t)=>{console.log("Loading dog profiles for user:",e),u(!0);try{const e=await fetch(`${n.API_URL}/dog`,{headers:{Authorization:`Bearer ${t}`}});if(e.ok){const t=await e.json();Array.isArray(t)?(i(t),t.length>0&&!s&&d(t[0].id)):t&&"object"===typeof t?(i([t]),d(t.id)):i([])}else i([])}catch(a){console.error("Error loading dog profiles:",a),i([])}finally{u(!1)}},[s]),h=(0,o.useCallback)(async()=>{e&&t&&await g(e.id,t.accessToken)},[e,t,g]);(0,o.useEffect)(()=>{a||(e&&t?g(e.id,t.accessToken):(i([]),u(!1)))},[e,t,g,a]);const y=(0,o.useCallback)(async e=>{if(!t)throw new Error("No session");const a=await fetch(`${n.API_URL}/dog`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.accessToken}`},body:JSON.stringify(e)});if(!a.ok){const e=await a.json();throw new Error(e.detail?.[0]?.msg||"Failed to create dog profile")}const o=await a.json();return i(e=>[...e,o]),d(o.id),o},[t]),m=(0,o.useCallback)(async e=>{if(!t)throw new Error("No session");if(!e.id)throw new Error("Dog ID is required for update");const a=await fetch(`${n.API_URL}/dog/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.accessToken}`},body:JSON.stringify(e)});if(!a.ok){const e=await a.json();throw new Error(e.detail?.[0]?.msg||"Failed to update dog profile")}const o=await a.json();return i(e=>e.map(e=>e.id===o.id?o:e)),o},[t]);return(0,o.useMemo)(()=>({dogProfile:f,dogProfiles:l,activeDogId:s,setActiveDogId:d,isDogProfileLoading:c,hasDogProfile:l.length>0,refreshDogProfile:h,createDogProfile:y,updateDogProfile:m}),[f,l,s,c,h,y,m])})}},t={};function a(o){var l=t[o];if(void 0!==l)return l.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,a),r.exports}a.m=e,(()=>{var e=[];a.O=(t,o,l,r)=>{if(!o){var n=1/0;for(c=0;c<e.length;c++){for(var[o,l,r]=e[c],i=!0,s=0;s<o.length;s++)(!1&r||n>=r)&&Object.keys(a.O).every(e=>a.O[e](o[s]))?o.splice(s--,1):(i=!1,r<n&&(n=r));if(i){e.splice(c--,1);var d=l();void 0!==d&&(t=d)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[o,l,r]}})(),a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.p="/",(()=>{var e={792:0};a.O.j=t=>0===e[t];var t=(t,o)=>{var l,r,[n,i,s]=o,d=0;if(n.some(t=>0!==e[t])){for(l in i)a.o(i,l)&&(a.m[l]=i[l]);if(s)var c=s(a)}for(t&&t(o);d<n.length;d++)r=n[d],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(c)},o=self.webpackChunkweb=self.webpackChunkweb||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var o=a.O(void 0,[607],()=>a(389));o=a.O(o)})();
//# sourceMappingURL=main.bbeac867.js.map