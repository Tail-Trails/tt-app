(()=>{var e={587(e,t,a){var o={"./(tabs)/_layout.tsx":5210,"./(tabs)/explore.styles.ts":2699,"./(tabs)/explore.tsx":4509,"./(tabs)/profile.styles.ts":8745,"./(tabs)/profile.tsx":8415,"./(tabs)/record.styles.ts":1095,"./(tabs)/record.tsx":5209,"./(tabs)/settings.styles.ts":4171,"./(tabs)/settings.tsx":282,"./+not-found.tsx":8973,"./_layout.tsx":5111,"./auth.styles.ts":5632,"./demo.tsx":5625,"./index.tsx":5250,"./login.tsx":4101,"./onboarding/dog-basics.styles.ts":7924,"./onboarding/dog-basics.tsx":4674,"./onboarding/dog-personality.styles.ts":8625,"./onboarding/dog-personality.tsx":6183,"./signup.tsx":3764,"./trail/[id].styles.ts":8776,"./trail/[id].tsx":3686,"./trails.tsx":2399};function r(e){var t=n(e);return a(t)}function n(e){if(!a.o(o,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return o[e]}r.keys=function(){return Object.keys(o)},r.resolve=n,e.exports=r,r.id=587},5210(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>T});var o=a(9637),r=a(1168),n=a(8032),i=a(2557),l=a(6665),s=a(5648),d=a(3929),c=a(5009),u=a(3041),f=a(8833),g=a(4866),y=a(3185),h=a(3668),p=a(9582),m=a(2291);const b=h.default.create({container:{width:"100%",paddingHorizontal:0,paddingTop:0,alignItems:"center"},tabBar:{flexDirection:"row",backgroundColor:p.default.backgroundPrimary,borderRadius:0,paddingVertical:8,paddingHorizontal:8,justifyContent:"space-around",alignItems:"center",shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:8,elevation:8,width:"100%",gap:6},tabButton:{height:64,borderRadius:16,overflow:"hidden",justifyContent:"center",alignItems:"center"},tabTouchable:{flex:1,width:"100%",justifyContent:"center",alignItems:"center"},tabContent:{flexDirection:"column",alignItems:"center",justifyContent:"center",gap:4,paddingHorizontal:0},iconWrapper:{width:22,height:22,alignItems:"center",justifyContent:"center"},label:Object.assign({},m.Typography.label(p.default.textMuted),void 0),labelActive:{color:p.default.accentPrimary}});var x=a(397);function j({state:e,descriptors:t,navigation:a}){const o=(0,f.useSafeAreaInsets)(),r=(0,l.useRef)(e.routes.map(()=>new c.default.Value(0))).current;(0,l.useEffect)(()=>{console.log("AnimatedTabBar state.index:",e.index),console.log("AnimatedTabBar routes:",e.routes.map(e=>({name:e.name,key:e.key}))),console.log("AnimatedTabBar descriptors keys:",Object.keys(t)),e.routes.forEach((t,a)=>{c.default.timing(r[a],{toValue:e.index===a?1:0,duration:300,useNativeDriver:!1}).start()})},[e.index,e.routes,r]);const n=Math.max(o.bottom,8);return(0,x.jsx)(d.default,{style:b.container,children:(0,x.jsx)(d.default,{style:[b.tabBar,{paddingBottom:n}],children:e.routes.filter(e=>{const a=t[e.key]?.options;return!(!a||!(a.tabBarLabel||a.title||a.tabBarIcon))}).map((o,n)=>{const{options:i}=t[o.key],l=void 0!==i.tabBarLabel?i.tabBarLabel:void 0!==i.title?i.title:o.name,f=e.index===n,h=(r[n],p.default.backgroundPrimary),m=f?p.default.accentPrimary:p.default.textMuted;f?p.default.accentPrimary:p.default.textMuted;return(0,x.jsx)(c.default.View,{style:[b.tabButton,{width:72,backgroundColor:h}],children:(0,x.jsx)(s.default,{accessibilityRole:"button",accessibilityState:f?{selected:!0}:{},accessibilityLabel:i.tabBarAccessibilityLabel,onPress:()=>{g.impactAsync(y.ImpactFeedbackStyle.Light);const e=a.emit({type:"tabPress",target:o.key,canPreventDefault:!0});f||e.defaultPrevented||a.navigate(o.name)},style:b.tabTouchable,children:(0,x.jsxs)(d.default,{style:b.tabContent,children:[(0,x.jsx)(d.default,{style:b.iconWrapper,children:i.tabBarIcon&&i.tabBarIcon({focused:f,color:m,size:22})}),(0,x.jsx)(c.default.View,{style:{opacity:1},children:(0,x.jsx)(u.Text,{style:[b.label,f&&b.labelActive],children:String(l)})})]})})},o.key)})})})}function T(){return(0,x.jsxs)(o.Tabs,{tabBar:e=>(0,x.jsx)(j,Object.assign({},e)),screenOptions:{headerShown:!1,tabBarActiveTintColor:p.default.backgroundSecondaryVarient,tabBarInactiveTintColor:p.default.backgroundPrimary},children:[(0,x.jsx)(o.Tabs.Screen,{name:"explore",options:{title:"Explore",tabBarIcon:({color:e,size:t})=>(0,x.jsx)(r.default,{size:t,color:e})}}),(0,x.jsx)(o.Tabs.Screen,{name:"record",options:{title:"Record",tabBarIcon:({color:e,size:t})=>(0,x.jsx)(n.default,{size:t,color:e})}}),(0,x.jsx)(o.Tabs.Screen,{name:"profile",options:{title:"Profile",tabBarIcon:({color:e,size:t})=>(0,x.jsx)(i.default,{size:t,color:e})}})]})}console.log("[init] components/AnimatedTabBar.tsx loaded")},2699(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>i});var o=a(3668),r=a(9582),n=a(2291);const i=o.default.create({safeContainer:{flex:1,backgroundColor:r.default.backgroundPrimary},container:{flex:1,backgroundColor:r.default.backgroundPrimary},stickyHeader:{backgroundColor:r.default.backgroundPrimary,paddingBottom:8},stickySearchContainer:{paddingHorizontal:16,paddingBottom:8,flexDirection:"row",alignItems:"center",gap:8},searchBar:{flex:1,flexDirection:"row",alignItems:"center",backgroundColor:r.default.backgroundSecondary,paddingHorizontal:16,paddingVertical:14,borderRadius:28,gap:12,borderWidth:1,borderColor:r.default.borderSubtle},demoButton:{backgroundColor:r.default.backgroundPrimary,paddingHorizontal:16,paddingVertical:12,borderRadius:24},demoButtonText:Object.assign({},n.Typography.label(r.default.textPrimary),{fontWeight:"700"}),searchPlaceholder:Object.assign({},n.Typography.body(r.default.textMuted)),largeTrailCard:{backgroundColor:r.default.textPrimary,borderRadius:24,overflow:"hidden",marginBottom:20,shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.1,shadowRadius:16,elevation:4,position:"relative"},largeTrailImage:{width:"100%",height:260,backgroundColor:r.default.backgroundSecondary},bookmarkButton:{position:"absolute",top:20,right:20,width:44,height:44,borderRadius:22,backgroundColor:"rgba(255, 255, 255, 0.95)",justifyContent:"center",alignItems:"center",shadowColor:r.default.backgroundSecondaryVarient,shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:8,elevation:4},cardGradient:{position:"absolute",top:0,bottom:0,left:0,right:0},cardOverlayContent:{position:"absolute",bottom:0,left:0,right:0,padding:18,paddingBottom:20},overlayTrailName:Object.assign({},n.Typography.h2(r.default.textPrimary),{marginBottom:6,lineHeight:34,textShadowColor:"rgba(0, 0, 0, 0.3)",textShadowOffset:{width:0,height:1},textShadowRadius:4}),overlayLocation:Object.assign({},n.Typography.body(r.default.textPrimary),{marginBottom:16,opacity:.95,textShadowColor:"rgba(0, 0, 0, 0.3)",textShadowOffset:{width:0,height:1},textShadowRadius:4}),overlayBadges:{flexDirection:"row",alignItems:"center",gap:12,flexWrap:"wrap"},badge:{flexDirection:"row",alignItems:"center",backgroundColor:"rgba(40, 40, 40, 0.8)",paddingHorizontal:14,paddingVertical:8,borderRadius:20,gap:6},badgeText:Object.assign({},n.Typography.label("#fff"),{paddingHorizontal:0,textTransform:"capitalize"}),categoriesSection:{backgroundColor:r.default.backgroundPrimary,paddingTop:8,paddingBottom:16},categoriesScroll:{paddingHorizontal:16,gap:12},categoryButton:{flexDirection:"row",alignItems:"center",justifyContent:"center",paddingHorizontal:20,paddingVertical:12,borderRadius:28,backgroundColor:r.default.textPrimary,alignSelf:"flex-start",minHeight:48},categoryText:Object.assign({},n.Typography.caption(r.default.textMuted),void 0),categoryButtonActive:{backgroundColor:r.default.backgroundPrimary},categoryTextActive:{color:r.default.textPrimary},categoryTrailsSection:{paddingHorizontal:16,paddingTop:16},bottomPadding:{height:40},loadingContainer:{paddingVertical:60,alignItems:"center",gap:16},loadingText:Object.assign({},n.Typography.caption(r.default.textMuted)),emptyContainer:{paddingVertical:60,alignItems:"center",gap:16,paddingHorizontal:32},emptyText:Object.assign({},n.Typography.body(r.default.textMuted),{textAlign:"center",lineHeight:24}),placeholderImage:{justifyContent:"center",alignItems:"center",backgroundColor:r.default.textPrimary},searchModalContainer:{flex:1,backgroundColor:r.default.backgroundPrimary},searchModalHeader:{flexDirection:"row",alignItems:"center",paddingHorizontal:16,paddingTop:12,paddingBottom:16,gap:12,borderBottomWidth:1,borderBottomColor:r.default.borderSubtle},backButton:{width:40,height:40,borderRadius:20,backgroundColor:r.default.accentPrimary,justifyContent:"center",alignItems:"center"},searchModalInputContainer:{flex:1,flexDirection:"row",alignItems:"center",backgroundColor:r.default.textPrimary,borderRadius:28,paddingHorizontal:16,paddingVertical:12,borderWidth:1,borderColor:r.default.textMuted,gap:12},searchModalInput:Object.assign({flex:1},n.Typography.body(r.default.textPrimary),{padding:0}),clearButton:{width:24,height:24,borderRadius:12,backgroundColor:r.default.borderSubtle,justifyContent:"center",alignItems:"center"},searchModalContent:{flex:1,paddingTop:12},currentLocationItem:{flexDirection:"row",alignItems:"center",paddingHorizontal:20,paddingVertical:16,gap:16,backgroundColor:r.default.backgroundSecondary,borderRadius:16,marginHorizontal:16,marginBottom:12},locationIconContainer:{width:48,height:48,borderRadius:24,backgroundColor:r.default.accentPrimary,justifyContent:"center",alignItems:"center"},locationTextContainer:{flex:1},locationTitle:Object.assign({},n.Typography.label(r.default.textPrimary),{marginBottom:4}),locationSubtitle:Object.assign({},n.Typography.caption(r.default.textMuted)),suggestionItem:{flexDirection:"row",alignItems:"center",paddingHorizontal:20,paddingVertical:16,gap:16,backgroundColor:r.default.backgroundSecondary,borderRadius:16,marginHorizontal:16,marginBottom:12},suggestionIconContainer:{width:48,height:48,borderRadius:24,backgroundColor:r.default.borderSubtle,justifyContent:"center",alignItems:"center"},suggestionTextContainer:{flex:1},suggestionTitle:Object.assign({},n.Typography.label(r.default.textPrimary),{marginBottom:4}),suggestionSubtitle:Object.assign({},n.Typography.caption(r.default.textMuted))})},4509(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>F});var o=a(6665),r=a(9637),n=a(3929),i=a(2772),l=a(5648),s=a(5009),d=a(6773),c=a(8264),u=a(932),f=a(3041),g=a(9857),y=a(5894),h=a(893),p=a(8833),m=a(675),b=a(5163),x=a(4866),j=a(3185),T=a(3087),w=a(2994),C=a(1449),k=a(3048),P=a(1168),I=a(8032),S=a(1858),v=a(5082),O=a(4550),B=a(2964),E=a(9582),_=a(6746),A=a(9269),L=a(9600),D=a(2699),R=a(397);const z=[{id:"nearby",name:"Nearby",icon:P.default},{id:"popular",name:"Popular",icon:k.default},{id:"beaches",name:"Beaches",icon:O.default}];function F(){const e=(0,r.useRouter)(),t=(0,p.useSafeAreaInsets)(),{loadNearbyTrails:a,saveTrailBookmark:k,removeTrailBookmark:O,isTrailSaved:F}=(0,_.useTrails)(),[N,U]=(0,o.useState)("nearby"),[M,V]=(0,o.useState)([]),[G,W]=(0,o.useState)(!0),[,H]=(0,o.useState)(void 0),[$,q]=(0,o.useState)({}),[X,J]=(0,o.useState)(""),[K,Y]=(0,o.useState)(!1),[Z,Q]=(0,o.useState)(""),[ee,te]=(0,o.useState)([]),ae=(0,o.useCallback)(async()=>{try{const{status:e}=await m.requestForegroundPermissionsAsync();if("granted"===e){const e=await m.getCurrentPositionAsync({accuracy:b.LocationAccuracy.Balanced});H(void 0),Q("Current location");const t=await a(e.coords.latitude,e.coords.longitude);V(t)}else{Q("Location unavailable");const e=await a();V(e)}}catch(e){console.error("Error loading location:",e),Q("Location unavailable");const t=await a();V(t)}finally{W(!1)}},[a]);(0,o.useEffect)(()=>{ae()},[ae]),(0,r.useFocusEffect)((0,o.useCallback)(()=>{console.log("Explore tab focused - refreshing nearby trails"),ae()},[ae]));const oe=(0,o.useCallback)(()=>{const e=X.toLowerCase(),t=M.filter(t=>{const a=t.name?.toLowerCase()||"",o=t.city?.toLowerCase()||"",r=t.country?.toLowerCase()||"";return a.includes(e)||o.includes(e)||r.includes(e)}).map(e=>({id:e.id,name:e.name||`Trail ${new Date(e.date).toLocaleDateString()}`,location:e.city?`${e.city}, ${e.country||"Unknown"}`:"Location unknown",type:"trail"})).slice(0,6);te(t)},[X,M]);(0,o.useEffect)(()=>{X.trim()?oe():te([])},[X,oe]);const re=()=>{x.impactAsync(j.ImpactFeedbackStyle.Light),Y(!1),J(""),te([])},ne=e=>{if(!$[e]){const t=new s.default.Value(1);return q(a=>Object.assign({},a,{[e]:t})),t}return $[e]},ie=(0,o.useCallback)(e=>{let t=e;return"popular"===N?t=[...t].sort((e,t)=>(t.rating||0)-(e.rating||0)):"beaches"===N&&(t=t.filter(e=>(e.environment_tags||[]).some(e=>e.toLowerCase().includes("beach")))),t},[N])(M);return(0,R.jsxs)(n.default,{style:D.default.safeContainer,children:[(0,R.jsxs)(i.default,{style:D.default.container,showsVerticalScrollIndicator:!1,stickyHeaderIndices:[0],children:[(0,R.jsxs)(n.default,{style:[D.default.stickyHeader,{paddingTop:t.top+16}],children:[(0,R.jsxs)(n.default,{style:D.default.stickySearchContainer,children:[(0,R.jsxs)(l.default,{style:D.default.searchBar,onPress:()=>{x.impactAsync(j.ImpactFeedbackStyle.Light),Y(!0)},activeOpacity:.7,children:[(0,R.jsx)(S.default,{size:20,color:E.default.textMuted}),(0,R.jsx)(f.Text,{style:D.default.searchPlaceholder,children:"Find trails"})]}),!1]}),(0,R.jsx)(n.default,{style:D.default.categoriesSection,children:(0,R.jsx)(i.default,{horizontal:!0,showsHorizontalScrollIndicator:!1,contentContainerStyle:D.default.categoriesScroll,children:z.map(e=>{const t=e.icon,a=N===e.id;return(0,R.jsxs)(l.default,{style:[D.default.categoryButton,a&&D.default.categoryButtonActive],onPress:()=>{return t=e.id,x.impactAsync(j.ImpactFeedbackStyle.Light),void U(t);var t},children:[(0,R.jsx)(n.default,{style:{marginRight:10},children:(0,R.jsx)(t,{size:20,color:a?E.default.accentPrimary:E.default.textMuted,strokeWidth:2})}),(0,R.jsx)(f.Text,{style:[D.default.categoryText,a&&D.default.categoryTextActive],children:e.name})]},e.id)})})})]}),(0,R.jsx)(n.default,{style:D.default.categoryTrailsSection,children:G?(0,R.jsxs)(n.default,{style:D.default.loadingContainer,children:[(0,R.jsx)(g.default,{size:120}),(0,R.jsx)(f.Text,{style:D.default.loadingText,children:"Loading trails..."})]}):ie.length>0?ie.map(t=>{const a=ne(t.id),o=F(t.id);return(0,R.jsxs)(l.default,{style:D.default.largeTrailCard,onPress:()=>{return a=t.id,x.impactAsync(j.ImpactFeedbackStyle.Light),void e.push(`/trail/${a}`);var a},children:[t.photo?(0,R.jsx)(y.Image,{source:{uri:t.photo},style:D.default.largeTrailImage,contentFit:"cover",cachePolicy:"memory-disk"}):(0,R.jsx)(L.default,{coordinates:t.coordinates,path:t.path,style:D.default.largeTrailImage,startLatitude:t.startLatitude,startLongitude:t.startLongitude}),(0,R.jsx)(h.LinearGradient,{colors:["rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0.25)","rgba(0, 0, 0, 0.6)"],locations:[0,.3,.6,1],style:D.default.cardGradient}),(0,R.jsx)(l.default,{style:D.default.bookmarkButton,onPress:e=>{e.stopPropagation(),(async(e,t=!1)=>{if(!t&&!/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e))return console.log("Cannot bookmark mock trail:",e),void x.notificationAsync(j.NotificationFeedbackType.Warning);x.impactAsync(j.ImpactFeedbackStyle.Medium);const a=ne(e),o=F(e);s.default.sequence([s.default.timing(a,{toValue:.6,duration:100,useNativeDriver:!0}),s.default.spring(a,{toValue:1,friction:3,tension:100,useNativeDriver:!0})]).start();try{o?await O(e):(await k(e),x.notificationAsync(j.NotificationFeedbackType.Success))}catch(r){console.error("Failed to toggle bookmark:",r)}})(t.id,!0)},children:(0,R.jsx)(s.default.View,{style:{transform:[{scale:a}]},children:(0,R.jsx)(w.default,{size:20,color:o?"#000":E.default.textMuted,fill:o?"#000":"none",strokeWidth:2})})}),(0,R.jsxs)(n.default,{style:D.default.cardOverlayContent,children:[(0,R.jsx)(f.Text,{style:D.default.overlayTrailName,children:t.name||`Trail ${new Date(t.date).toLocaleDateString()}`}),(0,R.jsxs)(n.default,{style:D.default.overlayBadges,children:[t.difficulty&&(0,R.jsxs)(n.default,{style:D.default.badge,children:[(0,R.jsx)(T.default,{size:14,color:E.default.accentPrimary,strokeWidth:2.5}),(0,R.jsx)(f.Text,{style:D.default.badgeText,children:t.difficulty})]}),(0,R.jsxs)(n.default,{style:D.default.badge,children:[(0,R.jsx)(P.default,{size:14,color:E.default.accentPrimary,strokeWidth:2.5}),(0,R.jsx)(f.Text,{style:D.default.badgeText,children:(0,A.formatDistance)(t.distance)})]}),"number"===typeof t.distance_from_user&&(0,R.jsxs)(n.default,{style:D.default.badge,children:[(0,R.jsx)(P.default,{size:14,color:E.default.accentPrimary,strokeWidth:2.5}),(0,R.jsx)(f.Text,{style:D.default.badgeText,children:(0,A.formatDistance)(t.distance_from_user)})]}),t.rating&&(0,R.jsxs)(n.default,{style:D.default.badge,children:[(0,R.jsx)(v.default,{size:14,color:E.default.accentPrimary,fill:E.default.accentPrimary,strokeWidth:2}),(0,R.jsx)(f.Text,{style:D.default.badgeText,children:t.rating.toFixed(1)})]})]})]})]},t.id)}):(0,R.jsxs)(n.default,{style:D.default.emptyContainer,children:[(0,R.jsx)(P.default,{size:48,color:"#9ca3af"}),(0,R.jsx)(f.Text,{style:D.default.emptyText,children:"No trails found yet. Record a trail to share with others!"})]})}),(0,R.jsx)(n.default,{style:D.default.bottomPadding})]}),(0,R.jsx)(c.default,{visible:K,animationType:"slide",presentationStyle:"fullScreen",onRequestClose:re,children:(0,R.jsxs)(n.default,{style:[D.default.searchModalContainer,{paddingTop:t.top}],children:[(0,R.jsxs)(n.default,{style:D.default.searchModalHeader,children:[(0,R.jsx)(l.default,{style:D.default.backButton,onPress:re,children:(0,R.jsx)(C.default,{size:24,color:"#5d6b4a"})}),(0,R.jsxs)(n.default,{style:D.default.searchModalInputContainer,children:[(0,R.jsx)(d.default,{style:D.default.searchModalInput,placeholder:"Find trails",placeholderTextColor:"#9ca3af",value:X,onChangeText:J,autoFocus:!0,returnKeyType:"search"}),X.length>0&&(0,R.jsx)(l.default,{style:D.default.clearButton,onPress:()=>J(""),children:(0,R.jsx)(B.default,{size:20,color:"#64748b"})})]})]}),(0,R.jsxs)(n.default,{style:D.default.searchModalContent,children:[""===X.trim()&&(0,R.jsxs)(l.default,{style:D.default.currentLocationItem,onPress:()=>{x.impactAsync(j.ImpactFeedbackStyle.Light),Y(!1),J(""),te([])},children:[(0,R.jsx)(n.default,{style:D.default.locationIconContainer,children:(0,R.jsx)(I.default,{size:20,color:"#5d6b4a"})}),(0,R.jsxs)(n.default,{style:D.default.locationTextContainer,children:[(0,R.jsx)(f.Text,{style:D.default.locationTitle,children:"Current location"}),(0,R.jsx)(f.Text,{style:D.default.locationSubtitle,children:Z})]})]}),ee.length>0&&(0,R.jsx)(u.default,{data:ee,keyExtractor:e=>e.id,renderItem:({item:t})=>(0,R.jsxs)(l.default,{style:D.default.suggestionItem,onPress:()=>{return a=t.id,x.impactAsync(j.ImpactFeedbackStyle.Light),Y(!1),J(""),te([]),void e.push(`/trail/${a}`);var a},children:[(0,R.jsx)(n.default,{style:D.default.suggestionIconContainer,children:(0,R.jsx)(P.default,{size:20,color:"#64748b"})}),(0,R.jsxs)(n.default,{style:D.default.suggestionTextContainer,children:[(0,R.jsx)(f.Text,{style:D.default.suggestionTitle,children:t.name}),(0,R.jsx)(f.Text,{style:D.default.suggestionSubtitle,children:t.location})]})]}),showsVerticalScrollIndicator:!1})]})]})})]})}},8745(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>i});var o=a(3668),r=a(9582),n=a(2291);const i=o.default.create({container:{flex:1,backgroundColor:r.default.backgroundPrimary},scrollContainer:{flex:1},content:{paddingHorizontal:16},settingsButton:{width:40,height:40,borderRadius:20,backgroundColor:r.default.backgroundPrimary,justifyContent:"center",alignItems:"center"},userSection:{marginBottom:24},userHeader:{flexDirection:"row",alignItems:"center"},userAvatar:{width:48,height:48,borderRadius:24,overflow:"hidden",backgroundColor:r.default.accentPrimary,borderWidth:2,borderColor:r.default.backgroundPrimary},userAvatarImage:{width:"100%",height:"100%"},userInfo:{marginLeft:12,flex:1},userName:Object.assign({},n.Typography.h2(r.default.accentPrimary),{marginBottom:2}),userEmailRow:{flexDirection:"row",alignItems:"center",gap:6},userEmail:Object.assign({},n.Typography.label(r.default.accentPrimary),{opacity:.8,marginLeft:6}),dogCardContainer:{marginBottom:24},dogCard:{backgroundColor:r.default.backgroundSecondary,borderRadius:24,padding:24,alignItems:"center",borderWidth:0,borderColor:r.default.backgroundPrimary},dogPhotoContainer:{marginBottom:16},dogPhoto:{width:100,height:100,borderRadius:50,backgroundColor:r.default.backgroundSecondaryVarient,borderWidth:0,borderColor:r.default.accentPrimary},dogPhotoPlaceholder:{justifyContent:"center",alignItems:"center"},dogName:Object.assign({},n.Typography.h2(r.default.accentPrimary),{marginBottom:4}),dogNickname:Object.assign({},n.Typography.label(r.default.textMuted),{opacity:.9,marginBottom:16}),nicknameSpacing:{height:16},statsRow:{flexDirection:"row",justifyContent:"space-around",width:"100%",marginBottom:20},statItem:{alignItems:"center"},statValue:Object.assign({},n.Typography.h1(r.default.accentPrimary),{marginBottom:4}),statLabel:Object.assign({},n.Typography.caption(r.default.textSecondary),{opacity:.8}),dogInfoRow:{flexDirection:"row",gap:12},dogInfoBadge:{backgroundColor:"rgba(255, 255, 255, 0.2)",paddingHorizontal:16,paddingVertical:8,borderRadius:16},dogInfoText:Object.assign({},n.Typography.label(r.default.textPrimary)),loadingDogCard:{backgroundColor:r.default.textPrimary,borderRadius:24,padding:48,alignItems:"center",justifyContent:"center",borderWidth:1,borderColor:r.default.backgroundPrimary},noDogCard:{backgroundColor:r.default.textPrimary,borderRadius:24,padding:32,alignItems:"center",gap:12,borderWidth:1,borderColor:r.default.backgroundPrimary},noDogText:Object.assign({},n.Typography.body(r.default.accentPrimary),{opacity:.9,textAlign:"center"}),addDogButton:{backgroundColor:r.default.backgroundPrimary,paddingHorizontal:20,paddingVertical:12,borderRadius:12,marginTop:8},addDogButtonText:Object.assign({},n.Typography.label(r.default.textPrimary)),tabsContainer:{flexDirection:"row",marginBottom:20,gap:12},tab:{flex:1,backgroundColor:r.default.backgroundSecondary,paddingVertical:16,paddingHorizontal:16,borderRadius:16,alignItems:"center",borderWidth:0},tabActive:{backgroundColor:r.default.accentPrimary},tabText:Object.assign({},n.Typography.label(r.default.textMuted)),tabTextActive:{color:r.default.backgroundSecondary},tabCount:Object.assign({},n.Typography.h1(r.default.accentPrimary),{marginBottom:4}),tabCountActive:{color:r.default.backgroundPrimary},trailsSection:{marginBottom:24},trailCard:{backgroundColor:r.default.textPrimary,borderRadius:24,overflow:"hidden",marginBottom:20,shadowColor:r.default.backgroundSecondaryVarient,shadowOffset:{width:0,height:4},shadowOpacity:.1,shadowRadius:16,elevation:4,position:"relative"},trailImage:{width:"100%",height:260,backgroundColor:r.default.backgroundSecondary},loadingContainer:{paddingVertical:40,alignItems:"center",justifyContent:"center"},trailGradient:{position:"absolute",left:0,right:0,bottom:0,height:120},bookmarkButton:{position:"absolute",top:12,right:12,width:44,height:44,borderRadius:22,backgroundColor:"rgba(255,255,255,0.95)",justifyContent:"center",alignItems:"center",borderWidth:1,borderColor:r.default.backgroundSecondary},trailContent:{position:"absolute",left:12,right:12,bottom:12,padding:12},trailName:Object.assign({},n.Typography.h2(r.default.textPrimary),{marginBottom:4}),trailLocation:Object.assign({},n.Typography.caption(r.default.textPrimary),{opacity:.95}),trailBadges:{flexDirection:"row",gap:8,marginTop:8},trailBadge:{flexDirection:"row",alignItems:"center",gap:6,backgroundColor:"rgba(255,255,255,0.08)",paddingHorizontal:8,paddingVertical:6,borderRadius:12},trailBadgeText:Object.assign({},n.Typography.caption(r.default.textPrimary)),emptyText:Object.assign({},n.Typography.body(r.default.backgroundPrimary),{opacity:.7,textAlign:"center",lineHeight:24}),emptyContainer:{alignItems:"center",justifyContent:"center",padding:40},signOutButton:{flexDirection:"row",alignItems:"center",justifyContent:"center",gap:12,backgroundColor:r.default.accentPrimary,borderRadius:12,padding:16,marginTop:16,borderWidth:1,borderColor:r.default.accentPrimary},signOutButtonDisabled:{opacity:.6},signOutText:Object.assign({},n.Typography.label(r.default.backgroundPrimary)),modalContainer:{flex:1,backgroundColor:r.default.backgroundPrimary},modalHeader:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:20,paddingBottom:20,backgroundColor:r.default.backgroundPrimary,borderBottomWidth:1,borderBottomColor:r.default.accentPrimary},modalTitle:Object.assign({},n.Typography.h2(r.default.textPrimary)),closeButton:{width:40,height:40,borderRadius:20,backgroundColor:r.default.accentPrimary,justifyContent:"center",alignItems:"center"},inputLabel:Object.assign({},n.Typography.label(r.default.backgroundPrimary),{marginBottom:8}),input:{backgroundColor:r.default.backgroundPrimary,borderRadius:12,padding:16,color:r.default.textPrimary,borderWidth:1,borderColor:r.default.accentPrimary},initialAvatar:{width:"100%",height:"100%",backgroundColor:r.default.accentPrimary,justifyContent:"center",alignItems:"center"},initialAvatarText:Object.assign({},n.Typography.h1(r.default.textPrimary)),modalContent:{paddingHorizontal:16,paddingTop:16,paddingBottom:80},photoSection:{alignItems:"center",marginBottom:20},photoContainer:{width:120,height:120,borderRadius:60,overflow:"hidden",justifyContent:"center",alignItems:"center",backgroundColor:r.default.accentPrimary,borderWidth:3,borderColor:r.default.backgroundPrimary},editPhoto:{width:"100%",height:"100%"},cameraOverlay:{position:"absolute",right:8,bottom:8,width:36,height:36,borderRadius:18,backgroundColor:r.default.backgroundPrimary+"22",justifyContent:"center",alignItems:"center"},photoHint:Object.assign({},n.Typography.caption(r.default.textMuted),{marginTop:8}),inputSection:{marginBottom:16},disabledInput:{backgroundColor:r.default.backgroundPrimary,borderRadius:12,padding:12,borderWidth:1,borderColor:r.default.accentPrimary},disabledInputText:Object.assign({},n.Typography.label(r.default.backgroundPrimary),{opacity:.8}),inputHint:Object.assign({},n.Typography.caption(r.default.textMuted),{marginTop:6}),modalFooter:{paddingHorizontal:16,paddingTop:12,borderTopWidth:1,borderTopColor:r.default.accentPrimary,backgroundColor:r.default.backgroundPrimary},saveButton:{backgroundColor:r.default.backgroundPrimary,paddingVertical:14,borderRadius:12,alignItems:"center",justifyContent:"center"},saveButtonDisabled:{opacity:.6},saveButtonText:Object.assign({},n.Typography.button(r.default.textPrimary))})},8415(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>M});var o=a(6665),r=a(3929),n=a(5648),i=a(1690),l=a(530),s=a(2772),d=a(6773),c=a(8264),u=a(5009),f=a(3041),g=a(5894),y=a(4866),h=a(3185),p=a(262),m=a(5938),b=a(3353),x=a(2598),j=a(9908),T=a(6746),w=a(3087),C=a(2994),k=a(9281),P=a(4522),I=a(1631),S=a(2081),v=a(1168),O=a(5082),B=a(6547),E=a(2964),_=a(9582),A=a(8833),L=a(8745),D=a(9637),R=a(9269),z=a(893),F=a(9600),N=a(397);const U=a(3229);function M(){const e=(0,b.useAuth)();if(!e)return(0,N.jsx)(r.default,{style:L.default.container,children:(0,N.jsx)(r.default,{style:L.default.loadingContainer,children:(0,N.jsx)(l.default,{size:"large",color:_.default.backgroundPrimary})})});const{user:t,signOut:a,session:M}=e,{userProfile:V,updateAccount:G,isLoading:W}=(0,x.useAccount)(),{dogProfile:H,isDogProfileLoading:$}=(0,j.useDogs)(),{trails:q,savedTrails:X,isLoading:J,saveTrailBookmark:K,removeTrailBookmark:Y,isTrailSaved:Z}=(0,T.useTrails)(),[Q,ee]=o.useState(!1),[te,ae]=o.useState(!1),[oe,re]=o.useState(""),[ne,ie]=o.useState(""),[le,se]=o.useState(!1),[de,ce]=o.useState("created"),[ue,fe]=o.useState({}),ge=(0,A.useSafeAreaInsets)(),ye=(0,D.useRouter)();o.useEffect(()=>{const e=V?.name||t?.email?.split("@")[0]||"",a=V?.image||U;re(e),ie(a)},[t,V]);const he=q.length,pe=q.reduce((e,t)=>e+(t.duration||0),0),me=q.reduce((e,t)=>e+t.distance,0),be=e=>{y.impactAsync(h.ImpactFeedbackStyle.Light),ce(e)},xe=e=>{if(!ue[e]){const t=new u.default.Value(1);return fe(a=>Object.assign({},a,{[e]:t})),t}return ue[e]},je=()=>{y.impactAsync(h.ImpactFeedbackStyle.Light),ye.push("/onboarding/dog-basics")},Te=()=>{y.impactAsync(h.ImpactFeedbackStyle.Light),ae(!1);const e=V?.name||t?.email?.split("@")[0]||"",a=V?.image||U;re(e),ie(a)},we="created"===de?q:"saved"===de?X:[];return(0,N.jsx)(r.default,{style:L.default.container,children:(0,N.jsxs)(s.default,{style:L.default.scrollContainer,contentContainerStyle:[L.default.content,{paddingTop:ge.top+16,paddingBottom:ge.bottom+20}],children:[(0,N.jsx)(r.default,{style:L.default.userSection,children:(0,N.jsxs)(r.default,{style:L.default.userHeader,children:[(0,N.jsx)(n.default,{style:L.default.userAvatar,onPress:()=>{y.impactAsync(h.ImpactFeedbackStyle.Light),ae(!0)},children:ne?(0,N.jsx)(g.Image,{source:ne,style:L.default.userAvatarImage,contentFit:"cover",cachePolicy:"memory-disk"}):(0,N.jsx)(r.default,{style:L.default.initialAvatar,children:(0,N.jsx)(f.Text,{style:L.default.initialAvatarText,children:(oe||V?.name||t?.email||"A").charAt(0).toUpperCase()})})}),(0,N.jsxs)(r.default,{style:L.default.userInfo,children:[(0,N.jsx)(f.Text,{style:L.default.userName,children:V?.name||oe||"Account Holder"}),(0,N.jsxs)(r.default,{style:L.default.userEmailRow,children:[(0,N.jsx)(S.default,{size:14,color:_.default.accentPrimary}),(0,N.jsx)(f.Text,{style:L.default.userEmail,children:t?.email||"Not available"})]})]}),(0,N.jsx)(n.default,{style:L.default.settingsButton,onPress:()=>ye.push("/settings"),accessibilityLabel:"Open settings",children:(0,N.jsx)(B.default,{size:20,color:_.default.accentSecondary})})]})}),$?(0,N.jsx)(r.default,{style:L.default.dogCardContainer,children:(0,N.jsx)(r.default,{style:L.default.loadingDogCard,children:(0,N.jsx)(l.default,{size:"large",color:_.default.accentPrimary})})}):H?(0,N.jsx)(r.default,{style:L.default.dogCardContainer,children:(0,N.jsxs)(n.default,{style:L.default.dogCard,onPress:je,children:[(0,N.jsx)(r.default,{style:L.default.dogPhotoContainer,children:H.image?(0,N.jsx)(g.Image,{source:H.image,style:L.default.dogPhoto,contentFit:"cover",cachePolicy:"memory-disk"}):(0,N.jsx)(r.default,{style:[L.default.dogPhoto,L.default.dogPhotoPlaceholder],children:(0,N.jsx)(P.default,{size:40,color:_.default.accentPrimary})})}),(0,N.jsx)(f.Text,{style:L.default.dogName,children:H.name}),H.nickname&&(0,N.jsx)(f.Text,{style:L.default.dogNickname,children:H.nickname}),!H.nickname&&(0,N.jsx)(r.default,{style:L.default.nicknameSpacing}),(0,N.jsxs)(r.default,{style:L.default.statsRow,children:[(0,N.jsxs)(r.default,{style:L.default.statItem,children:[(0,N.jsx)(f.Text,{style:L.default.statValue,children:he}),(0,N.jsx)(f.Text,{style:L.default.statLabel,children:"Walks"})]}),(0,N.jsxs)(r.default,{style:L.default.statItem,children:[(0,N.jsx)(f.Text,{style:L.default.statValue,children:(e=>{const t=Math.floor(e/3600),a=Math.floor(e%3600/60);return t>0?`${t}.${Math.floor(a/6)}h`:`${a}m`})(pe)}),(0,N.jsx)(f.Text,{style:L.default.statLabel,children:"Total Time"})]}),(0,N.jsxs)(r.default,{style:L.default.statItem,children:[(0,N.jsx)(f.Text,{style:L.default.statValue,children:(0,R.formatDistance)(me)}),(0,N.jsx)(f.Text,{style:L.default.statLabel,children:"Total Dist."})]})]})]})}):(0,N.jsx)(r.default,{style:L.default.dogCardContainer,children:(0,N.jsxs)(r.default,{style:L.default.noDogCard,children:[(0,N.jsx)(P.default,{size:48,color:_.default.textMuted}),(0,N.jsx)(f.Text,{style:L.default.noDogText,children:"No dog profile yet"}),(0,N.jsx)(n.default,{style:L.default.addDogButton,onPress:je,children:(0,N.jsx)(f.Text,{style:L.default.addDogButtonText,children:"Add Dog Profile"})})]})}),(0,N.jsxs)(r.default,{style:L.default.tabsContainer,children:[(0,N.jsxs)(n.default,{style:[L.default.tab,"created"===de&&L.default.tabActive],onPress:()=>be("created"),children:[(0,N.jsx)(f.Text,{style:[L.default.tabCount,"created"===de&&L.default.tabCountActive],children:q.length}),(0,N.jsx)(f.Text,{style:[L.default.tabText,"created"===de&&L.default.tabTextActive],children:"Created"})]}),(0,N.jsxs)(n.default,{style:[L.default.tab,"saved"===de&&L.default.tabActive],onPress:()=>be("saved"),children:[(0,N.jsx)(f.Text,{style:[L.default.tabCount,"saved"===de&&L.default.tabCountActive],children:X.length}),(0,N.jsx)(f.Text,{style:[L.default.tabText,"saved"===de&&L.default.tabTextActive],children:"Saved"})]}),(0,N.jsxs)(n.default,{style:[L.default.tab,"reviews"===de&&L.default.tabActive],onPress:()=>be("reviews"),children:[(0,N.jsx)(f.Text,{style:[L.default.tabCount,"reviews"===de&&L.default.tabCountActive],children:"0"}),(0,N.jsx)(f.Text,{style:[L.default.tabText,"reviews"===de&&L.default.tabTextActive],children:"Reviews"})]})]}),(0,N.jsx)(r.default,{style:L.default.trailsSection,children:J?(0,N.jsx)(r.default,{style:L.default.loadingContainer,children:(0,N.jsx)(l.default,{size:"large",color:_.default.backgroundPrimary})}):we.length>0?we.map(e=>{const t=xe(e.id),a=Z(e.id);return(0,N.jsxs)(n.default,{style:L.default.trailCard,onPress:()=>{return t=e.id,y.impactAsync(h.ImpactFeedbackStyle.Light),void ye.push(`/trail/${t}`);var t},children:[e.photo?(0,N.jsx)(g.Image,{source:{uri:e.photo},style:L.default.trailImage}):(0,N.jsx)(F.default,{coordinates:e.coordinates,path:e.path,style:L.default.trailImage,startLatitude:e.startLatitude,startLongitude:e.startLongitude}),(0,N.jsx)(z.LinearGradient,{colors:["rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0)","rgba(0, 0, 0, 0.25)","rgba(0, 0, 0, 0.6)"],locations:[0,.3,.6,1],style:L.default.trailGradient}),(0,N.jsx)(n.default,{style:L.default.bookmarkButton,onPress:t=>{t.stopPropagation(),(async e=>{y.impactAsync(h.ImpactFeedbackStyle.Medium);const t=xe(e),a=Z(e);u.default.sequence([u.default.timing(t,{toValue:.6,duration:100,useNativeDriver:!0}),u.default.spring(t,{toValue:1,friction:3,tension:100,useNativeDriver:!0})]).start();try{a?await Y(e):(await K(e),y.notificationAsync(h.NotificationFeedbackType.Success))}catch(o){console.error("Failed to toggle bookmark:",o)}})(e.id)},children:(0,N.jsx)(u.default.View,{style:{transform:[{scale:t}]},children:(0,N.jsx)(C.default,{size:20,color:a?"#000":_.default.textMuted,fill:a?"#000":"none",strokeWidth:2})})}),(0,N.jsxs)(r.default,{style:L.default.trailContent,children:[(0,N.jsx)(f.Text,{style:L.default.trailName,children:e.name||`Trail ${new Date(e.date).toLocaleDateString()}`}),(0,N.jsx)(f.Text,{style:L.default.trailLocation,children:e.city?`${e.city}, ${e.country||"Unknown"}`:"Location unknown"}),(0,N.jsxs)(r.default,{style:L.default.trailBadges,children:[e.difficulty&&(0,N.jsxs)(r.default,{style:L.default.trailBadge,children:[(0,N.jsx)(w.default,{size:14,color:_.default.accentPrimary,strokeWidth:2.5}),(0,N.jsx)(f.Text,{style:L.default.trailBadgeText,children:e.difficulty})]}),(0,N.jsxs)(r.default,{style:L.default.trailBadge,children:[(0,N.jsx)(v.default,{size:14,color:_.default.accentPrimary,strokeWidth:2.5}),(0,N.jsx)(f.Text,{style:L.default.trailBadgeText,children:(0,R.formatDistance)(e.distance)})]}),e.rating&&(0,N.jsxs)(r.default,{style:L.default.trailBadge,children:[(0,N.jsx)(O.default,{size:14,color:_.default.accentPrimary,fill:_.default.accentPrimary,strokeWidth:2}),(0,N.jsx)(f.Text,{style:L.default.trailBadgeText,children:e.rating.toFixed(1)})]})]})]})]},e.id)}):(0,N.jsxs)(r.default,{style:L.default.emptyContainer,children:[(0,N.jsx)(v.default,{size:48,color:_.default.textMuted}),(0,N.jsx)(f.Text,{style:L.default.emptyText,children:"created"===de?"No trails created yet":"saved"===de?"No trails saved yet":"No reviews yet"})]})}),(0,N.jsx)(n.default,{style:[L.default.signOutButton,Q&&L.default.signOutButtonDisabled],onPress:async()=>{y.impactAsync(h.ImpactFeedbackStyle.Medium),i.default.alert("Sign Out","Are you sure you want to sign out?",[{text:"Cancel",style:"cancel"},{text:"Sign Out",style:"destructive",onPress:async()=>{y.notificationAsync(h.NotificationFeedbackType.Success),ee(!0);try{await a()}catch(e){y.notificationAsync(h.NotificationFeedbackType.Error),i.default.alert("Error",e.message||"Failed to sign out")}finally{ee(!1)}}}])},disabled:Q,children:Q?(0,N.jsx)(l.default,{color:_.default.backgroundPrimary}):(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(I.default,{size:20,color:_.default.backgroundPrimary}),(0,N.jsx)(f.Text,{style:L.default.signOutText,children:"Sign Out"})]})}),(0,N.jsx)(c.default,{visible:te,animationType:"slide",presentationStyle:"pageSheet",onRequestClose:Te,children:(0,N.jsxs)(r.default,{style:L.default.modalContainer,children:[(0,N.jsxs)(r.default,{style:[L.default.modalHeader,{paddingTop:ge.top+20}],children:[(0,N.jsx)(f.Text,{style:L.default.modalTitle,children:"Edit Profile"}),(0,N.jsx)(n.default,{style:L.default.closeButton,onPress:Te,children:(0,N.jsx)(E.default,{size:24,color:_.default.backgroundPrimary})})]}),(0,N.jsxs)(s.default,{style:L.default.modalContent,children:[(0,N.jsxs)(r.default,{style:L.default.photoSection,children:[(0,N.jsxs)(n.default,{style:L.default.photoContainer,onPress:async()=>{y.impactAsync(h.ImpactFeedbackStyle.Light);const{status:e}=await p.requestMediaLibraryPermissionsAsync();if("granted"!==e)return void i.default.alert("Permission needed","Please allow access to your photo library");const t=await p.launchImageLibraryAsync({mediaTypes:["images"],allowsEditing:!0,aspect:[1,1],quality:.8});!t.canceled&&t.assets[0]&&ie(t.assets[0].uri)},children:[ne?(0,N.jsx)(g.Image,{source:ne,style:L.default.editPhoto,contentFit:"cover",cachePolicy:"memory-disk"}):(0,N.jsx)(r.default,{style:[L.default.editPhoto,L.default.initialAvatar],children:(0,N.jsx)(f.Text,{style:L.default.initialAvatarText,children:(oe||V?.name||t?.email||"A").charAt(0).toUpperCase()})}),(0,N.jsx)(r.default,{style:L.default.cameraOverlay,children:(0,N.jsx)(k.default,{size:24,color:_.default.accentPrimary})})]}),(0,N.jsx)(f.Text,{style:L.default.photoHint,children:"Tap to change photo"})]}),(0,N.jsxs)(r.default,{style:L.default.inputSection,children:[(0,N.jsx)(f.Text,{style:L.default.inputLabel,children:"Name"}),(0,N.jsx)(d.default,{style:L.default.input,value:oe,onChangeText:re,placeholder:"Enter your name",placeholderTextColor:_.default.textMuted})]}),(0,N.jsxs)(r.default,{style:L.default.inputSection,children:[(0,N.jsx)(f.Text,{style:L.default.inputLabel,children:"Email"}),(0,N.jsx)(r.default,{style:L.default.disabledInput,children:(0,N.jsx)(f.Text,{style:L.default.disabledInputText,children:t?.email})}),(0,N.jsx)(f.Text,{style:L.default.inputHint,children:"Email cannot be changed"})]})]}),(0,N.jsx)(r.default,{style:[L.default.modalFooter,{paddingBottom:ge.bottom+20}],children:(0,N.jsx)(n.default,{style:[L.default.saveButton,le&&L.default.saveButtonDisabled],onPress:async()=>{if(y.impactAsync(h.ImpactFeedbackStyle.Medium),oe.trim()){se(!0);try{let e;if("string"===typeof ne&&ne&&!ne.startsWith("http")){if(!M?.accessToken||!t?.id)throw new Error("No active session for upload");const a=new FormData,o=ne.split("/"),r=o[o.length-1]||`photo_${Date.now()}.jpg`,n=r.match(/\.([a-zA-Z0-9]+)(?:\?.*)?$/),i="png"===(n?n[1].toLowerCase():"jpg")?"image/png":"image/jpeg";a.append("file",{uri:ne,name:r,type:i}),a.append("filename",r),a.append("dog_id",""),a.append("trail_id",""),a.append("user_id",t.id);const l=await fetch(`${m.API_URL}/uploads`,{method:"POST",headers:{Authorization:`Bearer ${M.accessToken}`,accept:"application/json"},body:a});if(!l.ok){const e=await l.text();throw new Error(`Upload failed: ${l.status} ${e}`)}const s=await l.json();if(e=s.public_url||s.publicUrl||s.url,!e)throw new Error("Upload did not return a public URL")}else"string"===typeof ne&&ne.startsWith("http")&&(e=ne);await G({name:oe.trim(),image:e}),y.notificationAsync(h.NotificationFeedbackType.Success),ae(!1),i.default.alert("Success","Profile updated successfully!")}catch(e){console.error("Failed to save profile:",e),y.notificationAsync(h.NotificationFeedbackType.Error),i.default.alert("Error",e?.message||"Failed to update profile")}finally{se(!1)}}else i.default.alert("Error","Name cannot be empty")},disabled:le,children:le?(0,N.jsx)(l.default,{color:_.default.accentPrimary}):(0,N.jsx)(f.Text,{style:L.default.saveButtonText,children:"Save Changes"})})})]})})]})})}},1095(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>i});var o=a(3668),r=a(9582),n=a(2291);const i=o.default.create({container:{flex:1,backgroundColor:r.default.backgroundPrimary},map:Object.assign({},o.default.absoluteFillObject),webContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:r.default.backgroundPrimary,padding:20},webText:Object.assign({marginTop:16},n.Typography.body(r.default.textMuted),{textAlign:"center"}),loadingContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:r.default.backgroundPrimary},loadingText:Object.assign({marginTop:16},n.Typography.body(r.default.textMuted)),permissionContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:r.default.backgroundPrimary,padding:32},permissionTitle:Object.assign({marginTop:16},n.Typography.h2(r.default.textPrimary),{textAlign:"center"}),permissionText:Object.assign({marginTop:8},n.Typography.body(r.default.textMuted),{textAlign:"center"}),permissionButton:{marginTop:24,paddingHorizontal:32,paddingVertical:16,backgroundColor:r.default.backgroundPrimary,borderRadius:12},permissionButtonText:Object.assign({},n.Typography.label(r.default.textMuted)),statsContainer:{position:"absolute",left:20,right:20,flexDirection:"row",gap:12},compactRow:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginBottom:12},compactStats:{flexDirection:"row",gap:12,flex:1},compactStatBox:{backgroundColor:r.default.backgroundSecondary,borderRadius:12,paddingVertical:10,paddingHorizontal:14,alignItems:"center",minWidth:110},stopButtonCompact:{marginLeft:12,backgroundColor:"#111",paddingVertical:10,paddingHorizontal:16,borderRadius:12,flexDirection:"row",alignItems:"center",gap:8},stopButtonCompactText:{color:"#fff",fontWeight:"700",marginLeft:6},statBox:{flex:1,backgroundColor:"rgba(255, 255, 255, 0.95)",borderRadius:16,padding:16,shadowColor:r.default.borderSubtle,shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:8,elevation:4},statLabel:Object.assign({},n.Typography.caption(r.default.textMuted),{marginBottom:4}),statValue:Object.assign({},n.Typography.h1(r.default.textPrimary)),controlContainer:{position:"absolute",left:20,right:20,alignItems:"center"},recordButton:{flexDirection:"row",alignItems:"center",gap:12,paddingHorizontal:32,paddingVertical:20,backgroundColor:r.default.accentSecondary,borderRadius:50,shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:12,elevation:8},recordButtonActive:{backgroundColor:r.default.accentSecondary},recordButtonText:Object.assign({},n.Typography.button(r.default.backgroundPrimary)),bottomSheet:{position:"absolute",left:0,right:0,backgroundColor:r.default.backgroundPrimary,borderTopLeftRadius:24,borderTopRightRadius:24,shadowColor:"#000",shadowOffset:{width:0,height:-4},shadowOpacity:.15,shadowRadius:16,elevation:20},handleBar:{paddingTop:12,paddingBottom:8,alignItems:"center"},handleContainer:{alignItems:"center",gap:4},handle:{width:40,height:4,backgroundColor:r.default.borderSubtle,borderRadius:2},bottomSheetContent:{flex:1,paddingHorizontal:20,paddingBottom:92},statsGrid:{flexDirection:"row",flexWrap:"wrap",gap:12,marginBottom:20},statItem:{width:"31%",backgroundColor:r.default.backgroundSecondary,borderRadius:12,padding:12,alignItems:"center"},statItemLabel:Object.assign({},n.Typography.caption(r.default.textMuted),{textTransform:"uppercase",letterSpacing:.5,marginBottom:6}),statItemValue:Object.assign({},n.Typography.h2(r.default.textPrimary)),expandedContent:{marginTop:8},divider:{height:1,backgroundColor:r.default.borderSubtle,marginVertical:16},optionRow:{flexDirection:"row",alignItems:"center",paddingVertical:16,paddingHorizontal:16,backgroundColor:r.default.backgroundSecondary,borderRadius:12,marginBottom:12},optionIconContainer:{width:48,height:48,borderRadius:24,backgroundColor:"rgba(93, 107, 74, 0.1)",alignItems:"center",justifyContent:"center",marginRight:12},optionTextContainer:{flex:1},optionTitle:Object.assign({},n.Typography.body(r.default.textPrimary),{marginBottom:2}),optionSubtitle:Object.assign({},n.Typography.caption(r.default.textMuted)),optionBadge:{paddingHorizontal:12,paddingVertical:6,borderRadius:12,backgroundColor:r.default.borderSubtle},optionBadgeActive:{backgroundColor:"rgba(93, 107, 74, 0.15)"},optionBadgeText:Object.assign({},n.Typography.caption(r.default.textMuted)),optionBadgeTextActive:{color:r.default.backgroundPrimary},modalOverlay:{flex:1,backgroundColor:"rgba(0,0,0,0.4)",justifyContent:"center",alignItems:"center",padding:20},modalContainer:{width:"100%",maxHeight:"90%",backgroundColor:"#fff",borderRadius:12,overflow:"hidden"},modalContent:{padding:20},modalTitle:Object.assign({},n.Typography.h2(r.default.backgroundPrimary),{marginBottom:12}),input:{borderWidth:1,borderColor:"#e5e7eb",backgroundColor:"#f9fafb",paddingHorizontal:12,paddingVertical:10,borderRadius:8,marginTop:8,color:r.default.backgroundPrimary},modalButton:{flex:1,paddingVertical:12,paddingHorizontal:16,borderRadius:10,backgroundColor:"#e5e7eb",alignItems:"center",justifyContent:"center"},modalButtonPrimary:{backgroundColor:"#5d6b4a",marginLeft:8},modalButtonText:Object.assign({},n.Typography.label("#1f2937")),recenterButton:{position:"absolute",top:60,left:20,width:48,height:48,borderRadius:24,backgroundColor:r.default.backgroundSecondary,alignItems:"center",justifyContent:"center",shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.15,shadowRadius:8,elevation:4}})},5209(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>N});var o=a(6665),r=a(3929),n=a(5648),i=a(1690),l=a(530),s=a(5009),d=a(444),c=a(6725),u=a(6773),f=a(8264),g=a(2772),y=a(3041),h=a(7430),p=a(5894),m=a(262),b=a(675),x=a(5163),j=a(2981),T=a(4866),w=a(3185),C=a(9637),k=a(5259),P=a(5624),I=a(2301),S=a(1168),v=a(8032),O=a(8280),B=a(7353),E=a(4043),_=a(1095),A=a(9582),L=a(6746),D=a(3353),R=a(9269),z=a(397);const F="background-location-task";function N(){const{saveTrail:e,getTrailById:t}=(0,L.useTrails)(),{user:a}=(0,D.useAuth)(),N=(0,C.useLocalSearchParams)(),U=(0,C.useRouter)(),M="string"===typeof N.trailId?N.trailId:void 0,V=M?t(M):void 0,G=(0,o.useRef)(null),[W,H]=(0,o.useState)(!1),[$,q]=(0,o.useState)([]),[X,J]=(0,o.useState)(null),[K,Y]=(0,o.useState)(0),[Z,Q]=(0,o.useState)(null),[ee,te]=(0,o.useState)(!0),[ae,oe]=(0,o.useState)(null),re=(0,o.useRef)(null),ne=(0,o.useRef)(null),ie=.5*c.default.get("window").height,le=(0,o.useRef)(new s.default.Value(40)).current,[se,de]=(0,o.useState)(!1),[ce,ue]=(0,o.useState)(0),[fe,ge]=(0,o.useState)(0),[ye,he]=(0,o.useState)("0:00"),[pe,me]=(0,o.useState)(0),[be,xe]=(0,o.useState)(0),[je,Te]=(0,o.useState)(!1),[we,Ce]=(0,o.useState)(null),[ke,Pe]=(0,o.useState)(""),[Ie,Se]=(0,o.useState)(""),[ve,Oe]=(0,o.useState)(void 0),[Be,Ee]=(0,o.useState)([]),[_e,Ae]=(0,o.useState)(void 0),[Le,De]=(0,o.useState)(!!V),[Re,ze]=(0,o.useState)(null),Fe=(0,o.useRef)(null);(0,o.useEffect)(()=>{{Ue(),Ne();const e=setInterval(()=>{Ne()},1e3);return()=>{clearInterval(e),re.current&&re.current.remove(),ne.current&&clearInterval(ne.current)}}},[]),(0,o.useEffect)(()=>{V&&De(!0)},[V]),(0,o.useEffect)(()=>{let e=!0;return Le?(async()=>{if(!Z){const{status:e}=await b.requestForegroundPermissionsAsync();if("granted"!==e)return void i.default.alert("Permission required","Location permission is required to follow the trail");Q(!0)}try{const t=await b.watchPositionAsync({accuracy:x.LocationAccuracy.Balanced,distanceInterval:2,timeInterval:1e3},t=>{if(!e)return;const a={latitude:t.coords.latitude,longitude:t.coords.longitude};ze(a),J(a)});Fe.current=t}catch(t){console.error("Follow watchPosition error",t)}})():(Fe.current&&(Fe.current.remove(),Fe.current=null),ze(null)),()=>{e=!1,Fe.current&&(Fe.current.remove(),Fe.current=null)}},[Le,Z]);const Ne=async()=>{try{const e=await k.default.getItem("recording_coordinates");if(e){const t=JSON.parse(e);q(t)}const t=await k.default.getItem("recording_max_elevation");t&&ge(parseFloat(t));const a=await k.default.getItem("recording_max_speed");if(a&&xe(parseFloat(a)),W){const e=await k.default.getItem("recording_start_time");if(e){const t=parseInt(e),a=Math.floor((Date.now()-t)/1e3);Y(a)}}}catch(e){console.error("Error loading recording state:",e)}},Ue=async()=>{try{console.log("Requesting location permissions...");const{status:a}=await b.requestForegroundPermissionsAsync();if(console.log("Foreground permission status:",a),"granted"===a){try{const{status:e}=await b.requestBackgroundPermissionsAsync();console.log("Background permission status:",e),"granted"!==e&&i.default.alert("Background Location Required",'To continue recording your trail when the screen is locked, please enable "Allow all the time" in location settings.',[{text:"OK"}])}catch(e){console.warn("Background permission error (non-critical):",e.message)}Q(!0);try{const e=await b.getCurrentPositionAsync({accuracy:x.LocationAccuracy.Balanced}),t={latitude:e.coords.latitude,longitude:e.coords.longitude};J(t),console.log("Initial location:",t)}catch(t){console.warn("Error getting initial location:",t.message)}}else Q(!1),i.default.alert("Permission Required","Location permission is required to track your walks.",[{text:"OK"}])}catch(a){console.error("Permission error:",a);const e=a.message||"Failed to get location permission";e.includes("NSLocation")||e.includes("Info.plist")?i.default.alert("Configuration Error","This app needs to be built with a custom development build to use location tracking. Expo Go doesn't support background location tracking.\n\nPlease contact support or build a custom development client.",[{text:"OK"}]):i.default.alert("Error",e),Q(!1)}finally{te(!1)}};(0,o.useEffect)(()=>{if(K>0){const e=(0,R.calculateTotalDistance)($)/1e3;if(e>0){const t=K/60/e,a=Math.floor(t),o=Math.round(60*(t-a));he(`${a}:${o.toString().padStart(2,"0")}`)}}},[K,$]);const Me=(0,o.useRef)(0),Ve=(0,o.useRef)(d.default.create({onStartShouldSetPanResponder:()=>!0,onMoveShouldSetPanResponder:(e,t)=>Math.abs(t.dy)>5,onPanResponderGrant:()=>{Me.current=le._value},onPanResponderMove:(e,t)=>{const a=Me.current-t.dy;a>=40&&a<=ie&&le.setValue(a)},onPanResponderRelease:(e,t)=>{T.impactAsync(w.ImpactFeedbackStyle.Light);const a=(ie+40)/2,o=le._value;t.dy<-50?Ge():t.dy>50?We():o>a?Ge():We()}})).current,Ge=()=>{de(!0),s.default.spring(le,{toValue:ie,useNativeDriver:!1,tension:50,friction:8}).start()},We=()=>{de(!1),s.default.spring(le,{toValue:40,useNativeDriver:!1,tension:50,friction:8}).start()},He=async()=>{T.impactAsync(w.ImpactFeedbackStyle.Heavy),console.log("Stopping recording...");try{await j.isTaskRegisteredAsync(F)&&await b.stopLocationUpdatesAsync(F)}catch(g){console.error("Error stopping background location:",g)}re.current&&(re.current.remove(),re.current=null),ne.current&&(clearInterval(ne.current),ne.current=null);const e=await k.default.getItem("recording_coordinates"),t=e?JSON.parse(e):$,a=await k.default.getItem("recording_max_elevation"),o=a?parseFloat(a):fe,r=await k.default.getItem("recording_max_speed"),n=r?parseFloat(r):be,l=await k.default.getItem("recording_start_time"),s=l?Math.floor((Date.now()-parseInt(l))/1e3):K;if(t.length<2)return i.default.alert("No Trail Data","Not enough data to save this trail. Try walking a bit more!"),H(!1),q([]),Y(0),await k.default.removeItem("recording_coordinates"),await k.default.removeItem("recording_max_elevation"),await k.default.removeItem("recording_max_speed"),await k.default.removeItem("recording_start_time"),void await k.default.removeItem("recording_last_update");const d=(0,R.calculateTotalDistance)(t),c=d/1e3;let u="0:00";if(c>0){const e=s/60/c,t=Math.floor(e);u=`${t}:${Math.round(60*(e-t)).toString().padStart(2,"0")}`}const f={id:Date.now().toString(),date:Date.now(),distance:d,duration:s,coordinates:t,city:ae?.city,country:ae?.country,pace:u,speed:n,maxElevation:o};Ce(f),Pe(f.name||""),Se(f.description||""),Oe(f.photo||void 0),Ee(f.tags||[]),Ae(f.difficulty||void 0),Te(!0)},$e=()=>{Te(!1),Ce(null)};if(ee)return(0,z.jsxs)(r.default,{style:_.default.loadingContainer,children:[(0,z.jsx)(l.default,{size:"large",color:A.default.backgroundPrimary}),(0,z.jsx)(y.Text,{style:_.default.loadingText,children:"Checking permissions..."})]});if(!Z)return(0,z.jsxs)(r.default,{style:_.default.permissionContainer,children:[(0,z.jsx)(S.default,{size:64,color:"#666"}),(0,z.jsx)(y.Text,{style:_.default.permissionTitle,children:"Location Permission Required"}),(0,z.jsx)(y.Text,{style:_.default.permissionText,children:"This app needs access to your location to track your dog walks."}),(0,z.jsx)(n.default,{style:_.default.permissionButton,onPress:()=>{T.impactAsync(w.ImpactFeedbackStyle.Medium),Ue()},children:(0,z.jsx)(y.Text,{style:_.default.permissionButtonText,children:"Grant Permission"})})]});const qe=(0,R.calculateTotalDistance)($),Xe=V&&W&&$.length>0&&V.coordinates.length>0?Math.min(qe/V.distance*100,100):0,Je=!!V,Ke=se?92:12;return(0,z.jsxs)(r.default,{style:_.default.container,children:[X&&(0,z.jsx)(h.default,{ref:G,coordinates:V&&!W?V.coordinates:$,style:_.default.map,initialRegion:{latitude:X.latitude,longitude:X.longitude,latitudeDelta:.01,longitudeDelta:.01},userLocation:Re??X,showsUserLocation:!0,followsUserLocation:Le||W,showsMyLocationButton:!1}),(0,z.jsx)(n.default,{style:_.default.recenterButton,onPress:async()=>{if(T.impactAsync(w.ImpactFeedbackStyle.Light),G.current)try{const e=await b.getCurrentPositionAsync({accuracy:x.LocationAccuracy.Balanced}),t={latitude:e.coords.latitude,longitude:e.coords.longitude};J(t),G.current.animateToRegion({latitude:t.latitude,longitude:t.longitude,latitudeDelta:.01,longitudeDelta:.01},500)}catch(e){console.error("Error getting current location:",e),X&&G.current.animateToRegion({latitude:X.latitude,longitude:X.longitude,latitudeDelta:.01,longitudeDelta:.01},500)}},activeOpacity:.8,children:(0,z.jsx)(v.default,{size:24,color:A.default.accentPrimary})}),(0,z.jsxs)(s.default.View,{style:[_.default.bottomSheet,{height:s.default.add(le,92),bottom:0}],children:[(0,z.jsx)(r.default,Object.assign({},Ve.panHandlers,{style:_.default.handleBar,children:(0,z.jsxs)(n.default,{style:_.default.handleContainer,onPress:()=>{T.impactAsync(w.ImpactFeedbackStyle.Light),se?We():Ge()},activeOpacity:.7,children:[(0,z.jsx)(r.default,{style:_.default.handle}),se?(0,z.jsx)(P.default,{size:20,color:"#9ca3af"}):(0,z.jsx)(I.default,{size:20,color:"#9ca3af"})]})})),(0,z.jsxs)(r.default,{style:[_.default.bottomSheetContent,{paddingBottom:Ke}],children:[W?se?(0,z.jsxs)(r.default,{style:_.default.statsGrid,children:[(0,z.jsxs)(r.default,{style:_.default.statItem,children:[(0,z.jsx)(y.Text,{style:_.default.statItemLabel,children:"Time"}),(0,z.jsx)(y.Text,{style:_.default.statItemValue,children:(0,R.formatDuration)(K)})]}),(0,z.jsxs)(r.default,{style:_.default.statItem,children:[(0,z.jsx)(y.Text,{style:_.default.statItemLabel,children:"Distance"}),(0,z.jsx)(y.Text,{style:_.default.statItemValue,children:(0,R.formatDistance)(qe)})]}),(0,z.jsxs)(r.default,{style:_.default.statItem,children:[(0,z.jsx)(y.Text,{style:_.default.statItemLabel,children:"Elevation"}),(0,z.jsxs)(y.Text,{style:_.default.statItemValue,children:[ce.toFixed(0),"m"]})]}),(0,z.jsxs)(r.default,{style:_.default.statItem,children:[(0,z.jsx)(y.Text,{style:_.default.statItemLabel,children:"Pace"}),(0,z.jsxs)(y.Text,{style:_.default.statItemValue,children:[ye,"/km"]})]}),(0,z.jsxs)(r.default,{style:_.default.statItem,children:[(0,z.jsx)(y.Text,{style:_.default.statItemLabel,children:"Speed"}),(0,z.jsxs)(y.Text,{style:_.default.statItemValue,children:[pe.toFixed(1)," km/h"]})]}),Je&&(0,z.jsxs)(r.default,{style:_.default.statItem,children:[(0,z.jsx)(y.Text,{style:_.default.statItemLabel,children:"Progress"}),(0,z.jsxs)(y.Text,{style:_.default.statItemValue,children:[Xe.toFixed(0),"%"]})]})]}):(0,z.jsxs)(r.default,{style:_.default.compactRow,children:[(0,z.jsxs)(r.default,{style:_.default.compactStats,children:[(0,z.jsxs)(r.default,{style:_.default.compactStatBox,children:[(0,z.jsx)(y.Text,{style:_.default.statItemLabel,children:"Time"}),(0,z.jsx)(y.Text,{style:_.default.statItemValue,children:(0,R.formatDuration)(K)})]}),(0,z.jsxs)(r.default,{style:_.default.compactStatBox,children:[(0,z.jsx)(y.Text,{style:_.default.statItemLabel,children:"Distance"}),(0,z.jsx)(y.Text,{style:_.default.statItemValue,children:(0,R.formatDistance)(qe)})]})]}),(0,z.jsxs)(n.default,{style:_.default.stopButtonCompact,onPress:He,activeOpacity:.8,children:[(0,z.jsx)(B.default,{size:18,color:"#fff",fill:"#fff"}),(0,z.jsx)(y.Text,{style:_.default.stopButtonCompactText,children:"Stop"})]})]}):null,W?se?(0,z.jsx)(r.default,{style:_.default.controlContainer,children:(0,z.jsxs)(n.default,{style:_.default.recordButton,onPress:He,activeOpacity:.8,children:[(0,z.jsx)(B.default,{size:20,color:A.default.backgroundPrimary,fill:A.default.backgroundPrimary}),(0,z.jsx)(y.Text,{style:_.default.recordButtonText,children:"Stop & Save"})]})}):null:(0,z.jsx)(r.default,{style:_.default.controlContainer,children:V?(0,z.jsx)(n.default,{style:_.default.recordButton,onPress:()=>{Fe.current&&(Fe.current.remove(),Fe.current=null),De(!1),U.back()},activeOpacity:.8,children:(0,z.jsx)(y.Text,{style:_.default.recordButtonText,children:"Close"})}):(0,z.jsxs)(n.default,{style:_.default.recordButton,onPress:async()=>{T.impactAsync(w.ImpactFeedbackStyle.Heavy),console.log("Starting recording..."),H(!0),q([]),Y(0),ge(0),xe(0);try{const t=Date.now();await k.default.setItem("recording_start_time",t.toString()),await k.default.removeItem("recording_coordinates"),await k.default.removeItem("recording_max_elevation"),await k.default.removeItem("recording_max_speed"),await k.default.removeItem("recording_last_update");const a=await b.getCurrentPositionAsync({accuracy:x.LocationAccuracy.Balanced});oe(null);const o={latitude:a.coords.latitude,longitude:a.coords.longitude};await k.default.setItem("recording_coordinates",JSON.stringify([o])),q([o]),J(o);try{await b.startLocationUpdatesAsync(F,{accuracy:x.LocationAccuracy.BestForNavigation,distanceInterval:3,timeInterval:1e3,foregroundService:{notificationTitle:"Recording Trail",notificationBody:"TailTrails is tracking your walk",notificationColor:"#2563eb"},pausesUpdatesAutomatically:!1,showsBackgroundLocationIndicator:!0}),console.log("Background location tracking started successfully")}catch(e){console.warn("Background location not available:",e.message),(e.message?.includes("Background location")||e.message?.includes("UIBackgroundModes"))&&i.default.alert("Background Tracking Unavailable","Background location tracking requires a custom development build. The app will continue recording in foreground mode only. Please keep the app open while recording.",[{text:"OK"}])}re.current=await b.watchPositionAsync({accuracy:x.LocationAccuracy.BestForNavigation,distanceInterval:3,timeInterval:1e3},async e=>{const t={latitude:e.coords.latitude,longitude:e.coords.longitude};if(console.log("Foreground position update:",t,"Accuracy:",e.coords.accuracy),J(t),q(e=>{const a=[...e,t];return console.log("Total coordinates:",a.length,"Distance:",(0,R.calculateTotalDistance)(a),"m"),k.default.setItem("recording_coordinates",JSON.stringify(a)).catch(e=>{console.error("Error saving coordinates:",e)}),a}),e.coords.altitude){const t=Math.max(0,e.coords.altitude);ue(t),t>fe&&(ge(t),await k.default.setItem("recording_max_elevation",t.toString()))}if(e.coords.speed&&e.coords.speed>0){const t=3.6*e.coords.speed;me(t),t>be&&(xe(t),await k.default.setItem("recording_max_speed",t.toString()))}}),ne.current=setInterval(async()=>{try{const e=await k.default.getItem("recording_start_time");if(e){const t=parseInt(e),a=Math.floor((Date.now()-t)/1e3);Y(a)}}catch(e){console.error("Error calculating duration:",e)}},1e3)}catch(t){console.error("Recording error:",t);let e="Failed to start recording. Please try again.";t.message?.includes("rate limit")?e="Please wait a moment before starting a new recording. Location service is temporarily limited.":(t.message?.includes("Background location")||t.message?.includes("UIBackgroundModes"))&&(e="Background location tracking requires a custom development build. Please build the app with EAS or use foreground-only mode."),i.default.alert("Error",e),H(!1)}},activeOpacity:.8,children:[(0,z.jsx)(O.default,{size:24,color:A.default.backgroundPrimary,fill:A.default.backgroundPrimary}),(0,z.jsx)(y.Text,{style:_.default.recordButtonText,children:"Start Trail"})]})})]})]}),(0,z.jsx)(f.default,{visible:je,animationType:"slide",transparent:!0,onRequestClose:$e,children:(0,z.jsx)(r.default,{style:_.default.modalOverlay,children:(0,z.jsx)(r.default,{style:_.default.modalContainer,children:(0,z.jsxs)(g.default,{contentContainerStyle:_.default.modalContent,children:[(0,z.jsx)(y.Text,{style:_.default.modalTitle,children:"Save Trail"}),(0,z.jsx)(u.default,{placeholder:"Trail name",value:ke,onChangeText:Pe,style:_.default.input,placeholderTextColor:A.default.backgroundPrimary}),(0,z.jsx)(u.default,{placeholder:"Description",value:Ie,onChangeText:Se,style:[_.default.input,{height:100}],placeholderTextColor:A.default.backgroundPrimary,multiline:!0}),(0,z.jsx)(n.default,{onPress:async()=>{T.impactAsync(w.ImpactFeedbackStyle.Light);const{status:e}=await m.requestMediaLibraryPermissionsAsync();if("granted"!==e)return void i.default.alert("Permission needed","Please allow access to your photo library");const t=await m.launchImageLibraryAsync({mediaTypes:["images"],allowsEditing:!0,aspect:[16,9],quality:.8});!t.canceled&&t.assets[0]&&Oe(t.assets[0].uri)},style:[_.default.input,{padding:12,justifyContent:"center",alignItems:"center",flexDirection:"row"}],children:ve?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(p.Image,{source:{uri:ve},style:{width:80,height:60,borderRadius:8,marginRight:12}}),(0,z.jsx)(y.Text,{style:{flex:1},children:ke||"Selected image"}),(0,z.jsx)(E.default,{size:18,color:A.default.backgroundPrimary})]}):(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)(E.default,{size:18,color:A.default.backgroundPrimary}),(0,z.jsx)(y.Text,{style:{marginLeft:8,color:A.default.backgroundPrimary},children:"Add Photo (optional)"})]})}),(0,z.jsxs)(r.default,{style:{flexDirection:"row",gap:8,marginTop:8},children:[(0,z.jsx)(n.default,{style:_.default.modalButton,onPress:$e,children:(0,z.jsx)(y.Text,{style:_.default.modalButtonText,children:"Cancel"})}),(0,z.jsx)(n.default,{style:[_.default.modalButton,_.default.modalButtonPrimary],onPress:async()=>{if(!we)return;const t=Object.assign({},we,{name:ke||we.name||"Untitled Trail",description:Ie,photo:ve,tags:Be,difficulty:_e});try{await e(t);T.notificationAsync(w.NotificationFeedbackType.Success),Te(!1),Ce(null),H(!1),q([]),Y(0),oe(null),ue(0),ge(0),he("0:00"),me(0),xe(0),await k.default.removeItem("recording_coordinates"),await k.default.removeItem("recording_max_elevation"),await k.default.removeItem("recording_max_speed"),await k.default.removeItem("recording_start_time"),await k.default.removeItem("recording_last_update"),U.push("/(tabs)/profile")}catch(a){console.error("Save failed",a),i.default.alert("Error","Failed to save trail")}},children:(0,z.jsx)(y.Text,{style:[_.default.modalButtonText,{color:"#fff"}],children:"Save Trail"})})]})]})})})})]})}j.defineTask(F,async({data:e,error:t})=>{if(t)console.error("Background location error:",t);else if(e){const{locations:t}=e,o=t[0];if(o){console.log("Background location update:",o.coords);try{const e=await k.default.getItem("recording_coordinates"),t=e?JSON.parse(e):[],a={latitude:o.coords.latitude,longitude:o.coords.longitude};if(t.push(a),await k.default.setItem("recording_coordinates",JSON.stringify(t)),o.coords.altitude){const e=Math.max(0,o.coords.altitude),t=await k.default.getItem("recording_max_elevation");e>(t?parseFloat(t):0)&&await k.default.setItem("recording_max_elevation",e.toString())}if(o.coords.speed&&o.coords.speed>0){const e=3.6*o.coords.speed,t=await k.default.getItem("recording_max_speed");e>(t?parseFloat(t):0)&&await k.default.setItem("recording_max_speed",e.toString())}await k.default.setItem("recording_last_update",Date.now().toString())}catch(a){console.error("Error storing location:",a)}}}})},4171(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>i});var o=a(3668),r=a(9582),n=a(2291);const i=o.default.create({container:{flex:1,backgroundColor:r.default.backgroundPrimary},header:{height:64,paddingHorizontal:16,flexDirection:"row",alignItems:"center",justifyContent:"space-between",borderBottomWidth:0},backButton:{width:40,height:40,borderRadius:20,justifyContent:"center",alignItems:"center"},title:Object.assign({},n.Typography.h2(r.default.accentPrimary)),content:{padding:16,gap:16},sectionCard:{backgroundColor:r.default.backgroundSecondary,borderRadius:16,padding:18,shadowColor:r.default.borderSubtle,shadowOffset:{width:0,height:6},shadowOpacity:.06,shadowRadius:12,elevation:3},sectionTitle:Object.assign({},n.Typography.h2(r.default.accentPrimary),{marginBottom:12}),row:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingVertical:12,borderBottomWidth:1,borderBottomColor:"rgba(255,255,255,0.02)"},rowText:Object.assign({},n.Typography.label(r.default.accentPrimary),{flex:1}),logoutCard:{backgroundColor:r.default.backgroundSecondary,borderRadius:12,padding:16,marginTop:8,flexDirection:"row",alignItems:"center",justifyContent:"space-between"},logoutText:Object.assign({},n.Typography.label(r.default.accentPrimary))})},282(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>x});var o=a(6665),r=a(3929),n=a(2772),i=a(5648),l=a(1690),s=a(3668),d=a(3041),c=a(8833),u=a(5395),f=a(480),g=a(9637),y=a(4171),h=a(9582),p=a(3353),m=a(9857),b=a(397);function x(){const e=(0,c.useSafeAreaInsets)(),t=(0,g.useRouter)(),a=(0,p.useAuth)(),[s,x]=(0,o.useState)(!1),T=(e,a)=>{a?t.push(a):l.default.alert(e)};return(0,b.jsxs)(r.default,{style:[y.default.container,{paddingTop:e.top}],children:[(0,b.jsxs)(r.default,{style:y.default.header,children:[(0,b.jsx)(i.default,{style:y.default.backButton,onPress:()=>t.push("/profile"),children:(0,b.jsx)(u.default,{size:20,color:h.default.accentPrimary})}),(0,b.jsx)(d.Text,{style:y.default.title,children:"Settings"}),(0,b.jsx)(r.default,{style:{width:40}})]}),(0,b.jsxs)(n.default,{contentContainerStyle:y.default.content,children:[(0,b.jsxs)(r.default,{style:y.default.sectionCard,children:[(0,b.jsx)(d.Text,{style:y.default.sectionTitle,children:"Your Account"}),(0,b.jsxs)(i.default,{style:y.default.row,onPress:()=>T("Account Information","/settings/account"),children:[(0,b.jsx)(d.Text,{style:y.default.rowText,children:"Account Information"}),(0,b.jsx)(f.default,{size:18,color:h.default.accentPrimary})]}),(0,b.jsxs)(i.default,{style:y.default.row,onPress:()=>T("Privacy and Safety","/settings/privacy"),children:[(0,b.jsx)(d.Text,{style:y.default.rowText,children:"Privacy and Safety"}),(0,b.jsx)(f.default,{size:18,color:h.default.accentPrimary})]}),(0,b.jsxs)(i.default,{style:y.default.row,onPress:()=>T("Change your password","/settings/password"),children:[(0,b.jsx)(d.Text,{style:y.default.rowText,children:"Change your password"}),(0,b.jsx)(f.default,{size:18,color:h.default.accentPrimary})]})]}),(0,b.jsxs)(r.default,{style:y.default.sectionCard,children:[(0,b.jsx)(d.Text,{style:y.default.sectionTitle,children:"Dog Profile"}),(0,b.jsxs)(i.default,{style:y.default.row,onPress:()=>T("Dog Information","/settings/dog-info"),children:[(0,b.jsx)(d.Text,{style:y.default.rowText,children:"Dog Information"}),(0,b.jsx)(f.default,{size:18,color:h.default.accentPrimary})]}),(0,b.jsxs)(i.default,{style:y.default.row,onPress:()=>T("Edit Tags","/settings/dog-tags"),children:[(0,b.jsx)(d.Text,{style:y.default.rowText,children:"Edit Tags"}),(0,b.jsx)(f.default,{size:18,color:h.default.accentPrimary})]})]}),(0,b.jsxs)(r.default,{style:y.default.sectionCard,children:[(0,b.jsx)(d.Text,{style:y.default.sectionTitle,children:"Debug"}),(0,b.jsxs)(i.default,{style:y.default.row,onPress:()=>x(!0),children:[(0,b.jsx)(d.Text,{style:y.default.rowText,children:"Show Lottie Loader"}),(0,b.jsx)(f.default,{size:18,color:h.default.accentPrimary})]})]}),(0,b.jsxs)(i.default,{style:y.default.logoutCard,onPress:async()=>{try{a?.signOut&&await a.signOut()}catch(e){console.error("Logout failed",e),l.default.alert("Error","Failed to logout")}},children:[(0,b.jsx)(d.Text,{style:y.default.logoutText,children:"Logout"}),(0,b.jsx)(f.default,{size:18,color:h.default.accentPrimary})]})]}),s&&(0,b.jsx)(r.default,{style:j.overlay,children:(0,b.jsxs)(r.default,{style:j.container,children:[(0,b.jsx)(m.default,{size:220}),(0,b.jsx)(i.default,{style:j.close,onPress:()=>x(!1),children:(0,b.jsx)(d.Text,{style:j.closeText,children:"Close"})})]})})]})}const j=s.default.create({overlay:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",justifyContent:"center",alignItems:"center",zIndex:999},container:{backgroundColor:"white",borderRadius:12,padding:16,alignItems:"center"},close:{marginTop:12,paddingHorizontal:14,paddingVertical:8,borderRadius:8,backgroundColor:"#e5e7eb"},closeText:{color:"#111827",fontWeight:"600"}})},8973(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>d});var o=a(9637),r=(a(6665),a(3929)),n=a(3668),i=a(3041),l=a(2291),s=a(397);function d(){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Stack.Screen,{options:{title:"Oops!"}}),(0,s.jsxs)(r.default,{style:c.container,children:[(0,s.jsx)(i.Text,{style:c.title,children:"This screen doesn't exist."}),(0,s.jsx)(o.Link,{href:"/",asChild:!0,style:c.link,children:(0,s.jsx)(i.Text,{style:c.linkText,children:"Go to home screen!"})})]})]})}const c=n.default.create({container:{flex:1,alignItems:"center",justifyContent:"center",padding:20},title:Object.assign({},l.Typography.h2("#000")),link:{marginTop:15,paddingVertical:15},linkText:Object.assign({},l.Typography.label("#2e78b7"))})},5111(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>b});var o=a(5227),r=a(4108),n=a(9637),i=a(284),l=a(6665),s=a(3668),d=a(6691),c=a(3353),u=a(2598),f=a(6746),g=a(9908),y=a(9857),h=a(397);i.preventAutoHideAsync().catch(()=>{});const p=new o.QueryClient;function m(){const{isAuthenticated:e,isLoading:t}=(0,c.useAuth)(),{hasDogProfile:a,isDogProfileLoading:o}=(0,g.useDogs)(),r=(0,n.useSegments)(),s=(0,n.useRouter)(),[d,u]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{if(!t&&!o){const e=setTimeout(async()=>{await i.hideAsync().catch(()=>{}),u(!0)},50);return()=>clearTimeout(e)}},[t,o]),(0,l.useEffect)(()=>{if(t||o||!d)return;const n="(tabs)"===r[0],i="login"===r[0]||"signup"===r[0],l="onboarding"===r[0];e||!n&&!l?!e||a||l?e&&a&&i&&s.replace("/(tabs)/explore"):s.replace("/onboarding/dog-basics"):s.replace("/login")},[e,a,r,t,o,d]),t||o?(0,h.jsx)(y.default,{}):(0,h.jsxs)(n.Stack,{screenOptions:{headerBackTitle:"Back"},children:[(0,h.jsx)(n.Stack.Screen,{name:"login",options:{headerShown:!1}}),(0,h.jsx)(n.Stack.Screen,{name:"signup",options:{headerShown:!1}}),(0,h.jsx)(n.Stack.Screen,{name:"(tabs)",options:{headerShown:!1}}),(0,h.jsx)(n.Stack.Screen,{name:"trail/[id]",options:{headerShown:!1}})]})}function b(){return(0,h.jsx)(d.GestureHandlerRootView,{style:x.container,children:(0,h.jsx)(r.QueryClientProvider,{client:p,children:(0,h.jsx)(c.AuthContext,{children:(0,h.jsx)(u.AccountContext,{children:(0,h.jsx)(g.DogsContext,{children:(0,h.jsx)(f.TrailsContext,{children:(0,h.jsx)(m,{})})})})})})})}const x=s.default.create({container:{flex:1}})},5632(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>i});var o=a(3668),r=a(9582),n=a(2291);const i=o.default.create({container:{flex:1,backgroundColor:r.default.backgroundPrimary},content:{flex:1,padding:24,justifyContent:"center"},header:{alignItems:"center",marginBottom:48},logo:{width:100,height:100},title:Object.assign({},n.Typography.h2(r.default.textPrimary),{marginTop:16,textAlign:"center",paddingHorizontal:8}),subtitle:Object.assign({},n.Typography.body(r.default.textMuted),{marginTop:8,textAlign:"center",paddingHorizontal:0}),form:{width:"100%"},inputContainer:{marginBottom:20},label:Object.assign({},n.Typography.label(r.default.textMuted),{marginBottom:8,paddingHorizontal:0}),input:Object.assign({backgroundColor:r.default.backgroundPrimary,borderWidth:1,borderColor:r.default.borderSubtle,borderRadius:12,padding:16,color:r.default.textPrimary,fontSize:16},void 0),helperText:Object.assign({},n.Typography.caption(r.default.textMuted),{marginTop:8,paddingRight:0}),button:{backgroundColor:r.default.accentSecondary,borderRadius:12,paddingVertical:18,paddingHorizontal:16,alignItems:"center",marginTop:12,overflow:"visible",minHeight:56},buttonDisabled:{opacity:.6},buttonPressed:{transform:[{scale:.98}],opacity:.95},buttonText:Object.assign({},n.Typography.button(r.default.backgroundPrimary),{paddingHorizontal:4,textAlign:"center"},void 0),secondaryButton:{padding:16,alignItems:"center",marginTop:8},secondaryButtonText:Object.assign({},n.Typography.label(r.default.accentPrimary),{paddingHorizontal:8,paddingVertical:4}),footer:{flexDirection:"row",justifyContent:"center",alignItems:"center",marginTop:24,flexWrap:"wrap"},footerText:Object.assign({},n.Typography.label(r.default.textMuted),{paddingRight:0,paddingVertical:4}),linkText:Object.assign({},n.Typography.label(r.default.accentPrimary),{paddingHorizontal:4,paddingVertical:4})})},5625(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>j});a(6665);var o=a(3929),r=a(3668),n=a(2772),i=a(5648),l=a(3041),s=a(2291),d=a(9637),c=a(7430),u=a(5395),f=a(4494),g=a(1168),y=a(8032),h=a(477),p=a(9582),m=a(9269),b=a(397);const x={id:"demo-trail",name:"Scenic Coastal Walk",distance:5210,duration:3600,coordinates:[{latitude:50.81999932593175,longitude:-.1443926504884132},{latitude:50.81982005377856,longitude:-.14389605957015306},{latitude:50.8195735534442,longitude:-.14290287773496857},{latitude:50.81976403108945,longitude:-.14245949298612004},{latitude:50.819651985510006,longitude:-.1415904588798469},{latitude:50.819360665744455,longitude:-.141129338740825},{latitude:50.81955114425804,longitude:-.14054407087405707},{latitude:50.8194278935438,longitude:-.1397814491065219},{latitude:50.819282233189426,longitude:-.1389301503892284},{latitude:50.819696803774036,longitude:-.13903656272921694},{latitude:50.81999932593175,longitude:-.13919618123853184},{latitude:50.82010016621547,longitude:-.13853997181101363},{latitude:50.82041389015009,longitude:-.138220734792327},{latitude:50.82055954697452,longitude:-.13852223642078343},{latitude:50.82086206354296,longitude:-.13829167635185513}],city:"Brighton",country:"UK",difficulty:"Easy",pace:"11:32",maxElevation:45};function j(){const e=(0,d.useRouter)();return(0,b.jsxs)(o.default,{style:T.container,children:[(0,b.jsx)(d.Stack.Screen,{options:{title:"Demo Trail",headerShown:!1}}),(0,b.jsxs)(n.default,{style:T.scrollView,children:[(0,b.jsxs)(o.default,{style:T.header,children:[(0,b.jsx)(i.default,{style:T.backButton,onPress:()=>e.back(),children:(0,b.jsx)(u.default,{size:24,color:"#fff"})}),(0,b.jsxs)(o.default,{style:T.headerContent,children:[(0,b.jsx)(l.Text,{style:T.title,children:x.name}),(0,b.jsxs)(o.default,{style:T.locationRow,children:[(0,b.jsx)(g.default,{size:16,color:"#fff"}),(0,b.jsxs)(l.Text,{style:T.locationText,children:[x.city,", ",x.country]})]})]})]}),(0,b.jsx)(o.default,{style:T.mapContainer,children:(0,b.jsx)(c.default,{coordinates:x.coordinates,style:T.map,scrollEnabled:!0,zoomEnabled:!0})}),(0,b.jsxs)(o.default,{style:T.statsContainer,children:[(0,b.jsxs)(o.default,{style:T.statItem,children:[(0,b.jsx)(y.default,{size:20,color:p.default.backgroundPrimary}),(0,b.jsx)(l.Text,{style:T.statValue,children:(0,m.formatDistance)(x.distance)}),(0,b.jsx)(l.Text,{style:T.statLabel,children:"Distance"})]}),(0,b.jsxs)(o.default,{style:T.statItem,children:[(0,b.jsx)(f.default,{size:20,color:p.default.backgroundPrimary}),(0,b.jsx)(l.Text,{style:T.statValue,children:(0,m.formatDuration)(x.duration)}),(0,b.jsx)(l.Text,{style:T.statLabel,children:"Time"})]}),(0,b.jsxs)(o.default,{style:T.statItem,children:[(0,b.jsx)(h.default,{size:20,color:p.default.backgroundPrimary}),(0,b.jsxs)(l.Text,{style:T.statValue,children:[x.maxElevation,"m"]}),(0,b.jsx)(l.Text,{style:T.statLabel,children:"Elevation"})]})]}),(0,b.jsxs)(o.default,{style:T.section,children:[(0,b.jsx)(l.Text,{style:T.sectionTitle,children:"About this trail"}),(0,b.jsx)(l.Text,{style:T.description,children:"This is a beautiful coastal walk along the Brighton seafront. Perfect for a morning stroll with your dog. The path is paved and offers stunning views of the English Channel."})]})]})]})}const T=r.default.create({container:{flex:1,backgroundColor:p.default.backgroundPrimary},scrollView:{flex:1},header:{height:200,backgroundColor:p.default.backgroundPrimary,justifyContent:"flex-end",padding:20},backButton:{position:"absolute",top:50,left:20,zIndex:10},headerContent:{marginBottom:10},title:Object.assign({},s.Typography.h2("#fff"),{marginBottom:5}),locationRow:{flexDirection:"row",alignItems:"center"},locationText:Object.assign({},s.Typography.body("#fff"),{marginLeft:5}),mapContainer:{height:300,width:"100%"},map:{flex:1},statsContainer:{flexDirection:"row",justifyContent:"space-around",padding:20,backgroundColor:p.default.backgroundSecondary,borderBottomWidth:1,borderBottomColor:p.default.borderSubtle},statItem:{alignItems:"center"},statValue:Object.assign({},s.Typography.h2("#333"),{marginTop:5}),statLabel:Object.assign({},s.Typography.caption("#666"),{marginTop:2}),section:{padding:20},sectionTitle:Object.assign({},s.Typography.h2("#333"),{marginBottom:10}),description:Object.assign({},s.Typography.body("#666"),{lineHeight:24})})},5250(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>n});var o=a(9637),r=a(397);function n(){return(0,r.jsx)(o.Redirect,{href:"/(tabs)/explore"})}},4101(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>P});var o=a(6665),r=a(3929),n=a(6773),i=a(5708),l=a(5648),s=a(4767),d=a(1690),c=a(530),u=a(3041),f=a(9637),g=a(4866),y=a(3185),h=a(3353),p=a(5938),m=a(8787),b=a(9921),x=a(9449),j=a(5894),T=a(9582),w=a(7705),C=a(5632),k=a(397);function P(){const e=(0,f.useRouter)(),{signInWithToken:t}=(0,h.useAuth)(),[a,m]=o.useState(""),[P,I]=o.useState(""),[S,v]=o.useState(!1),O=x.default.expoConfig?.extra||x.default.manifest?.extra||{},B={EXPO_PUBLIC_GOOGLE_EXPO_CLIENT_ID:O.EXPO_PUBLIC_GOOGLE_EXPO_CLIENT_ID??{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.6",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"55.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_GOOGLE_EXPO_CLIENT_ID,EXPO_PUBLIC_GOOGLE_CLIENT_ID:O.EXPO_PUBLIC_GOOGLE_CLIENT_ID??{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.6",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"55.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_GOOGLE_CLIENT_ID,EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:O.EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID??{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.6",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"55.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID,EXPO_PUBLIC_GOOGLE_ANDROID_CLIENT_ID:O.EXPO_PUBLIC_GOOGLE_ANDROID_CLIENT_ID??{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.6",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"55.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_GOOGLE_ANDROID_CLIENT_ID};"undefined"===typeof window||B.EXPO_PUBLIC_GOOGLE_EXPO_CLIENT_ID||console.warn("Google web client id (EXPO_PUBLIC_GOOGLE_EXPO_CLIENT_ID) is not defined. Google auth on web requires a webClientId.");const[E,_,A]=b.useAuthRequest({webClientId:"447944956309-t92ug0tqs40adop6mnvifqbmfsi7dtj6.apps.googleusercontent.com",iosClientId:{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.6",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"55.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID||B.EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID,androidClientId:{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.6",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"55.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_GOOGLE_ANDROID_CLIENT_ID||B.EXPO_PUBLIC_GOOGLE_ANDROID_CLIENT_ID,clientId:{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.6",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"55.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_GOOGLE_CLIENT_ID||B.EXPO_PUBLIC_GOOGLE_CLIENT_ID,scopes:["profile","email"],responseType:"token"});o.useEffect(()=>{(async()=>{if("success"===_?.type)try{v(!0);const a=function(e){if(!e)return null;if("string"===typeof e)return e;try{if(e instanceof ArrayBuffer){const t=new Uint8Array(e);let a="";for(let e=0;e<t.length;e++)a+=String.fromCharCode(t[e]);return decodeURIComponent(escape(a))}if(e&&"object"===typeof e&&Array.isArray(e.data)){const t=e.data;let a="";for(let e=0;e<t.length;e++)a+=String.fromCharCode(t[e]);return decodeURIComponent(escape(a))}return String(e)}catch(t){return String(e)}}(_.authentication?.accessToken||_.authentication?.idToken);if(!a)throw new Error("No access token from Google");const o=await(0,w.signInWithGoogle)((0,w.getFirebaseAuth)(),a),r=await(0,p.firebaseAuthExchange)(o.idToken);await t(r),g.notificationAsync(y.NotificationFeedbackType.Success),e.replace("/")}catch(a){console.error("Google sign-in error",a),d.default.alert("Google Sign-In Error",a?.message||String(a))}finally{v(!1)}})()},[_]);const L=async()=>{if(console.log("handleSignIn invoked",{email:a,password:P}),!a||!P)return g.notificationAsync(y.NotificationFeedbackType.Error),void d.default.alert("Error","Please enter your email and password");g.impactAsync(y.ImpactFeedbackStyle.Medium),v(!0);try{const o=await(0,w.signInWithEmailAndPassword)((0,w.getFirebaseAuth)(),a.trim().toLowerCase(),P),r=await o.user.getIdToken(),n=await(0,p.firebaseAuthExchange)(r);await t(n),g.notificationAsync(y.NotificationFeedbackType.Success),e.replace("/")}catch(o){g.notificationAsync(y.NotificationFeedbackType.Error),console.error("Firebase sign-in error:",o),d.default.alert("Error",o.message||"Failed to sign in")}finally{v(!1)}},D="undefined"!==typeof window?{onKeyDown:e=>{"Enter"===(e?.nativeEvent?.key||e?.key)&&L()}}:{};return(0,k.jsx)(s.default,{style:C.default.container,behavior:void 0,children:(0,k.jsxs)(r.default,{style:C.default.content,children:[(0,k.jsxs)(r.default,{style:C.default.header,children:[(0,k.jsx)(j.Image,{source:{uri:"https://api.tailtrails.club/assets/logo"},style:C.default.logo,contentFit:"contain"}),(0,k.jsx)(u.Text,{style:C.default.title,children:"Welcome Back"}),(0,k.jsx)(u.Text,{style:C.default.subtitle,children:"Sign in to track your dog walks"})]}),(0,k.jsxs)(r.default,{style:C.default.form,children:[(0,k.jsxs)(r.default,{style:C.default.inputContainer,children:[(0,k.jsx)(u.Text,{style:C.default.label,children:"Email"}),(0,k.jsx)(n.default,{style:C.default.input,placeholder:"your@email.com",value:a,onChangeText:m,autoCapitalize:"none",keyboardType:"email-address",autoComplete:"email",editable:!S,placeholderTextColor:T.default.textMuted})]}),(0,k.jsxs)(r.default,{style:C.default.inputContainer,children:[(0,k.jsx)(u.Text,{style:C.default.label,children:"Password"}),(0,k.jsx)(n.default,{style:C.default.input,placeholder:"Enter your password",value:P,onChangeText:I,secureTextEntry:!0,autoCapitalize:"none",autoComplete:"password",editable:!S,placeholderTextColor:T.default.textMuted})]}),(0,k.jsx)(i.default,Object.assign({style:({pressed:e})=>[C.default.button,S&&C.default.buttonDisabled,e&&C.default.buttonPressed],onPress:L},D,{accessibilityRole:"button",disabled:S,children:S?(0,k.jsx)(c.default,{color:T.default.backgroundPrimary}):(0,k.jsx)(u.Text,{style:C.default.buttonText,children:"Sign In"})})),(0,k.jsxs)(r.default,{style:C.default.footer,children:[(0,k.jsx)(u.Text,{style:C.default.footerText,children:"Don't have an account? "}),(0,k.jsx)(l.default,{onPress:()=>{g.impactAsync(y.ImpactFeedbackStyle.Light),e.push("/signup")},children:(0,k.jsx)(u.Text,{style:C.default.linkText,children:"Sign Up"})})]})]})]})})}m.maybeCompleteAuthSession()},7924(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>i});var o=a(3668),r=a(9582),n=a(2291);const i=o.default.create({container:{flex:1,backgroundColor:r.default.backgroundPrimary},content:{padding:24},header:{marginBottom:32,alignItems:"center"},title:Object.assign({},n.Typography.h2(r.default.accentPrimary),{marginBottom:8,textAlign:"center"}),subtitle:Object.assign({},n.Typography.body(r.default.accentPrimary),{textAlign:"center",marginBottom:24}),progressContainer:{flexDirection:"row",gap:8},progressDot:{width:8,height:8,borderRadius:4,backgroundColor:"#3d4520"},progressDotActive:{backgroundColor:r.default.accentPrimary},photoContainer:{width:140,height:140,borderRadius:70,alignSelf:"center",marginBottom:32,overflow:"hidden"},photo:{width:"100%",height:"100%"},photoPlaceholder:{width:"100%",height:"100%",backgroundColor:r.default.backgroundSecondary,justifyContent:"center",alignItems:"center",gap:8},photoPlaceholderText:Object.assign({},n.Typography.label(r.default.accentPrimary)),photoOverlay:{position:"absolute",bottom:0,right:0,width:40,height:40,borderRadius:20,backgroundColor:r.default.accentPrimary,justifyContent:"center",alignItems:"center"},formSection:{marginBottom:24},label:Object.assign({},n.Typography.label(r.default.accentPrimary),{marginBottom:8,paddingHorizontal:0}),input:Object.assign({backgroundColor:r.default.backgroundPrimary,borderRadius:12,padding:16,color:r.default.accentPrimary,borderWidth:1,borderColor:"#3d4520",fontSize:16},void 0),pickerButton:{backgroundColor:r.default.backgroundPrimary,borderRadius:12,padding:16,flexDirection:"row",justifyContent:"space-between",alignItems:"center",borderWidth:1,borderColor:"#3d4520"},pickerButtonText:Object.assign({},n.Typography.body(r.default.accentPrimary)),pickerButtonTextPlaceholder:{color:"#5a6040"},pickerOptions:{backgroundColor:"#282E10",borderRadius:12,marginTop:8,borderWidth:1,borderColor:"#3d4520",overflow:"hidden"},pickerOption:{padding:16,borderBottomWidth:1,borderBottomColor:"#1a1f0a"},pickerOptionSelected:{backgroundColor:"rgba(255, 254, 119, 0.15)"},pickerOptionText:Object.assign({},n.Typography.body(r.default.accentPrimary)),pickerOptionTextSelected:Object.assign({},n.Typography.body(r.default.accentPrimary),{fontWeight:"600"}),nextButton:{backgroundColor:r.default.accentPrimary,borderRadius:12,padding:18,alignItems:"center",marginTop:16},nextButtonText:Object.assign({},n.Typography.button(r.default.backgroundPrimary)),closeButton:{width:40,height:40,borderRadius:20,backgroundColor:r.default.backgroundPrimary,justifyContent:"center",alignItems:"center"}})},4674(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>I});var o=a(6665),r=a(3929),n=a(5648),i=a(6773),l=a(484),s=a(1690),d=a(2772),c=a(530),u=a(3041),f=a(9637),g=a(9908),y=a(262),h=a(4866),p=a(3185),m=a(9281),b=a(5624),x=a(4043),j=a(2964),T=a(9582),w=a(8833),C=a(7924),k=a(594),P=a(397);function I(){const e=(0,f.useRouter)(),t=(0,w.useSafeAreaInsets)(),{dogProfile:a}=(0,g.useDogs)(),[I,S]=(0,o.useState)(""),[v,O]=(0,o.useState)(""),[B,E]=(0,o.useState)(""),[_,A]=(0,o.useState)(null),[L,D]=(0,o.useState)(null),[R,z]=(0,o.useState)(!1),[F,N]=(0,o.useState)(!1);(0,o.useEffect)(()=>{a&&(console.log("Loading existing dog profile for editing:",a),S(a.name),O(a.nickname||""),E(a.age.toString()),A(a.size),D(a.image||null))},[a]);const U=async()=>{h.impactAsync(p.ImpactFeedbackStyle.Light);const{status:e}=await y.requestMediaLibraryPermissionsAsync();if("granted"!==e)return void s.default.alert("Permission needed","We need access to your photo library");N(!0);const t=await y.launchImageLibraryAsync({mediaTypes:["images"],allowsEditing:!0,aspect:[1,1],quality:.7});N(!1),!t.canceled&&t.assets[0]&&(D(t.assets[0].uri),h.notificationAsync(p.NotificationFeedbackType.Success))},M=async()=>{h.impactAsync(p.ImpactFeedbackStyle.Light);const{status:e}=await y.requestCameraPermissionsAsync();if("granted"!==e)return void s.default.alert("Permission needed","We need camera access to take photos");N(!0);const t=await y.launchCameraAsync({allowsEditing:!0,aspect:[1,1],quality:.7});N(!1),!t.canceled&&t.assets[0]&&(D(t.assets[0].uri),h.notificationAsync(p.NotificationFeedbackType.Success))};return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(f.Stack.Screen,{options:{headerShown:!1}}),(0,P.jsxs)(d.default,{style:C.default.container,contentContainerStyle:[C.default.content,{paddingTop:t.top+20}],children:[(0,P.jsx)(n.default,{style:[C.default.closeButton,{position:"absolute",right:16,top:t.top+12}],onPress:()=>e.back(),accessibilityLabel:"Close",children:(0,P.jsx)(j.default,{size:20,color:T.default.accentPrimary})}),(0,P.jsxs)(r.default,{style:C.default.header,children:[(0,P.jsx)(u.Text,{style:C.default.title,children:a?"Edit dog profile":"Tell us about your dog"}),(0,P.jsx)(u.Text,{style:C.default.subtitle,children:a?"Update your dog's information":"Let's start with the basics"}),!a&&(0,P.jsxs)(r.default,{style:C.default.progressContainer,children:[(0,P.jsx)(r.default,{style:[C.default.progressDot,C.default.progressDotActive]}),(0,P.jsx)(r.default,{style:C.default.progressDot})]})]}),(0,P.jsxs)(n.default,{style:C.default.photoContainer,onPress:()=>{s.default.alert("Add Photo","Choose how you want to add a photo",[{text:"Take Photo",onPress:M},{text:"Choose from Library",onPress:U},{text:"Cancel",style:"cancel"}])},disabled:F,children:[F?(0,P.jsx)(c.default,{size:"large",color:"#FFFE77"}):L?(0,P.jsx)(l.default,{source:{uri:L},style:C.default.photo}):(0,P.jsxs)(r.default,{style:C.default.photoPlaceholder,children:[(0,P.jsx)(m.default,{size:32,color:"#FFFE77"}),(0,P.jsx)(u.Text,{style:C.default.photoPlaceholderText,children:"Add Photo"})]}),L&&!F&&(0,P.jsx)(r.default,{style:C.default.photoOverlay,children:(0,P.jsx)(x.default,{size:24,color:"#1a1f0a"})})]}),(0,P.jsxs)(r.default,{style:C.default.formSection,children:[(0,P.jsx)(u.Text,{style:C.default.label,children:"Name *"}),(0,P.jsx)(i.default,{style:C.default.input,value:I,onChangeText:S,placeholder:"Enter your dog's name",placeholderTextColor:"#5a6040",autoCapitalize:"words",testID:"dog-name-input"})]}),(0,P.jsxs)(r.default,{style:C.default.formSection,children:[(0,P.jsx)(u.Text,{style:C.default.label,children:"Nickname (Optional)"}),(0,P.jsx)(i.default,{style:C.default.input,value:v,onChangeText:O,placeholder:"Enter a nickname",placeholderTextColor:"#5a6040",autoCapitalize:"words",testID:"dog-nickname-input"})]}),(0,P.jsxs)(r.default,{style:C.default.formSection,children:[(0,P.jsx)(u.Text,{style:C.default.label,children:"Size *"}),(0,P.jsxs)(n.default,{style:C.default.pickerButton,onPress:()=>{h.impactAsync(p.ImpactFeedbackStyle.Light),z(!R)},testID:"size-picker-button",children:[(0,P.jsx)(u.Text,{style:[C.default.pickerButtonText,!_&&C.default.pickerButtonTextPlaceholder],children:_||"Select size"}),(0,P.jsx)(b.default,{size:20,color:"#a8ad8e"})]}),R&&(0,P.jsx)(r.default,{style:C.default.pickerOptions,children:k.DOG_SIZES.map(e=>(0,P.jsx)(n.default,{style:[C.default.pickerOption,_===e&&C.default.pickerOptionSelected],onPress:()=>{h.impactAsync(p.ImpactFeedbackStyle.Light),A(e),z(!1)},testID:`size-option-${e}`,children:(0,P.jsx)(u.Text,{style:[C.default.pickerOptionText,_===e&&C.default.pickerOptionTextSelected],children:e})},e))})]}),(0,P.jsxs)(r.default,{style:C.default.formSection,children:[(0,P.jsx)(u.Text,{style:C.default.label,children:"Age (years) *"}),(0,P.jsx)(i.default,{style:C.default.input,value:B,onChangeText:E,placeholder:"Enter age",placeholderTextColor:"#5a6040",keyboardType:"numeric",testID:"dog-age-input"})]}),(0,P.jsx)(n.default,{style:[C.default.nextButton,{marginBottom:t.bottom+20}],onPress:()=>{if(!I.trim())return void s.default.alert("Missing Information","Please enter your dog's name");if(!_)return void s.default.alert("Missing Information","Please select your dog's size");const t=parseInt(B,10);if(!B||isNaN(t)||t<0||t>30)return void s.default.alert("Invalid Age","Please enter a valid age (0-30 years)");h.impactAsync(p.ImpactFeedbackStyle.Medium);e[a?"replace":"push"]({pathname:"/onboarding/dog-personality",params:{name:I.trim(),nickname:v.trim(),age:t.toString(),size:_,image:L||"",isEditing:a?"true":"false"}})},testID:"next-button",children:(0,P.jsx)(u.Text,{style:C.default.nextButtonText,children:"Next"})})]})]})}},8625(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>i});var o=a(3668),r=a(9582),n=a(2291);const i=o.default.create({container:{flex:1,backgroundColor:r.default.backgroundSecondaryVarient},scrollView:{flex:1},content:{padding:24},header:{marginBottom:32,alignItems:"center"},title:Object.assign({},n.Typography.h2(r.default.accentPrimary),{marginBottom:8,textAlign:"center"}),subtitle:Object.assign({},n.Typography.body(r.default.accentPrimary),{textAlign:"center",marginBottom:24}),progressContainer:{flexDirection:"row",gap:8},progressDot:{width:8,height:8,borderRadius:4,backgroundColor:"#3d4520"},progressDotActive:{backgroundColor:r.default.accentPrimary},tagsContainer:{flexDirection:"row",flexWrap:"wrap",gap:12},tag:{paddingHorizontal:20,paddingVertical:12,borderRadius:24,backgroundColor:"#282E10",borderWidth:1.5,borderColor:"#3d4520"},tagSelected:{backgroundColor:"rgba(255, 254, 119, 0.15)",borderColor:r.default.accentPrimary},tagText:Object.assign({},n.Typography.label(r.default.accentPrimary),{paddingHorizontal:4}),tagTextSelected:Object.assign({},n.Typography.label(r.default.accentPrimary),{fontWeight:"700",paddingHorizontal:4}),sectionHeader:{marginTop:32,marginBottom:16},sectionTitle:Object.assign({},n.Typography.h2(r.default.accentPrimary)),section:{marginBottom:24},label:Object.assign({},n.Typography.label(r.default.accentPrimary),{marginBottom:4}),helperText:Object.assign({},n.Typography.caption(r.default.accentPrimary),{marginBottom:12}),recallContainer:{flexDirection:"row",gap:8},recallOption:{flex:1,paddingVertical:12,paddingHorizontal:16,borderRadius:12,backgroundColor:"#282E10",borderWidth:1.5,borderColor:"#3d4520",alignItems:"center"},recallOptionSelected:{backgroundColor:"rgba(255, 254, 119, 0.15)",borderColor:r.default.accentPrimary},recallText:Object.assign({},n.Typography.label(r.default.accentPrimary),{paddingHorizontal:4}),recallTextSelected:Object.assign({},n.Typography.label(r.default.accentPrimary),{fontWeight:"700",paddingHorizontal:4}),footer:{flexDirection:"row",gap:12,paddingHorizontal:24,paddingTop:20,borderTopWidth:1,borderTopColor:"#3d4520",backgroundColor:"#282E10"},backButton:{flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center",gap:8,backgroundColor:"transparent",borderRadius:12,padding:18,borderWidth:1.5,borderColor:r.default.accentPrimary},backButtonText:Object.assign({},n.Typography.label(r.default.accentPrimary),{paddingHorizontal:4}),finishButton:{flex:1,backgroundColor:r.default.accentPrimary,borderRadius:12,padding:18,alignItems:"center",justifyContent:"center",minHeight:56},finishButtonDisabled:{opacity:.6},finishButtonText:Object.assign({},n.Typography.button("#1a1f0a"),{paddingHorizontal:4})})},6183(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>j});var o=a(6665),r=a(3929),n=a(5648),i=a(2772),l=a(1690),s=a(530),d=a(3041),c=a(9637),u=a(4866),f=a(3185),g=a(1449),y=a(8833),h=a(8625),p=a(594),m=a(3353),b=a(9908),x=a(397);function j(){const e=(0,c.useRouter)(),t=(0,c.useLocalSearchParams)(),{user:a}=(0,m.useAuth)(),{dogProfile:j,refreshDogProfile:T,createDogProfile:w,updateDogProfile:C}=(0,b.useDogs)(),k=(0,y.useSafeAreaInsets)(),[P,I]=(0,o.useState)([]),[S,v]=(0,o.useState)("Fair"),[O,B]=(0,o.useState)(!1),E="true"===t.isEditing;(0,o.useEffect)(()=>{j&&E&&(console.log("Loading existing personality tags for editing:",j.personality_tags),I(j.personality_tags||[]),v(j.recall_reliability||"Fair"))},[j,E]);return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(c.Stack.Screen,{options:{headerShown:!1}}),(0,x.jsxs)(r.default,{style:[h.default.container,{paddingTop:k.top+20}],children:[(0,x.jsxs)(i.default,{style:h.default.scrollView,contentContainerStyle:h.default.content,children:[(0,x.jsxs)(r.default,{style:h.default.header,children:[(0,x.jsx)(d.Text,{style:h.default.title,children:"Personality & Behaviour"}),(0,x.jsx)(d.Text,{style:h.default.subtitle,children:"Choose the tags that best describe your dog"}),!E&&(0,x.jsxs)(r.default,{style:h.default.progressContainer,children:[(0,x.jsx)(r.default,{style:h.default.progressDot}),(0,x.jsx)(r.default,{style:[h.default.progressDot,h.default.progressDotActive]})]})]}),(0,x.jsx)(r.default,{style:h.default.tagsContainer,children:p.PERSONALITY_TAGS.map(e=>(0,x.jsx)(n.default,{style:[h.default.tag,P.includes(e)&&h.default.tagSelected],onPress:()=>(e=>{u.impactAsync(f.ImpactFeedbackStyle.Light),I(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e),testID:`tag-${e}`,children:(0,x.jsx)(d.Text,{style:[h.default.tagText,P.includes(e)&&h.default.tagTextSelected],children:e})},e))}),(0,x.jsx)(r.default,{style:h.default.sectionHeader,children:(0,x.jsx)(d.Text,{style:h.default.sectionTitle,children:"Health & Safety"})}),(0,x.jsxs)(r.default,{style:h.default.section,children:[(0,x.jsx)(d.Text,{style:h.default.label,children:"Recall Reliability"}),(0,x.jsx)(d.Text,{style:h.default.helperText,children:"How reliably does your dog return when called?"}),(0,x.jsx)(r.default,{style:h.default.recallContainer,children:p.RECALL_RELIABILITY_OPTIONS.map(e=>(0,x.jsx)(n.default,{style:[h.default.recallOption,S===e&&h.default.recallOptionSelected],onPress:()=>{u.impactAsync(f.ImpactFeedbackStyle.Light),v(e)},testID:`recall-${e}`,children:(0,x.jsx)(d.Text,{style:[h.default.recallText,S===e&&h.default.recallTextSelected],children:e})},e))})]})]}),(0,x.jsxs)(r.default,{style:[h.default.footer,{paddingBottom:k.bottom+20}],children:[(0,x.jsxs)(n.default,{style:h.default.backButton,onPress:()=>e.back(),disabled:O,testID:"back-button",children:[(0,x.jsx)(g.default,{size:24,color:"#FFFE77"}),(0,x.jsx)(d.Text,{style:h.default.backButtonText,children:"Back"})]}),(0,x.jsx)(n.default,{style:[h.default.finishButton,O&&h.default.finishButtonDisabled],onPress:async()=>{if(a){u.impactAsync(f.ImpactFeedbackStyle.Medium),B(!0);try{console.log(E?"Updating dog profile for user:":"Creating dog profile for user:",a.id);const o={user_id:a.id,name:t.name,nickname:t.nickname||void 0,size:t.size,age:parseInt(t.age,10),image:t.image||void 0,personality_tags:P,recall_reliability:S};console.log("Dog profile data:",o),E&&j?.id?await C(Object.assign({},o,{id:j.id})):await w(o),u.notificationAsync(f.NotificationFeedbackType.Success),E?e.replace("/(tabs)/profile"):e.replace("/(tabs)/explore")}catch(o){console.error("Error saving dog profile:",o),l.default.alert("Error",o.message||"Failed to save dog profile"),B(!1)}}else l.default.alert("Error","You must be logged in to create a dog profile")},disabled:O,testID:"finish-button",children:O?(0,x.jsx)(s.default,{color:"#1a1f0a"}):(0,x.jsx)(d.Text,{style:h.default.finishButtonText,children:E?"Save":"Finish"})})]})]})]})}},3764(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>k});var o=a(6665),r=a(3929),n=a(6773),i=a(5648),l=a(4767),s=a(1690),d=a(530),c=a(3041),u=a(9637),f=a(4866),g=a(3185),y=a(3353),h=a(5938),p=a(630),m=a(7705),b=a(8787),x=a(9921),j=a(9449),T=a(9582),w=a(5632),C=a(397);function k(){const e=(0,u.useRouter)(),{signInWithToken:t}=(0,y.useAuth)(),[a,b]=(0,o.useState)(""),[k,P]=(0,o.useState)(""),[I,S]=(0,o.useState)(""),[v,O]=(0,o.useState)(!1),B=j.default.expoConfig&&j.default.expoConfig.extra||{},[E,_,A]=x.useAuthRequest({webClientId:"447944956309-t92ug0tqs40adop6mnvifqbmfsi7dtj6.apps.googleusercontent.com",iosClientId:{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.6",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"55.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID||B.EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID,androidClientId:{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.6",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"55.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_GOOGLE_ANDROID_CLIENT_ID||B.EXPO_PUBLIC_GOOGLE_ANDROID_CLIENT_ID,clientId:{NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{name:"TailTrails",slug:"dog-walk-tracker-x2nouww",version:"1.0.6",orientation:"portrait",icon:"./assets/images/icon.png",scheme:"tail-trails",userInterfaceStyle:"automatic",splash:{image:"./assets/images/splash-icon.png",resizeMode:"contain",backgroundColor:"#ffffff"},web:{},experiments:{typedRoutes:!0},extra:{router:{},EXPO_PUBLIC_GOOGLE_IOS_CLIENT_ID:"603763351756-ekakr88vbtlkqv620q7h8j2h3amq0fem.apps.googleusercontent.com",eas:{projectId:"31ef470c-e5bd-45af-8bdc-f12b99e6db0b"}},sdkVersion:"55.0.0",platforms:["ios","android","web"]},EXPO_DEBUG:!1,PLATFORM:"web",WDS_SOCKET_PATH:"/_expo/ws",CI:"true"}.EXPO_PUBLIC_GOOGLE_CLIENT_ID||B.EXPO_PUBLIC_GOOGLE_CLIENT_ID,scopes:["profile","email"],responseType:"token"});o.useEffect(()=>{(async()=>{if("success"===_?.type)try{O(!0);const a=function(e){if(!e)return null;if("string"===typeof e)return e;try{if(e instanceof ArrayBuffer){const t=new Uint8Array(e);let a="";for(let e=0;e<t.length;e++)a+=String.fromCharCode(t[e]);return decodeURIComponent(escape(a))}if(e&&"object"===typeof e&&Array.isArray(e.data)){const t=e.data;let a="";for(let e=0;e<t.length;e++)a+=String.fromCharCode(t[e]);return decodeURIComponent(escape(a))}return String(e)}catch(t){return String(e)}}(_.authentication?.accessToken||_.authentication?.idToken);if(!a)throw new Error("No access token from Google");const o=await(0,m.signInWithGoogle)((0,m.getFirebaseAuth)(),a),r=await(0,h.firebaseAuthExchange)(o.idToken);await t(r),f.notificationAsync(g.NotificationFeedbackType.Success),e.replace("/")}catch(a){console.error("Google sign-up error",a),s.default.alert("Google Sign-Up Error",a?.message||String(a))}finally{O(!1)}})()},[_]);return(0,C.jsx)(l.default,{style:w.default.container,behavior:void 0,children:(0,C.jsxs)(r.default,{style:w.default.content,children:[(0,C.jsxs)(r.default,{style:w.default.header,children:[(0,C.jsx)(p.default,{size:64,color:"#5d6b4a"}),(0,C.jsx)(c.Text,{style:w.default.title,children:"Create Account"}),(0,C.jsx)(c.Text,{style:w.default.subtitle,children:"Sign up to start tracking your dog walks"})]}),(0,C.jsxs)(r.default,{style:w.default.form,children:[(0,C.jsxs)(r.default,{style:w.default.inputContainer,children:[(0,C.jsx)(c.Text,{style:w.default.label,children:"Name"}),(0,C.jsx)(n.default,{style:w.default.input,placeholder:"Your Name",value:k,onChangeText:P,autoCapitalize:"words",editable:!v,placeholderTextColor:T.default.textMuted})]}),(0,C.jsxs)(r.default,{style:w.default.inputContainer,children:[(0,C.jsx)(c.Text,{style:w.default.label,children:"Email"}),(0,C.jsx)(n.default,{style:w.default.input,placeholder:"your@email.com",value:a,onChangeText:b,autoCapitalize:"none",keyboardType:"email-address",autoComplete:"email",editable:!v,placeholderTextColor:T.default.textMuted})]}),(0,C.jsxs)(r.default,{style:w.default.inputContainer,children:[(0,C.jsx)(c.Text,{style:w.default.label,children:"Password"}),(0,C.jsx)(n.default,{style:w.default.input,placeholder:"Create a password",value:I,onChangeText:S,secureTextEntry:!0,autoCapitalize:"none",autoComplete:"password",editable:!v,placeholderTextColor:T.default.textMuted})]}),(0,C.jsx)(i.default,{style:[w.default.button,v&&w.default.buttonDisabled],onPress:async()=>{if(!a||!k||!I)return f.notificationAsync(g.NotificationFeedbackType.Error),void s.default.alert("Error","Please fill in all fields");f.impactAsync(g.ImpactFeedbackStyle.Medium),O(!0);try{const o=await(0,m.createUserWithEmailAndPassword)((0,m.getFirebaseAuth)(),a.trim().toLowerCase(),I);k.trim()&&await(0,m.updateProfile)(o.user,{displayName:k.trim()});const r=await o.user.getIdToken(!0),n=await(0,h.firebaseAuthExchange)(r);await t(n),f.notificationAsync(g.NotificationFeedbackType.Success),e.replace("/")}catch(o){f.notificationAsync(g.NotificationFeedbackType.Error),console.error("Firebase sign-up error:",o),s.default.alert("Error",o.message||"Failed to create account")}finally{O(!1)}},disabled:v,children:v?(0,C.jsx)(d.default,{color:T.default.backgroundPrimary}):(0,C.jsx)(c.Text,{style:w.default.buttonText,children:"Create Account"})}),(0,C.jsxs)(r.default,{style:w.default.footer,children:[(0,C.jsx)(c.Text,{style:w.default.footerText,children:"Already have an account? "}),(0,C.jsx)(i.default,{onPress:()=>{f.impactAsync(g.ImpactFeedbackStyle.Light),e.push("/login")},children:(0,C.jsx)(c.Text,{style:w.default.linkText,children:"Sign In"})})]})]})]})})}b.maybeCompleteAuthSession()},8776(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>i});var o=a(3668),r=a(9582),n=a(2291);const i=o.default.create({container:{flex:1,backgroundColor:r.default.backgroundPrimary},headerButtons:{position:"absolute",left:0,right:0,zIndex:100,flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingHorizontal:16},headerButton:{width:44,height:44,borderRadius:22,backgroundColor:r.default.textPrimary,justifyContent:"center",alignItems:"center",shadowColor:r.default.backgroundSecondaryVarient,shadowOffset:{width:0,height:2},shadowOpacity:.15,shadowRadius:4,elevation:4},headerRightButtons:{flexDirection:"row",gap:12},scrollContainer:{flex:1},scrollContent:{paddingBottom:32},loadingContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:r.default.backgroundPrimary},loadingText:Object.assign({marginTop:16},n.Typography.body(r.default.accentPrimary)),heroSection:{position:"relative"},heroImageContainer:{width:"100%",height:500,position:"relative"},heroImage:{width:"100%",height:"100%",backgroundColor:r.default.borderSubtle},heroGradient:{position:"absolute",bottom:0,left:0,right:0,height:100},changePhotoFab:{position:"absolute",bottom:80,right:20,width:56,height:56,borderRadius:28,backgroundColor:r.default.backgroundPrimary,justifyContent:"center",alignItems:"center",shadowColor:"#000",shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:8,elevation:6},addPhotoContainer:{width:"100%",height:280,backgroundColor:r.default.accentPrimary,justifyContent:"center",alignItems:"center",paddingHorizontal:32},addPhotoIcon:{width:72,height:72,borderRadius:36,backgroundColor:r.default.backgroundPrimary,justifyContent:"center",alignItems:"center",marginBottom:16},addPhotoText:Object.assign({},n.Typography.h2(r.default.textPrimary),{marginBottom:4}),addPhotoSubtext:Object.assign({},n.Typography.caption(r.default.backgroundSecondary)),contentWrapper:{backgroundColor:r.default.backgroundPrimary,borderTopLeftRadius:24,borderTopRightRadius:24,marginTop:-24,zIndex:10},content:{padding:24},titleSection:{marginBottom:20},dateRow:{flexDirection:"row",alignItems:"center",gap:8,marginBottom:8},dateText:Object.assign({},n.Typography.body(r.default.backgroundSecondary)),titleRow:{flexDirection:"row",alignItems:"flex-start",gap:12,marginBottom:8},title:Object.assign({flex:1},n.Typography.h1(r.default.textPrimary),{lineHeight:40}),authorRow:{flexDirection:"row",alignItems:"center",gap:12,marginTop:8,marginBottom:16},avatar:{width:36,height:36,borderRadius:18,backgroundColor:r.default.backgroundSecondary},avatarText:Object.assign({},n.Typography.label(r.default.accentPrimary)),authorName:Object.assign({},n.Typography.body(r.default.backgroundPrimary)),editIconButton:{width:40,height:40,borderRadius:20,backgroundColor:r.default.accentPrimary,justifyContent:"center",alignItems:"center",marginTop:4},nameEditContainer:{marginBottom:8},nameInput:Object.assign({},n.Typography.h2(r.default.textPrimary),{backgroundColor:r.default.textPrimary,borderWidth:2,borderColor:r.default.backgroundPrimary,borderRadius:12,padding:12,marginBottom:12}),nameInputInDetails:Object.assign({},n.Typography.body(r.default.textPrimary),{backgroundColor:r.default.backgroundPrimary,borderWidth:1,borderColor:r.default.accentPrimary,borderRadius:12,padding:16}),editButtons:{flexDirection:"row",gap:8},iconButton:{width:44,height:44,borderRadius:22,justifyContent:"center",alignItems:"center"},saveIconButton:{backgroundColor:r.default.backgroundPrimary},cancelIconButton:{backgroundColor:r.default.accentPrimary},locationRow:{flexDirection:"row",alignItems:"center",gap:6,marginBottom:12},location:Object.assign({},n.Typography.body(r.default.backgroundSecondary)),ratingRow:{flexDirection:"row",gap:4},reviewCard:{backgroundColor:r.default.backgroundSecondary,borderRadius:16,padding:20,marginBottom:24,borderWidth:1,borderColor:r.default.borderSubtle},reviewText:Object.assign({},n.Typography.body(r.default.backgroundPrimary),{lineHeight:24}),statsSection:{flexDirection:"row",flexWrap:"wrap",gap:12,marginBottom:24},statCard:{flex:1,minWidth:100,backgroundColor:r.default.backgroundSecondary,borderRadius:16,padding:16,alignItems:"center",shadowColor:r.default.backgroundSecondaryVarient,shadowOffset:{width:0,height:2},shadowOpacity:.05,shadowRadius:8,elevation:2},statIconContainer:{width:44,height:44,borderRadius:22,backgroundColor:r.default.backgroundPrimary,justifyContent:"center",alignItems:"center",marginBottom:12},statLabel:Object.assign({},n.Typography.caption(r.default.backgroundSecondary),{marginBottom:4}),statValue:Object.assign({},n.Typography.h2(r.default.accentPrimary)),tagsSection:{backgroundColor:r.default.backgroundSecondary,borderRadius:16,padding:20,marginBottom:20,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.05,shadowRadius:8,elevation:2},sectionHeader:{flexDirection:"row",alignItems:"center",gap:8,marginBottom:16},sectionTitle:Object.assign({},n.Typography.h2(r.default.backgroundPrimary)),tagsGrid:{flexDirection:"row",flexWrap:"wrap",gap:8},tagChip:{backgroundColor:r.default.backgroundPrimary,paddingHorizontal:16,paddingVertical:8,borderRadius:20},tagText:Object.assign({},n.Typography.label(r.default.backgroundSecondary)),editDetailsButton:{flexDirection:"row",alignItems:"center",justifyContent:"center",gap:8,backgroundColor:r.default.textPrimary,borderRadius:12,paddingVertical:14,paddingHorizontal:20,marginBottom:20,borderWidth:2,borderColor:r.default.backgroundPrimary},editDetailsText:Object.assign({},n.Typography.label(r.default.backgroundPrimary)),editSection:{backgroundColor:r.default.backgroundSecondary,borderRadius:16,padding:20,marginBottom:20,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.05,shadowRadius:8,elevation:2},editSectionTitle:Object.assign({},n.Typography.h2(r.default.textPrimary),{marginBottom:12}),ratingStars:{flexDirection:"row",gap:8},starButton:{padding:4},reviewInput:Object.assign({backgroundColor:r.default.backgroundPrimary,borderWidth:1,borderColor:r.default.accentPrimary,borderRadius:12,padding:16},n.Typography.body(r.default.textPrimary),{minHeight:120}),difficultyOptions:{flexDirection:"row",gap:8},difficultyChip:{flex:1,paddingVertical:12,paddingHorizontal:16,borderRadius:12,backgroundColor:r.default.backgroundPrimary,borderWidth:2,borderColor:r.default.accentPrimary,alignItems:"center"},difficultyChipSelected:{backgroundColor:r.default.backgroundPrimary,borderColor:r.default.backgroundPrimary},difficultyChipText:Object.assign({},n.Typography.label(r.default.backgroundSecondary)),difficultyChipTextSelected:{color:r.default.textPrimary},editTagChip:{paddingHorizontal:16,paddingVertical:8,borderRadius:20,backgroundColor:r.default.backgroundPrimary,borderWidth:1.5,borderColor:r.default.accentPrimary},editTagChipSelected:{backgroundColor:r.default.backgroundPrimary,borderColor:r.default.backgroundPrimary},editTagChipText:Object.assign({},n.Typography.label(r.default.backgroundSecondary)),editTagChipTextSelected:{color:r.default.textPrimary},editActionButtons:{flexDirection:"row",gap:12,marginTop:24},actionButton:{flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center",gap:8,paddingVertical:14,borderRadius:12},cancelActionButton:{backgroundColor:r.default.backgroundPrimary,borderWidth:2,borderColor:r.default.accentPrimary},cancelActionText:Object.assign({},n.Typography.label(r.default.textPrimary)),saveActionButton:{backgroundColor:r.default.backgroundPrimary},saveActionText:Object.assign({},n.Typography.label(r.default.textPrimary)),mapSection:{marginBottom:20},mapContainer:{height:260,borderRadius:16,overflow:"hidden",marginBottom:12,borderWidth:1,borderColor:r.default.accentPrimary},map:{width:"100%",height:"100%"},webMapPlaceholder:{justifyContent:"center",alignItems:"center",backgroundColor:r.default.accentPrimary},webMapText:Object.assign({marginTop:12},n.Typography.caption(r.default.backgroundSecondary)),directionsButton:{flexDirection:"row",alignItems:"center",justifyContent:"center",backgroundColor:r.default.backgroundPrimary,borderRadius:12,paddingVertical:16,paddingHorizontal:24,gap:10,shadowColor:r.default.backgroundPrimary,shadowOffset:{width:0,height:4},shadowOpacity:.3,shadowRadius:8,elevation:4},directionsButtonText:Object.assign({},n.Typography.label(r.default.textPrimary)),detailsSection:{backgroundColor:r.default.backgroundSecondary,borderRadius:16,padding:20,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.05,shadowRadius:8,elevation:2},detailsTitle:Object.assign({},n.Typography.h2(r.default.backgroundPrimary),{marginBottom:16}),detailRow:{flexDirection:"row",alignItems:"flex-start",paddingVertical:12,borderBottomWidth:1,borderBottomColor:r.default.backgroundPrimary},detailIcon:{width:36,height:36,borderRadius:18,backgroundColor:r.default.accentPrimary,justifyContent:"center",alignItems:"center",marginRight:12},detailContent:{flex:1},detailLabel:Object.assign({},n.Typography.caption(r.default.backgroundSecondary),{marginBottom:2}),detailValue:Object.assign({},n.Typography.body(r.default.backgroundPrimary)),startButton:{flex:1,backgroundColor:r.default.accentPrimary,borderRadius:16,paddingVertical:18,alignItems:"center",justifyContent:"center",shadowColor:"#000",shadowOffset:{width:0,height:6},shadowOpacity:.16,shadowRadius:12,elevation:6},startButtonText:Object.assign({},n.Typography.h2(r.default.backgroundPrimary)),reviewsCard:{width:140,backgroundColor:r.default.backgroundSecondary,borderRadius:16,padding:16,alignItems:"center",justifyContent:"center"},reviewsTitle:Object.assign({},n.Typography.label(r.default.backgroundSecondary),{marginBottom:8}),reviewStars:{flexDirection:"row",gap:6},mapModal:{flex:1,backgroundColor:r.default.backgroundPrimary},mapModalHeader:{height:64,paddingHorizontal:16,justifyContent:"center"},mapModalClose:{width:44,height:44,borderRadius:22,justifyContent:"center",alignItems:"center",backgroundColor:"transparent"},fullscreenMapContainer:{flex:1,backgroundColor:r.default.borderSubtle},fullscreenMap:{width:"100%",height:"100%"},mapModalFooter:{padding:16,backgroundColor:r.default.backgroundPrimary},beginNavButton:{backgroundColor:r.default.accentPrimary,borderRadius:16,paddingVertical:14,alignItems:"center"},beginNavText:Object.assign({},n.Typography.h2(r.default.backgroundPrimary))})},3686(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>W});var o=a(6665),r=a(3929),n=a(530),i=a(5648),l=a(6773),s=a(1690),d=a(9632),c=a(5009),u=a(3041),f=a(9637),g=a(5894),y=a(7430),h=a(8136),p=a(4686),m=a(5427),b=a(5395),x=a(2994),j=a(4164),T=a(9281),w=a(6508),C=a(4494),k=a(1168),P=a(8032),I=a(8948),S=a(5082),v=a(8360),O=a(477),B=a(2964),E=a(262),_=a(4866),A=a(3185),L=a(893),D=a(6746),R=a(3353),z=a(9269),F=a(9582),N=a(8833),U=a(8776),M=(a(2291),a(397));const V=["Forest","Urban","Beach","Mountain","Rural","Park","Shaded","Sunny","Crowded","Quiet","Paved","Trail"],G=["Easy","Moderate","Hard"];function W(){const{id:e}=(0,f.useLocalSearchParams)(),{user:t}=(0,R.useAuth)(),{getTrailById:a,updateTrailName:W,updateTrailPhoto:H,updateTrailDetails:$,getTrailWithUser:q}=(0,D.useTrails)(),[X,J]=(0,o.useState)(void 0),[K,Y]=(0,o.useState)(!0),[Z,Q]=(0,o.useState)(!1),[ee,te]=(0,o.useState)(""),[ae,oe]=(0,o.useState)(!1),[re,ne]=(0,o.useState)(0),[ie,le]=(0,o.useState)(""),[se,de]=(0,o.useState)([]),[ce,ue]=(0,o.useState)(""),[fe,ge]=(0,o.useState)(""),[ye,he]=(0,o.useState)(!1),pe=((0,o.useRef)(null),(0,o.useRef)(new c.default.Value(0)).current),me=(0,N.useSafeAreaInsets)(),be=({IconComponent:e,emoji:t,size:a=18,color:o})=>{const r=e;return(0,M.jsx)(r,{size:a,color:o})},[xe,je]=(0,o.useState)(!1);(0,o.useEffect)(()=>{Te()},[e]);const Te=async()=>{if("string"===typeof e){Y(!0);try{const t=a(e);if(t)J(t),te(t.name||""),ne(t.rating||0),le(t.review||""),de(t.environment_tags||[]),ue(t.difficulty||""),ge(t.name||"");else{const t=await q(e);t&&(J(t),te(t.name||""),ne(t.rating||0),le(t.review||""),de(t.environment_tags||[]),ue(t.difficulty||""),ge(t.name||""))}}catch(t){console.error("Error loading trail:",t)}finally{Y(!1)}}else Y(!1)},we=()=>{_.impactAsync(A.ImpactFeedbackStyle.Light),(async()=>{if(X)try{if(!(await E.requestMediaLibraryPermissionsAsync()).granted)return void s.default.alert("Permission Required","Please allow access to your photo library");const e=await E.launchImageLibraryAsync({mediaTypes:["images"],allowsEditing:!0,aspect:[16,9],quality:.8,base64:!0});if(!e.canceled&&e.assets[0]){he(!0);const t=`data:image/jpeg;base64,${e.assets[0].base64}`;await H(X.id,t),J(Object.assign({},X,{photo:t})),s.default.alert("Success","Photo uploaded successfully!"),he(!1)}}catch(e){console.error("Photo upload error:",e),s.default.alert("Error","Failed to upload photo"),he(!1)}})()};if(K)return(0,M.jsxs)(r.default,{style:U.default.loadingContainer,children:[(0,M.jsx)(n.default,{size:"large",color:F.default.backgroundPrimary}),(0,M.jsx)(u.Text,{style:U.default.loadingText,children:"Loading trail..."})]});if(!X)return(0,M.jsxs)(r.default,{style:U.default.loadingContainer,children:[(0,M.jsx)(k.default,{size:64,color:"#9ca3af"}),(0,M.jsx)(u.Text,{style:U.default.loadingText,children:"Trail not found"})]});const Ce=X.coordinates??[],ke=Ce.length>0?{latitude:Ce[0].latitude,longitude:Ce[0].longitude,latitudeDelta:.01,longitudeDelta:.01}:void 0,Pe=X.user_id===t?.id;return(0,M.jsxs)(r.default,{style:[U.default.container,{paddingTop:me.top+70,paddingBottom:Math.max(16,me.bottom),paddingHorizontal:16+(me.left||0)}],children:[!1,(0,M.jsxs)(r.default,{style:[U.default.headerButtons,{top:me.top+12}],children:[(0,M.jsx)(i.default,{style:U.default.headerButton,onPress:()=>{_.impactAsync(A.ImpactFeedbackStyle.Light),f.router.back()},children:(0,M.jsx)(b.default,{size:24})}),(0,M.jsxs)(r.default,{style:U.default.headerRightButtons,children:[(0,M.jsx)(i.default,{style:U.default.headerButton,onPress:()=>{_.impactAsync(A.ImpactFeedbackStyle.Light),s.default.alert("Share","Share functionality coming soon!")},children:(0,M.jsx)(I.default,{size:22})}),(0,M.jsx)(i.default,{style:U.default.headerButton,onPress:()=>{_.impactAsync(A.ImpactFeedbackStyle.Light),je(!xe)},children:(0,M.jsx)(x.default,{size:22,fill:xe?F.default.textPrimary:"none"})}),(0,M.jsx)(i.default,{style:U.default.headerButton,onPress:()=>{_.impactAsync(A.ImpactFeedbackStyle.Light),s.default.alert("Options","Mark as completed option coming soon!")},children:(0,M.jsx)(h.default,{size:22})})]})]}),(0,M.jsxs)(c.default.ScrollView,{style:U.default.scrollContainer,contentContainerStyle:U.default.scrollContent,onScroll:c.default.event([{nativeEvent:{contentOffset:{y:pe}}}],{useNativeDriver:!1}),scrollEventThrottle:16,children:[(0,M.jsx)(r.default,{style:U.default.heroSection,children:X.photo?(0,M.jsxs)(r.default,{style:U.default.heroImageContainer,children:[(0,M.jsx)(g.Image,{source:{uri:X.photo},style:U.default.heroImage,contentFit:"cover",cachePolicy:"memory-disk"}),(0,M.jsx)(L.LinearGradient,{colors:["rgba(0,0,0,0)","rgba(0,0,0,0.3)"],style:U.default.heroGradient}),Pe&&(0,M.jsx)(i.default,{style:U.default.changePhotoFab,onPress:we,disabled:ye,children:ye?(0,M.jsx)(n.default,{color:F.default.textPrimary,size:"small"}):(0,M.jsx)(T.default,{size:20,color:F.default.textPrimary})})]}):Pe&&(0,M.jsx)(i.default,{style:U.default.addPhotoContainer,onPress:we,disabled:ye,children:ye?(0,M.jsx)(n.default,{size:"large",color:F.default.backgroundPrimary}):(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(r.default,{style:U.default.addPhotoIcon,children:(0,M.jsx)(T.default,{size:32,color:F.default.backgroundPrimary})}),(0,M.jsx)(u.Text,{style:U.default.addPhotoText,children:"Add a photo"}),(0,M.jsx)(u.Text,{style:U.default.addPhotoSubtext,children:"Make your trail memorable"})]})})}),(0,M.jsx)(r.default,{style:U.default.contentWrapper,children:(0,M.jsxs)(r.default,{style:U.default.content,children:[(0,M.jsxs)(r.default,{style:U.default.titleSection,children:[(0,M.jsxs)(r.default,{style:U.default.dateRow,children:[(0,M.jsx)(be,{IconComponent:j.default,emoji:"\ud83d\udcc5",size:16,color:F.default.accentPrimary}),(0,M.jsx)(u.Text,{style:U.default.dateText,children:new Date(X.createdAt??X.date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),Pe&&Z?(0,M.jsxs)(r.default,{style:U.default.nameEditContainer,children:[(0,M.jsx)(l.default,{style:U.default.nameInput,value:ee,onChangeText:te,placeholder:"Enter trail name",autoFocus:!0,placeholderTextColor:"#9ca3af"}),(0,M.jsxs)(r.default,{style:U.default.editButtons,children:[(0,M.jsx)(i.default,{style:[U.default.iconButton,U.default.saveIconButton],onPress:async()=>{if(X&&ee.trim())try{await W(X.id,ee.trim()),J(Object.assign({},X,{name:ee.trim()})),Q(!1)}catch{s.default.alert("Error","Failed to update trail name. Please try again.")}else Q(!1)},children:(0,M.jsx)(w.default,{size:18,color:"#fff"})}),(0,M.jsx)(i.default,{style:[U.default.iconButton,U.default.cancelIconButton],onPress:()=>{te(X?.name||""),Q(!1)},children:(0,M.jsx)(B.default,{size:18,color:F.default.textPrimary})})]})]}):(0,M.jsx)(r.default,{style:U.default.titleRow,children:(0,M.jsx)(u.Text,{style:U.default.title,children:X.name||`Trail ${new Date(X.createdAt??X.date).toLocaleDateString()}`})}),(0,M.jsxs)(r.default,{style:U.default.authorRow,children:[t?.name?(0,M.jsx)(r.default,{style:U.default.avatar,children:(0,M.jsx)(u.Text,{style:U.default.avatarText,children:t.name.split(" ").map(e=>e[0]).slice(0,2).join("")})}):(0,M.jsx)(r.default,{style:U.default.avatar}),(0,M.jsx)(u.Text,{style:U.default.authorName,children:t?.name||"John Snow"})]}),X.city&&(0,M.jsxs)(r.default,{style:U.default.locationRow,children:[(0,M.jsx)(k.default,{size:16,color:F.default.textPrimary}),(0,M.jsxs)(u.Text,{style:U.default.location,children:[X.city,", ",X.country||"Unknown"]})]}),X.rating&&!ae&&(0,M.jsx)(r.default,{style:U.default.ratingRow,children:[1,2,3,4,5].map(e=>(0,M.jsx)(S.default,{size:18,color:e<=X.rating?"#f59e0b":"#d1d5db",fill:e<=X.rating?"#f59e0b":"none"},e))})]}),X.review&&!ae&&(0,M.jsx)(r.default,{style:U.default.reviewCard,children:(0,M.jsx)(u.Text,{style:U.default.reviewText,children:X.review})}),(0,M.jsxs)(r.default,{style:U.default.statsSection,children:[(0,M.jsxs)(r.default,{style:U.default.statCard,children:[(0,M.jsx)(r.default,{style:U.default.statIconContainer,children:(0,M.jsx)(k.default,{size:20,color:F.default.textPrimary,strokeWidth:2.5})}),(0,M.jsx)(u.Text,{style:U.default.statLabel,children:"Distance"}),(0,M.jsx)(u.Text,{style:U.default.statValue,children:(0,z.formatDistance)(X.distance)})]}),(0,M.jsxs)(r.default,{style:U.default.statCard,children:[(0,M.jsx)(r.default,{style:U.default.statIconContainer,children:(0,M.jsx)(C.default,{size:20,color:F.default.textPrimary,strokeWidth:2.5})}),(0,M.jsx)(u.Text,{style:U.default.statLabel,children:"Duration"}),(0,M.jsx)(u.Text,{style:U.default.statValue,children:(0,z.formatDuration)(X.duration)})]}),X.difficulty&&(0,M.jsxs)(r.default,{style:U.default.statCard,children:[(0,M.jsx)(r.default,{style:U.default.statIconContainer,children:(0,M.jsx)(be,{IconComponent:O.default,emoji:"\u26f0\ufe0f",size:20,color:F.default.textPrimary})}),(0,M.jsx)(u.Text,{style:U.default.statLabel,children:"Difficulty"}),(0,M.jsx)(u.Text,{style:U.default.statValue,children:X.difficulty})]})]}),X.environment_tags&&X.environment_tags.length>0&&!ae&&(0,M.jsxs)(r.default,{style:U.default.tagsSection,children:[(0,M.jsxs)(r.default,{style:U.default.sectionHeader,children:[(0,M.jsx)(be,{IconComponent:v.default,emoji:"\ud83c\udff7\ufe0f",size:18,color:F.default.textPrimary}),(0,M.jsx)(u.Text,{style:U.default.sectionTitle,children:"Environment"})]}),(0,M.jsx)(r.default,{style:U.default.tagsGrid,children:X.environment_tags.map((e,t)=>(0,M.jsx)(r.default,{style:U.default.tagChip,children:(0,M.jsx)(u.Text,{style:U.default.tagText,children:e})},t))})]}),Pe&&!ae&&(0,M.jsxs)(i.default,{style:U.default.editDetailsButton,onPress:()=>{_.impactAsync(A.ImpactFeedbackStyle.Light),oe(!0)},children:[(0,M.jsx)(p.default,{size:18,color:F.default.backgroundPrimary}),(0,M.jsx)(u.Text,{style:U.default.editDetailsText,children:"Edit Trail Details"})]}),Pe&&ae&&(0,M.jsxs)(r.default,{style:U.default.editSection,children:[(0,M.jsx)(u.Text,{style:U.default.editSectionTitle,children:"Trail Name"}),(0,M.jsx)(l.default,{style:U.default.nameInputInDetails,value:fe,onChangeText:ge,placeholder:"Enter trail name",placeholderTextColor:"#9ca3af"}),(0,M.jsx)(u.Text,{style:[U.default.editSectionTitle,{marginTop:24}],children:"Rating"}),(0,M.jsx)(r.default,{style:U.default.ratingStars,children:[1,2,3,4,5].map(e=>(0,M.jsx)(i.default,{onPress:()=>{_.impactAsync(A.ImpactFeedbackStyle.Light),ne(e)},style:U.default.starButton,children:(0,M.jsx)(S.default,{size:32,color:e<=re?"#f59e0b":"#d1d5db",fill:e<=re?"#f59e0b":"none"})},e))}),(0,M.jsx)(u.Text,{style:[U.default.editSectionTitle,{marginTop:24}],children:"Review"}),(0,M.jsx)(l.default,{style:U.default.reviewInput,value:ie,onChangeText:le,placeholder:"Share your experience on this trail...",placeholderTextColor:"#9ca3af",multiline:!0,numberOfLines:4,textAlignVertical:"top"}),(0,M.jsx)(u.Text,{style:[U.default.editSectionTitle,{marginTop:24}],children:"Difficulty"}),(0,M.jsx)(r.default,{style:U.default.difficultyOptions,children:G.map(e=>(0,M.jsx)(i.default,{style:[U.default.difficultyChip,ce===e&&U.default.difficultyChipSelected],onPress:()=>{_.impactAsync(A.ImpactFeedbackStyle.Light),ue(e)},children:(0,M.jsx)(u.Text,{style:[U.default.difficultyChipText,ce===e&&U.default.difficultyChipTextSelected],children:e})},e))}),(0,M.jsx)(u.Text,{style:[U.default.editSectionTitle,{marginTop:24}],children:"Environment Tags"}),(0,M.jsx)(r.default,{style:U.default.tagsGrid,children:V.map(e=>(0,M.jsx)(i.default,{style:[U.default.editTagChip,se.includes(e)&&U.default.editTagChipSelected],onPress:()=>(e=>{_.impactAsync(A.ImpactFeedbackStyle.Light),de(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e),children:(0,M.jsx)(u.Text,{style:[U.default.editTagChipText,se.includes(e)&&U.default.editTagChipTextSelected],children:e})},e))}),(0,M.jsxs)(r.default,{style:U.default.editActionButtons,children:[(0,M.jsxs)(i.default,{style:[U.default.actionButton,U.default.cancelActionButton],onPress:()=>{ne(X?.rating||0),le(X?.review||""),de(X?.environment_tags||[]),ue(X?.difficulty||""),ge(X?.name||""),oe(!1)},children:[(0,M.jsx)(B.default,{size:20,color:F.default.textPrimary}),(0,M.jsx)(u.Text,{style:U.default.cancelActionText,children:"Cancel"})]}),(0,M.jsxs)(i.default,{style:[U.default.actionButton,U.default.saveActionButton],onPress:async()=>{if(X)try{fe.trim()!==X.name&&await W(X.id,fe.trim()),await $(X.id,{rating:re>0?re:void 0,review:ie.trim()||void 0,environment_tags:se.length>0?se:void 0,difficulty:ce||void 0}),J(Object.assign({},X,{name:fe.trim(),rating:re>0?re:void 0,review:ie.trim()||void 0,environment_tags:se.length>0?se:void 0,difficulty:ce||void 0})),te(fe.trim()),oe(!1),s.default.alert("Success","Trail details updated!")}catch{s.default.alert("Error","Failed to update trail details. Please try again.")}},children:[(0,M.jsx)(w.default,{size:20,color:"#fff"}),(0,M.jsx)(u.Text,{style:U.default.saveActionText,children:"Save"})]})]})]}),(0,M.jsxs)(r.default,{style:U.default.mapSection,children:[(0,M.jsxs)(r.default,{style:U.default.sectionHeader,children:[(0,M.jsx)(be,{IconComponent:P.default,emoji:"\ud83e\udded",size:18,color:F.default.textPrimary}),(0,M.jsx)(u.Text,{style:U.default.sectionTitle,children:"Route Map"})]}),(0,M.jsx)(r.default,{style:U.default.mapContainer,children:(0,M.jsx)(y.default,{coordinates:Ce,style:U.default.map,initialRegion:ke||void 0,scrollEnabled:!1,zoomEnabled:!1})}),(0,M.jsxs)(i.default,{style:U.default.directionsButton,onPress:()=>{if(_.impactAsync(A.ImpactFeedbackStyle.Medium),!X||0===(X.coordinates?.length??0))return void s.default.alert("Error","Location not available for this trail");const e=X.coordinates[0].latitude,t=X.coordinates[0].longitude,a=(X.name,`https://www.google.com/maps/search/?api=1&query=${e},${t}`);d.default.canOpenURL(a).then(e=>{e?d.default.openURL(a):s.default.alert("Error","Unable to open maps application")})},children:[(0,M.jsx)(be,{IconComponent:P.default,emoji:"\ud83e\udded",size:18,color:"#fff"}),(0,M.jsx)(u.Text,{style:U.default.directionsButtonText,children:"Get Directions"})]}),(0,M.jsx)(r.default,{style:{height:16}}),(0,M.jsxs)(r.default,{style:{flexDirection:"row",gap:12,marginBottom:20},children:[(0,M.jsx)(i.default,{style:U.default.startButton,onPress:()=>{_.impactAsync(A.ImpactFeedbackStyle.Light),f.router.push(`/(tabs)/record?trailId=${X.id}`)},children:(0,M.jsx)(u.Text,{style:U.default.startButtonText,children:"Start Trail"})}),(0,M.jsxs)(r.default,{style:U.default.reviewsCard,children:[(0,M.jsx)(u.Text,{style:U.default.reviewsTitle,children:"Reviews"}),(0,M.jsx)(r.default,{style:U.default.reviewStars,children:[1,2,3,4,5].map(e=>(0,M.jsx)(S.default,{size:20,color:e<=(X.rating||0)?"#f59e0b":"#374151"},e))})]})]})]}),(0,M.jsxs)(r.default,{children:[(0,M.jsx)(u.Text,{style:U.default.detailsTitle,children:"Additional Details"}),void 0!==X.maxElevation&&(0,M.jsxs)(r.default,{style:U.default.detailRow,children:[(0,M.jsx)(r.default,{style:U.default.detailIcon,children:(0,M.jsx)(be,{IconComponent:O.default,emoji:"\u26f0\ufe0f",size:18,color:F.default.backgroundPrimary})}),(0,M.jsxs)(r.default,{style:U.default.detailContent,children:[(0,M.jsx)(u.Text,{style:U.default.detailLabel,children:"Elevation Gain"}),(0,M.jsxs)(u.Text,{style:U.default.detailValue,children:[X.maxElevation,"m"]})]})]}),X.pace&&(0,M.jsxs)(r.default,{style:U.default.detailRow,children:[(0,M.jsx)(r.default,{style:U.default.detailIcon,children:(0,M.jsx)(be,{IconComponent:m.default,emoji:"\ud83c\udfc3",size:18,color:F.default.backgroundPrimary})}),(0,M.jsxs)(r.default,{style:U.default.detailContent,children:[(0,M.jsx)(u.Text,{style:U.default.detailLabel,children:"Pace"}),(0,M.jsxs)(u.Text,{style:U.default.detailValue,children:[X.pace," /km"]})]})]}),X.speed&&(0,M.jsxs)(r.default,{style:U.default.detailRow,children:[(0,M.jsx)(r.default,{style:U.default.detailIcon,children:(0,M.jsx)(be,{IconComponent:m.default,emoji:"\u26a1",size:18,color:F.default.backgroundPrimary})}),(0,M.jsxs)(r.default,{style:U.default.detailContent,children:[(0,M.jsx)(u.Text,{style:U.default.detailLabel,children:"Max Speed"}),(0,M.jsxs)(u.Text,{style:U.default.detailValue,children:[X.speed.toFixed(1)," km/h"]})]})]}),(0,M.jsxs)(r.default,{style:U.default.detailRow,children:[(0,M.jsx)(r.default,{style:U.default.detailIcon,children:(0,M.jsx)(be,{IconComponent:j.default,emoji:"\ud83d\udcc5",size:18,color:F.default.backgroundPrimary})}),(0,M.jsxs)(r.default,{style:U.default.detailContent,children:[(0,M.jsx)(u.Text,{style:U.default.detailLabel,children:"Date & Time"}),(0,M.jsx)(u.Text,{style:U.default.detailValue,children:new Date(X.createdAt??X.date).toLocaleString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})})]})]})]})]})})]})]})}},2399(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>m});a(6665);var o=a(3668),r=a(3929),n=a(932),i=a(5648),l=a(530),s=a(3041),d=a(2291),c=a(9582),u=a(9637),f=a(4494),g=a(1168),y=a(6746),h=a(9269),p=a(397);function m(){const e=(0,u.useRouter)(),{trails:t,isLoading:a}=(0,y.useTrails)();return a?(0,p.jsx)(r.default,{style:b.loadingContainer,children:(0,p.jsx)(l.default,{size:"large",color:"#2563eb"})}):(0,p.jsx)(r.default,{style:b.container,children:(0,p.jsx)(n.default,{data:t,renderItem:({item:t})=>(0,p.jsx)(i.default,{style:b.trailItem,onPress:()=>e.push(`/trail/${t.id}`),children:(0,p.jsxs)(r.default,{style:b.trailHeader,children:[(0,p.jsx)(r.default,{style:b.iconContainer,children:(0,p.jsx)(g.default,{size:24,color:c.default.backgroundPrimary})}),(0,p.jsxs)(r.default,{style:b.trailInfo,children:[(0,p.jsx)(s.Text,{style:b.trailDate,children:(0,h.formatDate)(t.date)}),(0,p.jsxs)(r.default,{style:b.statsRow,children:[(0,p.jsxs)(r.default,{style:b.statItem,children:[(0,p.jsx)(g.default,{size:16,color:c.default.textMuted}),(0,p.jsx)(s.Text,{style:b.statText,children:(0,h.formatDistance)(t.distance)})]}),(0,p.jsxs)(r.default,{style:b.statItem,children:[(0,p.jsx)(f.default,{size:16,color:c.default.textMuted}),(0,p.jsx)(s.Text,{style:b.statText,children:(0,h.formatDuration)(t.duration)})]})]})]})]})}),keyExtractor:e=>e.id,contentContainerStyle:0===t.length?b.emptyList:b.list,ListEmptyComponent:()=>(0,p.jsxs)(r.default,{style:b.emptyContainer,children:[(0,p.jsx)(g.default,{size:64,color:c.default.borderSubtle}),(0,p.jsx)(s.Text,{style:b.emptyTitle,children:"No trails yet"}),(0,p.jsx)(s.Text,{style:b.emptyText,children:"Start recording your first dog walk to see it here!"})]})})})}const b=o.default.create({container:{flex:1,backgroundColor:c.default.backgroundSecondary},list:{padding:16,gap:12},emptyList:{flex:1},loadingContainer:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:c.default.backgroundSecondary},trailItem:{backgroundColor:c.default.textPrimary,borderRadius:16,padding:16,marginBottom:12,shadowColor:c.default.backgroundSecondaryVarient,shadowOffset:{width:0,height:2},shadowOpacity:.05,shadowRadius:8,elevation:2},trailHeader:{flexDirection:"row",alignItems:"center",gap:12},iconContainer:{width:48,height:48,borderRadius:24,backgroundColor:c.default.backgroundSecondary,justifyContent:"center",alignItems:"center"},trailInfo:{flex:1},trailDate:Object.assign({},d.Typography.body(c.default.textPrimary),{marginBottom:6}),statsRow:{flexDirection:"row",gap:16},statItem:{flexDirection:"row",alignItems:"center",gap:6},statText:Object.assign({},d.Typography.label(c.default.textMuted)),emptyContainer:{flex:1,justifyContent:"center",alignItems:"center",padding:32},emptyTitle:Object.assign({},d.Typography.h2("#1f2937"),{marginTop:16,marginBottom:8}),emptyText:Object.assign({},d.Typography.body(c.default.textMuted),{textAlign:"center",lineHeight:24})})},9857(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>s});a(6665);var o=a(3929),r=a(530),n=a(3668),i=(a(8627),a(9582)),l=a(397);function s({size:e=200}){return(0,l.jsx)(o.default,{style:d.center,children:(0,l.jsx)(r.default,{size:"large",color:"#2563eb"})})}const d=n.default.create({center:{flex:1,justifyContent:"center",alignItems:"center",backgroundColor:i.default.backgroundPrimary}})},7430(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>c});var o=a(6665),r=a(3929),n=a(3668),i=a(9582);const l=n.default.create({container:{backgroundColor:i.default.backgroundSecondary,overflow:"hidden"}});var s=a(7042),d=(a(1051),a(397));const c=(0,o.forwardRef)(({coordinates:e,style:t,initialRegion:a,scrollEnabled:n=!0,zoomEnabled:i=!0},c)=>{const u=(0,o.useRef)(null),f=(0,o.useRef)(null);return(0,o.useImperativeHandle)(c,()=>({animateToRegion:(e,t=500)=>{f.current&&f.current.easeTo({center:[e.longitude,e.latitude],zoom:14,duration:t})},fitToCoordinates:(e,t={})=>{if(f.current&&e.length>0){const a=new s.LngLatBounds;e.forEach(e=>a.extend([e.longitude,e.latitude])),f.current.fitBounds(a,{padding:t.edgePadding||20})}}})),(0,o.useEffect)(()=>{if(!u.current)return;const t=a?[a.longitude,a.latitude]:e.length>0?[e[0].longitude,e[0].latitude]:[0,0],o=a?14:12,r=new s.Map({container:u.current,style:"https://api.tailtrails.club/map/style.json",center:t,zoom:o,interactive:n&&i});return f.current=r,r.on("load",()=>{if(e.length>1){r.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:e.map(e=>[e.longitude,e.latitude])}}}),r.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#5d6b4a","line-width":4}});const t=new s.LngLatBounds;e.forEach(e=>t.extend([e.longitude,e.latitude])),r.fitBounds(t,{padding:20})}}),()=>{r.remove()}},[e,a,n,i]),(0,d.jsx)(r.default,{style:[t,l.container],children:(0,d.jsx)("div",{ref:u,style:{width:"100%",height:"100%"}})})})},9600(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>f});var o=a(6665),r=a(6283),n=a(3929),i=a(3668),l=a(9582),s=a(2291);const d=i.default.create({container:{overflow:"hidden",borderRadius:12,backgroundColor:l.default.backgroundSecondary},map:{width:"100%",height:"100%"},placeholder:{justifyContent:"center",alignItems:"center",padding:12},text:Object.assign({},s.Typography.body(l.default.backgroundPrimary),{fontWeight:"700"}),subtext:Object.assign({},s.Typography.caption(l.default.textMuted),{marginTop:4})});var c=a(7042),u=(a(1051),a(397));function f({coordinates:e,path:t,style:a,height:i=260,startLatitude:l=null,startLongitude:s=null}){const f=(0,o.useRef)(null),g=(0,o.useRef)(null),y=(0,o.useRef)(null),h=e&&e.length>0?e:Array.isArray(t)?t.map(e=>({latitude:e[1],longitude:e[0]})):[];return(0,o.useEffect)(()=>{if(!f.current)return;const e=null!=l&&null!=s?[s,l]:h.length>0?[h[0].longitude,h[0].latitude]:[0,0],t=new c.Map({container:f.current,style:"https://api.tailtrails.club/map/style.json",center:e,zoom:h.length>0?12:1,interactive:!1});return g.current=t,t.on("load",()=>{if(h&&h.length>1){const e={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:h.map(e=>[e.longitude,e.latitude])}};t.getSource("preview-route")?t.getSource("preview-route").setData(e):(t.addSource("preview-route",{type:"geojson",data:e}),t.addLayer({id:"preview-route",type:"line",source:"preview-route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#5d6b4a","line-width":3}}));const a=new c.LngLatBounds;h.forEach(e=>a.extend([e.longitude,e.latitude])),t.fitBounds(a,{padding:10,maxZoom:16})}else if(h&&1===h.length){const e=h[0];if(y.current)y.current.setLngLat([e.longitude,e.latitude]);else{const a=new c.Marker({color:"#5d6b4a"}).setLngLat([e.longitude,e.latitude]).addTo(t);y.current=a}t.setCenter([e.longitude,e.latitude]),t.setZoom(14)}}),()=>{try{t.remove()}catch(e){}g.current=null,y.current=null}},[JSON.stringify(h),l,s]),(0,u.jsx)(n.default,{style:[d.container,a],children:h&&h.length>0?(0,u.jsx)("div",{ref:f,style:{width:"100%",height:"number"===typeof i?`${i}px`:i}}):(0,u.jsxs)(n.default,{style:d.placeholder,children:[(0,u.jsx)(r.default,{style:d.text,children:"Map Preview (Web)"}),(0,u.jsxs)(r.default,{style:d.subtext,children:[h?.length||0," points recorded"]})]})})}},3041(e,t,a){"use strict";a.r(t),a.d(t,{Text:()=>d});var o=a(8587),r=(a(6665),a(6283)),n=a(3668),i=a(397);const l=["style","children"],s=n.default.create({defaultStyle:Object.assign({},void 0)}),d=e=>{let{style:t,children:a}=e,n=(0,o.default)(e,l);return(0,i.jsx)(r.default,Object.assign({},n,{style:[s.defaultStyle,t],children:a}))}},9582(e,t,a){"use strict";a.r(t),a.d(t,{default:()=>n,theme:()=>r});const o={backgroundPrimary:"#191E07",backgroundSecondary:"#272F0A",backgroundSecondaryVarient:"#3E481B",accentPrimary:"#FFFE77",accentSecondary:"#D4FF5E",textPrimary:"#FFFFFF",textSecondary:"#BEC056",textMuted:"#A0A883",borderSubtle:"#343A20"},r=o,n=o},2291(e,t,a){"use strict";a.r(t),a.d(t,{Typography:()=>r});const o=(e,t,a)=>Object.assign({fontSize:e,color:a},void 0),r={h1:e=>o(32,0,e),h2:e=>o(24,0,e),body:e=>o(16,0,e),label:e=>o(14,0,e),button:e=>o(16,0,e),caption:e=>o(12,0,e)}},2598(e,t,a){"use strict";a.r(t),a.d(t,{AccountContext:()=>l,useAccount:()=>s});var o=a(6665),r=a(2790),n=a(3353),i=a(5938);const[l,s]=(0,r.default)(()=>{const{user:e,session:t}=(0,n.useAuth)(),[a,r]=(0,o.useState)(null),[l,s]=(0,o.useState)(!0),d=(0,o.useCallback)(async()=>{if(t?.accessToken){s(!0);try{const e=await fetch(`${i.API_URL}/account/me`,{headers:{Authorization:`Bearer ${t.accessToken}`}});if(e.ok){const t=await e.json();r(t)}else console.error("Failed to fetch account:",e.status),r(null)}catch(e){console.error("Error fetching account:",e),r(null)}finally{s(!1)}}},[t?.accessToken]),c=(0,o.useCallback)(async e=>{if(!t?.accessToken)throw new Error("No active session");try{const a=await fetch(`${i.API_URL}/account/me`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.accessToken}`},body:JSON.stringify(e)});if(!a.ok){const e=await a.json();throw new Error(e.detail?.[0]?.msg||"Failed to update account")}const o=await a.json();return r(o),o}catch(a){throw console.error("Error updating account:",a),a}},[t?.accessToken]),u=(0,o.useCallback)(async()=>{if(!t?.accessToken)throw new Error("No active session");try{const e=await fetch(`${i.API_URL}/account/me`,{method:"DELETE",headers:{Authorization:`Bearer ${t.accessToken}`}});if(!e.ok){const t=await e.json();throw new Error(t.detail?.[0]?.msg||"Failed to delete account")}return r(null),!0}catch(e){throw console.error("Error deleting account:",e),e}},[t?.accessToken]);return(0,o.useEffect)(()=>{t?.accessToken?d():(r(null),s(!1))},[t?.accessToken,d]),(0,o.useMemo)(()=>({userProfile:a,isLoading:l,refreshAccount:d,updateAccount:c,deleteAccount:u}),[a,l,d,c,u])})},3353(e,t,a){"use strict";a.r(t),a.d(t,{AuthContext:()=>l,useAuth:()=>s});var o=a(6665),r=a(2790),n=a(5259),i=a(5938);const[l,s]=(0,r.default)(()=>{const[e,t]=(0,o.useState)(null),[a,r]=(0,o.useState)(null),[l,s]=(0,o.useState)(!0);(0,o.useEffect)(()=>{(async()=>{try{const e=await n.default.getItem("session");if(e){const a=JSON.parse(e);t(a),r(a.user)}}catch(e){console.error("Error loading session:",e)}finally{s(!1)}})()},[]);const d=(0,o.useCallback)(async e=>{console.log("Requesting OTP for:",e);const t=await fetch(`${i.API_URL}/otp/request`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!t.ok){const e=await t.json();throw new Error(e.detail?.[0]?.msg||"Failed to request OTP")}return!0},[]),c=(0,o.useCallback)(async(e,a)=>{console.log("Verifying OTP for:",e);const o=await fetch(`${i.API_URL}/otp/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,otpCode:a})});if(!o.ok){const e=await o.json();throw new Error(e.detail?.[0]?.msg||"Invalid OTP code")}const l=await o.json();return t(l),r(l.user),await n.default.setItem("session",JSON.stringify(l)),l},[]),u=(0,o.useCallback)(async(e,t)=>{console.log("Requesting registration for:",e);const a=await fetch(`${i.API_URL}/otp/register-request`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,name:t})});if(!a.ok){const e=await a.json();throw new Error(e.detail?.[0]?.msg||"Failed to request registration")}return!0},[]),f=(0,o.useCallback)(async(e,a)=>{console.log("Verifying registration for:",e);const o=await fetch(`${i.API_URL}/otp/register-verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,otpCode:a})});if(!o.ok){const e=await o.json();throw new Error(e.detail?.[0]?.msg||"Invalid OTP code")}const l=await o.json();return t(l),r(l.user),await n.default.setItem("session",JSON.stringify(l)),l},[]),g=(0,o.useCallback)(async e=>{const o={accessToken:e.accessToken,tokenType:e.tokenType||"bearer",user:e.user||a};return t(o),r(o.user),await n.default.setItem("session",JSON.stringify(o)),o},[a]),y=(0,o.useCallback)(async()=>{console.log("Signing out user"),t(null),r(null),await n.default.removeItem("session")},[]);return(0,o.useMemo)(()=>({session:e,user:a,isLoading:l,requestOtp:d,verifyOtp:c,requestRegistration:u,verifyRegistration:f,signInWithToken:g,signOut:y,isAuthenticated:!!e}),[e,a,l,d,c,u,f,y])})},9908(e,t,a){"use strict";a.r(t),a.d(t,{DogsContext:()=>l,useDogs:()=>s});var o=a(6665),r=a(2790),n=a(3353),i=a(5938);const[l,s]=(0,r.default)(()=>{const{user:e,session:t,isLoading:a}=(0,n.useAuth)(),[r,l]=(0,o.useState)([]),[s,d]=(0,o.useState)(null),[c,u]=(0,o.useState)(!0),f=(0,o.useMemo)(()=>r.find(e=>e.id===s)||r[0]||null,[r,s]),g=(0,o.useCallback)(async(e,t)=>{console.log("Loading dog profiles for user:",e),u(!0);try{const e=await fetch(`${i.API_URL}/dog`,{headers:{Authorization:`Bearer ${t}`}});if(e.ok){const t=await e.json();Array.isArray(t)?(l(t),t.length>0&&!s&&d(t[0].id)):t&&"object"===typeof t?(l([t]),d(t.id)):l([])}else l([])}catch(a){console.error("Error loading dog profiles:",a),l([])}finally{u(!1)}},[s]),y=(0,o.useCallback)(async()=>{e&&t&&await g(e.id,t.accessToken)},[e,t,g]);(0,o.useEffect)(()=>{a||(e&&t?g(e.id,t.accessToken):(l([]),u(!1)))},[e,t,g,a]);const h=(0,o.useCallback)(async e=>{if(!t)throw new Error("No session");let a=Object.assign({},e);a.photo&&delete a.photo;const o="string"===typeof e.image&&e.image&&!e.image.startsWith("http");o&&(a.image=void 0),console.log("createDogProfile - payload to create:",a);const r=await fetch(`${i.API_URL}/dog`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.accessToken}`},body:JSON.stringify(a)});if(!r.ok){const e=await r.json();throw new Error(e.detail?.[0]?.msg||"Failed to create dog profile")}const n=await r.json();if(l(e=>[...e,n]),d(n.id),o&&"string"===typeof e.image)try{const a=e.image,o=a.split("/"),r=o[o.length-1]||`dog_${Date.now()}.jpg`,s=r.match(/\.([a-zA-Z0-9]+)(?:\?.*)?$/),d="png"===(s?s[1].toLowerCase():"jpg")?"image/png":"image/jpeg",c=new FormData;c.append("file",{uri:a,name:r,type:d}),c.append("filename",r),c.append("dog_id",n.id),c.append("trail_id",""),c.append("user_id","");const u=await fetch(`${i.API_URL}/uploads`,{method:"POST",headers:{Authorization:`Bearer ${t.accessToken}`,accept:"application/json"},body:c});if(u.ok){const e=await u.json(),a=e.public_url||e.publicUrl||e.url;if(a){const e=await fetch(`${i.API_URL}/dog/${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.accessToken}`},body:JSON.stringify(Object.assign({},n,{image:a}))});if(e.ok){const t=await e.json();l(e=>e.map(e=>e.id===t.id?t:e))}else console.error("Failed to patch dog with uploaded image")}}else console.error("Dog image upload failed during create:",await u.text())}catch(s){console.error("Error uploading dog photo after create:",s)}return n},[t]),p=(0,o.useCallback)(async e=>{if(!t)throw new Error("No session");if(!e.id)throw new Error("Dog ID is required for update");console.log("updateDogProfile - incoming profile:",e);let a=Object.assign({},e);if(a.photo&&delete a.photo,"string"===typeof e.image&&e.image&&!e.image.startsWith("http"))try{const o=e.image,r=o.split("/"),n=r[r.length-1]||`dog_${Date.now()}.jpg`,l=n.match(/\.([a-zA-Z0-9]+)(?:\?.*)?$/),s="png"===(l?l[1].toLowerCase():"jpg")?"image/png":"image/jpeg",d=new FormData;d.append("file",{uri:o,name:n,type:s}),d.append("filename",n),d.append("dog_id",e.id),d.append("trail_id",""),d.append("user_id","");const c=await fetch(`${i.API_URL}/uploads`,{method:"POST",headers:{Authorization:`Bearer ${t.accessToken}`,accept:"application/json"},body:d});if(!c.ok){const e=await c.text();throw new Error(`Upload failed: ${c.status} ${e}`)}const u=await c.json(),f=u.public_url||u.publicUrl||u.url;if(!f)throw new Error("Upload did not return a public URL");a.image=f}catch(n){throw console.error("Error uploading dog photo during update:",n),n}console.log("updateDogProfile - profileToSend before PUT:",a);const o=await fetch(`${i.API_URL}/dog/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.accessToken}`},body:JSON.stringify(a)});if(!o.ok){const e=await o.json();throw new Error(e.detail?.[0]?.msg||"Failed to update dog profile")}const r=await o.json();return l(e=>e.map(e=>e.id===r.id?r:e)),r},[t]);return(0,o.useMemo)(()=>({dogProfile:f,dogProfiles:r,activeDogId:s,setActiveDogId:d,isDogProfileLoading:c,hasDogProfile:r.length>0,refreshDogProfile:y,createDogProfile:h,updateDogProfile:p}),[f,r,s,c,y,h,p])})},6746(e,t,a){"use strict";a.r(t),a.d(t,{TrailsContext:()=>l,useTrails:()=>s});var o=a(6665),r=a(2790),n=a(3353),i=a(5938);const[l,s]=(0,r.default)(()=>{const{user:e,session:t}=(0,n.useAuth)(),[a,r]=(0,o.useState)([]),[l,s]=(0,o.useState)([]),[d,c]=(0,o.useState)(!0),[u,f]=(0,o.useState)(!0),g=(0,o.useCallback)(async()=>{if(e&&t)try{console.log("Loading trails for user:",e.id);const a=await fetch(`${i.API_URL}/trail`,{headers:{Authorization:`Bearer ${t?.accessToken}`}});if(a.ok){const e=await a.json();r(e||[])}else console.error("Failed to load trails:",a.status),r([])}catch(a){console.error("Failed to load trails:",a)}finally{c(!1)}else try{const e=await fetch(`${i.API_URL}/trail`);if(e.ok){const t=await e.json();r(t||[])}else console.error("Failed to load trails (public):",e.status),r([])}catch(o){console.error("Failed to load trails:",o),r([])}finally{c(!1)}},[e,t]),y=(0,o.useCallback)(async()=>{if(!t?.accessToken)return s([]),void f(!1);try{console.log("Loading my trails for user:",e?.id);const a=await fetch(`${i.API_URL}/trail/me`,{headers:{Authorization:`Bearer ${t?.accessToken}`}});if(a.ok){const e=await a.json();s(e||[])}else console.error("Failed to load my trails:",a.status),s([])}catch(a){console.error("Failed to load saved trails:",a),s([])}finally{f(!1)}},[e,t]);(0,o.useEffect)(()=>{g(),y()},[g,y]);const h=(0,o.useCallback)(async a=>{if(!e)throw console.error("No user logged in"),new Error("Must be logged in to save trails");if(!t?.accessToken)throw console.error("No session/access token available"),new Error("Must be logged in to save trails");try{console.log("Saving trail for user via API:",e.id);const n=e=>e&&0!==e.length?e.map(e=>[e.longitude,e.latitude]):[],l={name:a.name,distance:a.distance,duration:a.duration,path:n(a.coordinates),photo:a.photo,city:a.city,country:a.country,description:a.description,tags:a.tags,elevation:a.elevation,surface_type:a.surfaceType,difficulty:a.difficulty,location:a.location,pace:a.pace,speed:a.speed,max_elevation:a.maxElevation,rating:a.rating,review:a.review,environment_tags:a.environment_tags},s=t.accessToken,d="string"===typeof l.photo&&l.photo&&!l.photo.startsWith("http"),c="object"===typeof l.photo&&null!==l.photo,u=Object.assign({},l);(d||c)&&(u.photo=void 0);const f=await fetch(`${i.API_URL}/trail/me`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(u)});if(!f.ok){const e=await f.text();throw console.error("Failed to save trail via API:",f.status,e),new Error("Failed to save trail")}const g=await f.json();if(r(e=>[g,...e]),d||c)try{const e=new FormData;if(c)e.append("file",l.photo),e.append("filename",l.photo.name||`trail_${Date.now()}.jpg`);else{const t=l.photo,a=t.split("/"),o=a[a.length-1]||`trail_${Date.now()}.jpg`,r=o.match(/\.([a-zA-Z0-9]+)(?:\?.*)?$/),n="png"===(r?r[1].toLowerCase():"jpg")?"image/png":"image/jpeg";e.append("file",{uri:t,name:o,type:n}),e.append("filename",o)}e.append("trail_id",g.id),e.append("dog_id",""),e.append("user_id","");const t=await fetch(`${i.API_URL}/uploads`,{method:"POST",headers:{Authorization:`Bearer ${s}`,accept:"application/json"},body:e});if(t.ok){const e=await t.json(),a=e.public_url||e.publicUrl||e.url;if(a){const e=await fetch(`${i.API_URL}/trail/${g.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(Object.assign({},g,{photo:a}))});if(e.ok){const t=await e.json();r(e=>e.map(e=>e.id===t.id?t:e))}else console.error("Failed to patch trail with uploaded photo")}}else console.error("Trail photo upload failed during create:",await t.text())}catch(o){console.error("Error uploading trail photo after create:",o)}return g}catch(n){throw console.error("Failed to save trail:",n),n}},[e,t]),p=(0,o.useCallback)(async e=>{try{if(console.log("Deleting trail via API:",e),!t?.accessToken)throw new Error("Not authenticated");const a=await fetch(`${i.API_URL}/trail/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t.accessToken}`}});if(204!==a.status){const e=await a.text();throw console.error("Failed to delete trail:",a.status,e),new Error("Failed to delete trail")}r(t=>t.filter(t=>t.id!==e))}catch(a){throw console.error("Failed to delete trail:",a),a}},[t]),m=(0,o.useCallback)(e=>{const t=a.find(t=>t.id===e);return t||("demo-trail"===e?{id:"demo-trail",name:"Scenic Coastal Walk",distance:5.2,duration:3600,coordinates:[{latitude:50.81999932593175,longitude:-.1443926504884132},{latitude:50.81982005377856,longitude:-.14389605957015306},{latitude:50.8195735534442,longitude:-.14290287773496857},{latitude:50.81976403108945,longitude:-.14245949298612004},{latitude:50.819651985510006,longitude:-.1415904588798469},{latitude:50.819360665744455,longitude:-.141129338740825},{latitude:50.81955114425804,longitude:-.14054407087405707},{latitude:50.8194278935438,longitude:-.1397814491065219},{latitude:50.819282233189426,longitude:-.1389301503892284},{latitude:50.819696803774036,longitude:-.13903656272921694},{latitude:50.81999932593175,longitude:-.13919618123853184},{latitude:50.82010016621547,longitude:-.13853997181101363},{latitude:50.82041389015009,longitude:-.138220734792327},{latitude:50.82055954697452,longitude:-.13852223642078343},{latitude:50.82086206354296,longitude:-.13829167635185513}],city:"Brighton",country:"UK",difficulty:"Easy",pace:"11:32",maxElevation:45,date:Date.now(),environment_tags:["Beach","Sunny","Paved"],rating:4.5,review:"A beautiful walk along the seafront. Very dog friendly!"}:void 0)},[a]),b=(0,o.useCallback)(async(e,a,o=10)=>{try{if(console.log("Loading nearby trails:",{latitude:e,longitude:a,distanceKm:o}),"number"===typeof e&&"number"===typeof a&&t?.accessToken)try{const r=await fetch(`${i.API_URL}/trail/nearby?latitude=${encodeURIComponent(e)}&longitude=${encodeURIComponent(a)}&distance_km=${encodeURIComponent(o)}`,{headers:{Authorization:`Bearer ${t.accessToken}`}});if(r.ok){return await r.json()}return 404===r.status?(console.warn("Nearby trails endpoint returned 404 (no trails)"),[]):(console.error("Failed to load nearby trails from API:",r.status),[])}catch(r){return console.error("Error calling nearby trails API:",r),[]}return[]}catch(n){return console.error("Failed to load nearby trails:",n),[]}},[t]),x=(0,o.useCallback)(async(e,a)=>{try{if(console.log("Updating trail name via API:",e,a),!t?.accessToken)throw new Error("Not authenticated");const o=await fetch(`${i.API_URL}/trail/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t?.accessToken}`},body:JSON.stringify({name:a})});if(!o.ok){const e=await o.text();throw new Error(e||"Failed to update")}const n=await o.json();r(t=>t.map(t=>t.id===e?n:t))}catch(o){throw console.error("Failed to update trail name:",o),o}},[t]),j=(0,o.useCallback)(async(e,a)=>{try{if(console.log("Updating trail photo via API:",e),!t?.accessToken)throw new Error("Not authenticated");const o=await fetch(`${i.API_URL}/trail/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t?.accessToken}`},body:JSON.stringify({photo:a})});if(!o.ok){const e=await o.text();throw new Error(e||"Failed to update photo")}const n=await o.json();r(t=>t.map(t=>t.id===e?n:t))}catch(o){throw console.error("Failed to update trail photo:",o),o}},[t]),T=(0,o.useCallback)(async(e,a)=>{try{if(console.log("Updating trail details via API:",e,a),!t?.accessToken)throw new Error("Not authenticated");const o=await fetch(`${i.API_URL}/trail/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t?.accessToken}`},body:JSON.stringify(a)});if(!o.ok){const e=await o.text();throw new Error(e||"Failed to update details")}const n=await o.json();r(t=>t.map(t=>t.id===e?n:t))}catch(o){throw console.error("Failed to update trail details:",o),o}},[]),w=(0,o.useCallback)(async e=>{try{console.log("Loading trail with user data via API:",e);const t=await fetch(`${i.API_URL}/trail/${e}`);if(!t.ok)return void console.error("Failed to fetch trail:",t.status);return await t.json()}catch(t){return void console.error("Failed to load trail with user:",t)}},[]),C=(0,o.useCallback)(async t=>{if(!e)throw console.error("No user logged in"),new Error("Must be logged in to save trails");try{console.log("Saving trail bookmark:",t);const e=a.find(e=>e.id===t);e&&s(t=>[e,...t])}catch(o){throw console.error("Failed to save trail bookmark:",o),o}},[e,a]),k=(0,o.useCallback)(async t=>{if(!e)throw console.error("No user logged in"),new Error("Must be logged in to remove saved trails");try{console.log("Removing trail bookmark:",t),s(e=>e.filter(e=>e.id!==t))}catch(a){throw console.error("Failed to remove trail bookmark:",a),a}},[e]),P=(0,o.useCallback)(e=>l.some(t=>t.id===e),[l]);return(0,o.useMemo)(()=>({trails:a,savedTrails:l,isLoading:d,isSavedLoading:u,saveTrail:h,deleteTrail:p,getTrailById:m,updateTrailName:x,updateTrailPhoto:j,updateTrailDetails:T,loadNearbyTrails:b,saveTrailBookmark:C,removeTrailBookmark:k,isTrailSaved:P,getTrailWithUser:w}),[a,l,d,u,h,p,m,x,j,T,b,C,k,P,w])})},5938(e,t,a){"use strict";a.r(t),a.d(t,{API_URL:()=>o,base64UrlToBuffer:()=>r,bufferToBase64Url:()=>n,firebaseAuthExchange:()=>c,webauthnAuthOptions:()=>s,webauthnAuthVerify:()=>d,webauthnRegisterOptions:()=>i,webauthnRegisterVerify:()=>l});const o=("undefined"!==typeof window?window.__EXPO_PUBLIC_API_URL__:void 0)||"https://api.tailtrails.club";function r(e){const t=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),a="function"===typeof atob?atob(t):Buffer.from(t,"base64").toString("binary"),o=a.length,r=new Uint8Array(o);for(let n=0;n<o;++n)r[n]=a.charCodeAt(n);return r}function n(e){const t=e instanceof Uint8Array?e:new Uint8Array(e);let a="";for(let o=0;o<t.byteLength;o++)a+=String.fromCharCode(t[o]);return("function"===typeof btoa?btoa(a):Buffer.from(a,"binary").toString("base64")).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function i(e,t){const a=await fetch(`${o}/webauthn/register/options`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,name:t})});if(!a.ok){const e=await a.json().catch(()=>({}));throw new Error(e.detail||"Failed to get registration options")}return a.json()}async function l(e){const t=await fetch(`${o}/webauthn/register/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.detail||"Failed to verify registration")}return t.json()}async function s(e){const t=await fetch(`${o}/webauthn/auth/options`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.detail||"Failed to get auth options")}return t.json()}async function d(e){const t=await fetch(`${o}/webauthn/auth/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.detail||"Failed to verify authentication")}return t.json()}async function c(e){const t=await fetch(`${o}/auth/firebase`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_token:e})});if(!t.ok){const e=await t.json().catch(()=>({}));throw new Error(e.detail?.[0]?.msg||e.detail||"Failed to authenticate with Firebase")}return t.json()}console.log("Current API URL:",o)},7705(e,t,a){"use strict";a.r(t),a.d(t,{createUserWithEmailAndPassword:()=>s,default:()=>f,getFirebaseAuth:()=>u,signInWithEmailAndPassword:()=>l,signInWithGoogle:()=>c,updateProfile:()=>d});let o=null,r=null;let n=null;function i(){return n||(n=async function(){a(8506);const e=a(8506),t="function"===typeof e?e():e.default?e.default():e();return o=t,r="native",{signInWithEmailAndPassword:async(e,a,o)=>(await t.signInWithEmailAndPassword(a,o),{user:t.currentUser}),createUserWithEmailAndPassword:async(e,a,o)=>(await t.createUserWithEmailAndPassword(a,o),{user:t.currentUser}),updateProfile:async(e,a)=>{const o=e||t.currentUser;if(!o)throw new Error("No authenticated user to update");return o.updateProfile(a)},signInWithGoogle:async(a,o,r)=>{const n=(e.GoogleAuthProvider||t.GoogleAuthProvider).credential(r||null,o||null);await t.signInWithCredential(n);const i=t.currentUser;if(!i)throw new Error("Failed to sign in with Google");return{idToken:await i.getIdToken(),user:i}}}}(),n)}async function l(e,t,a){return(await i()).signInWithEmailAndPassword(e,t,a)}async function s(e,t,a){return(await i()).createUserWithEmailAndPassword(e,t,a)}async function d(e,t){return(await i()).updateProfile(e,t)}async function c(e,t,a){const o=await i();if(!o.signInWithGoogle)throw new Error("Google sign-in not supported by this implementation");return o.signInWithGoogle(e,t,a)}function u(){return o||i().catch(()=>{}),o}const f={getFirebaseAuth:u,signInWithEmailAndPassword:l,createUserWithEmailAndPassword:s,updateProfile:d}},594(e,t,a){"use strict";a.r(t),a.d(t,{DOG_SIZES:()=>o,PERSONALITY_TAGS:()=>r,RECALL_RELIABILITY_OPTIONS:()=>n});const o=["XS","S","M","L","XL"],r=["Friendly","Shy","Energetic","Calm","Social","Independent","Playful","Curious","Barky","Reactive","Easily Triggered","Gentle","Protective","Anxious","Confident","Food-Motivated","Quiet","Adventurous","Lazy","Affectionate","Dominant","Submissive","Fearful","Obedient","Stubborn","High-Prey-Drive","Leash-Pulling","Good-With-Dogs","Good-With-Kids"],n=["Poor","Fair","Good","Excellent"]},9269(e,t,a){"use strict";function o(e,t){const a=r(t.latitude-e.latitude),o=r(t.longitude-e.longitude),n=r(e.latitude),i=r(t.latitude),l=Math.sin(a/2)*Math.sin(a/2)+Math.sin(o/2)*Math.sin(o/2)*Math.cos(n)*Math.cos(i);return 6371*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))}function r(e){return e*Math.PI/180}function n(e){if(e.length<2)return 0;let t=0;for(let a=0;a<e.length-1;a++){t+=o(e[a],e[a+1])}return 1e3*t}function i(e){if(e<1e3)return`${Math.round(e)}m`;return`${(e/1e3).toFixed(2)}km`}function l(e){const t=Math.floor(e/3600),a=Math.floor(e%3600/60),o=e%60;return t>0?`${t}h ${a}m`:a>0?`${a}m ${o}s`:`${o}s`}function s(e){const t=new Date(e),a=new Date,o=Math.floor((a.getTime()-t.getTime())/864e5);return 0===o?`Today at ${t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`:1===o?`Yesterday at ${t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})}`:t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}a.r(t),a.d(t,{calculateDistance:()=>o,calculateTotalDistance:()=>n,formatDate:()=>s,formatDistance:()=>i,formatDuration:()=>l})},4492(e,t,a){"use strict";a.r(t),a.d(t,{customAlphabet:()=>o,nanoid:()=>r});const o=(e,t=21)=>(a=t)=>{let o="",r=0|a;for(;r--;)o+=e[Math.random()*e.length|0];return o},r=(e=21)=>{let t="",a=0|e;for(;a--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[64*Math.random()|0];return t}},8627(e,t,a){a(6665);function o(e){return null}e.exports=o,e.exports.default=o},8506(e){function t(){throw new Error("@react-native-firebase is not available in web builds.")}e.exports=t,e.exports.default=t},3229(e,t,a){"use strict";e.exports=a.p+"static/media/icon.f99e957780228420852c.png"}},t={};function a(o){var r=t[o];if(void 0!==r)return r.exports;var n=t[o]={exports:{}};return e[o].call(n.exports,n,n.exports,a),n.exports}a.m=e,(()=>{var e=[];a.O=(t,o,r,n)=>{if(!o){var i=1/0;for(c=0;c<e.length;c++){for(var[o,r,n]=e[c],l=!0,s=0;s<o.length;s++)(!1&n||i>=n)&&Object.keys(a.O).every(e=>a.O[e](o[s]))?o.splice(s--,1):(l=!1,n<i&&(i=n));if(l){e.splice(c--,1);var d=r();void 0!==d&&(t=d)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[o,r,n]}})(),a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce((t,o)=>(a.f[o](e,t),t),[])),a.u=e=>"static/js/"+e+"."+{684:"efca5d87",888:"8c99ba14",908:"88be4c33"}[e]+".chunk.js",a.miniCssF=e=>{},a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="web:";a.l=(o,r,n,i)=>{if(e[o])e[o].push(r);else{var l,s;if(void 0!==n)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var u=d[c];if(u.getAttribute("src")==o||u.getAttribute("data-webpack")==t+n){l=u;break}}l||(s=!0,(l=document.createElement("script")).charset="utf-8",a.nc&&l.setAttribute("nonce",a.nc),l.setAttribute("data-webpack",t+n),l.src=o),e[o]=[r];var f=(t,a)=>{l.onerror=l.onload=null,clearTimeout(g);var r=e[o];if(delete e[o],l.parentNode&&l.parentNode.removeChild(l),r&&r.forEach(e=>e(a)),t)return t(a)},g=setTimeout(f.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=f.bind(null,l.onerror),l.onload=f.bind(null,l.onload),s&&document.head.appendChild(l)}}})(),a.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.p="/",(()=>{var e={792:0};a.f.j=(t,o)=>{var r=a.o(e,t)?e[t]:void 0;if(0!==r)if(r)o.push(r[2]);else{var n=new Promise((a,o)=>r=e[t]=[a,o]);o.push(r[2]=n);var i=a.p+a.u(t),l=new Error;a.l(i,o=>{if(a.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var n=o&&("load"===o.type?"missing":o.type),i=o&&o.target&&o.target.src;l.message="Loading chunk "+t+" failed.\n("+n+": "+i+")",l.name="ChunkLoadError",l.type=n,l.request=i,r[1](l)}},"chunk-"+t,t)}},a.O.j=t=>0===e[t];var t=(t,o)=>{var r,n,[i,l,s]=o,d=0;if(i.some(t=>0!==e[t])){for(r in l)a.o(l,r)&&(a.m[r]=l[r]);if(s)var c=s(a)}for(t&&t(o);d<i.length;d++)n=i[d],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(c)},o=self.webpackChunkweb=self.webpackChunkweb||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var o=a.O(void 0,[589],()=>a(389));o=a.O(o)})();
//# sourceMappingURL=main.3bb0f869.js.map